"use strict";(self.webpackChunkweb_cms_qtmt=self.webpackChunkweb_cms_qtmt||[]).push([[40],{2040:(te,g,s)=>{s.r(g),s.d(g,{DeviceModule:()=>V});var m=s(9808),d=s(8753),e=s(5e3),b=s(6675),f=s(8215),r=s(2382),u=s(5330),v=s(6015),p=s(9783),_=s(845),C=s(5787),T=s(1424),y=s(2537);function Z(i,a){1&i&&(e.TgZ(0,"div"),e._uU(1," *C\u1ea7n \u0111i\u1ec1n t\xean cho Tr\u1ea1m."),e.qZA())}function w(i,a){1&i&&(e.TgZ(0,"div"),e._uU(1," *T\xean Tr\u1ea1m d\xe0i \xedt nh\u1ea5t 2 k\xfd t\u1ef1."),e.qZA())}function D(i,a){if(1&i&&(e.TgZ(0,"small",16),e.YNc(1,Z,2,0,"div",17),e.YNc(2,w,2,0,"div",17),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.name.invalid),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.name.errors.minlength)}}let E=(()=>{class i{constructor(t,n,o,c,h){this.ref=t,this.config=n,this.formBuilder=o,this.dHttpService=c,this.messageService=h,this.title="Th\xeam m\u1edbi Tr\u1ea1m quan tr\u1eafc"}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",[r.kI.required,r.kI.minLength(2)]],mac:["",[r.kI.required]]}),this.config.data&&(this.company=this.config.data.company,this.title=this.config.data.title,this.formGroup.setValue({name:this.company.name,description:this.company.description?this.company.description:""}))}onSubmit(){this.company?this.onEdit():this.onAdd()}onAdd(){let t=this.formGroup.value.mac.split("-").join("");this.dHttpService.create(this.formGroup.value.name,t).subscribe({next:n=>{200===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea1o C\xf4ng ty th\xe0nh c\xf4ng"}),this.ref.close("success")):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})}onEdit(){}onDestroy(){this.ref.destroy()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.E7),e.Y36(u.S),e.Y36(r.qu),e.Y36(v.x),e.Y36(p.ez))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-create-device"]],decls:24,vars:4,consts:[[3,"formGroup","ngSubmit"],[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["for","name"],[1,"ml-2","text-red-500"],["id","name","type","text","aria-describedby","name-help","pInputText","","formControlName","name"],["id","name-help","class","text-red-500",4,"ngIf"],["formControlName","mac","mask","****-****-****","styleClass","w-full","characterPattern","[a-f0-9]"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","submit","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled"],["id","name-help",1,"text-red-500"],[4,"ngIf"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.TgZ(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return n.onDestroy()}),e.qZA()(),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),e._uU(10,"T\xean Tr\u1ea1m"),e.TgZ(11,"span",9),e._uU(12,"(*)"),e.qZA()(),e._UZ(13,"input",10),e.YNc(14,D,3,2,"small",11),e.qZA(),e.TgZ(15,"div",7)(16,"label"),e._uU(17,"\u0110\u1ecba ch\u1ec9 MAC"),e.TgZ(18,"span",9),e._uU(19,"(*)"),e.qZA()(),e._UZ(20,"p-inputMask",12),e.qZA()()(),e.TgZ(21,"div",13)(22,"button",14),e.NdJ("click",function(){return n.onDestroy()}),e.qZA(),e._UZ(23,"button",15),e.qZA()()()),2&t&&(e.Q6J("formGroup",n.formGroup),e.xp6(4),e.Oqu(n.title),e.xp6(10),e.Q6J("ngIf",n.formGroup.controls.name.invalid&&n.formGroup.controls.name.touched),e.xp6(9),e.Q6J("disabled",n.formGroup.invalid))},directives:[r._Y,r.JL,r.sg,_.Hq,C.H,r.Fj,T.o,r.JJ,r.u,m.O5,y.vy],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}"]}),i})();var x=s(5941),A=s(5431),P=s(9269),M=s(8386),S=s(7658),l=s(8952),U=s(9955),q=s(4132),B=s(97);const O=["divBound"],I=["divTable"],H=["divPaginator"];function J(i,a){1&i&&(e.TgZ(0,"tr")(1,"th",27),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",28),e._uU(4,"T\xean "),e._UZ(5,"p-sortIcon",29),e.qZA(),e.TgZ(6,"th",30),e._uU(7,"M\xf4 t\u1ea3"),e.qZA(),e.TgZ(8,"th",31),e._uU(9,"MAC"),e.qZA(),e.TgZ(10,"th",32),e._uU(11,"Khu \u0111\xf4 th\u1ecb"),e.qZA(),e.TgZ(12,"th",32),e._uU(13,"Khu ch\u1ee9c n\u0103ng"),e.qZA(),e.TgZ(14,"th",33),e._uU(15,"Th\u1eddi gian t\u1ea1o "),e._UZ(16,"p-sortIcon",34),e.qZA(),e.TgZ(17,"th",35),e._uU(18,"C\u1eadp nh\u1eadt "),e._UZ(19,"p-sortIcon",36),e.qZA()())}function R(i,a){if(1&i&&(e.TgZ(0,"tr",37)(1,"td",27),e._uU(2),e.qZA(),e.TgZ(3,"td",30),e._uU(4),e.qZA(),e.TgZ(5,"td",30),e._uU(6),e.qZA(),e.TgZ(7,"td",31),e._uU(8),e.qZA(),e.TgZ(9,"td",32),e._uU(10),e.qZA(),e.TgZ(11,"td",32),e._uU(12),e.qZA(),e.TgZ(13,"td",31),e._uU(14),e.qZA(),e.TgZ(15,"td",31),e._uU(16),e.qZA()()),2&i){const t=a.$implicit,n=a.rowIndex,o=e.oxw(2);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+n),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(o.macDivision(t.mac)),e.xp6(2),e.Oqu(t.area_name),e.xp6(2),e.Oqu(t.floc_name),e.xp6(2),e.Oqu(o.convertTime(t.created_at)),e.xp6(2),e.Oqu(o.convertTime(t.updated_at))}}function k(i,a){1&i&&(e.TgZ(0,"div",38),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function F(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onAdd()}),e.qZA()}}function Y(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",40),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onEdit()}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",!t.currentDevice)}}function N(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"p-splitButton",41),e.NdJ("onClick",function(){return e.CHM(t),e.oxw(2).onViewDetail()}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("showTransitionOptions","200ms")("hideTransitionOptions","200ms")("model",t.moreCommands)("disabled",!t.currentDevice)}}const L=function(){return[15,20,30,50]};function Q(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4),e._UZ(3,"p-breadcrumb",5),e.TgZ(4,"div",6)(5,"h3",7),e._UZ(6,"i",8),e._uU(7,"Danh s\xe1ch Tr\u1ea1m quan tr\u1eafc "),e.qZA()(),e.TgZ(8,"div",9,10)(10,"p-table",11),e.NdJ("selectionChange",function(o){return e.CHM(t),e.oxw().currentDevice=o})("onRowSelect",function(o){return e.CHM(t),e.oxw().onRowSelect(o)})("onRowUnselect",function(o){return e.CHM(t),e.oxw().onRowUnselect(o)}),e.YNc(11,J,20,0,"ng-template",12),e.YNc(12,R,17,9,"ng-template",13),e.YNc(13,k,2,0,"ng-template",14),e.qZA()()(),e.TgZ(14,"div",15,16)(16,"div",17)(17,"div",18),e.YNc(18,F,1,0,"button",19),e.YNc(19,Y,1,1,"button",20),e.YNc(20,N,1,4,"p-splitButton",21),e.qZA(),e.TgZ(21,"div",22)(22,"p-paginator",23),e.NdJ("onPageChange",function(o){return e.CHM(t),e.oxw().onPageChange(o)}),e.qZA()(),e.TgZ(23,"div",24)(24,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(25,"span",26),e._uU(26),e.qZA()()()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(7),e.Q6J("selection",t.currentDevice)("value",t.devices)("scrollable",!0)("loading",t.loading),e.xp6(8),e.Q6J("ngIf",t.permission.device.create),e.xp6(1),e.Q6J("ngIf",t.permission.device.edit),e.xp6(1),e.Q6J("ngIf",t.permission.device.self),e.xp6(2),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(17,L))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function G(i,a){1&i&&(e._UZ(0,"i",49),e.TgZ(1,"span",50),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function W(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-messages",43),e.YNc(2,G,3,0,"ng-template",44),e.qZA()(),e.TgZ(3,"div",45)(4,"div",46),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",47),e.TgZ(6,"span",48),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const $=[{path:"",component:(()=>{class i{constructor(t,n,o,c,h,K,X,ee){this.dHttpService=t,this.messageService=n,this.renderer=o,this.dialogService=c,this.permissionService=h,this.router=K,this.confirmService=X,this.userService=ee,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.devices=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-62}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t="";return t=this.windowWidth<576?.95*this.windowWidth+"px":this.windowWidth>=576&&this.windowWidth<768?.55*this.windowWidth+"px":this.windowWidth>=768&&this.windowWidth<992?.45*this.windowWidth+"px":this.windowWidth>=992&&this.windowWidth<1400?.4*this.windowWidth+"px":.3*this.windowWidth+"px",t}ngOnInit(){this.myAccount=this.userService.getUserFromStorage(),this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfDevices())})}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd chung",disabled:!0},{label:"Danh s\xe1ch C\xf4ng ty",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"},this.moreCommands=[{label:"X\xf3a b\u1ecf",icon:"fa-solid fa-minus",disabled:!0,command:()=>{this.onDelete()}}]}fetchListOfDevices(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getList(void 0,this.itemsPerPage,this.offset).subscribe({next:t=>{200===t.status?(this.devices=t.metadata.docs,this.totalItems=t.metadata.total,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentDevice=void 0):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDevices()}onReSync(){this.fetchListOfDevices()}onRowSelect(t){this.moreCommands[0].disabled=!this.permission.device.delete||!this.currentDevice}onRowUnselect(t){this.moreCommands[0].disabled=!this.permission.device.delete||!this.currentDevice}onAdd(){this.dialogService.open(E,{showHeader:!1,height:"365px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfDevices()})}onEdit(){this.dialogService.open(x.q,{data:{device:this.currentDevice,title:"C\u1eadp nh\u1eadt Tr\u1ea1m quan tr\u1eafc",editable:this.permission.device.edit},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onDestroy.subscribe(()=>{this.fetchListOfDevices()})}onViewDetail(){this.dialogService.open(x.q,{data:{device:this.currentDevice},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}})}onDelete(){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Tr\u1ea1m "${this.currentDevice.name}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Tr\u1ea1m quan tr\u1eafc",icon:"pi pi-info-circle"}).then(t=>{t&&this.dHttpService.delete(this.currentDevice._id).subscribe({next:n=>{200===n.status?(this.fetchListOfDevices(),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a Tr\u1ea1m quan tr\u1eafc th\xe0nh c\xf4ng"})):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})}).catch(t=>{})}macDivision(t){return`${t.substring(0,4)}-${t.substring(4,8)}-${t.substring(8,12)}`}convertTime(t){return b.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}onComeback(){localStorage.removeItem(f.o.USER),sessionStorage.removeItem(f.o.ACC),this.router.navigate(["/come-back"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.x),e.Y36(p.ez),e.Y36(e.Qsj),e.Y36(u.xA),e.Y36(A.$),e.Y36(d.F0),e.Y36(P.I),e.Y36(M.K))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-device-management"]],viewQuery:function(t,n){if(1&t&&(e.Gf(O,5,e.SBq),e.Gf(I,5,e.SBq),e.Gf(H,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(n.divBound=o.first),e.iGM(o=e.CRH())&&(n.divTable=o.first),e.iGM(o=e.CRH())&&(n.divPaginator=o.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"page-content","mt-1"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus","class","mx-1",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen","class","mr-1",3,"disabled","click",4,"ngIf"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],[2,"min-width","200px"],[2,"min-width","150px"],["pSortableColumn","created_at",2,"min-width","200px"],["field","created_at"],["pSortableColumn","updated_at",2,"min-width","200px"],["field","updated_at"],[3,"pSelectableRow"],[1,"p-fluid","p-2"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus",1,"mx-1",3,"click"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen",1,"mr-1",3,"disabled","click"],["label","Chi ti\u1ebft","icon","fa-solid fa-wand-sparkles",3,"showTransitionOptions","hideTransitionOptions","model","disabled","onClick"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,n){if(1&t&&(e.YNc(0,Q,27,18,"div",0),e.YNc(1,W,8,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Q6J("ngIf",n.permission.device.self)("ngIfElse",o)}},directives:[m.O5,S.a,l.iA,p.jx,l.lQ,l.fz,l.Ei,_.Hq,C.H,U.a,q.D,B.V],styles:[""]}),i})()}];let j=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[d.Bz.forChild($)],d.Bz]}),i})();var z=s(6939);let V=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[m.ez,j,z.m]]}),i})()}}]);