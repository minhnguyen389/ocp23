"use strict";(self.webpackChunkweb_radacam=self.webpackChunkweb_radacam||[]).push([[523],{7523:(de,b,a)=>{a.r(b),a.d(b,{DashboardModule:()=>le});var v=a(9808),f=a(8753),S=a(6675),E=a(8215),e=a(5e3),_=a(1489),m=a(9783),T=a(5330),c=a(8952),w=a(5861),A=a(1764),g=a.n(A),I=a(4327),M=a(4313),P=a(1135);let Z=(()=>{class n{constructor(){this.sourceEvent=new P.X(null),this.currentEvent=this.sourceEvent.asObservable()}changeCurrentEvent(t){this.sourceEvent.next(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Y=a(388),h=a(3725),J=a(5077),x=a(2382),L=a(1424),N=a(845),U=a(4119);const B=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function k(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",14)(2,"input",15),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw(2).rangeTimes=r}),e.qZA()(),e.TgZ(3,"div",16)(4,"div",17)(5,"span")(6,"button",18),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onClear()}),e.qZA(),e.TgZ(7,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onSearch()}),e.qZA(),e.TgZ(8,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).exportExcell()}),e.qZA()(),e.TgZ(9,"span")(10,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onBack()}),e.qZA(),e.TgZ(11,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onNext()}),e.qZA()()()()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("showDropdowns",!0)("locale",e.DdM(11,B))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(5),e.Q6J("disabled",!(t.station&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate)),e.xp6(1),e.Q6J("disabled",!t.eventLogs||0==t.eventLogs.length),e.xp6(2),e.Q6J("disabled",!(t.station&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate)),e.xp6(1),e.Q6J("disabled",!(t.station&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate))}}function O(n,o){if(1&n&&e.YNc(0,k,12,12,"div",12),2&n){const t=e.oxw();e.Q6J("ngIf",1==t.tabIndex)}}function H(n,o){1&n&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",24),e._uU(4,"Th\u1eddi gian"),e.qZA(),e.TgZ(5,"th",25),e._uU(6,"T\u1ed1c \u0111\u1ed9 (km/h)"),e.qZA(),e.TgZ(7,"th",26),e._uU(8,"Bi\u1ec3n s\u1ed1"),e.qZA(),e.TgZ(9,"th",26),e._uU(10,"Ph\u01b0\u01a1ng ti\u1ec7n"),e.qZA(),e.TgZ(11,"th",26),e._uU(12,"Vi ph\u1ea1m"),e.qZA()())}function Q(n,o){if(1&n&&(e.TgZ(0,"td",23),e._uU(1),e.qZA()),2&n){const t=e.oxw().rowIndex;e.xp6(1),e.Oqu(t+1)}}function R(n,o){if(1&n&&(e.TgZ(0,"td",23),e._uU(1),e.qZA()),2&n){const t=e.oxw().rowIndex,i=e.oxw();e.xp6(1),e.hij("",(i.currentPage-1)*i.itemsPerPage+1+t," ")}}function F(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Xe m\xe1y"),e.qZA())}function q(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"\xd4 t\xf4"),e.qZA())}function V(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"N/A"),e.qZA())}function j(n,o){1&n&&(e.TgZ(0,"span",32),e._uU(1,"Kh\xf4ng"),e.qZA())}function z(n,o){1&n&&(e.TgZ(0,"span",33),e._uU(1,"C\xf3"),e.qZA())}function X(n,o){if(1&n&&(e.TgZ(0,"tr",27),e.YNc(1,Q,2,1,"td",28),e.YNc(2,R,2,1,"td",28),e.TgZ(3,"td",24),e._uU(4),e.qZA(),e.TgZ(5,"td",25),e._uU(6),e.qZA(),e.TgZ(7,"td",26),e._uU(8),e.qZA(),e.TgZ(9,"td",26),e.YNc(10,F,2,0,"span",29),e.YNc(11,q,2,0,"span",29),e.YNc(12,V,2,0,"span",29),e.qZA(),e.TgZ(13,"td",26),e.YNc(14,j,2,0,"span",30),e.YNc(15,z,2,0,"span",31),e.qZA()()),2&n){const t=o.$implicit,i=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(1),e.Q6J("ngIf",0==i.tabIndex),e.xp6(1),e.Q6J("ngIf",1==i.tabIndex),e.xp6(2),e.Oqu(i.convertTime(t.event_time)),e.xp6(2),e.Oqu(t.speed),e.xp6(2),e.Oqu(t.number_plate),e.xp6(2),e.Q6J("ngIf",1==t.vehicle_type),e.xp6(1),e.Q6J("ngIf",0==t.vehicle_type),e.xp6(1),e.Q6J("ngIf",-1==t.vehicle_type),e.xp6(2),e.Q6J("ngIf",!t.overspeed),e.xp6(1),e.Q6J("ngIf",t.overspeed)}}function $(n,o){1&n&&(e.TgZ(0,"div",34),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}let K=(()=>{class n{constructor(t,i,r,s,p){this.sHttpService=t,this.messageService=i,this.dialogService=r,this.eService=s,this.sioService=p,this.tabIndex=0,this.loading=!1,this.eventLogs=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.socketDatas=[]}ngOnDestroy(){this.socketIoSub&&this.socketIoSub.unsubscribe(),this.eService.changeCurrentEvent(null)}ngOnChanges(t){let i=t.station;i&&i.currentValue&&(this.eventLogs=[])}ngOnInit(){this.socketIoSub=this.sioService.currentSocketMsg.subscribe(t=>{if(t)try{let i=JSON.parse(t);this.socketDatas.find(s=>s._id==i._id)||(this.station?this.station._id==i.monitor_id&&this.socketDatas.push(i):this.socketDatas.push(i)),this.socketDatas.length>100&&this.socketDatas.shift(),this.eventLogs=this.socketDatas.slice().reverse()}catch(i){console.error(i)}})}onRowSelect(t){this.eService.changeCurrentEvent(this.currentEvent)}onRowUnselect(t){this.eService.changeCurrentEvent(null)}convertTime(t){return S.I.isoToVnTime(t)}fetchLogOfStation(){this.sHttpService.getLogOfStation(this.station._id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:t=>{200===t.status?(this.eventLogs=t.metadata.docs,this.totalItems=t.metadata.total):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onClear(){this.startDate=void 0,this.endDate=void 0,this.rangeTimes=void 0}onSearch(){this.startDate=this.rangeTimes&&this.rangeTimes.startDate?g().utc(this.rangeTimes.startDate).subtract(7,"hours").format():void 0,this.endDate=this.rangeTimes&&this.rangeTimes.endDate?g().utc(this.rangeTimes.endDate).subtract(7,"hours").format():void 0,this.fetchLogOfStation()}onBack(){this.currentPage--,this.currentPage<1&&(this.currentPage=1),this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchLogOfStation()}onNext(){this.currentPage++,this.currentPage>this.totalItems/this.itemsPerPage&&(this.currentPage=Math.ceil(this.totalItems/this.itemsPerPage)),this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchLogOfStation()}handleChange(t){this.tabIndex=t.index,this.rangeTimes=void 0}exportExcell(){this.sHttpService.getLogOfStation(this.station._id,this.startDate,this.endDate,this.totalItems,0).subscribe({next:t=>{200===t.status?this.exportEx(t.metadata.docs):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}exportEx(t){var i=this;return(0,w.Z)(function*(){let r=i.rangeTimes&&i.rangeTimes.startDate?g().utc(i.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",s=i.rangeTimes&&i.rangeTimes.endDate?g().utc(i.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const p=new M.Workbook,d=p.addWorksheet("EVENT"),u=d.getRow(2);u.height=20,d.mergeCells(2,1,2,6),u.getCell(1).value="C\xc1C S\u1ef0 KI\u1ec6N",u.getCell(1).font={name:"Times New Roman",size:12,bold:!0},u.getCell(1).alignment={horizontal:"center"};const C=d.getRow(3);d.mergeCells(3,1,3,6),C.getCell(1).value=`T\u1eeb ${r} \u0111\u1ebfn ${s}`,C.getCell(1).font={name:"Times New Roman",size:11},C.getCell(1).alignment={horizontal:"center"};let D=[];t.forEach((l,ce)=>{let me=[ce+1,i.convertTime(l.event_time),l.speed,l.number_plate,1==l.vehicle_type?"\xd4 t\xf4":0==l.vehicle_type?"Xe m\xe1y":"N/A",l.overspeed?"C\xf3":"Kh\xf4ng"];D.push(me)}),d.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Th\u1eddi gian",filterButton:!1},{name:"T\u1ed1c \u0111\u1ed9 (km/h)",filterButton:!1},{name:"Bi\u1ec3n s\u1ed1",filterButton:!1},{name:"Ph\u01b0\u01a1ng ti\u1ec7n",filterButton:!1},{name:"Vi ph\u1ea1m",filterButton:!1}],rows:D}),p.xlsx.writeBuffer().then(l=>{(0,I.saveAs)(new Blob([l],{type:"application/octet-stream"}),"Bao_cao_su_kien.xlsx")})})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.P),e.Y36(m.ez),e.Y36(T.xA),e.Y36(Z),e.Y36(Y.y))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-station-event"]],inputs:{station:"station"},features:[e.TTD],decls:12,vars:5,consts:[[1,"relative","h-full","w-full"],["divBound",""],[1,"tabm"],[3,"onChange"],["header","Live",3,"selected"],["header","Logs"],[1,"tbl"],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","p-fluid grid",4,"ngIf"],[1,"p-fluid","grid"],[1,"field","col-12","md:col-7","mb-1"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"field","col-12","md:col-5"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file excel",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chevron-left",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chevron-right",3,"disabled","click"],[2,"width","60px","max-width","60px"],[2,"min-width","180px"],[2,"min-width","120px"],[2,"min-width","100px"],[3,"pSelectableRow"],["style","width:60px; max-width:60px;",4,"ngIf"],[4,"ngIf"],["class","p-1 bg-green-500 text-white",4,"ngIf"],["class","p-1 bg-red-500 text-white",4,"ngIf"],[1,"p-1","bg-green-500","text-white"],[1,"p-1","bg-red-500","text-white"],[1,"p-fluid","p-2"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0,1)(2,"div",2)(3,"p-tabView",3),e.NdJ("onChange",function(s){return i.handleChange(s)}),e._UZ(4,"p-tabPanel",4)(5,"p-tabPanel",5),e.qZA()(),e.TgZ(6,"div",6)(7,"p-table",7),e.NdJ("selectionChange",function(s){return i.currentEvent=s})("onRowSelect",function(s){return i.onRowSelect(s)})("onRowUnselect",function(s){return i.onRowUnselect(s)}),e.YNc(8,O,1,1,"ng-template",8),e.YNc(9,H,13,0,"ng-template",9),e.YNc(10,X,16,11,"ng-template",10),e.YNc(11,$,2,0,"ng-template",11),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("selected",!0),e.xp6(3),e.Q6J("selection",i.currentEvent)("value",i.eventLogs)("scrollable",!0)("loading",i.loading))},directives:[h.xf,h.x4,c.iA,m.jx,v.O5,J.SP,x.Fj,L.o,x.JJ,x.On,N.Hq,U.u,c.Ei],styles:[".tabm[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:50px;width:100%}.tbl[_ngcontent-%COMP%]{position:absolute;top:50px;left:0;bottom:0;width:100%}"]}),n})();var y=a(2340),G=a(5034);function W(n,o){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"img",5),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("src",t.photo_url,e.LSH)}}function ee(n,o){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"video",6),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("src",t.video_url,e.LSH)}}let te=(()=>{class n{constructor(t,i,r,s){this.sHttpService=t,this.messageService=i,this.dialogService=r,this.eService=s,this.tabIndex=0,this.loading=!1}ngOnDestroy(){this.subEvent&&this.subEvent.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){this.subEvent=this.eService.currentEvent.subscribe(t=>{t?(this.photo_url="assets/no_img.jpg",this.video_url="",this.eventLog=t,this.eventLog.photo_filename&&(this.photo_url=y.N.url.BASE_IMG+this.eventLog.photo_filename),this.eventLog.video_filename&&1==this.tabIndex&&this.convertVideo(this.eventLog._id)):(this.photo_url="",this.video_url="")})}convertVideo(t){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.sHttpService.convertVideo(t).subscribe({next:i=>{200===i.status?(this.eventLog=i.metadata,this.video_url=y.N.url.BASE_IMG+this.eventLog.video_filename,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}handleChange(t){this.tabIndex=t.index,this.eventLog&&1==this.tabIndex&&!this.video_url&&this.convertVideo(this.eventLog._id)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.P),e.Y36(m.ez),e.Y36(T.xA),e.Y36(Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-detail-event"]],decls:6,vars:4,consts:[[3,"onChange"],["header","Photo",3,"selected"],["header","Video"],[4,"ngIf"],[3,"show"],["width","100%",3,"src"],["width","100%","controls","","preload","none","poster","assets/video-poster.png",3,"src"]],template:function(t,i){1&t&&(e.TgZ(0,"p-tabView",0),e.NdJ("onChange",function(s){return i.handleChange(s)}),e._UZ(1,"p-tabPanel",1)(2,"p-tabPanel",2),e.qZA(),e.YNc(3,W,2,1,"div",3),e.YNc(4,ee,2,1,"div",3),e._UZ(5,"ngx-loading",4)),2&t&&(e.xp6(1),e.Q6J("selected",!0),e.xp6(2),e.Q6J("ngIf",0==i.tabIndex),e.xp6(1),e.Q6J("ngIf",1==i.tabIndex),e.xp6(1),e.Q6J("show",i.loading))},directives:[h.xf,h.x4,v.O5,G.RJ],styles:[""]}),n})();function ne(n,o){1&n&&(e.TgZ(0,"tr")(1,"th",12),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",13),e._uU(4,"Tr\u1ea1m "),e._UZ(5,"p-sortIcon",14),e.qZA()())}function ie(n,o){if(1&n&&(e.TgZ(0,"tr",15)(1,"td",12),e._uU(2),e.qZA(),e.TgZ(3,"td",16),e._uU(4),e.qZA()()),2&n){const t=o.$implicit,i=o.rowIndex;e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Oqu(t.name)}}function oe(n,o){1&n&&(e.TgZ(0,"div",17),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}const ae=[{path:"",component:(()=>{class n{constructor(t,i,r,s){this.sHttpService=t,this.messageService=i,this.dialogService=r,this.router=s,this.stations=[],this.loading=!1}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){this.fetchListOfStations()}fetchListOfStations(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.sHttpService.getList(999999,0).subscribe({next:t=>{200===t.status?(this.stations=t.metadata.docs,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentStation=void 0):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convertTime(t){return S.I.isoToVnTime(t)}onComeback(){localStorage.removeItem(E.o.USER),sessionStorage.removeItem(E.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.P),e.Y36(m.ez),e.Y36(T.xA),e.Y36(f.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-dashboard-management"]],decls:13,vars:5,consts:[[1,"relative","h-full","w-full"],["divBound",""],[1,"absolute","h-full","w-full"],[1,"grid","grid-nogutter","h-full","w-full"],[1,"col-12","md:col-2","border-right-1","border-gray-300"],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"col-12","md:col-5","border-right-1","border-gray-300"],[3,"station"],[1,"col-12","md:col-5"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","150px"],["field","name"],[3,"pSelectableRow"],[2,"min-width","150px"],[1,"p-fluid","p-2"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"p-table",5),e.NdJ("selectionChange",function(s){return i.currentStation=s}),e.YNc(6,ne,6,0,"ng-template",6),e.YNc(7,ie,5,3,"ng-template",7),e.YNc(8,oe,2,0,"ng-template",8),e.qZA()(),e.TgZ(9,"div",9),e._UZ(10,"app-station-event",10),e.qZA(),e.TgZ(11,"div",11),e._UZ(12,"app-detail-event"),e.qZA()()()()),2&t&&(e.xp6(5),e.Q6J("selection",i.currentStation)("value",i.stations)("scrollable",!0)("loading",i.loading),e.xp6(5),e.Q6J("station",i.currentStation))},directives:[c.iA,m.jx,c.lQ,c.fz,c.Ei,K,te],styles:[""]}),n})()}];let se=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[f.Bz.forChild(ae)],f.Bz]}),n})();var re=a(8772);let le=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[v.ez,se,re.m]]}),n})()}}]);