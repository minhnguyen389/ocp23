"use strict";(self.webpackChunkweb_radacam=self.webpackChunkweb_radacam||[]).push([[679],{6015:(F,A,s)=>{s.d(A,{x:()=>e});var T=s(520),h=s(2340),D=s(5e3);let e=(()=>{class C{constructor(m){this.http=m}getList(m,g,r,P){let u=new T.LE;return u=u.append("limit",r),u=u.append("offset",P),m&&(u=u.append("monitor_id",m)),g&&(u=u.append("company_id",g)),this.http.get(`${h.N.url.BASE_URL}/device`,{params:u})}getDetail(m){return this.http.get(`${h.N.url.BASE_URL}/device/${m}`)}create(m,g){let r=new T.LE;return r=r.append("name",m),r=r.append("device_type",g),this.http.post(`${h.N.url.BASE_URL}/device`,r)}edit(m,g,r,P,u,d,R){let c=new T.LE;return g&&(c=c.append("name",g)),r&&(c=c.append("description",r)),P&&(c=c.append("ip",P)),u&&(c=c.append("edge_storage_ip",u)),d&&(c=c.append("eth_mac",d)),R&&(c=c.append("monitor_id",R)),this.http.put(`${h.N.url.BASE_URL}/device/${m}`,c)}delete(m){return this.http.delete(`${h.N.url.BASE_URL}/device/${m}`)}getLogOfOnOff(m,g,r,P,u){let d=new T.LE;return m&&(d=d.append("device_id",m)),d=d.append("limit",P),d=d.append("offset",u),(null!=g||null!=g)&&(d=d.append("time_start",g)),(null!=r||null!=r)&&(d=d.append("time_end",r)),this.http.get(`${h.N.url.BASE_URL}/device/logonoff`,{params:d})}}return C.\u0275fac=function(m){return new(m||C)(D.LFG(T.eN))},C.\u0275prov=D.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},9182:(F,A,s)=>{s.r(A),s.d(A,{ReportModule:()=>Ae});var T=s(9808),h=s(8753),D=s(5861),e=s(5e3),C=s(6675),S=s(4327),m=s(4313),g=s(1764),r=s.n(g),P=s(5268),u=s.n(P),d=s(8215),R=s(4416),c=s(1489),E=s(9783),k=s(5330),q=s(5431),M=s(7658),Z=s(2382),I=s(1424),x=s(845),B=s(5787),Y=s(5077),J=s(4119),_=s(8952),U=s(4132),H=s(97);const Q=["divBound"],z=["divHeader"],G=["divTable"],$=["divPaginator"];function j(o,a){1&o&&(e.TgZ(0,"tr")(1,"th",36),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",37),e._uU(4,"Tr\u1ea1m"),e.qZA(),e.TgZ(5,"th",38),e._uU(6,"\u0110i\u1ec7n \xe1p(V)"),e.qZA(),e.TgZ(7,"th",38),e._uU(8,"D\xf2ng \u0111i\u1ec7n(A)"),e.qZA(),e.TgZ(9,"th",38),e._uU(10,"C\xf4ng su\u1ea5t(W)"),e.qZA(),e.TgZ(11,"th",39),e._uU(12,"Th\u1eddi gian"),e._UZ(13,"p-sortIcon",40),e.qZA()())}function W(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td",36),e._uU(2),e.qZA(),e.TgZ(3,"td",37),e._uU(4),e.qZA(),e.TgZ(5,"td",38),e._uU(6),e.qZA(),e.TgZ(7,"td",38),e._uU(8),e.qZA(),e.TgZ(9,"td",38),e._uU(10),e.qZA(),e.TgZ(11,"td",41),e._uU(12),e.qZA()()),2&o){const i=a.$implicit,t=a.rowIndex,n=e.oxw();e.xp6(2),e.Oqu((n.currentPage-1)*n.itemsPerPage+1+t),e.xp6(2),e.Oqu(n.station_name),e.xp6(2),e.Oqu(i.u),e.xp6(2),e.Oqu(i.i),e.xp6(2),e.Oqu(i.p),e.xp6(2),e.Oqu(n.convertTime(i.updated_at))}}function V(o,a){1&o&&(e.TgZ(0,"div",42),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn thi\u1ebft b\u1ecb v\xe0 th\u1eddi gian t\xecm ki\u1ebfm ph\xf9 h\u1ee3p. "),e.qZA())}function K(o,a){1&o&&(e._UZ(0,"i",50),e.TgZ(1,"span",51),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function X(o,a){if(1&o){const i=e.EpF();e.TgZ(0,"div",43)(1,"p-messages",44),e.YNc(2,K,3,0,"ng-template",45),e.qZA()(),e.TgZ(3,"div",46)(4,"div",47),e.NdJ("click",function(){return e.CHM(i),e.oxw().onGoBackHome()}),e._UZ(5,"span",48),e.TgZ(6,"span",49),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const ee=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}},te=function(){return[15,20,30,50]};r().extend(u());let ie=(()=>{class o{constructor(i,t,n,l,v,p){this.sHttpService=i,this.messageService=t,this.renderer=n,this.dialogService=l,this.permissionService=v,this.router=p,this.logUIPs=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let n=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${n}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(i=>{i&&(this.permission=i,this.initForm())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"Ch\u1ec9 s\u1ed1 U-I-P",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}onPickStation(){this.dialogService.open(R.L,{data:{stationIns:[]},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(t=>{t&&(this.station_name=t.name,this.station_id=t._id)})}fetchListOfStationUIP(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.sHttpService.getLogUIP(this.station_id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:i=>{200===i.status?(this.logUIPs=i.metadata.docs,this.totalItems=i.metadata.total,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convertTime(i){return C.I.isoToVnTime(i)}convertTimestamp(i){return i?r()(i).format("HH:mm:ss DD/MM/YYYY"):"N/A"}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){this.sHttpService.getLogUIP(this.station_id,this.startDate,this.endDate,this.totalItems,0).subscribe({next:i=>{200===i.status?this.exportEx(i.metadata.docs):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}exportEx(i){var t=this;return(0,D.Z)(function*(){let n=t.rangeTimes&&t.rangeTimes.startDate?r().utc(t.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",l=t.rangeTimes&&t.rangeTimes.endDate?r().utc(t.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const v=new m.Workbook,p=v.addWorksheet("UIP"),b=p.getRow(2);b.height=20,p.mergeCells(2,1,2,6),b.getCell(1).value="CH\u1ec8 S\u1ed0 \u0110O U-I-P C\u1ee6A TR\u1ea0M",b.getCell(1).font={name:"Times New Roman",size:12,bold:!0},b.getCell(1).alignment={horizontal:"center"};const y=p.getRow(3);p.mergeCells(3,1,3,6),y.getCell(1).value=`T\u1eeb ${n} \u0111\u1ebfn ${l}`,y.getCell(1).font={name:"Times New Roman",size:11},y.getCell(1).alignment={horizontal:"center"};let w=[];i.forEach((f,O)=>{let L=[O+1,t.station_name,f.u,f.i,f.p,t.convertTime(f.updated_at)];w.push(L)}),p.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Tr\u1ea1m",filterButton:!1},{name:"\u0110i\u1ec7n \xe1p (V)",filterButton:!1},{name:"D\xf2ng \u0111i\u1ec7n (A)",filterButton:!1},{name:"C\xf4ng su\u1ea5t (W)",filterButton:!1},{name:"Th\u1eddi gian",filterButton:!1}],rows:w}),v.xlsx.writeBuffer().then(f=>{(0,S.saveAs)(new Blob([f],{type:"application/octet-stream"}),"Bao_cao_chi_so_UIP.xlsx")})})()}onClear(){this.station_id=void 0,this.station_name=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate?(this.startDate=r().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=r().utc(this.rangeTimes.endDate).subtract(7,"hours").format(),this.fetchListOfStationUIP()):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Vui l\xf2ng ch\u1ecdn kho\u1ea3ng th\u1eddi gian t\xecm ki\u1ebfm!"})}onPageChange(i){this.currentPage=i.page+1,this.itemsPerPage=i.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfStationUIP()}onReSync(){this.fetchListOfStationUIP()}onComeback(){localStorage.removeItem(d.o.USER),sessionStorage.removeItem(d.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(c.P),e.Y36(E.ez),e.Y36(e.Qsj),e.Y36(k.xA),e.Y36(q.$),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-report-uip"]],viewQuery:function(i,t){if(1&i&&(e.Gf(Q,5,e.SBq),e.Gf(z,5,e.SBq),e.Gf(G,5,e.SBq),e.Gf($,5,e.SBq)),2&i){let n;e.iGM(n=e.CRH())&&(t.divBound=n.first),e.iGM(n=e.CRH())&&(t.divHeader=n.first),e.iGM(n=e.CRH())&&(t.divTable=n.first),e.iGM(n=e.CRH())&&(t.divPaginator=n.first)}},decls:41,vars:25,consts:[[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn tr\u1ea1m","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file excel",3,"disabled","click"],[1,"absolute","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],["noPermission",""],[2,"width","60px","max-width","60px"],[2,"min-width","300px"],[2,"min-width","150px"],["pSortableColumn","last_time_updated",2,"min-width","200px"],["field","last_time_updated"],[2,"min-width","200px"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0,1),e.NdJ("resize",function(){return t.onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",2,3),e._UZ(4,"p-breadcrumb",4),e.TgZ(5,"div",5)(6,"h3",6),e._UZ(7,"i",7),e._uU(8,"Ch\u1ec9 s\u1ed1 \u0111o U-I-P c\u1ee7a tr\u1ea1m "),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",10)(13,"input",11),e.NdJ("ngModelChange",function(l){return t.station_name=l}),e.qZA(),e.TgZ(14,"button",12),e.NdJ("click",function(){return t.onPickStation()}),e.qZA()()()(),e.TgZ(15,"div",13)(16,"input",14),e.NdJ("ngModelChange",function(l){return t.rangeTimes=l}),e.qZA()(),e.TgZ(17,"div",15)(18,"div",16)(19,"span")(20,"button",17),e.NdJ("click",function(){return t.onClear()}),e.qZA(),e.TgZ(21,"button",18),e.NdJ("click",function(){return t.onSearch()}),e.qZA(),e.TgZ(22,"button",19),e.NdJ("click",function(){return t.exportExcell()}),e.qZA()()()()()(),e.TgZ(23,"div",20,21)(25,"p-table",22),e.YNc(26,j,14,0,"ng-template",23),e.YNc(27,W,13,6,"ng-template",24),e.YNc(28,V,2,0,"ng-template",25),e.qZA()(),e.TgZ(29,"div",26,27)(31,"div",28),e._UZ(32,"div",29),e.TgZ(33,"div",30)(34,"p-paginator",31),e.NdJ("onPageChange",function(l){return t.onPageChange(l)}),e.qZA()(),e.TgZ(35,"div",32)(36,"button",33),e.NdJ("click",function(){return t.onReSync()}),e.qZA(),e.TgZ(37,"span",34),e._uU(38),e.qZA()()()()(),e.YNc(39,X,8,0,"ng-template",null,35,e.W1O)),2&i&&(e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(9),e.Q6J("ngModel",t.station_name),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(23,ee))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(5),e.Q6J("disabled",!(t.station_id&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate)),e.xp6(1),e.Q6J("disabled",!t.logUIPs||0==t.logUIPs.length),e.xp6(3),e.Q6J("value",t.logUIPs)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(24,te))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,""))},directives:[M.a,Z.Fj,I.o,Z.JJ,Z.On,x.Hq,B.H,Y.SP,J.u,_.iA,E.jx,_.lQ,_.fz,U.D,H.V],styles:[""]}),o})();var N=s(6015);const ne=["divBound"],oe=["divTable"],se=["divPaginator"];function ae(o,a){1&o&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"#"),e.qZA(),e._UZ(3,"th",23),e.TgZ(4,"th",24),e._uU(5,"T\xean "),e._UZ(6,"p-sortIcon",25),e.qZA(),e.TgZ(7,"th",26),e._uU(8,"M\xf4 t\u1ea3"),e.qZA(),e.TgZ(9,"th",27),e._uU(10,"Lo\u1ea1i"),e.qZA(),e.TgZ(11,"th",28),e._uU(12,"Thu\u1ed9c tr\u1ea1m"),e.qZA()())}const re=function(o){return{"background-color":o}};function le(o,a){if(1&o&&(e.TgZ(0,"tr",29)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",23),e._UZ(4,"p-tableRadioButton",30),e.qZA(),e.TgZ(5,"td",26),e._uU(6),e.qZA(),e.TgZ(7,"td",26),e._uU(8),e.qZA(),e.TgZ(9,"td",27),e._uU(10),e.qZA(),e.TgZ(11,"td",28),e._uU(12),e.qZA()()),2&o){const i=a.$implicit,t=a.rowIndex,n=e.oxw();e.Q6J("ngStyle",e.VKq(8,re,n.isIn(i))),e.xp6(2),e.Oqu((n.currentPage-1)*n.itemsPerPage+1+t),e.xp6(2),e.Q6J("value",i)("disabled",n.isDisabled(i)),e.xp6(2),e.Oqu(i.name),e.xp6(2),e.Oqu(i.description),e.xp6(2),e.Oqu(n.getDeviceType(i.device_type)),e.xp6(2),e.Oqu(null==i.monitor_id?null:i.monitor_id.name)}}function de(o,a){1&o&&(e._UZ(0,"i",33),e.TgZ(1,"span",34),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function me(o,a){1&o&&(e.TgZ(0,"p-messages",31),e.YNc(1,de,3,0,"ng-template",32),e.qZA())}const ue=function(){return[15,20,30,50]};let pe=(()=>{class o{constructor(i,t,n,l,v,p){this.ref=i,this.config=t,this.dHttpService=n,this.messageService=l,this.renderer=v,this.router=p,this.title="Ch\u1ecdn tr\u1ea1m",this.devices=[],this.selectedDevices=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngAfterViewInit(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-40}px`)}onWindowResize(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-40}px`)}ngOnInit(){this.config.data&&(this.deviceIns=this.config.data.station,this.fetchListOfDevices())}fetchListOfDevices(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getList(void 0,void 0,this.itemsPerPage,this.offset).subscribe({next:i=>{200===i.status?(this.devices=i.metadata.docs,this.totalItems=i.metadata.total,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}loadStatus(){this.devices.forEach(i=>{i.is_used=!1,this.deviceIns&&this.deviceIns._id==i._id&&(i.is_used=!0)})}getDeviceType(i){let t="N/A";return"camera"==i?t="Camera":"gateway"==i?t="Gateway":"radar"==i?t="Radar":"light"==i?t="\u0110\xe8n strobe":"ledscreen"==i&&(t="M\xe0n h\xecnh"),t}onPageChange(i){this.currentPage=i.page+1,this.itemsPerPage=i.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDevices()}onReSync(){this.fetchListOfDevices()}onSubmit(){this.ref.close(this.selectedDevices)}onDestroy(){this.ref.destroy()}isRowSelectable(i){return!i.data.is_used}isDisabled(i){return!!i.is_used}isIn(i){return i.is_used?"#cae6fc":null}onComeback(){localStorage.removeItem(d.o.USER),sessionStorage.removeItem(d.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(k.E7),e.Y36(k.S),e.Y36(N.x),e.Y36(E.ez),e.Y36(e.Qsj),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-pick-device"]],viewQuery:function(i,t){if(1&i&&(e.Gf(ne,5,e.SBq),e.Gf(oe,5,e.SBq),e.Gf(se,5,e.SBq)),2&i){let n;e.iGM(n=e.CRH())&&(t.divBound=n.first),e.iGM(n=e.CRH())&&(t.divTable=n.first),e.iGM(n=e.CRH())&&(t.divPaginator=n.first)}},decls:26,vars:17,consts:[[1,"absolute","top-0","left-0","bottom-0","right-0",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"page-content"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","dataKey","_id","scrollHeight","flex",3,"value","selection","selectionPageOnly","rowSelectable","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],[1,"absolute","bottom-0","left-0","w-full","p-1","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Ch\u1ecdn","icon","fa-solid fa-check",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text",3,"click"],[1,"ml-1"],["noPermission",""],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],[2,"min-width","100px"],[2,"min-width","200px"],[3,"ngStyle"],[3,"value","disabled"],["severity","error"],["pTemplate",""],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0,1),e.NdJ("resize",function(){return t.onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",2)(3,"div",3)(4,"span",4),e._uU(5),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return t.onDestroy()}),e.qZA()(),e.TgZ(7,"div",6,7)(9,"p-table",8),e.NdJ("selectionChange",function(l){return t.selectedDevices=l}),e.YNc(10,ae,13,0,"ng-template",9),e.YNc(11,le,13,10,"ng-template",10),e.qZA()()(),e.TgZ(12,"div",11,12)(14,"div",13)(15,"div",14)(16,"button",15),e.NdJ("click",function(){return t.onSubmit()}),e.qZA(),e.TgZ(17,"button",16),e.NdJ("click",function(){return t.onDestroy()}),e.qZA()(),e.TgZ(18,"div",17)(19,"p-paginator",18),e.NdJ("onPageChange",function(l){return t.onPageChange(l)}),e.qZA()(),e.TgZ(20,"div",19)(21,"button",20),e.NdJ("click",function(){return t.onReSync()}),e.qZA(),e.TgZ(22,"span",21),e._uU(23),e.qZA()()()()(),e.YNc(24,me,2,0,"ng-template",null,22,e.W1O)),2&i&&(e.xp6(5),e.Oqu(t.title),e.xp6(4),e.Q6J("value",t.devices)("selection",t.selectedDevices)("selectionPageOnly",!0)("rowSelectable",t.isRowSelectable)("scrollable",!0)("loading",t.loading),e.xp6(7),e.Q6J("disabled",!t.selectedDevices||0==t.selectedDevices.length),e.xp6(3),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(16,ue))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Displaying ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage," of ",t.totalItems,""))},directives:[x.Hq,B.H,_.iA,E.jx,_.lQ,_.fz,T.PC,_.GE,U.D,H.V],styles:[""]}),o})();const ce=["divBound"],ge=["divHeader"],he=["divTable"],fe=["divPaginator"];function ve(o,a){1&o&&(e.TgZ(0,"tr")(1,"th",36),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",37),e._uU(4,"Thi\u1ebft b\u1ecb "),e._UZ(5,"p-sortIcon",38),e.qZA(),e.TgZ(6,"th",39),e._uU(7,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(8,"th",40),e._uU(9,"Th\u1eddi gian"),e._UZ(10,"p-sortIcon",41),e.qZA()())}const _e=function(o){return{"background-color":o}};function Te(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td",36),e._uU(2),e.qZA(),e.TgZ(3,"td",42),e._uU(4),e.qZA(),e.TgZ(5,"td",39)(6,"span",43),e._uU(7),e.qZA()(),e.TgZ(8,"td",44),e._uU(9),e.qZA()()),2&o){const i=a.$implicit,t=a.rowIndex,n=e.oxw();e.xp6(2),e.Oqu((n.currentPage-1)*n.itemsPerPage+1+t),e.xp6(2),e.Oqu(i.device_id),e.xp6(2),e.Q6J("ngStyle",e.VKq(5,_e,n.getStatus(i).color)),e.xp6(1),e.Oqu(n.getStatus(i).status),e.xp6(2),e.Oqu(n.convertTime(i.updated_at))}}function Ce(o,a){1&o&&(e.TgZ(0,"div",45),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn thi\u1ebft b\u1ecb v\xe0 th\u1eddi gian t\xecm ki\u1ebfm ph\xf9 h\u1ee3p. "),e.qZA())}function be(o,a){1&o&&(e._UZ(0,"i",53),e.TgZ(1,"span",54),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Pe(o,a){if(1&o){const i=e.EpF();e.TgZ(0,"div",46)(1,"p-messages",47),e.YNc(2,be,3,0,"ng-template",48),e.qZA()(),e.TgZ(3,"div",49)(4,"div",50),e.NdJ("click",function(){return e.CHM(i),e.oxw().onGoBackHome()}),e._UZ(5,"span",51),e.TgZ(6,"span",52),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const ye=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}},Ee=function(){return[15,20,30,50]};r().extend(u());const Ze=[{path:"uip",component:ie},{path:"onoff",component:(()=>{class o{constructor(i,t,n,l,v,p){this.dHttpService=i,this.messageService=t,this.renderer=n,this.dialogService=l,this.permissionService=v,this.router=p,this.deviceLogs=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let n=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${n}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(i=>{i&&(this.permission=i,this.initForm())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"Tr\u1ea1ng th\xe1i ho\u1ea1t \u0111\u1ed9ng",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}onPickDevice(){this.dialogService.open(pe,{data:{deviceIns:[]},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(t=>{t&&(this.device_name=t.name,this.device_id=t._id)})}fetchListOfDeviceLogs(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getLogOfOnOff(this.device_id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:i=>{200===i.status?(this.deviceLogs=i.metadata.docs,this.totalItems=i.metadata.total,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convertTime(i){return C.I.isoToVnTime(i)}convertTimestamp(i){return i?r()(i).format("HH:mm:ss DD/MM/YYYY"):"N/A"}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){this.dHttpService.getLogOfOnOff(this.device_id,this.startDate,this.endDate,this.totalItems,0).subscribe({next:i=>{200===i.status?this.exportEx(i.metadata.docs):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}exportEx(i){var t=this;return(0,D.Z)(function*(){let n=t.rangeTimes&&t.rangeTimes.startDate?r().utc(t.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",l=t.rangeTimes&&t.rangeTimes.endDate?r().utc(t.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const v=new m.Workbook,p=v.addWorksheet("STATUS"),b=p.getRow(2);b.height=20,p.mergeCells(2,1,2,4),b.getCell(1).value="TR\u1ea0NG TH\xc1I HO\u1ea0T \u0110\u1ed8NG C\u1ee6A THI\u1ebeT B\u1eca",b.getCell(1).font={name:"Times New Roman",size:12,bold:!0},b.getCell(1).alignment={horizontal:"center"};const y=p.getRow(3);p.mergeCells(3,1,3,4),y.getCell(1).value=`T\u1eeb ${n} \u0111\u1ebfn ${l}`,y.getCell(1).font={name:"Times New Roman",size:11},y.getCell(1).alignment={horizontal:"center"};let w=[];i.forEach((f,O)=>{let L=[O+1,f.device_id,t.getStatus(f).status,t.convertTime(f.updated_at)];w.push(L)}),p.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"Tr\u1ea1ng th\xe1i",filterButton:!0},{name:"Th\u1eddi gian",filterButton:!1}],rows:w}),v.xlsx.writeBuffer().then(f=>{(0,S.saveAs)(new Blob([f],{type:"application/octet-stream"}),"Bao_cao_trang_thai_thiet_bi.xlsx")})})()}onClear(){this.device_id=void 0,this.device_name=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate?(this.startDate=r().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=r().utc(this.rangeTimes.endDate).subtract(7,"hours").format(),this.fetchListOfDeviceLogs()):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Vui l\xf2ng ch\u1ecdn kho\u1ea3ng th\u1eddi gian t\xecm ki\u1ebfm!"})}onPageChange(i){this.currentPage=i.page+1,this.itemsPerPage=i.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDeviceLogs()}onReSync(){this.fetchListOfDeviceLogs()}onComeback(){localStorage.removeItem(d.o.USER),sessionStorage.removeItem(d.o.ACC),this.router.navigate(["/come-back"])}getStatus(i){let t;return i.status&&("camera"==i.device_type||"gateway"==i.device_type)&&(t={status:"\u0110ang k\u1ebft n\u1ed1i",color:"green"}),!i.status&&("camera"==i.device_type||"gateway"==i.device_type)&&(t={status:"M\u1ea5t k\u1ebft n\u1ed1i",color:"red"}),i.status&&!("camera"==i.device_type||"gateway"==i.device_type)&&(t={status:"B\xecnh th\u01b0\u1eddng",color:"green"}),!i.status&&!("camera"==i.device_type||"gateway"==i.device_type)&&(t={status:"Kh\xf4ng x\xe1c \u0111\u1ecbnh",color:"red"}),t}}return o.\u0275fac=function(i){return new(i||o)(e.Y36(N.x),e.Y36(E.ez),e.Y36(e.Qsj),e.Y36(k.xA),e.Y36(q.$),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-report-onoff"]],viewQuery:function(i,t){if(1&i&&(e.Gf(ce,5,e.SBq),e.Gf(ge,5,e.SBq),e.Gf(he,5,e.SBq),e.Gf(fe,5,e.SBq)),2&i){let n;e.iGM(n=e.CRH())&&(t.divBound=n.first),e.iGM(n=e.CRH())&&(t.divHeader=n.first),e.iGM(n=e.CRH())&&(t.divTable=n.first),e.iGM(n=e.CRH())&&(t.divPaginator=n.first)}},decls:41,vars:25,consts:[[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file excel",3,"disabled","click"],[1,"absolute","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],["noPermission",""],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","100px"],["pSortableColumn","last_time_updated",2,"min-width","200px"],["field","last_time_updated"],[2,"min-width","300px"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[2,"min-width","200px"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0,1),e.NdJ("resize",function(){return t.onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",2,3),e._UZ(4,"p-breadcrumb",4),e.TgZ(5,"div",5)(6,"h3",6),e._UZ(7,"i",7),e._uU(8,"Ho\u1ea1t \u0111\u1ed9ng c\u1ee7a thi\u1ebft b\u1ecb "),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",10)(13,"input",11),e.NdJ("ngModelChange",function(l){return t.device_name=l}),e.qZA(),e.TgZ(14,"button",12),e.NdJ("click",function(){return t.onPickDevice()}),e.qZA()()()(),e.TgZ(15,"div",13)(16,"input",14),e.NdJ("ngModelChange",function(l){return t.rangeTimes=l}),e.qZA()(),e.TgZ(17,"div",15)(18,"div",16)(19,"span")(20,"button",17),e.NdJ("click",function(){return t.onClear()}),e.qZA(),e.TgZ(21,"button",18),e.NdJ("click",function(){return t.onSearch()}),e.qZA(),e.TgZ(22,"button",19),e.NdJ("click",function(){return t.exportExcell()}),e.qZA()()()()()(),e.TgZ(23,"div",20,21)(25,"p-table",22),e.YNc(26,ve,11,0,"ng-template",23),e.YNc(27,Te,10,7,"ng-template",24),e.YNc(28,Ce,2,0,"ng-template",25),e.qZA()(),e.TgZ(29,"div",26,27)(31,"div",28),e._UZ(32,"div",29),e.TgZ(33,"div",30)(34,"p-paginator",31),e.NdJ("onPageChange",function(l){return t.onPageChange(l)}),e.qZA()(),e.TgZ(35,"div",32)(36,"button",33),e.NdJ("click",function(){return t.onReSync()}),e.qZA(),e.TgZ(37,"span",34),e._uU(38),e.qZA()()()()(),e.YNc(39,Pe,8,0,"ng-template",null,35,e.W1O)),2&i&&(e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(9),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(23,ye))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(5),e.Q6J("disabled",!t.rangeTimes||!t.rangeTimes.startDate||!t.rangeTimes.endDate),e.xp6(1),e.Q6J("disabled",!t.deviceLogs||0==t.deviceLogs.length),e.xp6(3),e.Q6J("value",t.deviceLogs)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(24,Ee))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,""))},directives:[M.a,Z.Fj,I.o,Z.JJ,Z.On,x.Hq,B.H,Y.SP,J.u,_.iA,E.jx,_.lQ,_.fz,T.PC,U.D,H.V],styles:[""]}),o})()}];let De=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[h.Bz.forChild(Ze)],h.Bz]}),o})();var we=s(8772);let Ae=(()=>{class o{}return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[T.ez,De,we.m]]}),o})()}}]);