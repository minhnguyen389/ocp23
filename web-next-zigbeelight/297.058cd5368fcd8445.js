"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[297],{5297:(j,u,a)=>{a.d(u,{_:()=>G});var e=a(5e3),p=a(8215),m=a(7789),d=a(9783),r=a(5330),g=a(9979),h=a(845),f=a(5787),_=a(9808),v=a(4204),b=a(8054),y=a(7658),l=a(8952),P=a(4132);const T=["divBound"],x=["divHeader"],S=["divContent"],C=["divTree"],D=["divTable"],E=["divPaginator"];function Z(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",14,15)(2,"app-device-tree",16),e.NdJ("onSuccess",function(o){return e.CHM(t),e.oxw(2).onSelectedNode(o)}),e.qZA()()}if(2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("treeLevel",2)("disabled_nodes",t.disabled_nodes)("template",t.template)}}function A(i,s){1&i&&e.GkF(0)}function w(i,s){if(1&i&&(e.TgZ(0,"div",14),e.YNc(1,A,1,0,"ng-container",17),e.qZA()),2&i){e.oxw(2);const t=e.MAs(13);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}const I=function(){return{height:"100%"}},M=function(){return[20,80]},k=function(){return[15,65]};function O(i,s){if(1&i&&(e.TgZ(0,"p-splitter",12),e.YNc(1,Z,3,3,"ng-template",13),e.YNc(2,w,2,1,"ng-template",13),e.qZA()),2&i){const t=e.oxw();e.Akn(e.DdM(5,I)),e.Q6J("panelSizes",e.DdM(6,M))("minSizes",e.DdM(7,k))("layout",t.layout)}}function N(i,s){1&i&&e.GkF(0)}function H(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",18,15)(3,"app-device-tree",19),e.NdJ("onSuccess",function(o){return e.CHM(t),e.oxw().onSelectedNode(o)}),e.qZA()(),e.YNc(4,N,1,0,"ng-container",17),e.qZA()}if(2&i){const t=e.oxw(),n=e.MAs(13);e.xp6(3),e.Q6J("treeType","option")("treeLevel",2)("disabled_nodes",t.disabled_nodes)("template",t.template),e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function U(i,s){1&i&&(e.TgZ(0,"th",40),e._UZ(1,"p-tableHeaderCheckbox"),e.qZA())}function R(i,s){1&i&&e._UZ(0,"th",40)}function L(i,s){if(1&i&&(e.TgZ(0,"tr")(1,"th",40),e._uU(2,"#"),e.qZA(),e.YNc(3,U,2,0,"th",41),e.YNc(4,R,1,0,"th",41),e.TgZ(5,"th",42),e._uU(6,"T\xean "),e._UZ(7,"p-sortIcon",43),e.qZA(),e.TgZ(8,"th",44),e._uU(9,"Ph\xe2n lo\u1ea1i"),e.qZA(),e.TgZ(10,"th",45),e._uU(11,"Danh m\u1ee5c"),e.qZA(),e.TgZ(12,"th",46),e._uU(13,"Lo\u1ea1i"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",t.has_multi_selection),e.xp6(1),e.Q6J("ngIf",!t.has_multi_selection)}}function B(i,s){if(1&i&&(e.TgZ(0,"td",40),e._UZ(1,"p-tableCheckbox",48),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("value",t)("disabled",n.isDisabled(t))}}function q(i,s){if(1&i&&(e.TgZ(0,"td",40),e._UZ(1,"p-tableRadioButton",49),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("value",t)}}const J=function(i){return{"background-color":i}};function Q(i,s){if(1&i&&(e.TgZ(0,"tr",47)(1,"td",40),e._uU(2),e.qZA(),e.YNc(3,B,2,2,"td",41),e.YNc(4,q,2,1,"td",41),e.TgZ(5,"td",44),e._uU(6),e.qZA(),e.TgZ(7,"td",44),e._uU(8),e.qZA(),e.TgZ(9,"td",45),e._uU(10),e.qZA(),e.TgZ(11,"td",46),e._uU(12),e.qZA()()),2&i){const t=s.$implicit,n=s.rowIndex,o=e.oxw(2);e.Q6J("ngStyle",e.VKq(9,J,o.isIn(t))),e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+n),e.xp6(1),e.Q6J("ngIf",o.has_multi_selection),e.xp6(1),e.Q6J("ngIf",!o.has_multi_selection),e.xp6(2),e.AsE("",t.name," (#",t.id,")"),e.xp6(2),e.Oqu(t.device_type.name),e.xp6(2),e.Oqu(t.device_type.specificity_name),e.xp6(2),e.hij("",t.device_type.is_combination_name," ")}}function Y(i,s){if(1&i&&(e.TgZ(0,"div",50),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. ",t.moreInfo," ")}}const W=function(){return[15,20,30,50]};function K(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",20,21)(2,"div",22),e._UZ(3,"p-breadcrumb",23),e.qZA(),e.TgZ(4,"p-table",24),e.NdJ("selectionChange",function(o){return e.CHM(t),e.oxw().selectedDeviceSubtypes=o}),e.YNc(5,L,14,2,"ng-template",25),e.YNc(6,Q,13,11,"ng-template",26),e.YNc(7,Y,2,1,"ng-template",27),e.qZA()(),e.TgZ(8,"div",28,29)(10,"div",30)(11,"div",31)(12,"button",32),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSubmit()}),e.qZA(),e.TgZ(13,"div",33)(14,"button",34),e.NdJ("click",function(){return e.CHM(t),e.oxw().onDestroy()}),e.qZA()()(),e.TgZ(15,"div",35)(16,"p-paginator",36),e.NdJ("onPageChange",function(o){return e.CHM(t),e.oxw().onPageChange(o)}),e.qZA()(),e.TgZ(17,"div",37)(18,"button",38),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(19,"span",39),e._uU(20),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("model",t.categoryLinks)("home",t.categoryHome),e.xp6(1),e.Q6J("value",t.deviceSubtypes)("selection",t.selectedDeviceSubtypes)("selectionPageOnly",!0)("rowSelectable",t.isRowSelectable)("scrollable",!0)("loading",t.loading),e.xp6(8),e.Q6J("disabled",!t.selectedDeviceSubtypes||0==t.selectedDeviceSubtypes.length),e.xp6(4),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(17,W))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Displaying ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage," of ",t.totalItems,"")}}let G=(()=>{class i{constructor(t,n,o,c,z,F){this.dstHttpService=t,this.messageService=n,this.renderer=o,this.ref=c,this.config=z,this.router=F,this.title="Ch\u1ecdn lo\u1ea1i thi\u1ebft b\u1ecb",this.deviceSubtypeIns=[],this.disabled_nodes=[],this.moreInfo='H\xe3y ch\u1ecdn m\u1ed9t "Ph\xe2n lo\u1ea1i" c\u1ee5 th\u1ec3.',this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.deviceSubtypes=[],this.template=!1,this.loading=!1}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime),this.subTreeNode&&this.subTreeNode.unsubscribe()}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let t=this.divBound.nativeElement.offsetHeight,n=this.divHeader.nativeElement.offsetHeight;this.renderer.setStyle(this.divContent.nativeElement,"height",`  ${t-n}px`),setTimeout(()=>{this.windowWidth<1025?(this.layout="vertical",setTimeout(()=>{this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${t-n-this.divPaginator.nativeElement.offsetHeight-73}px`)},50)):(this.layout="horizontal",setTimeout(()=>{this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${t-n-this.divPaginator.nativeElement.offsetHeight-33}px`)},50))},50)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.categoryHome={icon:"pi pi-home",disabled:!0},this.config.data&&(this.config.data.deviceSubtypeIns&&(this.deviceSubtypeIns=this.config.data.deviceSubtypeIns),this.config.data.title&&(this.title=this.config.data.title),this.config.data.has_multi_selection&&(this.has_multi_selection=this.config.data.has_multi_selection),this.config.data.disabled_nodes&&(this.disabled_nodes=this.config.data.disabled_nodes))}createCategoryLink(){let t=[];t.push({label:this.treeNode.label,id:this.treeNode.data,disabled:!0});let n=this.treeNode;for(;n.parent;)t.push({label:n.parent.label,id:n.parent.data,disabled:!0}),n=n.parent;this.categoryLinks=t.reverse()}processNode(){let t=this.treeNode.data.split("@");"type"===t[0]?(this.deviceTypeId=void 0,this.deviceTypeName="",this.deviceSubtypes=[],this.selectedDeviceSubtypes=void 0,this.moreInfo='H\xe3y ch\u1ecdn m\u1ed9t "Ph\xe2n lo\u1ea1i" c\u1ee5 th\u1ec3.'):"device_type"===t[0]&&(this.deviceTypeId=Number(t[1]),this.deviceTypeName=this.treeNode.label,this.selectedDeviceSubtypes=void 0,this.fetchListOfDeviceSubtypes(),this.moreInfo="")}fetchListOfDeviceSubtypes(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dstHttpService.getList(this.deviceTypeId,this.template,this.itemsPerPage,this.offset).subscribe({next:t=>{0===t.status?(this.deviceSubtypes=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDeviceSubtypes()}onReSync(){this.fetchListOfDeviceSubtypes()}onDestroy(){this.ref.destroy()}onSelectedNode(t){this.treeNode=t,this.processNode(),this.createCategoryLink()}loadStatus(){this.deviceSubtypes.forEach(t=>{t.is_used=!1,this.deviceSubtypeIns.find(n=>n.id==t.id)&&(t.is_used=!0)})}isRowSelectable(t){return!t.data.is_used}isDisabled(t){return!!t.is_used}isIn(t){return this.deviceSubtypeIns.find(n=>n.id==t.id)?"#cae6fc":null}onSubmit(){this.ref.close(this.selectedDeviceSubtypes)}onComeback(){localStorage.removeItem(p.o.USER),sessionStorage.removeItem(p.o.ACC),this.router.navigate(["/come-back"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(m.C),e.Y36(d.ez),e.Y36(e.Qsj),e.Y36(r.E7),e.Y36(r.S),e.Y36(g.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-pick-device-subtype"]],viewQuery:function(t,n){if(1&t&&(e.Gf(T,5,e.SBq),e.Gf(x,5,e.SBq),e.Gf(S,5,e.SBq),e.Gf(C,5,e.SBq),e.Gf(D,5,e.SBq),e.Gf(E,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(n.divBound=o.first),e.iGM(o=e.CRH())&&(n.divHeader=o.first),e.iGM(o=e.CRH())&&(n.divContent=o.first),e.iGM(o=e.CRH())&&(n.divTree=o.first),e.iGM(o=e.CRH())&&(n.divTable=o.first),e.iGM(o=e.CRH())&&(n.divPaginator=o.first)}},decls:14,vars:3,consts:[[1,"relative","w-full","h-full"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"absolute","bottom-0","left-0","w-full"],["divContent",""],[3,"style","panelSizes","minSizes","layout",4,"ngIf"],["class","relative h-full w-full",4,"ngIf"],["TableConent",""],[3,"panelSizes","minSizes","layout"],["pTemplate",""],[1,"relative","h-full","w-full"],["divTree",""],[3,"treeLevel","disabled_nodes","template","onSuccess"],[4,"ngTemplateOutlet"],[1,"p-fluid",2,"padding","2px"],[3,"treeType","treeLevel","disabled_nodes","template","onSuccess"],[1,"absolute","left-0","w-full"],["divTable",""],[2,"height","30px","padding","1px"],["styleClass","text-sm p-1",3,"model","home"],["styleClass","p-datatable-sm p-datatable-striped","dataKey","id","scrollHeight","flex",3,"value","selection","selectionPageOnly","rowSelectable","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","p-1","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Ch\u1ecdn","icon","fa-solid fa-check",1,"mr-1",3,"disabled","click"],[1,"flex","align-items-center","justify-content-center"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined",3,"click"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],["style","width:60px; max-width:60px;",4,"ngIf"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],[2,"min-width","200px"],[2,"min-width","150px"],[3,"ngStyle"],[3,"value","disabled"],[3,"value"],[1,"p-fluid","p-2"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0,1)(2,"div",2,3)(4,"div",4)(5,"span",5),e._uU(6),e.qZA(),e.TgZ(7,"button",6),e.NdJ("click",function(){return n.onDestroy()}),e.qZA()()(),e.TgZ(8,"div",7,8),e.YNc(10,O,3,8,"p-splitter",9),e.YNc(11,H,5,5,"div",10),e.qZA()(),e.YNc(12,K,21,18,"ng-template",null,11,e.W1O)),2&t&&(e.xp6(6),e.Oqu(n.title),e.xp6(4),e.Q6J("ngIf","horizontal"==n.layout),e.xp6(1),e.Q6J("ngIf","vertical"==n.layout))},directives:[h.Hq,f.H,_.O5,v.q,d.jx,b.a,_.tP,y.a,l.iA,l.Mo,l.lQ,l.fz,_.PC,l.UA,l.GE,P.D],styles:[""]}),i})()}}]);