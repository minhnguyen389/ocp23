"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[417],{8417:(Te,x,a)=>{a.r(x),a.d(x,{ElectricEnergyModule:()=>ye});var _=a(9808),p=a(9979),P=a(5861),e=a(5e3),b=a(6675),h=a(8215),H=a(6254),E=a(9783),v=a(5330),Z=a(845),M=a(5787),w=a(4036),m=a(2382),B=a(3300),S=a(5034);function J(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",6)(1,"label"),e._uU(2,"Ng\xe0y ghi"),e.qZA(),e.TgZ(3,"p-dropdown",14),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().day=n})("ngModelChange",function(){return e.CHM(t),e.oxw().onChange()}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("options",t.dayOption)("ngModel",t.day)}}let L=(()=>{class o{constructor(t,i,n,s,l){this.comHttpService=t,this.messageService=i,this.ref=n,this.config=s,this.router=l,this.has_change=!1,this.byOption=[{name:"Theo ng\xe0y",value:"daily"},{name:"Theo th\xe1ng",value:"monthly"}],this.dayOption=[],this.loading=!1}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){for(let t=0;t<28;t++)this.dayOption.push({name:`${t+1}`,value:`${t+1}`});this.fetchOperationSetting()}fetchOperationSetting(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.comHttpService.getSetting().subscribe({next:t=>{0===t.status?(this.setting=t.data,this.setting.power_used_day&&"0"!=this.setting.power_used_day&&(this.day=this.setting.power_used_day),this.setting.power_used_time&&""!=this.setting.power_used_time&&(this.time=this.setting.power_used_time),this.log_by=this.time&&!this.day?"daily":"monthly",this.has_change=!1,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onDestroy(){this.ref.destroy()}onChange(){this.has_change=!0}onSubmit(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.time&&"daily"==this.log_by||"monthly"==this.log_by&&this.day&&"0"!=this.day?this.comHttpService.updateSetting(this.setting.id,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.time,"daily"==this.log_by?"0":this.day).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\u1eddi gian ghi ch\u1ec9 s\u1ed1 th\xe0nh c\xf4ng"}),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.ref.destroy()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\xf4ng tin c\xe0i \u0111\u1eb7t kh\xf4ng h\u1ee3p l\u1ec7"})}onComeback(){localStorage.removeItem(h.o.USER),sessionStorage.removeItem(h.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(H.n),e.Y36(E.ez),e.Y36(v.E7),e.Y36(v.S),e.Y36(p.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-electric-energy-setting"]],decls:20,vars:8,consts:[[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["optionLabel","name","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm","placeholder","Ch\u1ecdn ki\u1ec3u ghi ch\u1ec9 s\u1ed1",3,"options","ngModel","ngModelChange"],["class","field mb-2",4,"ngIf"],[3,"ngModel","controlOnly","format","ngModelChange","timeChanged"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled","click"],[3,"show"],["optionLabel","name","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm","placeholder","Ch\u1ecdn ng\xe0y ghi ch\u1ec9 s\u1ed1",3,"options","ngModel","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"C\xe0i \u0111\u1eb7t th\u1eddi gian ghi ch\u1ec9 s\u1ed1"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label"),e._uU(9,"Ghi ch\u1ec9 s\u1ed1 theo"),e.qZA(),e.TgZ(10,"p-dropdown",7),e.NdJ("ngModelChange",function(s){return i.log_by=s})("ngModelChange",function(){return i.onChange()}),e.qZA()(),e.YNc(11,J,4,2,"div",8),e.TgZ(12,"div",6)(13,"label"),e._uU(14,"Th\u1eddi gian ghi"),e.qZA(),e.TgZ(15,"ngx-timepicker-field",9),e.NdJ("ngModelChange",function(s){return i.time=s})("timeChanged",function(){return i.onChange()}),e.qZA()()()(),e.TgZ(16,"div",10)(17,"button",11),e.NdJ("click",function(){return i.onDestroy()}),e.qZA(),e.TgZ(18,"button",12),e.NdJ("click",function(){return i.onSubmit()}),e.qZA()()(),e._UZ(19,"ngx-loading",13)),2&t&&(e.xp6(10),e.Q6J("options",i.byOption)("ngModel",i.log_by),e.xp6(1),e.Q6J("ngIf","monthly"==i.log_by),e.xp6(4),e.Q6J("ngModel",i.time)("controlOnly",!0)("format",24),e.xp6(3),e.Q6J("disabled",!i.has_change),e.xp6(1),e.Q6J("show",i.loading))},directives:[Z.Hq,M.H,w.Lt,m.JJ,m.On,_.O5,B.Ox,S.RJ],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}"]}),o})();var I=a(4327),N=a(4313),F=a(8087),U=a(1764),u=a.n(U),O=a(5268),Y=a.n(O),y=a(520),A=a(2340);let R=(()=>{class o{constructor(t){this.http=t}getList(t,i,n,s,l,g){let c=new y.LE;return t&&(c=c.append("device_id",t)),i&&(c=c.append("parameter_id",i)),n&&s&&(c=c.append("time_start",n),c=c.append("time_end",s)),c=c.append("limit",l),c=c.append("offset",g),this.http.get(`${A.N.url.BASE_URL}/power`,{params:c})}getTotal(t,i,n,s){let l=new y.LE;return t&&(l=l.append("device_id",t)),i&&(l=l.append("parameter_id",i)),n&&s&&(l=l.append("time_start",n),l=l.append("time_end",s)),this.http.get(`${A.N.url.BASE_URL}/power/sum`,{params:l})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(y.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var q=a(5431),Q=a(7658),z=a(1424),j=a(5077),$=a(4119),C=a(8952),W=a(1753),G=a(4132),V=a(97);const X=["divBound"],K=["divHeader"],ee=["divTable"],te=["divPaginator"];function ie(o,r){if(1&o&&(e.TgZ(0,"div",45)(1,"span",46),e._uU(2),e.qZA(),e.TgZ(3,"span",47),e._uU(4),e.qZA()()),2&o){const t=e.oxw(3);e.xp6(2),e.hij("T\u1ed5ng s\u1ed1 \u0111i\u1ec7n h\u1ec7 th\u1ed1ng: ",t.toDigis(t.allElectricEnergy)," (kWh)"),e.xp6(2),e.hij("T\u1ed5ng s\u1ed1 \u0111i\u1ec7n c\u1ee7a t\u1ee7: ",t.toDigis(t.totalElectricEnergy)," (kWh)")}}function ne(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",48),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",49),e._uU(4,"Thi\u1ebft b\u1ecb "),e._UZ(5,"p-sortIcon",50),e.qZA(),e.TgZ(6,"th",51),e._uU(7,"C\xf4ng t\u01a1"),e.qZA(),e.TgZ(8,"th",52),e._uU(9,"CS \u0111\u1ea7u k\u1ef3"),e.qZA(),e.TgZ(10,"th",52),e._uU(11,"CS cu\u1ed1i k\u1ef3"),e.qZA(),e.TgZ(12,"th",53),e._uU(13,"Th\u1eddi gian ghi"),e._UZ(14,"p-sortIcon",54),e.qZA(),e.TgZ(15,"th",51),e._uU(16,"S\u1ed1 \u0111i\u1ec7n (kWh)"),e.qZA()())}function oe(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"td",48),e._uU(2),e.qZA(),e.TgZ(3,"td",55),e._uU(4),e.qZA(),e.TgZ(5,"td",51),e._uU(6),e.qZA(),e.TgZ(7,"td",52),e._uU(8),e.qZA(),e.TgZ(9,"td",52),e._uU(10),e.qZA(),e.TgZ(11,"td",56),e._uU(12),e.qZA(),e.TgZ(13,"td",51),e._uU(14),e.qZA()()),2&o){const t=r.$implicit,i=r.rowIndex,n=e.oxw(3);e.xp6(2),e.Oqu((n.currentPage-1)*n.itemsPerPage+1+i),e.xp6(2),e.AsE("",t.device.name," (#",t.device_id,")"),e.xp6(2),e.Oqu(t.meter_name),e.xp6(2),e.hij(" ",t.value_processed_prev," "),e.xp6(2),e.hij("",t.value_processed," "),e.xp6(2),e.Oqu(n.convertTime(t.createdAt)),e.xp6(2),e.Oqu(n.toDigis(t.energy_number))}}function ae(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"td",48),e._uU(2,"T\u1ed5ng:"),e.qZA(),e._UZ(3,"td",57)(4,"td",52)(5,"td",52)(6,"td",52)(7,"td",56),e.TgZ(8,"td",58),e._uU(9),e.qZA()()),2&o){const t=e.oxw(3);e.xp6(9),e.Oqu(t.onSum())}}function re(o,r){1&o&&(e.TgZ(0,"div",59),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn thi\u1ebft b\u1ecb v\xe0 th\u1eddi gian t\xecm ki\u1ebfm ph\xf9 h\u1ee3p. "),e.qZA())}function se(o,r){if(1&o&&(e.TgZ(0,"p-table",39),e.YNc(1,ie,5,2,"ng-template",40),e.YNc(2,ne,17,0,"ng-template",41),e.YNc(3,oe,15,8,"ng-template",42),e.YNc(4,ae,10,1,"ng-template",43),e.YNc(5,re,2,0,"ng-template",44),e.qZA()),2&o){const t=e.oxw(2);e.Q6J("value",t.electricEnergies)("scrollable",!0)("loading",t.loading)}}function le(o,r){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"p-chart",64),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("data",t.data)("options",t.options)}}function ce(o,r){1&o&&(e.TgZ(0,"div",59),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function ge(o,r){if(1&o&&(e.TgZ(0,"div",60),e.YNc(1,le,2,2,"div",61),e.YNc(2,ce,2,0,"ng-template",null,62,e.W1O),e._UZ(4,"ngx-loading",63),e.qZA()),2&o){const t=e.MAs(3),i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",i.electricEnergies.length)("ngIfElse",t),e.xp6(3),e.Q6J("show",i.loading)}}function de(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onConfig()}),e.qZA()}}const me=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}},ue=function(){return[15,20,30,50]};function pe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"Qu\u1ea3n l\xfd \u0110i\u1ec7n n\u0103ng ti\xeau th\u1ee5 "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"div",12)(12,"input",13),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().device_name=n}),e.qZA(),e.TgZ(13,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()(),e.TgZ(14,"div",11)(15,"p-dropdown",15),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().parameter_id=n}),e.qZA()(),e.TgZ(16,"div",11)(17,"input",16),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().rangeTimes=n}),e.qZA()(),e.TgZ(18,"div",17)(19,"div",18)(20,"span")(21,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(22,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(23,"span")(24,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewList()}),e.qZA(),e.TgZ(25,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewChart()}),e.qZA(),e.TgZ(26,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportPage()}),e.qZA(),e.TgZ(27,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportAll()}),e.qZA()()()()()(),e.TgZ(28,"div",25,26),e.YNc(30,se,6,3,"p-table",27),e.YNc(31,ge,5,3,"div",28),e.qZA(),e.TgZ(32,"div",29,30)(34,"div",31)(35,"div",32),e.YNc(36,de,1,0,"button",33),e.qZA(),e.TgZ(37,"div",34)(38,"p-paginator",35),e.NdJ("onPageChange",function(n){return e.CHM(t),e.oxw().onPageChange(n)}),e.qZA()(),e.TgZ(39,"div",36)(40,"button",37),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(41,"span",38),e._uU(42),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(8),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("options",t.meterOptions)("ngModel",t.parameter_id),e.xp6(2),e.Q6J("showDropdowns",!0)("locale",e.DdM(25,me))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(7),e.Q6J("disabled",!t.electricEnergies.length||"list"==t.displayIs),e.xp6(1),e.Q6J("disabled",!t.electricEnergies.length||"chart"==t.displayIs),e.xp6(5),e.Q6J("ngIf","list"==t.displayIs),e.xp6(1),e.Q6J("ngIf","chart"==t.displayIs),e.xp6(5),e.Q6J("ngIf",t.permission.electric_energy.config),e.xp6(2),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(26,ue))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function he(o,r){1&o&&(e._UZ(0,"i",73),e.TgZ(1,"span",74),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function fe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",66)(1,"p-messages",67),e.YNc(2,he,3,0,"ng-template",68),e.qZA()(),e.TgZ(3,"div",69)(4,"div",70),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",71),e.TgZ(6,"span",72),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}u().extend(Y());const _e=[{path:"",component:(()=>{class o{constructor(t,i,n,s,l,g){this.eHttpService=t,this.messageService=i,this.renderer=n,this.dialogService=s,this.permissionService=l,this.router=g,this.displayIs="list",this.meterOptions=[{name:"T\u1ea5t c\u1ea3",value:0},{name:"C\xf4ng t\u01a1 pha 1",value:47},{name:"C\xf4ng t\u01a1 pha 2",value:48},{name:"C\xf4ng t\u01a1 pha 3",value:49}],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.electricEnergies=[],this.options={plugins:{title:{display:!0,text:"\u0110I\u1ec6N N\u0102NG TI\xcaU TH\u1ee4",fontSize:18},legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057",maxTicksLimit:10},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057",maxTicksLimit:10},grid:{color:"#ebedef"}}}},this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let n=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${n}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfElectricEnergies())})}initForm(){this.pathLinks=[{label:"V\u1eadn h\xe0nh",disabled:!0},{label:"Qu\u1ea3n l\xfd \u0111i\u1ec7n n\u0103ng",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfElectricEnergies(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.eHttpService.getList(this.device_id,this.parameter_id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:t=>{0===t.status?(this.electricEnergies=t.data.rows,this.totalItems=t.data.count,this.fetchTotalEnergyOfDevice(),this.fetchAllEnergy(),this.calEnergyNumber(this.electricEnergies),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}fetchTotalEnergyOfDevice(){this.eHttpService.getTotal(this.device_id,this.parameter_id,this.startDate,this.endDate).subscribe({next:t=>{0===t.status?this.totalElectricEnergy=Math.round(t.data/1e3):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchAllEnergy(){this.eHttpService.getTotal(void 0,void 0,this.startDate,this.endDate).subscribe({next:t=>{0===t.status?this.allElectricEnergy=Math.round(t.data/1e3):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}calEnergyNumber(t){t.forEach(i=>{i.value_processed=Math.round(i.value_processed/1e3),i.value_processed_prev=Math.round(i.value_processed_prev/1e3),i.energy_number=i.value_processed-i.value_processed_prev,47===i.parameter_id?i.meter_name="C\xf4ng t\u01a1 pha 1":48===i.parameter_id?i.meter_name="C\xf4ng t\u01a1 pha 2":49===i.parameter_id&&(i.meter_name="C\xf4ng t\u01a1 pha 3")}),this.renderChart()}renderChart(){this.data=null;let t=[],i=[],n=[],s=[];this.electricEnergies.forEach(l=>{let g=this.convertTime(l.createdAt);t.includes(g)||t.push(g),47===l.parameter_id?i.push(l.energy_number):48===l.parameter_id?n.push(l.energy_number):49===l.parameter_id&&s.push(l.energy_number)}),this.data={labels:t,datasets:[{label:"C\xf4ng t\u01a1 pha 1 (kWh)",backgroundColor:"#FFCC33",data:i},{label:"C\xf4ng t\u01a1 pha 2 (kWh)",backgroundColor:"#66CC99",data:n},{label:"C\xf4ng t\u01a1 pha 3 (kWh)",backgroundColor:"#33CCFF",data:s}]}}onSum(){let t=0;return this.electricEnergies.forEach(i=>t+=i.energy_number),t}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfElectricEnergies()}onReSync(){this.fetchListOfElectricEnergies()}onConfig(){this.dialogService.open(L,{showHeader:!1,width:"350px",height:"400px",contentStyle:{padding:"0",margin:0}})}exportAll(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.eHttpService.getList(this.device_id,this.parameter_id,this.startDate,this.endDate,this.totalItems,0).subscribe({next:t=>{if(0===t.status){let i=t.data.rows;if(this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),!i||0==i.length)return void this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"});this.calEnergyNumber(i),this.exportExcell(i,!1)}else 2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}exportPage(){this.electricEnergies&&0!=this.electricEnergies.length?this.exportExcell(this.electricEnergies,!0):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"})}exportExcell(t,i){var n=this;return(0,P.Z)(function*(){let s=n.rangeTimes&&n.rangeTimes.startDate?u().utc(n.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",l=n.rangeTimes&&n.rangeTimes.endDate?u().utc(n.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const g=new N.Workbook,c=g.addWorksheet("Bao cao dien nang tieu thu"),f=c.getRow(2);f.height=20,c.mergeCells(2,1,2,7),f.getCell(1).value="B\xc1O C\xc1O S\u1ed0 \u0110I\u1ec6N TI\xcaU TH\u1ee4",f.getCell(1).font={name:"Times New Roman",size:12,bold:!0},f.getCell(1).alignment={horizontal:"center"};const T=c.getRow(3);c.mergeCells(3,1,3,7),T.getCell(1).value=`T\u1eeb ${s} \u0111\u1ebfn ${l}`,T.getCell(1).font={name:"Times New Roman",size:11},T.getCell(1).alignment={horizontal:"center"};let D=[];t.forEach((d,k)=>{let Ce=[i?(n.currentPage-1)*n.itemsPerPage+1+k:k+1,d.device.name,d.meter_name,d.value_processed_prev,d.value_processed,n.convertTime(d.createdAt),d.energy_number];D.push(Ce)}),c.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!0,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",totalsRowLabel:"T\u1ed5ng:",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"C\xf4ng t\u01a1",filterButton:!0},{name:"CS \u0111\u1ea7u k\u1ef3",filterButton:!1},{name:"CS cu\u1ed1i k\u1ef3",filterButton:!1},{name:"Th\u1eddi gian ghi",filterButton:!1},{name:"S\u1ed1 \u0111i\u1ec7n (kWh)",totalsRowFunction:"sum",filterButton:!1}],rows:D}),g.xlsx.writeBuffer().then(d=>{(0,I.saveAs)(new Blob([d],{type:"application/octet-stream"}),"Bao_cao_dien_nang_tieu_thu.xlsx")})})()}onPickDevice(){this.dialogService.open(F.$,{data:{deviceIns:[],title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!1,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&(this.device_name=`${i.name} (#${i.id})`,this.device_id=i.id)})}onClear(){this.device_id=void 0,this.device_name=void 0,this.parameter_id=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate&&(this.startDate=u().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=u().utc(this.rangeTimes.endDate).subtract(7,"hours").format()),this.fetchListOfElectricEnergies()}onViewList(){this.displayIs="list"}onViewChart(){this.displayIs="chart"}toDigis(t){return b.Q.toDigis(t,0)}convertTime(t){return b.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}onComeback(){localStorage.removeItem(h.o.USER),sessionStorage.removeItem(h.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(R),e.Y36(E.ez),e.Y36(e.Qsj),e.Y36(v.xA),e.Y36(q.$),e.Y36(p.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-electric-energy-management"]],viewQuery:function(t,i){if(1&t&&(e.Gf(X,5,e.SBq),e.Gf(K,5,e.SBq),e.Gf(ee,5,e.SBq),e.Gf(te,5,e.SBq)),2&t){let n;e.iGM(n=e.CRH())&&(i.divBound=n.first),e.iGM(n=e.CRH())&&(i.divHeader=n.first),e.iGM(n=e.CRH())&&(i.divTable=n.first),e.iGM(n=e.CRH())&&(i.divPaginator=n.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"field","col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],["placeholder","Ch\u1ecdn c\xf4ng t\u01a1","panelStyleClass","text-overflow-ellipsis text-sm","optionLabel","name","optionValue","value","styleClass","w-full",3,"options","ngModel","ngModelChange"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",3,"click"],["type","button","pButton","","icon","pi pi-list",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chart-line",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t trang hi\u1ec7n t\u1ea1i",1,"p-button-success","mr-1",3,"click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t t\u1ea5t c\u1ea3",3,"click"],[1,"absolute","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading",4,"ngIf"],["class","w-full h-full overflow-auto",4,"ngIf"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","C\xe0i \u0111\u1eb7t","icon","fa-solid fa-cog","class","mx-1",3,"click",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],["pTemplate","emptymessage"],[1,"flex","m-0","p-0"],[1,"font-bold","ml-auto","text-blue-500","mr-3"],[1,"font-bold","ml-auto","text-blue-500"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","150px"],[2,"min-width","100px"],["pSortableColumn","createdAt",2,"min-width","200px"],["field","createdAt"],[2,"min-width","300px"],[2,"min-width","200px"],[1,"font-bold",2,"min-width","300px"],[1,"font-bold",2,"min-width","150px"],[1,"p-fluid","p-2"],[1,"w-full","h-full","overflow-auto"],[4,"ngIf","ngIfElse"],["noLog",""],[3,"show"],["type","bar","width","95vw","height","50vh",3,"data","options"],["pButton","","pRipple","","type","button","label","C\xe0i \u0111\u1eb7t","icon","fa-solid fa-cog",1,"mx-1",3,"click"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,pe,43,27,"div",0),e.YNc(1,fe,8,0,"ng-template",null,1,e.W1O)),2&t){const n=e.MAs(2);e.Q6J("ngIf",i.permission.electric_energy.self)("ngIfElse",n)}},directives:[_.O5,Q.a,m.Fj,z.o,m.JJ,m.On,Z.Hq,M.H,w.Lt,j.SP,$.u,C.iA,E.jx,C.lQ,C.fz,W.C,S.RJ,G.D,V.V],styles:[""]}),o})()}];let Ee=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[p.Bz.forChild(_e)],p.Bz]}),o})();var ve=a(4695);let ye=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[_.ez,Ee,ve.m]]}),o})()}}]);