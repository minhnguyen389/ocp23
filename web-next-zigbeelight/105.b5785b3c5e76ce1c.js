"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[105],{7105:(Ue,Z,a)=>{a.r(Z),a.d(Z,{DeviceLogModule:()=>we});var v=a(9808),T=a(9979),D=a(5861),e=a(5e3),y=a(6675),E=a(4327),P=a(4313),L=a(8087),N=a(1764),g=a.n(N),F=a(5268),A=a.n(F),x=a(8215),w=a(6290),C=a(9783),S=a(5330),U=a(5431),H=a(7658),f=a(2382),B=a(1424),k=a(845),M=a(5787),I=a(5077),q=a(4119),_=a(8952),O=a(1753),R=a(5034),J=a(4132),Y=a(97);const Q=["divBound"],z=["divHeader"],$=["divTable"],W=["divPaginator"];function V(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",42),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",43),e._uU(4,"Thi\u1ebft b\u1ecb "),e._UZ(5,"p-sortIcon",44),e.qZA(),e.TgZ(6,"th",45),e._uU(7,"U1(V)"),e.qZA(),e.TgZ(8,"th",45),e._uU(9,"I1(A)"),e.qZA(),e.TgZ(10,"th",45),e._uU(11,"P1(W)"),e.qZA(),e.TgZ(12,"th",45),e._uU(13,"U2(V)"),e.qZA(),e.TgZ(14,"th",45),e._uU(15,"I2(A)"),e.qZA(),e.TgZ(16,"th",45),e._uU(17,"P2(W)"),e.qZA(),e.TgZ(18,"th",45),e._uU(19,"U3(V)"),e.qZA(),e.TgZ(20,"th",45),e._uU(21,"I3(A)"),e.qZA(),e.TgZ(22,"th",45),e._uU(23,"P3(W)"),e.qZA(),e.TgZ(24,"th",46),e._uU(25,"Th\u1eddi gian ghi"),e._UZ(26,"p-sortIcon",47),e.qZA()())}function j(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij("(#",t.device_id,")")}}function G(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij("|(",t.mac,")")}}function X(n,s){if(1&n&&(e.TgZ(0,"tr")(1,"td",42),e._uU(2),e.qZA(),e.TgZ(3,"td",48)(4,"span"),e._uU(5),e.YNc(6,j,2,1,"span",49),e.YNc(7,G,2,1,"span",49),e.qZA()(),e.TgZ(8,"td",45),e._uU(9),e.qZA(),e.TgZ(10,"td",45),e._uU(11),e.qZA(),e.TgZ(12,"td",45),e._uU(13),e.qZA(),e.TgZ(14,"td",45),e._uU(15),e.qZA(),e.TgZ(16,"td",45),e._uU(17),e.qZA(),e.TgZ(18,"td",45),e._uU(19),e.qZA(),e.TgZ(20,"td",45),e._uU(21),e.qZA(),e.TgZ(22,"td",45),e._uU(23),e.qZA(),e.TgZ(24,"td",45),e._uU(25),e.qZA(),e.TgZ(26,"td",50),e._uU(27),e.qZA()()),2&n){const t=s.$implicit,o=s.rowIndex,i=e.oxw(3);e.xp6(2),e.Oqu((i.currentPage-1)*i.itemsPerPage+1+o),e.xp6(3),e.hij("",null==t.device?null:t.device.name," "),e.xp6(1),e.Q6J("ngIf",t.device_id),e.xp6(1),e.Q6J("ngIf",t.mac),e.xp6(2),e.Oqu(t[22]),e.xp6(2),e.Oqu(t[25]),e.xp6(2),e.Oqu(t[28]),e.xp6(2),e.Oqu(t[23]),e.xp6(2),e.Oqu(t[26]),e.xp6(2),e.Oqu(t[29]),e.xp6(2),e.Oqu(t[24]),e.xp6(2),e.Oqu(t[27]),e.xp6(2),e.Oqu(t[30]),e.xp6(2),e.Oqu(i.convertTime(t.createdAt))}}function K(n,s){1&n&&(e.TgZ(0,"div",51),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn thi\u1ebft b\u1ecb v\xe0 th\u1eddi gian t\xecm ki\u1ebfm ph\xf9 h\u1ee3p. "),e.qZA())}function ee(n,s){if(1&n&&(e.TgZ(0,"p-table",38),e.YNc(1,V,27,0,"ng-template",39),e.YNc(2,X,28,14,"ng-template",40),e.YNc(3,K,2,0,"ng-template",41),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("value",t.deviceLogs)("scrollable",!0)("loading",t.loading)}}function te(n,s){if(1&n&&(e.TgZ(0,"div")(1,"div",56),e._UZ(2,"p-chart",57),e.qZA(),e.TgZ(3,"div",56),e._UZ(4,"p-chart",57),e.qZA(),e.TgZ(5,"div"),e._UZ(6,"p-chart",57),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("data",t.data1)("options",t.options1),e.xp6(2),e.Q6J("data",t.data2)("options",t.options2),e.xp6(2),e.Q6J("data",t.data3)("options",t.options3)}}function ie(n,s){1&n&&(e.TgZ(0,"div",51),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function ne(n,s){if(1&n&&(e.TgZ(0,"div",52),e.YNc(1,te,7,6,"div",53),e.YNc(2,ie,2,0,"ng-template",null,54,e.W1O),e._UZ(4,"ngx-loading",55),e.qZA()),2&n){const t=e.MAs(3),o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",o.deviceLogs.length)("ngIfElse",t),e.xp6(3),e.Q6J("show",o.loading)}}const oe=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}},se=function(){return[15,20,30,50]};function ae(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"Th\xf4ng s\u1ed1 U-I-P "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"div",12)(12,"input",13),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().device_name=i}),e.qZA(),e.TgZ(13,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()(),e.TgZ(14,"div",15)(15,"input",16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().rangeTimes=i}),e.qZA()(),e.TgZ(16,"div",17)(17,"div",18)(18,"span")(19,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(20,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(21,"span")(22,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewList()}),e.qZA(),e.TgZ(23,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewChart()}),e.qZA(),e.TgZ(24,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportPage()}),e.qZA(),e.TgZ(25,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportAll()}),e.qZA()()()()()(),e.TgZ(26,"div",25,26),e.YNc(28,ee,4,3,"p-table",27),e.YNc(29,ne,5,3,"div",28),e.qZA(),e.TgZ(30,"div",29,30)(32,"div",31),e._UZ(33,"div",32),e.TgZ(34,"div",33)(35,"p-paginator",34),e.NdJ("onPageChange",function(i){return e.CHM(t),e.oxw().onPageChange(i)}),e.qZA()(),e.TgZ(36,"div",35)(37,"button",36),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(38,"span",37),e._uU(39),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(8),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(22,oe))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(7),e.Q6J("disabled",!t.deviceLogs.length||"list"==t.displayIs),e.xp6(1),e.Q6J("disabled",!t.deviceLogs.length||"chart"==t.displayIs),e.xp6(5),e.Q6J("ngIf","list"==t.displayIs),e.xp6(1),e.Q6J("ngIf","chart"==t.displayIs),e.xp6(6),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(23,se))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function le(n,s){1&n&&(e._UZ(0,"i",65),e.TgZ(1,"span",66),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function re(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",58)(1,"p-messages",59),e.YNc(2,le,3,0,"ng-template",60),e.qZA()(),e.TgZ(3,"div",61)(4,"div",62),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",63),e.TgZ(6,"span",64),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}g().extend(A());let ce=(()=>{class n{constructor(t,o,i,r,m,c){this.logHttpService=t,this.messageService=o,this.renderer=i,this.dialogService=r,this.permissionService=m,this.router=c,this.displayIs="list",this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.deviceLogs=[],this.options1={plugins:{title:{display:!0,text:"CH\u1ec8 S\u1ed0 PHA 1",fontSize:18},legend:{position:"bottom"}},scales:{x:{ticks:{maxTicksLimit:10}},y:{ticks:{maxTicksLimit:10}}}},this.options2={plugins:{title:{display:!0,text:"CH\u1ec8 S\u1ed0 PHA 2",fontSize:18},legend:{position:"bottom"}},scales:{x:{ticks:{maxTicksLimit:10}},y:{ticks:{maxTicksLimit:10}}}},this.options3={plugins:{title:{display:!0,text:"CH\u1ec8 S\u1ed0 PHA 3",fontSize:18},legend:{position:"bottom"}},scales:{x:{ticks:{maxTicksLimit:10}},y:{ticks:{maxTicksLimit:10}}}},this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let i=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${i}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm())})}initForm(){this.pathLinks=[{label:"V\u1eadn h\xe0nh",disabled:!0},{label:"Th\xf4ng s\u1ed1 gi\xe1m s\xe1t",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfDeviceLogs(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.logHttpService.getVAW(this.device_id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:t=>{0===t.status?(this.deviceLogs=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.renderChart()):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}renderChart(){this.data1=null,this.data2=null,this.data3=null;let t=[],o=[],i=[],r=[],m=[],c=[],d=[],p=[],h=[],u=[];this.deviceLogs.forEach(l=>{t.push(this.convertTime(l.createdAt)),o.push(l[22]),i.push(l[25]),r.push(l[28]),m.push(l[23]),c.push(l[26]),d.push(l[29]),p.push(l[24]),h.push(l[27]),u.push(l[30])}),this.data1={labels:t,datasets:[{label:"U1(V)",data:o,tension:.4},{label:"I1(A)",data:i,tension:.4},{label:"P1(W)",data:r,tension:.4}]},this.data2={labels:t,datasets:[{label:"U2(V)",data:m,tension:.4},{label:"I2(A)",data:c,tension:.4},{label:"P2(W)",data:d,tension:.4}]},this.data3={labels:t,datasets:[{label:"U3(V)",data:p,tension:.4},{label:"I3(A)",data:h,tension:.4},{label:"P3(W)",data:u,tension:.4}]}}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDeviceLogs()}onReSync(){this.fetchListOfDeviceLogs()}convertTime(t){return y.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}exportAll(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.logHttpService.getVAW(this.device_id,this.startDate,this.endDate,this.totalItems,0).subscribe({next:t=>{if(0===t.status){let o=t.data.rows;if(this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),!o||0==o.length)return void this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"});this.exportExcell(o,!1)}else 2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}exportPage(){this.deviceLogs&&0!=this.deviceLogs.length?this.exportExcell(this.deviceLogs,!0):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"})}exportExcell(t,o){var i=this;return(0,D.Z)(function*(){let r=i.rangeTimes&&i.rangeTimes.startDate?g().utc(i.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",m=i.rangeTimes&&i.rangeTimes.endDate?g().utc(i.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const c=new P.Workbook,d=c.addWorksheet("U-I-P"),p=d.getRow(2);p.height=20,d.mergeCells(2,1,2,12),p.getCell(1).value="L\u1ecaCH S\u1eec TH\xd4NG S\u1ed0 U-I-P",p.getCell(1).font={name:"Times New Roman",size:12,bold:!0},p.getCell(1).alignment={horizontal:"center"};const h=d.getRow(3);d.mergeCells(3,1,3,12),h.getCell(1).value=`T\u1eeb ${r} \u0111\u1ebfn ${m}`,h.getCell(1).font={name:"Times New Roman",size:11},h.getCell(1).alignment={horizontal:"center"};let u=[];t.forEach((l,b)=>{let Se=[o?(i.currentPage-1)*i.itemsPerPage+1+b:b+1,`${l.device.name}${l.device_id?" (#"+l.device_id+")":""}${l.mac?"|("+l.mac+")":""}`,l[22],l[25],l[28],l[23],l[26],l[29],l[24],l[27],l[30],i.convertTime(l.createdAt)];u.push(Se)}),d.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"U1(V)",filterButton:!1},{name:"I1(A)",filterButton:!1},{name:"P1(W)",filterButton:!1},{name:"U2(V)",filterButton:!1},{name:"I2(A)",filterButton:!1},{name:"P2(W)",filterButton:!1},{name:"U3(V)",filterButton:!1},{name:"I3(A)",filterButton:!1},{name:"P3(W)",filterButton:!1},{name:"Th\u1eddi gian ghi",filterButton:!1}],rows:u}),c.xlsx.writeBuffer().then(l=>{(0,E.saveAs)(new Blob([l],{type:"application/octet-stream"}),"Bao_cao_chi_so_dien.xlsx")})})()}onPickDevice(){this.dialogService.open(L.$,{data:{deviceIns:[],title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!1,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(o=>{o&&(this.device_name=`${o.name} (#${o.id})`,this.device_id=o.id)})}onClear(){this.device_id=void 0,this.device_name=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate&&(this.startDate=g().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=g().utc(this.rangeTimes.endDate).subtract(7,"hours").format()),this.fetchListOfDeviceLogs()}onViewList(){this.displayIs="list"}onViewChart(){this.displayIs="chart"}onComeback(){localStorage.removeItem(x.o.USER),sessionStorage.removeItem(x.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.N),e.Y36(C.ez),e.Y36(e.Qsj),e.Y36(S.xA),e.Y36(U.$),e.Y36(T.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-device-uip-log"]],viewQuery:function(t,o){if(1&t&&(e.Gf(Q,5,e.SBq),e.Gf(z,5,e.SBq),e.Gf($,5,e.SBq),e.Gf(W,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(o.divBound=i.first),e.iGM(i=e.CRH())&&(o.divHeader=i.first),e.iGM(i=e.CRH())&&(o.divTable=i.first),e.iGM(i=e.CRH())&&(o.divPaginator=i.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-4","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-4","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"col-12","md:col-4"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",3,"click"],["type","button","pButton","","icon","pi pi-list",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chart-line",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t trang hi\u1ec7n t\u1ea1i",1,"p-button-success","mr-1",3,"click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t t\u1ea5t c\u1ea3",3,"click"],[1,"absolute","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading",4,"ngIf"],["class","w-full h-full overflow-auto",4,"ngIf"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","100px"],["pSortableColumn","createdAt",2,"min-width","200px"],["field","createdAt"],[2,"min-width","300px"],[4,"ngIf"],[2,"min-width","200px"],[1,"p-fluid","p-2"],[1,"w-full","h-full","overflow-auto"],[4,"ngIf","ngIfElse"],["noLog",""],[3,"show"],[1,"border-bottom-1","border-blue-500"],["type","line","width","95vw","height","35vh",3,"data","options"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,o){if(1&t&&(e.YNc(0,ae,40,24,"div",0),e.YNc(1,re,8,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",o.permission.electric_energy.self)("ngIfElse",i)}},directives:[v.O5,H.a,f.Fj,B.o,f.JJ,f.On,k.Hq,M.H,I.SP,q.u,_.iA,C.jx,_.lQ,_.fz,O.C,R.RJ,J.D,Y.V],styles:[""]}),n})();var de=a(4036);const ue=["divBound"],ge=["divHeader"],me=["divTable"],pe=["divPaginator"];function he(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",38),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",39),e._uU(4,"Thi\u1ebft b\u1ecb "),e._UZ(5,"p-sortIcon",40),e.qZA(),e.TgZ(6,"th",41),e._uU(7,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(8,"th",42),e._uU(9,"Th\u1eddi gian"),e._UZ(10,"p-sortIcon",43),e.qZA()())}const fe=function(){return{"background-color":"green"}};function _e(n,s){1&n&&(e.TgZ(0,"span",47),e._uU(1,"On / Online"),e.qZA()),2&n&&e.Q6J("ngStyle",e.DdM(1,fe))}const ve=function(){return{"background-color":"blue"}};function Te(n,s){1&n&&(e.TgZ(0,"span",47),e._uU(1,"Off / Offline"),e.qZA()),2&n&&e.Q6J("ngStyle",e.DdM(1,ve))}function xe(n,s){if(1&n&&(e.TgZ(0,"tr")(1,"td",38),e._uU(2),e.qZA(),e.TgZ(3,"td",44),e._uU(4),e.qZA(),e.TgZ(5,"td",41),e.YNc(6,_e,2,2,"span",45),e.YNc(7,Te,2,2,"span",45),e.qZA(),e.TgZ(8,"td",46),e._uU(9),e.qZA()()),2&n){const t=s.$implicit,o=s.rowIndex,i=e.oxw(2);e.xp6(2),e.Oqu((i.currentPage-1)*i.itemsPerPage+1+o),e.xp6(2),e.AsE("",t.device.name," (#",t.device_id,")"),e.xp6(2),e.Q6J("ngIf",t.state),e.xp6(1),e.Q6J("ngIf",!t.state),e.xp6(2),e.Oqu(i.convertTime(t.updatedAt))}}function Ce(n,s){1&n&&(e.TgZ(0,"div",48),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn thi\u1ebft b\u1ecb v\xe0 th\u1eddi gian t\xecm ki\u1ebfm ph\xf9 h\u1ee3p. "),e.qZA())}const be=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}},Ze=function(){return[15,20,30,50]};function De(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"L\u1ecbch s\u1eed tr\u1ea1ng th\xe1i thi\u1ebft b\u1ecb "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"p-dropdown",12),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().log_case=i}),e.qZA()(),e.TgZ(12,"div",11)(13,"div",13)(14,"div",13)(15,"input",14),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().device_name=i}),e.qZA(),e.TgZ(16,"button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()()(),e.TgZ(17,"div",16)(18,"input",17),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().rangeTimes=i}),e.qZA()(),e.TgZ(19,"div",18)(20,"div",19)(21,"span")(22,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(23,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(24,"span")(25,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportExcell()}),e.qZA()()()()()(),e.TgZ(26,"div",23,24)(28,"p-table",25),e.YNc(29,he,11,0,"ng-template",26),e.YNc(30,xe,10,6,"ng-template",27),e.YNc(31,Ce,2,0,"ng-template",28),e.qZA()(),e.TgZ(32,"div",29,30)(34,"div",31),e._UZ(35,"div",32),e.TgZ(36,"div",33)(37,"p-paginator",34),e.NdJ("onPageChange",function(i){return e.CHM(t),e.oxw().onPageChange(i)}),e.qZA()(),e.TgZ(38,"div",35)(39,"button",36),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(40,"span",37),e._uU(41),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(7),e.Q6J("options",t.logOptions)("ngModel",t.log_case),e.xp6(4),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(25,be))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes),e.xp6(5),e.Q6J("disabled",!(t.log_case&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate)),e.xp6(2),e.Q6J("disabled",!t.deviceLogs||0==t.deviceLogs.length),e.xp6(3),e.Q6J("value",t.deviceLogs)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(26,Ze))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function ye(n,s){1&n&&(e._UZ(0,"i",56),e.TgZ(1,"span",57),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Ee(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",49)(1,"p-messages",50),e.YNc(2,ye,3,0,"ng-template",51),e.qZA()(),e.TgZ(3,"div",52)(4,"div",53),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",54),e.TgZ(6,"span",55),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}g().extend(A());const Pe=[{path:"uip",component:ce},{path:"status",component:(()=>{class n{constructor(t,o,i,r,m,c){this.logHttpService=t,this.messageService=o,this.renderer=i,this.dialogService=r,this.permissionService=m,this.router=c,this.logOptions=[{name:"Tr\u1ea1ng th\xe1i on-off",value:1}],this.deviceLogs=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let i=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${i}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm())})}initForm(){this.pathLinks=[{label:"V\u1eadn h\xe0nh",disabled:!0},{label:"L\u1ecbch s\u1eed tr\u1ea1ng th\xe1i",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}onPickDevice(){this.dialogService.open(L.$,{data:{deviceIns:[],title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!1,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(o=>{o&&(this.device_name=`${o.name} (#${o.id})`,this.device_id=o.id)})}fetchListOfDeviceLogs(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.logHttpService.getOnOff(this.device_id,this.startDate,this.endDate,this.itemsPerPage,this.offset).subscribe({next:t=>{0===t.status?(this.totalItems=t.data.count,this.deviceLogs=t.data.rows,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convertTime(t){return y.I.isoToVnTime(t)}convertTimestamp(t){return t?g()(t).format("HH:mm:ss DD/MM/YYYY"):"N/A"}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){var t=this;return(0,D.Z)(function*(){let o=t.deviceLogs,i=t.rangeTimes&&t.rangeTimes.startDate?g().utc(t.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",r=t.rangeTimes&&t.rangeTimes.endDate?g().utc(t.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const m=new P.Workbook,c=m.addWorksheet("OFFLINE"),d=c.getRow(2);d.height=20,c.mergeCells(2,1,2,4),d.getCell(1).value="L\u1ecaCH S\u1eec TR\u1ea0NG TH\xc1I THI\u1ebeT B\u1eca",d.getCell(1).font={name:"Times New Roman",size:12,bold:!0},d.getCell(1).alignment={horizontal:"center"};const p=c.getRow(3);c.mergeCells(3,1,3,4),p.getCell(1).value=`T\u1eeb ${i} \u0111\u1ebfn ${r}`,p.getCell(1).font={name:"Times New Roman",size:11},p.getCell(1).alignment={horizontal:"center"};let h=[];o.forEach((u,l)=>{let b=[l+1,`${u.device.name}(#${u.device_id})`,u.state?"On / Online":"Off / Offline",t.convertTime(u.updatedAt)];h.push(b)}),c.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"Tr\u1ea1ng th\xe1i",filterButton:!0},{name:"Th\u1eddi gian",filterButton:!1}],rows:h}),m.xlsx.writeBuffer().then(u=>{(0,E.saveAs)(new Blob([u],{type:"application/octet-stream"}),"Bao_cao_trang_thai_thiet_bi.xlsx")})})()}onClear(){this.device_id=void 0,this.device_name=void 0,this.log_case=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate?(this.startDate=g().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=g().utc(this.rangeTimes.endDate).subtract(7,"hours").format(),this.fetchListOfDeviceLogs()):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Vui l\xf2ng ch\u1ecdn kho\u1ea3ng th\u1eddi gian t\xecm ki\u1ebfm!"})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfDeviceLogs()}onReSync(){this.fetchListOfDeviceLogs()}onComeback(){localStorage.removeItem(x.o.USER),sessionStorage.removeItem(x.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.N),e.Y36(C.ez),e.Y36(e.Qsj),e.Y36(S.xA),e.Y36(U.$),e.Y36(T.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-device-status-log"]],viewQuery:function(t,o){if(1&t&&(e.Gf(ue,5,e.SBq),e.Gf(ge,5,e.SBq),e.Gf(me,5,e.SBq),e.Gf(pe,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(o.divBound=i.first),e.iGM(i=e.CRH())&&(o.divHeader=i.first),e.iGM(i=e.CRH())&&(o.divTable=i.first),e.iGM(i=e.CRH())&&(o.divPaginator=i.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-3","mb-1"],["placeholder","Ch\u1ecdn tr\u01b0\u1eddng h\u1ee3p","panelStyleClass","text-overflow-ellipsis text-sm","optionLabel","name","optionValue","value","styleClass","w-full",3,"options","ngModel","ngModelChange"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file excel",3,"disabled","click"],[1,"absolute","left-0","w-full"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","100px"],["pSortableColumn","last_time_updated",2,"min-width","200px"],["field","last_time_updated"],[2,"min-width","300px"],["class","m-0 py-1 px-2 text-white border-round-sm",3,"ngStyle",4,"ngIf"],[2,"min-width","200px"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,o){if(1&t&&(e.YNc(0,De,42,27,"div",0),e.YNc(1,Ee,8,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",o.permission.device_log.self)("ngIfElse",i)}},directives:[v.O5,H.a,de.Lt,f.JJ,f.On,f.Fj,B.o,k.Hq,M.H,I.SP,q.u,_.iA,C.jx,_.lQ,_.fz,v.PC,J.D,Y.V],styles:[""]}),n})()}];let Le=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[T.Bz.forChild(Pe)],T.Bz]}),n})();var Ae=a(4695);let we=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[v.ez,Le,Ae.m]]}),n})()}}]);