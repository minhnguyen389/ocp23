"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[348],{6348:(Ai,B,a)=>{a.r(B),a.d(B,{TroubleModule:()=>Ei});var h=a(9808),Z=a(9979),N=a(5861),e=a(5e3),S=a(6675),ee=a(4464),g=a(8215),m=a(2340),T=a(5330),R=a(6254),te=a(9411),f=a(9783),x=a(845),C=a(5787),ie=a(1208),c=a(2382);let F=(()=>{class n{constructor(t,i,o,r,l,u){this.ref=t,this.config=i,this.comHttpService=o,this.dtHttpService=r,this.messageService=l,this.router=u,this.iconDevNewUrl="assets/other/ban-24-r.png",this.iconDevReceivedUrl="assets/other/ban-24-r.png",this.iconDevDoneUrl="assets/other/ban-24-r.png",this.devPlaySound=!1,this.iconTTNewUrl="assets/other/ban-24-r.png",this.iconTTReceivedUrl="assets/other/ban-24-r.png",this.iconTTDoneUrl="assets/other/ban-24-r.png",this.ttPlaySound=!1,this.iconCDNewUrl="assets/other/ban-24-r.png",this.iconCDReceivedUrl="assets/other/ban-24-r.png",this.iconCDDoneUrl="assets/other/ban-24-r.png",this.cdPlaySound=!1}ngOnDestroy(){}ngOnInit(){this.fetchOperationSetting()}fetchOperationSetting(){this.comHttpService.getSetting().subscribe({next:t=>{0===t.status?(this.setting=t.data,this.genSetting()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}genSetting(){this.setting.warning_sound?(this.soundUrl=m.N.url.BASE_IMG+this.setting.warning_sound,this.soundFileName=this.soundUrl.substr(this.soundUrl.lastIndexOf("/")+1)):(this.soundFileName=null,this.soundUrl=null),this.iconDevNewUrl=this.setting.trouble_device_icon_new?m.N.url.BASE_IMG+this.setting.trouble_device_icon_new:null,this.iconDevReceivedUrl=this.setting.trouble_device_icon_received?m.N.url.BASE_IMG+this.setting.trouble_device_icon_received:null,this.iconDevDoneUrl=this.setting.trouble_device_icon_done?m.N.url.BASE_IMG+this.setting.trouble_device_icon_done:null,this.devPlaySound=1===this.setting.trouble_device_play_sound,this.iconTTNewUrl=this.setting.trouble_tt_icon_new?m.N.url.BASE_IMG+this.setting.trouble_tt_icon_new:null,this.iconTTReceivedUrl=this.setting.trouble_tt_icon_received?m.N.url.BASE_IMG+this.setting.trouble_tt_icon_received:null,this.iconTTDoneUrl=this.setting.trouble_tt_icon_done?m.N.url.BASE_IMG+this.setting.trouble_tt_icon_done:null,this.ttPlaySound=1===this.setting.trouble_tt_play_sound,this.iconCDNewUrl=this.setting.trouble_cd_icon_new?m.N.url.BASE_IMG+this.setting.trouble_cd_icon_new:null,this.iconCDReceivedUrl=this.setting.trouble_cd_icon_received?m.N.url.BASE_IMG+this.setting.trouble_cd_icon_received:null,this.iconCDDoneUrl=this.setting.trouble_cd_icon_done?m.N.url.BASE_IMG+this.setting.trouble_cd_icon_done:null,this.cdPlaySound=1===this.setting.trouble_cd_play_sound}onFileIconDevNewSelect(t){if(t.target.files.length>0){this.fileIconDevNew=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconDevNewUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconDevRecceivedSelect(t){if(t.target.files.length>0){this.fileIconDevRecceived=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconDevReceivedUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconDevDoneSelect(t){if(t.target.files.length>0){this.fileIconDevDone=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconDevDoneUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconTTNewSelect(t){if(t.target.files.length>0){this.fileIconTTNew=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconTTNewUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconTTRecceivedSelect(t){if(t.target.files.length>0){this.fileIconTTRecceived=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconTTReceivedUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconTTDoneSelect(t){if(t.target.files.length>0){this.fileIconTTDone=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconTTDoneUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconCDNewSelect(t){if(t.target.files.length>0){this.fileIconCDNew=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconCDNewUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconCDRecceivedSelect(t){if(t.target.files.length>0){this.fileIconCDRecceived=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconCDReceivedUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileIconCDDoneSelect(t){if(t.target.files.length>0){this.fileIconCDDone=t.target.files[0];const i=new FileReader;i.onload=o=>this.iconCDDoneUrl=i.result,i.readAsDataURL(t.target.files[0])}}onFileSoundSelect(t){t.target.files.length>0&&(this.fileSound=t.target.files[0])}getNameFile(t){return t?t.name:"Ch\u1ecdn file..."}onSubmit(){var t=this;return(0,N.Z)(function*(){let i=[],o=[];if(t.fileIconDevNew&&i.push({file:t.fileIconDevNew,filename:"fileIconDevNew"}),t.fileIconDevRecceived&&i.push({file:t.fileIconDevRecceived,filename:"fileIconDevRecceived"}),t.fileIconDevDone&&i.push({file:t.fileIconDevDone,filename:"fileIconDevDone"}),t.fileIconTTNew&&i.push({file:t.fileIconTTNew,filename:"fileIconTTNew"}),t.fileIconTTRecceived&&i.push({file:t.fileIconTTRecceived,filename:"fileIconTTRecceived"}),t.fileIconTTDone&&i.push({file:t.fileIconTTDone,filename:"fileIconTTDone"}),t.fileIconCDNew&&i.push({file:t.fileIconCDNew,filename:"fileIconCDNew"}),t.fileIconCDRecceived&&i.push({file:t.fileIconCDRecceived,filename:"fileIconCDRecceived"}),t.fileIconCDDone&&i.push({file:t.fileIconCDDone,filename:"fileIconCDDone"}),t.fileSound&&o.push({file:t.fileSound,filename:t.fileSound.name}),0!=i.length||0!=o.length)try{const r=yield(0,ee.n)(t.dtHttpService.uploadFile(i,o));if(0!==r.status)return t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${r.message}`}),void console.error("C\xf3 l\u1ed7i x\u1ea3y ra",r.message);const l=r.data.image,u=r.data.file;let d,b,E,q,y,I,A,L,X,K;l&&0!==l.length&&l.forEach(p=>{"fileIconDevNew"===p.originalname?b=p.filename:"fileIconDevRecceived"===p.originalname?E=p.filename:"fileIconDevDone"===p.originalname?q=p.filename:"fileIconTTNew"===p.originalname?y=p.filename:"fileIconTTRecceived"===p.originalname?I=p.filename:"fileIconTTDone"===p.originalname?A=p.filename:"fileIconCDNew"===p.originalname?L=p.filename:"fileIconCDRecceived"===p.originalname?X=p.filename:"fileIconCDDone"===p.originalname&&(K=p.filename)}),u&&0!==u.length&&(d=u[0].filename),t.comHttpService.updateSetting(t.setting.id,d,b,E,q,t.devPlaySound?1:0,y,I,A,t.ttPlaySound?1:0,L,X,K,t.cdPlaySound?1:0,void 0,void 0,void 0).subscribe({next:p=>{0===p.status?(t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt c\xe0i \u0111\u1eb7t c\u1ea3nh b\xe1o s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"}),t.ref.destroy()):2===p.status?t.onComeback():(t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${p.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",p.message))},error:p=>{t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",p)}})}catch(r){t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",r)}else t.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng c\xf3 s\u1ef1 thay \u0111\u1ed5i trong c\xe0i \u0111\u1eb7t"})})()}onDestroy(){this.ref.destroy()}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.E7),e.Y36(T.S),e.Y36(R.n),e.Y36(te.g),e.Y36(f.ez),e.Y36(Z.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-config"]],decls:151,vars:27,consts:[[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"grid","grid-nogutter"],[1,"col-12","md:col-4"],[1,"border-1","border-round","border-gray-300","m-2","p-1"],[1,"field","mb-2"],[1,"font-bold","text-2x"],[1,"border-round","border-1","border-gray-300","mb-1","p-2"],[1,"flex","align-items-center","mb-2"],[1,"ml-auto","mr-2"],[2,"max-width","24px",3,"src"],[1,"flex","align-items-center"],["type","file","accept","image/*",1,"file-input",3,"change"],["dev_new",""],["pButton","","pRipple","","type","button","label","Ch\u1ecdn \u1ea3nh","icon","fa-solid fa-upload",1,"p-button-sm","p-button-outlined","mr-2",3,"click"],["dev_rec",""],[1,"border-round","border-1","border-gray-300","mb-2","p-2"],["dev_done",""],["label","Ph\xe1t \xe2m thanh c\u1ea3nh b\xe1o s\u1ef1 c\u1ed1 m\u1edbi",3,"binary","ngModel","ngModelChange"],["tt_new",""],["tt_rec",""],["tt_done",""],["cd_new",""],["cd_rec",""],["cd_done",""],[1,"border-round","border-1","border-gray-300","m-2","p-2"],["controls","","preload","none",3,"src"],["type","file","accept","audio/mp3",1,"file-input",3,"change"],["sound",""],["pButton","","pRipple","","type","button","label","Ch\u1ecdn \xe2m thanh","icon","fa-solid fa-upload",1,"p-button-sm","p-button-outlined","mr-2",3,"click"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"click"]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"C\xe0i \u0111\u1eb7t c\u1ea3nh b\xe1o s\u1ef1 c\u1ed1"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8)(10,"span",9),e._uU(11,"C\xe0i \u0111\u1eb7t s\u1ef1 c\u1ed1 Thi\u1ebft b\u1ecb"),e.qZA()(),e.TgZ(12,"div",10)(13,"div",11)(14,"span"),e._uU(15,"Icon m\u1edbi: "),e.qZA(),e.TgZ(16,"span",12),e._UZ(17,"img",13),e.qZA()(),e.TgZ(18,"div",14)(19,"input",15,16),e.NdJ("change",function(l){return i.onFileIconDevNewSelect(l)}),e.qZA(),e.TgZ(21,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(20).click()}),e.qZA(),e.TgZ(22,"span"),e._uU(23),e.qZA()()(),e.TgZ(24,"div",10)(25,"div",11)(26,"span"),e._uU(27,"Icon \u0111\xe3 ti\u1ebfp nh\u1eadn: "),e.qZA(),e.TgZ(28,"span",12),e._UZ(29,"img",13),e.qZA()(),e.TgZ(30,"div",14)(31,"input",15,18),e.NdJ("change",function(l){return i.onFileIconDevRecceivedSelect(l)}),e.qZA(),e.TgZ(33,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(32).click()}),e.qZA(),e.TgZ(34,"span"),e._uU(35),e.qZA()()(),e.TgZ(36,"div",19)(37,"div",11)(38,"span"),e._uU(39,"Icon \u0111\xe3 x\u1eed l\xfd: "),e.qZA(),e.TgZ(40,"span",12),e._UZ(41,"img",13),e.qZA()(),e.TgZ(42,"div",14)(43,"input",15,20),e.NdJ("change",function(l){return i.onFileIconDevDoneSelect(l)}),e.qZA(),e.TgZ(45,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(44).click()}),e.qZA(),e.TgZ(46,"span"),e._uU(47),e.qZA()()(),e.TgZ(48,"p-checkbox",21),e.NdJ("ngModelChange",function(l){return i.devPlaySound=l}),e.qZA()()(),e.TgZ(49,"div",6)(50,"div",7)(51,"div",8)(52,"span",9),e._uU(53,"C\xe0i \u0111\u1eb7t s\u1ef1 c\u1ed1 tu\u1ea7n tra"),e.qZA()(),e.TgZ(54,"div",10)(55,"div",11)(56,"span"),e._uU(57,"Icon m\u1edbi: "),e.qZA(),e.TgZ(58,"span",12),e._UZ(59,"img",13),e.qZA()(),e.TgZ(60,"div",14)(61,"input",15,22),e.NdJ("change",function(l){return i.onFileIconTTNewSelect(l)}),e.qZA(),e.TgZ(63,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(62).click()}),e.qZA(),e.TgZ(64,"span"),e._uU(65),e.qZA()()(),e.TgZ(66,"div",10)(67,"div",11)(68,"span"),e._uU(69,"Icon \u0111\xe3 ti\u1ebfp nh\u1eadn: "),e.qZA(),e.TgZ(70,"span",12),e._UZ(71,"img",13),e.qZA()(),e.TgZ(72,"div",14)(73,"input",15,23),e.NdJ("change",function(l){return i.onFileIconTTRecceivedSelect(l)}),e.qZA(),e.TgZ(75,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(74).click()}),e.qZA(),e.TgZ(76,"span"),e._uU(77),e.qZA()()(),e.TgZ(78,"div",19)(79,"div",11)(80,"span"),e._uU(81,"Icon \u0111\xe3 x\u1eed l\xfd: "),e.qZA(),e.TgZ(82,"span",12),e._UZ(83,"img",13),e.qZA()(),e.TgZ(84,"div",14)(85,"input",15,24),e.NdJ("change",function(l){return i.onFileIconTTDoneSelect(l)}),e.qZA(),e.TgZ(87,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(86).click()}),e.qZA(),e.TgZ(88,"span"),e._uU(89),e.qZA()()(),e.TgZ(90,"p-checkbox",21),e.NdJ("ngModelChange",function(l){return i.ttPlaySound=l}),e.qZA()()(),e.TgZ(91,"div",6)(92,"div",7)(93,"div",8)(94,"span",9),e._uU(95,"C\xe0i \u0111\u1eb7t s\u1ef1 c\u1ed1 C\u01b0 d\xe2n"),e.qZA()(),e.TgZ(96,"div",10)(97,"div",11)(98,"span"),e._uU(99,"Icon m\u1edbi: "),e.qZA(),e.TgZ(100,"span",12),e._UZ(101,"img",13),e.qZA()(),e.TgZ(102,"div",14)(103,"input",15,25),e.NdJ("change",function(l){return i.onFileIconCDNewSelect(l)}),e.qZA(),e.TgZ(105,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(104).click()}),e.qZA(),e.TgZ(106,"span"),e._uU(107),e.qZA()()(),e.TgZ(108,"div",10)(109,"div",11)(110,"span"),e._uU(111,"Icon \u0111\xe3 ti\u1ebfp nh\u1eadn: "),e.qZA(),e.TgZ(112,"span",12),e._UZ(113,"img",13),e.qZA()(),e.TgZ(114,"div",14)(115,"input",15,26),e.NdJ("change",function(l){return i.onFileIconCDRecceivedSelect(l)}),e.qZA(),e.TgZ(117,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(116).click()}),e.qZA(),e.TgZ(118,"span"),e._uU(119),e.qZA()()(),e.TgZ(120,"div",19)(121,"div",11)(122,"span"),e._uU(123,"Icon \u0111\xe3 x\u1eed l\xfd: "),e.qZA(),e.TgZ(124,"span",12),e._UZ(125,"img",13),e.qZA()(),e.TgZ(126,"div",14)(127,"input",15,27),e.NdJ("change",function(l){return i.onFileIconCDDoneSelect(l)}),e.qZA(),e.TgZ(129,"button",17),e.NdJ("click",function(){return e.CHM(o),e.MAs(128).click()}),e.qZA(),e.TgZ(130,"span"),e._uU(131),e.qZA()()(),e.TgZ(132,"p-checkbox",21),e.NdJ("ngModelChange",function(l){return i.cdPlaySound=l}),e.qZA()()()(),e.TgZ(133,"div",28)(134,"div",11)(135,"span"),e._uU(136),e.qZA()(),e.TgZ(137,"div",11),e._UZ(138,"audio",29),e.qZA(),e.TgZ(139,"div",11)(140,"span"),e._uU(141,"Thay \u0111\u1ed5i \xe2m thanh:"),e.qZA()(),e.TgZ(142,"div",14)(143,"input",30,31),e.NdJ("change",function(l){return i.onFileSoundSelect(l)}),e.qZA(),e.TgZ(145,"button",32),e.NdJ("click",function(){return e.CHM(o),e.MAs(144).click()}),e.qZA(),e.TgZ(146,"span"),e._uU(147),e.qZA()()()(),e.TgZ(148,"div",33)(149,"button",34),e.NdJ("click",function(){return i.onDestroy()}),e.qZA(),e.TgZ(150,"button",35),e.NdJ("click",function(){return i.onSubmit()}),e.qZA()()()}2&t&&(e.xp6(17),e.Q6J("src",i.iconDevNewUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconDevNew)),e.xp6(6),e.Q6J("src",i.iconDevReceivedUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconDevRecceived)),e.xp6(6),e.Q6J("src",i.iconDevDoneUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconDevDone)),e.xp6(1),e.Q6J("binary",!0)("ngModel",i.devPlaySound),e.xp6(11),e.Q6J("src",i.iconTTNewUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconTTNew)),e.xp6(6),e.Q6J("src",i.iconTTReceivedUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconTTRecceived)),e.xp6(6),e.Q6J("src",i.iconTTDoneUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconTTDone)),e.xp6(1),e.Q6J("binary",!0)("ngModel",i.ttPlaySound),e.xp6(11),e.Q6J("src",i.iconCDNewUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconCDNew)),e.xp6(6),e.Q6J("src",i.iconCDReceivedUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconCDRecceived)),e.xp6(6),e.Q6J("src",i.iconCDDoneUrl,e.LSH),e.xp6(6),e.Oqu(i.getNameFile(i.fileIconCDDone)),e.xp6(1),e.Q6J("binary",!0)("ngModel",i.cdPlaySound),e.xp6(4),e.hij("\xc2m thanh c\u1ea3nh b\xe1o s\u1ef1 c\u1ed1: ",i.soundFileName,""),e.xp6(2),e.Q6J("src",i.soundUrl,e.LSH),e.xp6(9),e.Oqu(i.getNameFile(i.fileSound)))},directives:[x.Hq,C.H,ie.XZ,c.JJ,c.On],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}.file-input[_ngcontent-%COMP%]{display:none}"]}),n})();var ne=a(9857);function oe(n,s){1&n&&e._UZ(0,"img",17),2&n&&e.Q6J("src",s.$implicit,e.LSH)}function se(n,s){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"img",19),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.Q6J("src",t,e.LSH)}}const re=function(){return{"max-width":"800px","max-height":"600px"}};function le(n,s){if(1&n&&(e.TgZ(0,"div",12)(1,"div",13)(2,"p-galleria",14),e.YNc(3,oe,1,1,"ng-template",15),e.YNc(4,se,2,1,"ng-template",16),e.qZA()()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("value",t.images)("responsiveOptions",t.responsiveOptions)("containerStyle",e.DdM(10,re))("numVisible",5)("circular",!0)("showItemNavigators",!0)("showThumbnails",!1)("showIndicators",!0)("showItemNavigatorsOnHover",!0)("showIndicatorsOnItem",!0)}}function ae(n,s){1&n&&(e.TgZ(0,"div",20),e._uU(1," Kh\xf4ng c\xf3 \u1ea3nh trong m\u1ee5c n\xe0y. "),e.qZA())}function ce(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"button",24),e.NdJ("click",function(){const r=e.CHM(t).$implicit;return e.oxw(2).onOpenFile(r)}),e._uU(2),e.qZA()()}if(2&n){const t=s.$implicit,i=e.oxw(2);e.xp6(2),e.Oqu(i.getFileName(t))}}function ue(n,s){if(1&n&&(e.TgZ(0,"div",21)(1,"ul",22),e.YNc(2,ce,3,1,"li",23),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.files)}}function pe(n,s){1&n&&(e.TgZ(0,"div",20),e._uU(1," Kh\xf4ng c\xf3 t\u1ec7p trong m\u1ee5c n\xe0y. "),e.qZA())}let J=(()=>{class n{constructor(t,i){this.ref=t,this.config=i,this.images=[],this.files=[],this.responsiveOptions=[{breakpoint:"1024px",numVisible:5},{breakpoint:"768px",numVisible:3},{breakpoint:"560px",numVisible:1}]}ngOnInit(){this.config.data&&this.config.data.trouble&&(this.trouble=this.config.data.trouble,this.trouble.trouble_report_images.forEach(t=>{"img"===t.file_type?this.images.push(m.N.url.BASE_IMG+t.image_path):"file"===t.file_type&&this.files.push(m.N.url.BASE_IMG+t.image_path)}))}getFileName(t){let i=t.split("/");return i[i.length-1]}onOpenFile(t){window.open(t)}onClose(){this.ref.destroy()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.E7),e.Y36(T.S))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-attach"]],decls:20,vars:4,consts:[[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content","p-2"],[1,"w-full"],["class","flex align-content-center justify-content-center w-full mb-2","style","max-height:600px",4,"ngIf","ngIfElse"],["noPhoto",""],["class","w-full","style","max-height: 150px; overflow: auto;",4,"ngIf","ngIfElse"],["noFile",""],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","pl-2","pr-1","border-gray-300"],["pButton","","pRipple","","type","button","label","\u0110\xf3ng","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],[1,"flex","align-content-center","justify-content-center","w-full","mb-2",2,"max-height","600px"],[1,"flex","align-items-center"],[3,"value","responsiveOptions","containerStyle","numVisible","circular","showItemNavigators","showThumbnails","showIndicators","showItemNavigatorsOnHover","showIndicatorsOnItem"],["pTemplate","item"],["pTemplate","thumbnail"],[2,"width","100%","display","block",3,"src"],[1,"grid","grid-nogutter","justify-content-center"],[2,"display","block",3,"src"],[1,"m-2"],[1,"w-full",2,"max-height","150px","overflow","auto"],[1,"list-disc"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","type","button",1,"p-button-text","m-0","p-0",3,"click"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Chi ti\u1ebft file \u0111\xednh k\xe8m"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.onClose()}),e.qZA()(),e.TgZ(5,"div",4)(6,"div",5)(7,"b"),e._uU(8,"\u1ea2nh hi\u1ec7n tr\u1ea1ng:"),e.qZA()(),e.YNc(9,le,5,11,"div",6),e.YNc(10,ae,2,0,"ng-template",null,7,e.W1O),e.TgZ(12,"div",5)(13,"b"),e._uU(14,"T\u1ec7p \u0111\xednh k\xe8m:"),e.qZA()(),e.YNc(15,ue,3,1,"div",8),e.YNc(16,pe,2,0,"ng-template",null,9,e.W1O),e.qZA(),e.TgZ(18,"div",10)(19,"button",11),e.NdJ("click",function(){return i.onClose()}),e.qZA()()()),2&t){const o=e.MAs(11),r=e.MAs(17);e.xp6(9),e.Q6J("ngIf",i.images&&0!==i.images.length)("ngIfElse",o),e.xp6(6),e.Q6J("ngIf",i.files&&0!==i.files.length)("ngIfElse",r)}},directives:[x.Hq,C.H,h.O5,ne.dz,f.jx,h.sg],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:42px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:42px;bottom:42px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:42px;left:0;width:100%}"]}),n})();var w=a(6180),v=a(8952),M=a(4132),D=a(97);const de=["divBound"],me=["divTable"],he=["divPaginator"];function ge(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"#"),e.qZA(),e._UZ(3,"th",23),e.TgZ(4,"th",24),e._uU(5,"T\xean "),e._UZ(6,"p-sortIcon",25),e.qZA(),e.TgZ(7,"th",24),e._uU(8,"M\xf4 t\u1ea3"),e.qZA()())}const fe=function(n){return{"background-color":n}};function _e(n,s){if(1&n&&(e.TgZ(0,"tr",26)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",23),e._UZ(4,"p-tableRadioButton",27),e.qZA(),e.TgZ(5,"td",24),e._uU(6),e.qZA(),e.TgZ(7,"td",24),e._uU(8),e.qZA()()),2&n){const t=s.$implicit,i=s.rowIndex,o=e.oxw();e.Q6J("ngStyle",e.VKq(6,fe,o.isIn(t))),e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+i),e.xp6(2),e.Q6J("value",t)("disabled",o.isDisabled(t)),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function be(n,s){1&n&&(e._UZ(0,"i",30),e.TgZ(1,"span",31),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Te(n,s){1&n&&(e.TgZ(0,"p-messages",28),e.YNc(1,be,3,0,"ng-template",29),e.qZA())}const ve=function(){return[15,20,30,50]};let H=(()=>{class n{constructor(t,i,o,r,l,u){this.ref=t,this.config=i,this.tHttpService=o,this.messageService=r,this.renderer=l,this.router=u,this.title="Ch\u1ecdn Lo\u1ea1i s\u1ef1 c\u1ed1",this.types=[],this.selectedTypes=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.loading=!1}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngAfterViewInit(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-40}px`)}onWindowResize(){this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-40}px`)}ngOnInit(){this.config.data&&(this.typeIn=this.config.data.type,this.fetchListOfTroubleTypes())}fetchListOfTroubleTypes(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubleTypes(this.itemsPerPage,this.offset,1).subscribe({next:t=>{0===t.status?(this.types=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.loadStatus()):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}loadStatus(){this.types.forEach(t=>{t.is_used=!1,this.typeIn&&this.typeIn.id==t.id&&(t.is_used=!0)})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfTroubleTypes()}onReSync(){this.fetchListOfTroubleTypes()}onSubmit(){this.ref.close(this.selectedTypes)}onDestroy(){this.ref.destroy()}isRowSelectable(t){return!t.data.is_used}isDisabled(t){return!!t.is_used}isIn(t){return t.is_used?"#cae6fc":null}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.E7),e.Y36(T.S),e.Y36(w.R),e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(Z.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-pick-trouble-type"]],viewQuery:function(t,i){if(1&t&&(e.Gf(de,5,e.SBq),e.Gf(me,5,e.SBq),e.Gf(he,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divTable=o.first),e.iGM(o=e.CRH())&&(i.divPaginator=o.first)}},decls:26,vars:17,consts:[[1,"absolute","top-0","left-0","bottom-0","right-0",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"page-content"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","dataKey","id","scrollHeight","flex",3,"value","selection","selectionPageOnly","rowSelectable","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],[1,"absolute","bottom-0","left-0","w-full","p-1","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Ch\u1ecdn","icon","fa-solid fa-check",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text",3,"click"],[1,"ml-1"],["noPermission",""],[2,"width","60px","max-width","60px"],[2,"min-width","300px"],["field","name"],[3,"ngStyle"],[3,"value","disabled"],["severity","error"],["pTemplate",""],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0,1),e.NdJ("resize",function(){return i.onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",2)(3,"div",3)(4,"span",4),e._uU(5),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e.TgZ(7,"div",6,7)(9,"p-table",8),e.NdJ("selectionChange",function(r){return i.selectedTypes=r}),e.YNc(10,ge,9,0,"ng-template",9),e.YNc(11,_e,9,8,"ng-template",10),e.qZA()()(),e.TgZ(12,"div",11,12)(14,"div",13)(15,"div",14)(16,"button",15),e.NdJ("click",function(){return i.onSubmit()}),e.qZA(),e.TgZ(17,"button",16),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e.TgZ(18,"div",17)(19,"p-paginator",18),e.NdJ("onPageChange",function(r){return i.onPageChange(r)}),e.qZA()(),e.TgZ(20,"div",19)(21,"button",20),e.NdJ("click",function(){return i.onReSync()}),e.qZA(),e.TgZ(22,"span",21),e._uU(23),e.qZA()()()()(),e.YNc(24,Te,2,0,"ng-template",null,22,e.W1O)),2&t&&(e.xp6(5),e.Oqu(i.title),e.xp6(4),e.Q6J("value",i.types)("selection",i.selectedTypes)("selectionPageOnly",!0)("rowSelectable",i.isRowSelectable)("scrollable",!0)("loading",i.loading),e.xp6(7),e.Q6J("disabled",!i.selectedTypes||0==i.selectedTypes.length),e.xp6(3),e.Q6J("rows",i.itemsPerPage)("totalRecords",i.totalItems)("rowsPerPageOptions",e.DdM(16,ve))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Displaying ",(i.currentPage-1)*i.itemsPerPage+1,"-",(i.currentPage-1)*i.itemsPerPage+i.itemsPerPage>i.totalItems?i.totalItems:(i.currentPage-1)*i.itemsPerPage+i.itemsPerPage," of ",i.totalItems,""))},directives:[x.Hq,C.H,v.iA,f.jx,v.fz,h.PC,v.GE,M.D,D.V],styles:[""]}),n})();var ye=a(4327),Ce=a(4313),xe=a(1764),P=a.n(xe),Ze=a(5268),we=a.n(Ze),Ee=a(8087),k=a(5431),U=a(7658),Y=a(1424),Q=a(4036),Ae=a(5077),Se=a(4119),De=a(9955);const Pe=["divBound"],ke=["divTable"],qe=["divPaginator"],Ie=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"HH:mm DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function Me(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"div",31)(3,"input",32),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).device_name=o}),e.qZA(),e.TgZ(4,"button",33),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onPickDevice()}),e.qZA()()(),e.TgZ(5,"div",30)(6,"p-dropdown",34),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).group=o})("onChange",function(){return e.CHM(t),e.oxw(2).onGroupChange()}),e.qZA()(),e.TgZ(7,"div",30)(8,"p-dropdown",35),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).type=o}),e.qZA()(),e.TgZ(9,"div",30)(10,"p-dropdown",36),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).state=o}),e.qZA()(),e.TgZ(11,"div",30)(12,"input",37),e.NdJ("ngModelChange",function(o){return e.CHM(t),e.oxw(2).rangeTimes=o}),e.qZA()(),e.TgZ(13,"div",38)(14,"div",39)(15,"span")(16,"button",40),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onClear()}),e.qZA(),e.TgZ(17,"button",41),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onSearch()}),e.qZA()(),e.TgZ(18,"span")(19,"button",42),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).exportPage()}),e.qZA(),e.TgZ(20,"button",43),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).exportAll()}),e.qZA()()()()()}if(2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("options",t.groupOptions)("ngModel",t.group),e.xp6(2),e.Q6J("options",t.typeOption)("ngModel",t.type),e.xp6(2),e.Q6J("options",t.stateOptions)("ngModel",t.state),e.xp6(2),e.Q6J("showDropdowns",!0)("locale",e.DdM(14,Ie))("showClearButton",!0)("timePicker",!0)("timePicker24Hour",!0)("dateLimit",31)("ngModel",t.rangeTimes)}}function Ue(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",44),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",45),e._uU(4,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(5,"th",46),e._uU(6,"Nh\xf3m"),e.qZA(),e.TgZ(7,"th",47),e._uU(8,"Lo\u1ea1i"),e.qZA(),e.TgZ(9,"th",48),e._uU(10,"T\xean"),e._UZ(11,"p-sortIcon",49),e.qZA(),e.TgZ(12,"th",50),e._uU(13,"N\u1ed9i dung"),e.qZA(),e.TgZ(14,"th",50),e._uU(15,"\u0110ia \u0111i\u1ec3m"),e.qZA(),e.TgZ(16,"th",51),e._uU(17,"Th\u1eddi gian"),e._UZ(18,"p-sortIcon",52),e.qZA(),e.TgZ(19,"th",53),e._uU(20,"Ng\u01b0\u1eddi g\u1eedi"),e.qZA()())}const Le=function(n){return{"background-color":n}};function Ne(n,s){if(1&n&&(e.TgZ(0,"tr",54)(1,"td",44),e._uU(2),e.qZA(),e.TgZ(3,"td",45)(4,"span",55),e._uU(5),e.qZA()(),e.TgZ(6,"td",46),e._uU(7),e.qZA(),e.TgZ(8,"td",47),e._uU(9),e.qZA(),e.TgZ(10,"td",50),e._uU(11),e.qZA(),e.TgZ(12,"td",50),e._uU(13),e.qZA(),e.TgZ(14,"td",50),e._uU(15),e.qZA(),e.TgZ(16,"td",53),e._uU(17),e.qZA(),e.TgZ(18,"td",53),e._uU(19),e.qZA()()),2&n){const t=s.$implicit,i=s.rowIndex,o=e.oxw(2);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+i),e.xp6(2),e.Q6J("ngStyle",e.VKq(11,Le,0===t.state?"red":1===t.state?"orange":"green")),e.xp6(1),e.Oqu(t.state_name),e.xp6(2),e.Oqu(t.group),e.xp6(2),e.Oqu(null==t.trouble_type?null:t.trouble_type.name),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.content),e.xp6(2),e.Oqu(t.address),e.xp6(2),e.Oqu(o.convertTime(t.createdAt)),e.xp6(2),e.Oqu(o.getSender(t))}}function Re(n,s){1&n&&(e.TgZ(0,"div",56),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function Oe(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"p-splitButton",57),e.NdJ("onClick",function(){return e.CHM(t),e.oxw(2).onConfig()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("showTransitionOptions","200ms")("hideTransitionOptions","200ms")("model",t.moreCommandsAll)}}function Be(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",58),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onChangeState(1)}),e.qZA()}}function Fe(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onChangeState(2)}),e.qZA()}}function Je(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"p-splitButton",60),e.NdJ("onClick",function(){return e.CHM(t),e.oxw(2).onViewAttach()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("showTransitionOptions","200ms")("hideTransitionOptions","200ms")("model",t.moreCommands)}}const He=function(){return[15,20,30,50]};function Ye(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4),e._UZ(3,"p-breadcrumb",5),e.TgZ(4,"div",6)(5,"h3",7),e._UZ(6,"i",8),e._uU(7,"Danh s\xe1ch S\u1ef1 c\u1ed1 "),e.qZA()(),e.TgZ(8,"div",9,10)(10,"p-table",11),e.NdJ("selectionChange",function(o){return e.CHM(t),e.oxw().currentTrouble=o})("onRowSelect",function(o){return e.CHM(t),e.oxw().onRowSelect(o)})("onRowUnselect",function(o){return e.CHM(t),e.oxw().onRowUnselect(o)}),e.YNc(11,Me,21,15,"ng-template",12),e.YNc(12,Ue,21,0,"ng-template",13),e.YNc(13,Ne,20,13,"ng-template",14),e.YNc(14,Re,2,0,"ng-template",15),e.qZA()()(),e.TgZ(15,"div",16,17)(17,"div",18)(18,"div",19),e.YNc(19,Oe,1,3,"p-splitButton",20),e.YNc(20,Be,1,0,"button",21),e.YNc(21,Fe,1,0,"button",22),e.YNc(22,Je,1,3,"p-splitButton",23),e.qZA(),e.TgZ(23,"div",24)(24,"p-paginator",25),e.NdJ("onPageChange",function(o){return e.CHM(t),e.oxw().onPageChange(o)}),e.qZA()(),e.TgZ(25,"div",26)(26,"button",27),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(27,"span",28),e._uU(28),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(7),e.Q6J("selection",t.currentTrouble)("value",t.troubles)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("ngIf",t.permission.trouble.config),e.xp6(1),e.Q6J("ngIf",t.currentTrouble&&0==t.currentTrouble.state&&t.permission.trouble.process),e.xp6(1),e.Q6J("ngIf",t.currentTrouble&&1==t.currentTrouble.state&&t.permission.trouble.process),e.xp6(1),e.Q6J("ngIf",t.currentTrouble),e.xp6(2),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(18,He))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function Qe(n,s){1&n&&(e._UZ(0,"i",68),e.TgZ(1,"span",69),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Ge(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",61)(1,"p-messages",62),e.YNc(2,Qe,3,0,"ng-template",63),e.qZA()(),e.TgZ(3,"div",64)(4,"div",65),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",66),e.TgZ(6,"span",67),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}P().extend(we());let $e=(()=>{class n{constructor(t,i,o,r,l,u){this.tHttpService=t,this.messageService=i,this.renderer=o,this.dialogService=r,this.permissionService=l,this.router=u,this.groupOptions=[{name:"Thi\u1ebft b\u1ecb",value:"Thi\u1ebft b\u1ecb"},{name:"Tu\u1ea7n tra",value:"Tu\u1ea7n tra"},{name:"C\u01b0 d\xe2n",value:"C\u01b0 d\xe2n"}],this.stateOptions=[{name:"M\u1edbi",value:0},{name:"\u0110\xe3 ti\u1ebfp nh\u1eadn",value:1},{name:"\u0110\xe3 x\u1eed l\xfd",value:2}],this.typeOption=[],this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.troubles=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-62}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfTroubleTypes(),this.fetchListOfTroubles())})}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd s\u1ef1 c\u1ed1",disabled:!0},{label:"Danh s\xe1ch s\u1ef1 c\u1ed1",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"},this.moreCommands=[{label:"Ph\xe2n lo\u1ea1i",icon:"pi pi-server",disabled:!0,command:()=>{this.onClassify()}}],this.moreCommandsAll=[{label:"Ti\u1ebfp nh\u1eadn t\u1ea5t c\u1ea3",icon:"fa-solid fa-check",command:()=>{this.onChangeStateAll(1)}},{label:"\u0110\xe3 x\u1eed l\xfd t\u1ea5t c\u1ea3",icon:"fa-solid fa-check-double",command:()=>{this.onChangeStateAll(2)}}]}fetchListOfTroubleTypes(){this.tHttpService.getListOfTroubleTypes(this.itemsPerPage,this.offset,this.isFromUser).subscribe({next:t=>{0===t.status?this.typeOption=t.data.rows:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onGroupChange(){this.isFromUser="Thi\u1ebft b\u1ecb"==this.group?0:1,this.type=void 0,this.fetchListOfTroubleTypes()}fetchListOfTroubles(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubles(this.group,this.type,this.state,this.startDate,this.endDate,void 0,void 0,void 0,void 0,void 0,this.itemsPerPage,this.offset,this.device_id).subscribe({next:t=>{0===t.status?(this.troubles=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentTrouble=void 0):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onRowSelect(t){this.moreCommands[0].disabled=!(this.currentTrouble&&"Thi\u1ebft b\u1ecb"!==this.currentTrouble.group)}onRowUnselect(t){this.moreCommands[0].disabled=!(this.currentTrouble&&"Thi\u1ebft b\u1ecb"!==this.currentTrouble.group)}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfTroubles()}onReSync(){this.fetchListOfTroubles()}onConfig(){this.dialogService.open(F,{showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}})}convertTime(t){return S.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}onClear(){this.group=void 0,this.state=void 0,this.startDate=void 0,this.endDate=void 0,this.rangeTimes=void 0,this.device_id=void 0,this.device_name=void 0}onSearch(){this.startDate=this.rangeTimes&&this.rangeTimes.startDate?P().utc(this.rangeTimes.startDate).subtract(7,"hours").format():void 0,this.endDate=this.rangeTimes&&this.rangeTimes.endDate?P().utc(this.rangeTimes.endDate).subtract(7,"hours").format():void 0,this.fetchListOfTroubles()}onChangeState(t){this.tHttpService.changleState(this.currentTrouble.id,t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 thay \u0111\u1ed5i tr\u1ea1ng th\xe1i x\u1eed l\xfd th\xe0nh c\xf4ng"}),this.fetchListOfTroubles()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onViewAttach(){this.dialogService.open(J,{data:{trouble:this.currentTrouble},showHeader:!1,width:"800px",height:"800px",contentStyle:{padding:"0",margin:0}})}onClassify(){this.dialogService.open(H,{data:{type:this.currentTrouble.trouble_type},showHeader:!1,height:"99vh",width:"99vw",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{this.tHttpService.changeTroubleTypeForTrouble(this.currentTrouble.id,i.id).subscribe({next:o=>{0===o.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 ph\xe2n lo\u1ea1i s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"}),this.fetchListOfTroubles()):2===o.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${o.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o.message))},error:o=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o)}})})}onChangeStateAll(t){this.tHttpService.changleStateAll(t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 thay \u0111\u1ed5i tr\u1ea1ng th\xe1i x\u1eed l\xfd th\xe0nh c\xf4ng"}),this.fetchListOfTroubles()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}getSender(t){let i="";return i=t.created_by_user?t.created_by_user.username:t.created_by_device?`${t.created_by_device.name}(#${t.created_by_device.id})`:"C\u01b0 d\xe2n",i}exportAll(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubles(this.group,this.type,this.state,this.startDate,this.endDate,void 0,void 0,void 0,void 0,void 0,this.totalItems,0,this.device_id).subscribe({next:t=>{if(0===t.status){let i=t.data.rows;if(this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),!i||0==i.length)return void this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"});this.exportExcell(i,!1)}else 2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}exportPage(){this.troubles&&0!=this.troubles.length?this.exportExcell(this.troubles,!0):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u"})}exportExcell(t,i){var o=this;return(0,N.Z)(function*(){let r=o.rangeTimes&&o.rangeTimes.startDate?P().utc(o.rangeTimes.startDate).format("HH:mm DD/MM/YYYY"):"...",l=o.rangeTimes&&o.rangeTimes.endDate?P().utc(o.rangeTimes.endDate).format("HH:mm DD/MM/YYYY"):"...";const u=new Ce.Workbook,d=u.addWorksheet("BC S\u1ef1 c\u1ed1"),b=d.getRow(2);b.height=20,d.mergeCells(2,1,2,9),b.getCell(1).value="DANH S\xc1CH B\xc1O C\xc1O S\u1ef0 C\u1ed0",b.getCell(1).font={name:"Times New Roman",size:12,bold:!0},b.getCell(1).alignment={horizontal:"center"};const E=d.getRow(3);d.mergeCells(3,1,3,9),E.getCell(1).value=`T\u1eeb ${r} \u0111\u1ebfn ${l}`,E.getCell(1).font={name:"Times New Roman",size:11},E.getCell(1).alignment={horizontal:"center"};let q=[];t.forEach((y,I)=>{var A;let L=[i?(o.currentPage-1)*o.itemsPerPage+1+I:I+1,y.state_name,y.group,null===(A=y.trouble_type)||void 0===A?void 0:A.name,y.name,y.content,y.address,o.convertTime(y.createdAt),o.getSender(y)];q.push(L)}),d.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Tr\u1ea1ng th\xe1i",filterButton:!0},{name:"Nh\xf3m",filterButton:!0},{name:"Lo\u1ea1i",filterButton:!0},{name:"T\xean",filterButton:!1},{name:"N\u1ed9i dung",filterButton:!1},{name:"\u0110\u1ecba \u0111i\u1ec3m",filterButton:!1},{name:"Th\u1eddi gian",filterButton:!1},{name:"Ng\u01b0\u1eddi g\u1eedi",filterButton:!1}],rows:q}),u.xlsx.writeBuffer().then(y=>{(0,ye.saveAs)(new Blob([y],{type:"application/octet-stream"}),"Bao_cao_su_co.xlsx")})})()}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}onPickDevice(){this.dialogService.open(Ee.$,{data:{deviceIns:[],title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!1,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{i&&(this.device_name=`${i.name} (#${i.id})`,this.device_id=i.id)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.R),e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(T.xA),e.Y36(k.$),e.Y36(Z.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-list"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Pe,5,e.SBq),e.Gf(ke,5,e.SBq),e.Gf(qe,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divTable=o.first),e.iGM(o=e.CRH())&&(i.divPaginator=o.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"page-content","mt-1"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect","onRowUnselect"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["label","C\xe0i \u0111\u1eb7t","class","mx-1","icon","fa-solid fa-cog",3,"showTransitionOptions","hideTransitionOptions","model","onClick",4,"ngIf"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check","class","mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","label","\u0110\xe3 x\u1eed l\xfd","icon","fa-solid fa-check-double","class","mr-1",3,"click",4,"ngIf"],["label","\u0110\xednh k\xe8m","icon","fa-solid fa-paperclip",3,"showTransitionOptions","hideTransitionOptions","model","onClick",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[1,"p-fluid","grid","formgrid"],[1,"field","col-12","md:col-2","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],["placeholder","Ch\u1ecdn nh\xf3m","optionLabel","name","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange","onChange"],["placeholder","Ch\u1ecdn lo\u1ea1i","optionLabel","name","optionValue","id","panelStyleClass","text-overflow-ellipsis",3,"options","ngModel","ngModelChange"],["placeholder","Ch\u1ecdn tr\u1ea1ng th\xe1i","panelStyleClass","text-overflow-ellipsis text-sm","optionLabel","name","optionValue","value",3,"options","ngModel","ngModelChange"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","timePicker","timePicker24Hour","dateLimit","ngModel","ngModelChange"],[1,"field","col-12","md:col-2"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",3,"click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t trang hi\u1ec7n t\u1ea1i",1,"p-button-success","mr-1",3,"click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t t\u1ea5t c\u1ea3",3,"click"],["pFrozenColumn","",2,"width","60px","max-width","60px"],["pFrozenColumn","",2,"min-width","150px"],[2,"min-width","100px"],[2,"min-width","250px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],["pSortableColumn","createdAt",2,"min-width","200px"],["field","createdAt"],[2,"min-width","200px"],[3,"pSelectableRow"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[1,"p-fluid","p-2"],["label","C\xe0i \u0111\u1eb7t","icon","fa-solid fa-cog",1,"mx-1",3,"showTransitionOptions","hideTransitionOptions","model","onClick"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","\u0110\xe3 x\u1eed l\xfd","icon","fa-solid fa-check-double",1,"mr-1",3,"click"],["label","\u0110\xednh k\xe8m","icon","fa-solid fa-paperclip",3,"showTransitionOptions","hideTransitionOptions","model","onClick"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,Ye,29,19,"div",0),e.YNc(1,Ge,8,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Q6J("ngIf",i.permission.trouble.self)("ngIfElse",o)}},directives:[h.O5,U.a,v.iA,f.jx,c.Fj,Y.o,c.JJ,c.On,x.Hq,C.H,Q.Lt,Ae.SP,Se.u,v.on,v.lQ,v.fz,v.Ei,h.PC,De.a,M.D,D.V],styles:[""]}),n})();var We=a(2216),_=a(8407),G=a(4520);function ze(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.trouble.created_by_user.username)}}function je(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.AsE(" ",t.trouble.created_by_device.name,"(#",t.trouble.created_by_device.id,")")}}function Ve(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"C\u01b0 d\xe2n"),e.qZA())}a(2937);let Xe=(()=>{class n{constructor(){}ngOnInit(){}convertTime(t){return S.I.isoToVnTime(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-tooltip"]],inputs:{trouble:"trouble"},decls:19,vars:6,consts:[["id","tooltip",1,"card"],[1,"m-0","p-0"],[1,"font-bold","text-blue-500"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"p",1)(2,"span",2),e._uU(3,"N\u1ed9i dung: "),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"p",1)(6,"span",2),e._uU(7,"Ng\u01b0\u1eddi g\u1eedi: "),e.qZA(),e.YNc(8,ze,2,1,"span",3),e.YNc(9,je,2,2,"span",3),e.YNc(10,Ve,2,0,"span",3),e.qZA(),e.TgZ(11,"p",1)(12,"span",2),e._uU(13,"Th\u1eddi gian: "),e.qZA(),e._uU(14),e.qZA(),e.TgZ(15,"p",1)(16,"span",2),e._uU(17,"T\xecnh tr\u1ea1ng: "),e.qZA(),e._uU(18),e.qZA()()),2&t&&(e.xp6(4),e.Oqu(i.trouble.content),e.xp6(4),e.Q6J("ngIf",i.trouble.created_by_user),e.xp6(1),e.Q6J("ngIf",i.trouble.created_by_device),e.xp6(1),e.Q6J("ngIf",!i.trouble.created_by_user&&!i.trouble.created_by_device),e.xp6(4),e.Oqu(i.convertTime(i.trouble.createdAt)),e.xp6(4),e.Oqu(i.trouble.state_name))},directives:[h.O5],styles:["#tooltip[_ngcontent-%COMP%]{width:250px}#tooltip[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{word-break:break-all;white-space:normal}"]}),n})();var $=a(9997),O=a(8386);function Ke(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.trouble.created_by_user.username)}}function et(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.AsE(" ",t.trouble.created_by_device.name,"(#",t.trouble.created_by_device.id,")")}}function tt(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"C\u01b0 d\xe2n"),e.qZA())}const it=function(n){return{"background-color":n}};function nt(n,s){if(1&n&&(e.TgZ(0,"div",11)(1,"p",12)(2,"span",13),e._uU(3,"Nh\xf3m: "),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"p",12)(6,"span",13),e._uU(7,"Lo\u1ea1i: "),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"p",12)(10,"span",13),e._uU(11,"T\xean: "),e.qZA(),e._uU(12),e.qZA(),e.TgZ(13,"p",12)(14,"span",13),e._uU(15,"N\u1ed9i dung: "),e.qZA(),e._uU(16),e.qZA(),e.TgZ(17,"p",12)(18,"span",13),e._uU(19,"\u0110\u1ecba ch\u1ec9: "),e.qZA(),e._uU(20),e.qZA(),e.TgZ(21,"p",12)(22,"span",13),e._uU(23,"Th\u1eddi gian: "),e.qZA(),e._uU(24),e.qZA(),e.TgZ(25,"p",12)(26,"span",13),e._uU(27,"Ng\u01b0\u1eddi g\u1eedi: "),e.qZA(),e.YNc(28,Ke,2,1,"span",14),e.YNc(29,et,2,2,"span",14),e.YNc(30,tt,2,0,"span",14),e.qZA(),e.TgZ(31,"p",12)(32,"span",13),e._uU(33,"T\xecnh tr\u1ea1ng: "),e.qZA(),e.TgZ(34,"span",15),e._uU(35),e.qZA()()()),2&n){const t=e.oxw();e.xp6(4),e.Oqu(t.trouble.group),e.xp6(4),e.Oqu(null==t.trouble.trouble_type?null:t.trouble.trouble_type.name),e.xp6(4),e.Oqu(t.trouble.name),e.xp6(4),e.Oqu(t.trouble.content),e.xp6(4),e.Oqu(t.trouble.address),e.xp6(4),e.Oqu(t.convertTime(t.trouble.createdAt)),e.xp6(4),e.Q6J("ngIf",t.trouble.created_by_user),e.xp6(1),e.Q6J("ngIf",t.trouble.created_by_device),e.xp6(1),e.Q6J("ngIf",!t.trouble.created_by_user&&!t.trouble.created_by_device),e.xp6(4),e.Q6J("ngStyle",e.VKq(11,it,0===t.trouble.state?"red":1===t.trouble.state?"orange":"green")),e.xp6(1),e.Oqu(t.trouble.state_name)}}function ot(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().onChangeState(1)}),e.qZA()}}function st(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onChangeState(2)}),e.qZA()}}let rt=(()=>{class n{constructor(t,i,o,r,l){this.messageService=t,this.permissionService=i,this.tHttpService=o,this.dialogService=r,this.router=l,this.closeEvent=new e.vpe,this.changeEvent=new e.vpe}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t)})}onClose(){this.closeEvent.emit()}convertTime(t){return S.I.isoToVnTime(t)}onChangeState(t){this.tHttpService.changleState(this.trouble.id,t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 thay \u0111\u1ed5i tr\u1ea1ng th\xe1i x\u1eed l\xfd th\xe0nh c\xf4ng"}),this.changeEvent.emit()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onViewAttach(){this.dialogService.open(J,{data:{trouble:this.trouble},showHeader:!1,width:"800px",height:"800px",contentStyle:{padding:"0",margin:0}})}onClassify(){this.dialogService.open(H,{data:{type:this.trouble.trouble_type},showHeader:!1,height:"99vh",width:"99vw",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(i=>{this.tHttpService.changeTroubleTypeForTrouble(this.trouble.id,i.id).subscribe({next:o=>{0===o.status?this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 ph\xe2n lo\u1ea1i s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"}):2===o.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${o.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o.message))},error:o=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o)}})})}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.ez),e.Y36(k.$),e.Y36(w.R),e.Y36(T.xA),e.Y36(Z.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-detail"]],inputs:{trouble:"trouble"},outputs:{closeEvent:"closeEvent",changeEvent:"changeEvent"},decls:12,vars:4,consts:[[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],["class","card",4,"ngIf"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","pl-2","pr-1","border-gray-300"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check","class","mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","label","\u0110\xe3 x\u1eed l\xfd","icon","fa-solid fa-check-double","class","mr-1",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","label","\u0110\xednh k\xe8m","icon","fa-solid fa-paperclip",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","Ph\xe2n lo\u1ea1i","icon","pi pi-server",1,"mr-1",3,"disabled","click"],[1,"card"],[1,"py-0","pl-2","pr-1"],[1,"font-bold","text-blue-500"],[4,"ngIf"],[1,"py-1","px-2","text-white","border-round-sm",3,"ngStyle"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","\u0110\xe3 x\u1eed l\xfd","icon","fa-solid fa-check-double",1,"mr-1",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2),e._uU(3,"Chi ti\u1ebft s\u1ef1 c\u1ed1"),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.onClose()}),e.qZA()(),e.TgZ(5,"div",4),e.YNc(6,nt,36,13,"div",5),e.qZA(),e.TgZ(7,"div",6),e.YNc(8,ot,1,0,"button",7),e.YNc(9,st,1,0,"button",8),e.TgZ(10,"button",9),e.NdJ("click",function(){return i.onViewAttach()}),e.qZA(),e.TgZ(11,"button",10),e.NdJ("click",function(){return i.onClassify()}),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("ngIf",i.trouble),e.xp6(2),e.Q6J("ngIf",i.trouble&&0==i.trouble.state&&i.permission.trouble.process),e.xp6(1),e.Q6J("ngIf",i.trouble&&1==i.trouble.state&&i.permission.trouble.process),e.xp6(2),e.Q6J("disabled","Thi\u1ebft b\u1ecb"==i.trouble.group))},directives:[x.Hq,C.H,h.O5,h.PC],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:42px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:42px;bottom:42px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:42px;left:0;width:100%}"]}),n})();var lt=a(374);const at=["divBound"],ct=["divDetail"],ut=["divEvent"];function pt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",7,8)(2,"app-trouble-detail",9),e.NdJ("closeEvent",function(){return e.CHM(t),e.oxw(2).onCloseDetail()})("changeEvent",function(){return e.CHM(t),e.oxw(2).onStateChange()}),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("trouble",t.selectedTrouble)}}function dt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",10,11)(2,"app-trouble-new-event",12),e.NdJ("closeEvent",function(){return e.CHM(t),e.oxw(2).onCloseTroubleEvent()})("troubleSelected",function(o){return e.CHM(t),e.oxw(2).onTroubleSelected(o)}),e.qZA()()}}function mt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e._UZ(2,"div",4),e.YNc(3,pt,3,1,"div",5),e.YNc(4,dt,3,0,"div",6),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.display_detail),e.xp6(1),e.Q6J("ngIf",t.display_event)}}function ht(n,s){1&n&&(e._UZ(0,"i",20),e.TgZ(1,"span",21),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function gt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"p-messages",14),e.YNc(2,ht,3,0,"ng-template",15),e.qZA()(),e.TgZ(3,"div",16)(4,"div",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",18),e.TgZ(6,"span",19),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}let ft=(()=>{class n{constructor(t,i,o,r,l,u,d,b,E){this.messageService=t,this.renderer=i,this.dialogService=o,this.permissionService=r,this.userService=l,this.viewContainerRef=u,this.router=d,this.comHttpService=b,this.tHttpService=E,this.display_detail=!1,this.display_event=!1,this.homeLat=21.028291,this.homeLng=105.843517,this.tooltipMap=new Map,this.firstDraw=!0,this.pixiTroubles=[],this.troubles=[]}ngOnDestroy(){this.loadTimer&&clearInterval(this.loadTimer),this.destroyAllTooltips(),this.pixiOverlay&&this.pixiOverlay.removeFrom(this.leafletMap),this.leafletMap&&this.leafletMap.remove(),this.subPermission&&this.subPermission.unsubscribe()}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.windowWidth<576?(this.display_detail&&(this.renderer.setStyle(this.divDetail.nativeElement,"width","100%"),this.renderer.setStyle(this.divDetail.nativeElement,"height","70%")),this.display_event&&(this.renderer.setStyle(this.divEvent.nativeElement,"width","100%"),this.renderer.setStyle(this.divEvent.nativeElement,"height","70%"))):(this.display_detail&&(this.renderer.setStyle(this.divDetail.nativeElement,"width","400px"),this.renderer.setStyle(this.divDetail.nativeElement,"height","100%")),this.display_event&&(this.renderer.setStyle(this.divEvent.nativeElement,"width","600px"),this.renderer.setStyle(this.divEvent.nativeElement,"height","100%")))}ngAfterViewChecked(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t)}),this.user=this.userService.getMyAccount(),this.user.latitude&&this.user.longitude&&(this.homeLat=this.user.latitude,this.homeLng=this.user.longitude)}ngAfterViewInit(){this.setStyleDiv(),this.initMap()}initMap(){this.leafletMap&&this.leafletMap.remove(),this.leafletMap=null;let t=$.K.baseMaps;this.leafletMap=_.map("trouble-map",{center:[this.homeLat,this.homeLng],zoom:g.o.MAP_ZOOM_INIT,layers:[$.K.OpenStreetMap_Mapnik],attributionControl:!1}),_.control.layers(t,{}).addTo(this.leafletMap).setPosition("bottomleft"),_.control.scale().addTo(this.leafletMap).setPosition("bottomright"),this.leafletMap.zoomControl.setPosition("bottomright");let i=_.easyButton("fa-solid fa-cog",(d,b)=>this.onConfig()),o=_.easyButton("fa-solid fa-triangle-exclamation",(d,b)=>{this.display_event=!0}),r=_.easyButton("fa-solid fa-location-crosshairs",(d,b)=>this.getCurrentPosition()),l=_.easyButton("fa-solid fa-check-double",(d,b)=>{this.onChangeStateAll(1)}),u=_.easyButton("pi pi-trash",(d,b)=>{this.onChangeStateAll(2)});_.easyBar([i,o,l,u,r]).addTo(this.leafletMap).setPosition("topright"),this.leafletMap.on("click",()=>{this.markerClicked?(_.popup({closeButton:!1}).setLatLng([this.markerClicked.lat,this.markerClicked.lng]).setContent(`${this.markerClicked.originObject.name?this.markerClicked.originObject.name:"--"}`).openOn(this.leafletMap),this.selectedTrouble=this.markerClicked.originObject,this.display_detail=!0,this.markerClicked=void 0):(this.destroyAllTooltips(),this.myMarker&&this.myMarker.removeFrom(this.leafletMap))}),this.leafletMap.on("contextmenu",d=>{this.markerRightclicked&&(_.popup({closeButton:!1}).setLatLng([this.markerRightclicked.lat,this.markerRightclicked.lng]).setContent(`${this.markerRightclicked.originObject.name?this.markerRightclicked.originObject.name:"--"}`).openOn(this.leafletMap),this.selectedTrouble=this.markerRightclicked.originObject,this.display_detail=!0,this.markerRightclicked=void 0)}),this.leafletMap.whenReady(()=>{setTimeout(()=>{this.initPixiOverlay()},100),this.autoReload()})}autoReload(){this.loadTimer=setInterval(()=>{this.fetchTroubleByLocation()},1e3*g.o.TIME_UPDATE)}initPixiOverlay(){this.pixiContainer&&(this.pixiContainer.destroy(),this.pixiContainer=null),this.pixiContainer=new G.Container;var t={doubleBuffering:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,autoPreventDefault:!1};this.pixiOverlay=_.pixiOverlay((i,o)=>{this.pixiUtils=i,this.pixiEvent=o,"add"===o.type?this.fetchOperationSetting():"moveend"===o.type&&(this.drawDeviceMarker(),this.fetchTroubleByLocation())},this.pixiContainer,t),this.pixiOverlay.addTo(this.leafletMap)}getCurrentPosition(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{let i=t.coords.latitude,o=t.coords.longitude;this.leafletMap.flyTo([i,o],18);var r=_.icon({iconUrl:"/assets/map/user-32.png",iconSize:[24,24],iconAnchor:[12,0]});this.myMarker=_.marker([i,o],{icon:r}).addTo(this.leafletMap),this.myMarker.bindTooltip(`V\u1ecb tr\xed c\u1ee7a t\xf4i:(${i},${o})`,{direction:"top"}).openTooltip()},t=>{switch(t.code){case t.PERMISSION_DENIED:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Quy\u1ec1n truy c\u1eadp v\u1ecb tr\xed b\u1ecb t\u1eeb ch\u1ed1i. C\u1ea7n cho ph\xe9p \u0111\u1ec3 m\u1edf l\u1ea1i quy\u1ec1n truy c\u1eadp"});break;case t.POSITION_UNAVAILABLE:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"V\u1ecb tr\xed kh\xf4ng s\u1eb5n s\xe0ng"});break;case t.TIMEOUT:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\u1eddi gian l\u1ea5y t\u1ecda \u0111\u1ed9 qu\xe1 l\xe2u"})}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 l\u1ea5y t\u1ecda \u0111\u1ed9 \u0111\u1ecba l\xfd"})}fetchOperationSetting(){this.comHttpService.getSetting().subscribe({next:t=>{0===t.status?(this.setting=t.data,this.fetchTroubleByLocation()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchTroubleByLocation(){let t;this.leafletMap&&(t=this.leafletMap.getBounds()),t&&this.tHttpService.getListOfTroubles(void 0,void 0,void 0,void 0,void 0,t._southWest.lat,t._southWest.lng,t._northEast.lat,t._northEast.lng,void 0,9999999,0,void 0).subscribe({next:i=>{0===i.status?(this.troubles=i.data.rows,this.destroyAllTooltips(),this.selectedTrouble&&(this.selectedTrouble=this.troubles.find(o=>o.id==this.selectedTrouble.id)),this.createMarker()):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}createMarker(){this.pixiTroubles.forEach(t=>{t.sprite.destroy()}),this.pixiTroubles=[],this.troubles.forEach(t=>{if(2!==t.state&&t.latitude&&t.longitude){let i;"Tu\u1ea7n tra"===t.group?0===t.state?i=m.N.url.BASE_IMG+this.setting.trouble_tt_icon_new:1===t.state&&(i=m.N.url.BASE_IMG+this.setting.trouble_tt_icon_received):"C\u01b0 d\xe2n"===t.group?0===t.state?i=m.N.url.BASE_IMG+this.setting.trouble_cd_icon_new:1===t.state&&(i=m.N.url.BASE_IMG+this.setting.trouble_cd_icon_received):"Thi\u1ebft b\u1ecb"===t.group&&(0===t.state?i=m.N.url.BASE_IMG+this.setting.trouble_device_icon_new:1===t.state&&(i=m.N.url.BASE_IMG+this.setting.trouble_device_icon_received)),i||(i="assets/map/warning-5-24-r.png");let o=new We.J;o.lat=t.latitude,o.lng=t.longitude,o.sprite=G.Sprite.from(i),o.firstDraw=!0,o.preZoom=void 0,o.originObject=t,this.pixiTroubles.push(o)}}),this.prepareMarkerToDraw()}prepareMarkerToDraw(){this.pixiTroubles.forEach(t=>{t.sprite.interactive=!0,t.sprite.buttonMode=!0;let i=t.originObject;t.sprite.on("click",()=>{this.markerClicked=t,this.destroyTooltip(i.id)}),t.sprite.on("tap",()=>{this.markerClicked=t,this.destroyTooltip(i.id)}),t.sprite.on("mouseover",()=>{this.destroyTooltip(i.id),this.openTooltip(i)}),t.sprite.on("mouseout",()=>{this.destroyTooltip(i.id)}),t.sprite.on("rightclick",()=>{this.markerRightclicked=t,this.destroyTooltip(i.id)}),this.pixiContainer.addChild(t.sprite)}),this.firstDraw?setTimeout(()=>{this.drawDeviceMarker(),this.firstDraw=!1},100):this.drawDeviceMarker()}drawDeviceMarker(){this.pixiTroubles.forEach(t=>{let i=this.pixiUtils.latLngToLayerPoint([t.lat,t.lng]);t.sprite.x=i.x,t.sprite.y=i.y,t.sprite.anchor.set(.5,.5),t.sprite.scale.set(1/this.pixiUtils.getScale())}),this.pixiUtils.getRenderer().render(this.pixiUtils.getContainer())}onCloseDetail(){this.display_detail=!1,this.selectedTrouble=null}onCloseTroubleEvent(){this.display_event=!1}onStateChange(){this.fetchTroubleByLocation()}openTooltip(t){let i=this.viewContainerRef.createComponent(Xe);i.instance.trouble=t;let o=_.tooltip({direction:"bottom",opacity:.95});o.setContent(i.location.nativeElement),o.setLatLng([t.latitude,t.longitude]),o.addTo(this.leafletMap),this.tooltipMap.set(t.id,{tooltip:o,ref:i})}destroyAllTooltips(){this.tooltipMap.size&&this.tooltipMap.forEach((t,i)=>{t.tooltip&&t.tooltip.removeFrom(this.leafletMap),t.ref&&t.ref.destroy()})}destroyTooltip(t){if(this.tooltipMap.has(t)){let i=this.tooltipMap.get(t);i.tooltip&&i.tooltip.removeFrom(this.leafletMap),i.ref&&i.ref.destroy(),this.tooltipMap.delete(t)}}onGoBackHome(){this.router.navigate(["/"])}onConfig(){this.dialogService.open(F,{showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}})}onTroubleSelected(t){if(t.latitude&&t.longitude){let i=_.latLng(t.latitude,t.longitude);this.leafletMap.setView(i,17),_.popup({closeButton:!1}).setLatLng(i).setContent(`${t.name}<br>(${t.latitude}, ${t.longitude})`).openOn(this.leafletMap)}else this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"C\u1ea3nh b\xe1o kh\xf4ng c\xf3 t\u1ecda \u0111\u1ed9 tr\xean b\u1ea3n \u0111\u1ed3"})}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}onChangeStateAll(t){this.tHttpService.changleStateAll(t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 thay \u0111\u1ed5i tr\u1ea1ng th\xe1i x\u1eed l\xfd th\xe0nh c\xf4ng"}),this.fetchTroubleByLocation()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(T.xA),e.Y36(k.$),e.Y36(O.K),e.Y36(e.s_b),e.Y36(Z.F0),e.Y36(R.n),e.Y36(w.R))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-map"]],viewQuery:function(t,i){if(1&t&&(e.Gf(at,5,e.SBq),e.Gf(ct,5,e.SBq),e.Gf(ut,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divDetail=o.first),e.iGM(o=e.CRH())&&(i.divEvent=o.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],["id","trouble-map"],["id","detail",4,"ngIf"],["id","event",4,"ngIf"],["id","detail"],["divDetail",""],[3,"trouble","closeEvent","changeEvent"],["id","event"],["divEvent",""],[3,"closeEvent","troubleSelected"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,mt,5,2,"div",0),e.YNc(1,gt,8,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Q6J("ngIf",i.permission.trouble.self)("ngIfElse",o)}},directives:[h.O5,rt,lt.S,D.V,f.jx,C.H],styles:["#trouble-map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;width:100%;z-index:210}#detail[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;width:350px;z-index:220;background-color:#fff}#event[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:350px;z-index:230;background-color:#fff}"]}),n})();const _t=["divBound"],bt=["divTable"],Tt=["divPaginator"];function vt(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",24),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",25),e._uU(4,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(5,"th",26),e._uU(6,"T\xean"),e.qZA(),e.TgZ(7,"th",26),e._uU(8,"N\u1ed9i dung"),e.qZA(),e.TgZ(9,"th",26),e._uU(10,"\u0110\u1ecba \u0111i\u1ec3m"),e.qZA(),e.TgZ(11,"th",27),e._uU(12,"T\u1ecda \u0111\u1ed9"),e.qZA(),e.TgZ(13,"th",28),e._uU(14,"\u0110V ti\u1ebfp nh\u1eadn"),e.qZA(),e.TgZ(15,"th",28),e._uU(16,"Th\u1eddi gian t\u1ea1o"),e.qZA()())}const yt=function(n){return{"background-color":n}};function Ct(n,s){if(1&n&&(e.TgZ(0,"tr")(1,"td",24),e._uU(2),e.qZA(),e.TgZ(3,"td",25)(4,"span",29),e._uU(5),e.qZA()(),e.TgZ(6,"td",26),e._uU(7),e.qZA(),e.TgZ(8,"td",26),e._uU(9),e.qZA(),e.TgZ(10,"td",26),e._uU(11),e.qZA(),e.TgZ(12,"td",27),e._uU(13),e.qZA(),e.TgZ(14,"td",28),e._uU(15),e.qZA(),e.TgZ(16,"td",28),e._uU(17),e.qZA()()),2&n){const t=s.$implicit,i=s.rowIndex,o=e.oxw(2);e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+i),e.xp6(2),e.Q6J("ngStyle",e.VKq(11,yt,0===t.state?"red":1===t.state?"orange":"green")),e.xp6(1),e.Oqu(t.state_name),e.xp6(2),e.AsE("",t.name," (#",t.id,")"),e.xp6(2),e.Oqu(t.content),e.xp6(2),e.Oqu(t.address),e.xp6(2),e.AsE("",t.latitude,", ",t.longitude,""),e.xp6(2),e.Oqu(null==t.company?null:t.company.name),e.xp6(2),e.Oqu(o.convertTime(t.createdAt))}}function xt(n,s){1&n&&(e.TgZ(0,"div",30),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}const Zt=function(){return[15,20,30,50]};function wt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4),e._UZ(3,"p-breadcrumb",5),e.TgZ(4,"div",6)(5,"h3",7),e._UZ(6,"i",8),e._uU(7,"Danh s\xe1ch B\xe1o s\u1ef1 c\u1ed1 c\u1ee7a t\xf4i "),e.qZA()(),e.TgZ(8,"div",9,10)(10,"p-table",11),e.YNc(11,vt,17,0,"ng-template",12),e.YNc(12,Ct,18,13,"ng-template",13),e.YNc(13,xt,2,0,"ng-template",14),e.qZA()()(),e.TgZ(14,"div",15,16)(16,"div",17),e._UZ(17,"div",18),e.TgZ(18,"div",19)(19,"p-paginator",20),e.NdJ("onPageChange",function(o){return e.CHM(t),e.oxw().onPageChange(o)}),e.qZA()(),e.TgZ(20,"div",21)(21,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(22,"span",23),e._uU(23),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(7),e.Q6J("value",t.reports)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(13,Zt))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function Et(n,s){1&n&&(e._UZ(0,"i",38),e.TgZ(1,"span",39),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function At(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",31)(1,"p-messages",32),e.YNc(2,Et,3,0,"ng-template",33),e.qZA()(),e.TgZ(3,"div",34)(4,"div",35),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",36),e.TgZ(6,"span",37),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}let St=(()=>{class n{constructor(t,i,o,r,l,u){this.tHttpService=t,this.messageService=i,this.renderer=o,this.permissionService=r,this.router=l,this.userService=u,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.reports=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-62}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t="";return t=this.windowWidth<576?.95*this.windowWidth+"px":this.windowWidth>=576&&this.windowWidth<768?.55*this.windowWidth+"px":this.windowWidth>=768&&this.windowWidth<992?.45*this.windowWidth+"px":this.windowWidth>=992&&this.windowWidth<1400?.4*this.windowWidth+"px":.3*this.windowWidth+"px",t}ngOnInit(){this.user=this.userService.getMyAccount(),this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfReportByMe())})}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd s\u1ef1 c\u1ed1",disabled:!0},{label:"B\xe1o s\u1ef1 c\u1ed1 c\u1ee7a t\xf4i",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfReportByMe(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubles(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.user.id,this.itemsPerPage,this.offset,void 0).subscribe({next:t=>{0===t.status?(this.reports=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfReportByMe()}onReSync(){this.fetchListOfReportByMe()}convertTime(t){return S.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.R),e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(k.$),e.Y36(Z.F0),e.Y36(O.K))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-report-list"]],viewQuery:function(t,i){if(1&t&&(e.Gf(_t,5,e.SBq),e.Gf(bt,5,e.SBq),e.Gf(Tt,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divTable=o.first),e.iGM(o=e.CRH())&&(i.divPaginator=o.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"page-content","mt-1"],["divTable",""],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],[2,"min-width","150px"],[2,"min-width","300px"],[2,"min-width","100px"],[2,"min-width","200px"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,wt,24,14,"div",0),e.YNc(1,At,8,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Q6J("ngIf",i.permission.trouble.report)("ngIfElse",o)}},directives:[h.O5,U.a,v.iA,f.jx,h.PC,M.D,x.Hq,C.H,D.V],styles:[""]}),n})();var Dt=a(2304),W=a(7579),z=a(7295);function Pt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"webcam",9),e.NdJ("imageCapture",function(o){return e.CHM(t),e.oxw().handleImage(o)})("initError",function(o){return e.CHM(t),e.oxw().handleInitError(o)}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("height",300)("width",350)("trigger",t.triggerObservable)("allowCameraSwitch",!1)("switchCamera",t.nextWebcamObservable)("imageQuality",1)}}function kt(n,s){1&n&&(e.TgZ(0,"div",10)(1,"div",11)(2,"span",12),e._uU(3,"Kh\xf4ng c\xf3 camera"),e.qZA()()())}let qt=(()=>{class n{constructor(t,i){this.ref=t,this.messageService=i,this.multipleWebcamsAvailable=!1,this.trigger=new W.x,this.nextWebcam=new W.x,this.has_error=!1}ngOnInit(){z.BF.getAvailableVideoInputs().then(t=>{this.multipleWebcamsAvailable=t&&t.length>1})}triggerSnapshot(){this.trigger.next()}handleInitError(t){t&&(this.has_error=!0,this.messageService.add(t.mediaStreamError&&"NotAllowedError"===t.mediaStreamError.name?{severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Camera b\u1ecb t\u1eeb ch\u1ed1i c\u1ea5p quy\u1ec1n t\u1eeb ng\u01b0\u1eddi s\u1eed d\u1ee5ng."}:!t.mediaStreamError||"NotReadableError"!==t.mediaStreamError.name&&"NotFoundError"!==t.mediaStreamError.name?{severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"C\xf3 l\u1ed7i x\u1ea3y ra."}:{severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng c\xf3 camera t\u01b0\u01a1ng th\xedch."}))}showNextWebcam(t){this.nextWebcam.next(t)}handleImage(t){const i=t.imageAsDataUrl.split(","),o=i[0].match(/:(.*?);/)[1],r=atob(i[1]);let l=r.length;const u=new Uint8Array(l);for(;l--;)u[l]=r.charCodeAt(l);const d=new File([u],`IMG_${Number(new Date)}.jpg`,{type:o});this.ref.close({file:d,url:t.imageAsDataUrl})}get triggerObservable(){return this.trigger.asObservable()}get nextWebcamObservable(){return this.nextWebcam.asObservable()}onDestroy(){this.ref.destroy()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.E7),e.Y36(f.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-camera"]],decls:8,vars:4,consts:[[1,"relative","h-full","w-full","bg-white","border-round-xl"],["class","cam absolute flex justify-content-center",4,"ngIf"],[1,"cmd","absolute"],[1,"absolute","bottom-0","w-full","p-2","flex","align-items-center","justify-content-center"],["pButton","","pRipple","","type","button","icon","pi pi-sync",1,"p-button-rounded","p-button-outlined","mr-2",3,"disabled","click"],["pButton","","pRipple","","type","button","icon","pi pi-camera",1,"p-button-rounded","p-button-outlined","mr-2",3,"disabled","click"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-outlined",3,"click"],["class","no-camera absolute",4,"ngIf"],[1,"cam","absolute","flex","justify-content-center"],[3,"height","width","trigger","allowCameraSwitch","switchCamera","imageQuality","imageCapture","initError"],[1,"no-camera","absolute"],[1,"absolute","h-full","w-full","flex","align-items-center","justify-content-center"],[1,"text-2xl","font-bold"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Pt,2,6,"div",1),e.TgZ(2,"div",2)(3,"div",3)(4,"button",4),e.NdJ("click",function(){return i.showNextWebcam(!0)}),e.qZA(),e.TgZ(5,"button",5),e.NdJ("click",function(){return i.triggerSnapshot()}),e.qZA(),e.TgZ(6,"button",6),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()()(),e.YNc(7,kt,4,0,"div",7),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!i.has_error),e.xp6(3),e.Q6J("disabled",!i.multipleWebcamsAvailable||i.has_error),e.xp6(1),e.Q6J("disabled",i.has_error),e.xp6(2),e.Q6J("ngIf",i.has_error))},directives:[h.O5,z.i3,x.Hq,C.H],styles:[".cam[_ngcontent-%COMP%]{top:30px;left:0;right:0;z-index:1000}.cmd[_ngcontent-%COMP%]{height:40px;bottom:10px;left:0;right:0;z-index:2000}.no-camera[_ngcontent-%COMP%]{top:40px;bottom:40px;left:0;right:0;z-index:3000}"]}),n})();var It=a(6015),Mt=a(8759),Ut=a(2472),Lt=a(8185),j=a(3407);const Nt=["divBound"],Rt=["divTable"],Ot=["divPaginator"],Bt=["fileUploader"];function Ft(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",31)(1,"div"),e._UZ(2,"img",32),e.qZA(),e.TgZ(3,"button",33),e.NdJ("click",function(){const r=e.CHM(t).$implicit;return e.oxw(2).onImageRemove(r)}),e.qZA()()}if(2&n){const t=s.$implicit;e.xp6(2),e.Q6J("src",t.url,e.LSH)}}function Jt(n,s){if(1&n&&(e.TgZ(0,"div")(1,"p-carousel",29),e.YNc(2,Ft,4,1,"ng-template",30),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("value",t.images)("numVisible",3)("numScroll",1)("circular",!0)("autoplayInterval",3e3)("responsiveOptions",t.responsiveOptions)}}function Ht(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",35),e.NdJ("onRemove",function(){const r=e.CHM(t).$implicit;return e.oxw(2).onFileRemove(r)}),e.qZA()}2&n&&(e.s9C("label",s.$implicit.name),e.Q6J("removable",!0))}function Yt(n,s){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,Ht,1,2,"p-chip",34),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.files)}}const Qt=function(){return{height:"6px"}};function Gt(n,s){1&n&&e._UZ(0,"p-progressBar",36),2&n&&e.Akn(e.DdM(2,Qt))}function $t(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *Nh\u1eadp n\u1ed9i dung b\xe1o c\xe1o s\u1ef1 c\u1ed1."),e.qZA())}function Wt(n,s){if(1&n&&(e.TgZ(0,"small",37),e.YNc(1,$t,2,0,"div",15),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.content.invalid)}}function zt(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *Nh\u1eadp \u0111\u1ecba ch\u1ec9 x\u1ea3y ra s\u1ef1 c\u1ed1."),e.qZA())}function jt(n,s){if(1&n&&(e.TgZ(0,"small",37),e.YNc(1,zt,2,0,"div",15),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.address.invalid)}}function Vt(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *Ch\u1ecdn \u0111\u01a1n v\u1ecb qu\u1ea3n l\xfd."),e.qZA())}function Xt(n,s){if(1&n&&(e.TgZ(0,"small",37),e.YNc(1,Vt,2,0,"div",15),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.company.invalid)}}function Kt(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",19)(1,"p-dropdown",38),e.NdJ("onChange",function(){return e.CHM(t),e.oxw().onCompanyChange()}),e.qZA(),e.YNc(2,Xt,2,1,"small",21),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("options",t.companies),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.company.invalid&&t.formGroup.controls.company.touched)}}function ei(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *Ch\u1ecdn lo\u1ea1i s\u1ef1 c\u1ed1."),e.qZA())}function ti(n,s){if(1&n&&(e.TgZ(0,"small",37),e.YNc(1,ei,2,0,"div",15),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.type.invalid)}}function ii(n,s){if(1&n&&(e.TgZ(0,"div",19),e._UZ(1,"p-dropdown",39),e.YNc(2,ti,2,1,"small",21),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("options",t.types),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.type.invalid&&t.formGroup.controls.type.touched)}}let ni=(()=>{class n{constructor(t,i,o,r,l,u,d,b){this.cHttpService=t,this.tHttpService=i,this.dHttpService=o,this.messageService=r,this.renderer=l,this.dialogService=u,this.formBuilder=d,this.userService=b,this.use_case="guest",this.companies=[],this.types=[],this.en_select_company=!0,this.files=[],this.images=[],this.en_display_file_area=!0,this.max_file_size=1048576*g.o.MAX_FILE_SIZE,this.upload_progress=0,this.responsiveOptions=[{breakpoint:"1920px",numVisible:8,numScroll:1},{breakpoint:"1366px",numVisible:5,numScroll:1},{breakpoint:"1024px",numVisible:3,numScroll:1},{breakpoint:"768px",numVisible:2,numScroll:1},{breakpoint:"560px",numVisible:1,numScroll:1}]}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-62}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t="";return t=this.windowWidth<576?.95*this.windowWidth+"px":this.windowWidth>=576&&this.windowWidth<768?.55*this.windowWidth+"px":this.windowWidth>=768&&this.windowWidth<992?.45*this.windowWidth+"px":this.windowWidth>=992&&this.windowWidth<1400?.4*this.windowWidth+"px":.3*this.windowWidth+"px",t}ngOnInit(){this.formGroup=this.formBuilder.group({content:["",[c.kI.required]],address:["",[c.kI.required]],company:["",[c.kI.required]],type:["",[c.kI.required]]}),this.user=this.userService.getMyAccount(),"guest"==this.use_case?this.fetchListOfCompaniesByGuest():this.user&&6===this.user.user_group_id?this.fetchListOfCompanies():this.user&&(2===this.user.user_group_id||3===this.user.user_group_id)&&(this.en_select_company=!1,this.formGroup.controls.company.disable(),this.fetchListOfTroubleTypes())}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd s\u1ef1 c\u1ed1",disabled:!0},{label:"B\xe1o s\u1ef1 c\u1ed1",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfCompanies(){this.cHttpService.getList(999999,0).subscribe({next:t=>{0===t.status?this.companies=t.data.rows:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchListOfCompaniesByGuest(){this.cHttpService.getListByGuest(999999,0).subscribe({next:t=>{0===t.status?this.companies=t.data.rows:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onCompanyChange(){this.formGroup.controls.type.setValue(""),this.types=[],this.fetchListOfTroubleTypesByGuest(this.formGroup.value.company)}fetchListOfTroubleTypes(){this.tHttpService.getListOfTroubleTypes(999999,0,1).subscribe({next:t=>{0===t.status?this.types=t.data.rows:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchListOfTroubleTypesByGuest(t){this.tHttpService.getListOfTroubleTypesByGuest(t,1).subscribe({next:i=>{0===i.status?this.types=i.data.rows:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onFileAttach(t){if(t.target.files.length>0){for(const i of t.target.files)if(i.size<=this.max_file_size&&i.type.includes("image")){this.en_display_file_area=!1;const o=new FileReader;o.onload=r=>this.images.push({file:i,url:o.result}),o.readAsDataURL(i)}else i.size<=this.max_file_size?this.files.push(i):this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:`File ${i.name} v\u01b0\u1ee3t qu\xe1 10MB dung l\u01b0\u1ee3ng cho ph\xe9p`});this.fileUploader.nativeElement.value=null}this.en_display_file_area||setTimeout(()=>{this.en_display_file_area=!0},50)}onLoadFileUrl(t){let i;const o=new FileReader;o.onload=r=>{i=o.result},o.readAsDataURL(t)}onFileRemove(t){this.files.splice(this.files.indexOf(t),1)}onImageRemove(t){this.images.splice(this.images.indexOf(t),1)}onScanQr(){this.dialogService.open(Dt.H,{showHeader:!1,width:"320px",height:"390px",contentStyle:{padding:"0",margin:0,"background-color":"transparent"}}).onClose.subscribe(i=>{i&&("guest"==this.use_case||this.user&&6===this.user.user_group_id?this.fetchDeviceByCodeByGuest(i):(2===this.user.user_group_id||3===this.user.user_group_id)&&this.fetchDeviceByCode(i))})}fetchDeviceByCode(t){this.dHttpService.getDeviceByCode(t).subscribe({next:i=>{0===i.status?(this.device=i.data,this.formGroup.controls.content.setValue(`Thi\u1ebft b\u1ecb '${this.device.name} (#${this.device.id}), t\u1ecda \u0111\u1ed9 (${this.device.latitude},${this.device.longitude})' \u0111ang g\u1eb7p ra s\u1ef1 c\u1ed1`)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}fetchDeviceByCodeByGuest(t){this.dHttpService.getDeviceByCodeByGuest(t).subscribe({next:i=>{0===i.status?(this.device=i.data,this.formGroup.controls.content.setValue(`Thi\u1ebft b\u1ecb '${this.device.name} (#${this.device.id}), t\u1ecda \u0111\u1ed9 (${this.device.latitude},${this.device.longitude})' \u0111ang g\u1eb7p ra s\u1ef1 c\u1ed1`),this.formGroup.controls.company.setValue(this.device.company_id),this.formGroup.controls.company.disable(),this.formGroup.controls.type.setValue(""),this.types=[],this.fetchListOfTroubleTypesByGuest(this.device.company_id)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onCamera(){var t=this;return(0,N.Z)(function*(){t.dialogService.open(qt,{showHeader:!1,width:"400px",height:"360px",contentStyle:{padding:"0",margin:0,"background-color":"transparent"}}).onClose.subscribe(o=>{o&&(t.en_display_file_area=!1,t.images.push({file:o.file,url:o.url}),setTimeout(()=>{t.en_display_file_area=!0},50))})})()}onSubmit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.latitude=t.coords.latitude,this.longitude=t.coords.longitude,this.onSend()},t=>{switch(t.code){case t.PERMISSION_DENIED:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Quy\u1ec1n truy c\u1eadp v\u1ecb tr\xed b\u1ecb t\u1eeb ch\u1ed1i. C\u1ea7n cho ph\xe9p \u0111\u1ec3 m\u1edf l\u1ea1i quy\u1ec1n truy c\u1eadp"});break;case t.POSITION_UNAVAILABLE:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"V\u1ecb tr\xed kh\xf4ng s\u1eb5n s\xe0ng"});break;case t.TIMEOUT:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\u1eddi gian l\u1ea5y t\u1ecda \u0111\u1ed9 qu\xe1 l\xe2u"})}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 l\u1ea5y t\u1ecda \u0111\u1ed9 \u0111\u1ecba l\xfd"})}onSend(){"guest"==this.use_case?this.onCreateByGuest():this.onCreateByUser()}onCreateByUser(){let t=[];this.images.forEach(i=>t.push(i.file)),this.tHttpService.createReport(this.formGroup.value.content,this.latitude,this.longitude,this.formGroup.value.address,this.formGroup.value.type,this.device?void 0:6==this.user.user_group_id?this.formGroup.value.company:void 0,this.device?this.device.id:void 0,t,this.files).subscribe({next:i=>{"error"===i.message?(console.error("C\xf3 l\u1ed7i trong qu\xe1 tr\xecnh t\u1ea3i file: ",i.message),this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i trong qu\xe1 tr\xecnh t\u1ea3i file"}),this.upload_progress=0):"progress"===i.message?this.upload_progress=i.status:0===i.status&&"Th\xe0nh c\xf4ng"===i.message&&(this.upload_progress=0,this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 g\u1eedi b\xe1o c\xe1o s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng."}),setTimeout(()=>{window.location.reload()},500))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.upload_progress=0}})}onCreateByGuest(){let t=[];this.images.forEach(i=>t.push(i.file)),this.tHttpService.createReportByGuest(this.formGroup.value.content,this.latitude,this.longitude,this.formGroup.value.address,this.formGroup.value.type,this.device?void 0:this.formGroup.value.company,this.device?this.device.id:void 0,t,this.files).subscribe({next:i=>{"error"===i.message?(console.error("C\xf3 l\u1ed7i trong qu\xe1 tr\xecnh t\u1ea3i file: ",i.message),this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i trong qu\xe1 tr\xecnh t\u1ea3i file"}),this.upload_progress=0):"progress"===i.message?this.upload_progress=i.status:0===i.status&&"Th\xe0nh c\xf4ng"===i.message&&(this.upload_progress=0,this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 g\u1eedi b\xe1o c\xe1o s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng."}),setTimeout(()=>{window.location.reload()},500))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.upload_progress=0}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(R.n),e.Y36(w.R),e.Y36(It.x),e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(T.xA),e.Y36(c.qu),e.Y36(O.K))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-create-trouble-report"]],viewQuery:function(t,i){if(1&t&&(e.Gf(Nt,5,e.SBq),e.Gf(Rt,5,e.SBq),e.Gf(Ot,5,e.SBq),e.Gf(Bt,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divTable=o.first),e.iGM(o=e.CRH())&&(i.divPaginator=o.first),e.iGM(o=e.CRH())&&(i.fileUploader=o.first)}},inputs:{use_case:"use_case"},decls:36,vars:11,consts:[[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"overflow-auto"],["divTable",""],[1,"m-2"],["pButton","","pRipple","","type","button","label","Qu\xe9t m\xe3","icon","fa-solid fa-qrcode",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","Ch\u1ee5p \u1ea3nh","icon","fa-solid fa-camera",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","\u0110\xednh k\xe8m","icon","fa-solid fa-paperclip",1,"mr-1",3,"click"],["type","file","multiple","",2,"display","none",3,"change"],["fileUploader","","fileUp",""],[4,"ngIf"],["mode","indeterminate",3,"style",4,"ngIf"],[3,"formGroup"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["rows","6","pInputTextarea","","formControlName","content","placeholder","Nh\u1eadp n\u1ed9i dung b\xe1o c\xe1o"],["class","text-red-500",4,"ngIf"],["rows","3","pInputTextarea","","formControlName","address","placeholder","Nh\u1eadp \u0111\u1ecba ch\u1ec9"],["class","field mb-2",4,"ngIf"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","flex","align-items-center","p-1"],["pButton","","pRipple","","type","button","label","G\u1eedi","icon","fa-solid fa-plus",1,"mr-1",3,"disabled","click"],["styleClass","custom-carousel",3,"value","numVisible","numScroll","circular","autoplayInterval","responsiveOptions"],["pTemplate","item"],[1,"text-center"],[1,"img",3,"src"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-outlined","m-1",3,"click"],["icon","pi pi-file","styleClass","m-1",3,"label","removable","onRemove",4,"ngFor","ngForOf"],["icon","pi pi-file","styleClass","m-1",3,"label","removable","onRemove"],["mode","indeterminate"],[1,"text-red-500"],["formControlName","company","optionLabel","name","optionValue","id","placeholder","Ch\u1ecdn \u0111\u01a1n v\u1ecb qu\u1ea3n l\xfd","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","onChange"],["formControlName","type","optionLabel","name","optionValue","id","placeholder","Ch\u1ecdn lo\u1ea1i s\u1ef1 c\u1ed1","panelStyleClass","text-overflow-ellipsis text-sm",3,"options"]],template:function(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",0,1),e.NdJ("resize",function(){return i.onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",2),e._UZ(3,"p-breadcrumb",3),e.TgZ(4,"div",4)(5,"h3",5),e._UZ(6,"i",6),e._uU(7,"B\xe1o c\xe1o s\u1ef1 c\u1ed1 "),e.qZA()(),e.TgZ(8,"div",7,8)(10,"div",9)(11,"button",10),e.NdJ("click",function(){return i.onScanQr()}),e.qZA(),e.TgZ(12,"button",11),e.NdJ("click",function(){return i.onCamera()}),e.qZA(),e.TgZ(13,"button",12),e.NdJ("click",function(){return e.CHM(o),e.MAs(16).click()}),e.qZA(),e.TgZ(14,"input",13,14),e.NdJ("change",function(l){return i.onFileAttach(l)}),e.qZA()(),e.TgZ(17,"div",9),e.YNc(18,Jt,3,6,"div",15),e.YNc(19,Yt,2,1,"div",15),e.YNc(20,Gt,1,3,"p-progressBar",16),e.qZA(),e.TgZ(21,"form",17)(22,"div",18)(23,"div",19),e._UZ(24,"textarea",20),e.YNc(25,Wt,2,1,"small",21),e.qZA(),e.TgZ(26,"div",19),e._UZ(27,"textarea",22),e.YNc(28,jt,2,1,"small",21),e.qZA(),e.YNc(29,Kt,3,2,"div",23),e.YNc(30,ii,3,2,"div",23),e.qZA()()()(),e.TgZ(31,"div",24,25)(33,"div",26)(34,"div",27)(35,"button",28),e.NdJ("click",function(){return i.onSubmit()}),e.qZA()()()()()}2&t&&(e.xp6(3),e.Q6J("model",i.pathLinks)("home",i.homeLink),e.xp6(15),e.Q6J("ngIf",i.en_display_file_area&&i.images&&i.images.length),e.xp6(1),e.Q6J("ngIf",i.files&&i.files.length),e.xp6(1),e.Q6J("ngIf",i.upload_progress),e.xp6(1),e.Q6J("formGroup",i.formGroup),e.xp6(4),e.Q6J("ngIf",i.formGroup.controls.content.invalid&&i.formGroup.controls.content.touched),e.xp6(3),e.Q6J("ngIf",i.formGroup.controls.address.invalid&&i.formGroup.controls.address.touched),e.xp6(1),e.Q6J("ngIf",i.en_select_company&&i.companies.length&&!i.device),e.xp6(1),e.Q6J("ngIf",i.types.length),e.xp6(5),e.Q6J("disabled",i.formGroup.invalid))},directives:[U.a,x.Hq,C.H,h.O5,Mt.l,f.jx,h.sg,Ut.A,Lt.k,c._Y,c.JL,c.sg,c.Fj,j.g,c.JJ,c.u,Q.Lt],styles:[".img[_ngcontent-%COMP%]{height:100px;box-shadow:0 3px 6px #00000029,0 3px 6px #0000003b}"]}),n})(),oi=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-report"]],decls:1,vars:1,consts:[[3,"use_case"]],template:function(t,i){1&t&&e._UZ(0,"app-create-trouble-report",0),2&t&&e.Q6J("use_case","user")},directives:[ni],styles:[""]}),n})();function si(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *C\u1ea7n \u0111i\u1ec1n t\xean cho Lo\u1ea1i s\u1ef1 c\u1ed1."),e.qZA())}function ri(n,s){1&n&&(e.TgZ(0,"div"),e._uU(1," *T\xean Lo\u1ea1i s\u1ef1 c\u1ed1 d\xe0i \xedt nh\u1ea5t 2 k\xfd t\u1ef1."),e.qZA())}function li(n,s){if(1&n&&(e.TgZ(0,"small",17),e.YNc(1,si,2,0,"div",18),e.YNc(2,ri,2,0,"div",18),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.name.invalid),e.xp6(1),e.Q6J("ngIf",t.formGroup.controls.name.errors.minlength)}}let V=(()=>{class n{constructor(t,i,o,r,l){this.ref=t,this.config=i,this.formBuilder=o,this.tHttpService=r,this.messageService=l,this.title="Th\xeam m\u1edbi Lo\u1ea1i s\u1ef1 c\u1ed1"}ngOnInit(){this.formGroup=this.formBuilder.group({name:["",[c.kI.required,c.kI.minLength(2)]],description:[""]}),this.config.data&&(this.type=this.config.data.type,this.title=this.config.data.title,this.formGroup.setValue({name:this.type.name,description:this.type.description}))}onSubmit(){this.type?this.onEdit():this.onAdd()}onAdd(){this.tHttpService.createTroubleType(this.formGroup.value.name,this.formGroup.value.description).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea1o Lo\u1ea1i s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"}),this.ref.close("success")):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onEdit(){this.tHttpService.editTroubleType(this.type.id,this.formGroup.value.name,this.formGroup.value.description).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 c\u1eadp nh\u1eadt Lo\u1ea1i s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"}),this.ref.close("success")):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onDestroy(){this.ref.destroy()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.E7),e.Y36(T.S),e.Y36(c.qu),e.Y36(w.R),e.Y36(f.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-create-or-edit-trouble-type"]],decls:22,vars:4,consts:[[3,"formGroup","ngSubmit"],[1,"outbound"],[1,"header","flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","text-xl","font-bold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"p-fluid","m-2"],[1,"field","mb-2"],["for","name"],[1,"ml-2","text-red-500"],["id","name","type","text","aria-describedby","name-help","pInputText","","formControlName","name"],["id","name-help","class","text-red-500",4,"ngIf"],["for","desc"],["id","desc","rows","3","pInputTextarea","","formControlName","description"],[1,"footer","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","submit","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-floppy-disk",1,"mr-1",3,"disabled"],["id","name-help",1,"text-red-500"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),e._uU(10,"T\xean Lo\u1ea1i s\u1ef1 c\u1ed1"),e.TgZ(11,"span",9),e._uU(12,"(*)"),e.qZA()(),e._UZ(13,"input",10),e.YNc(14,li,3,2,"small",11),e.qZA(),e.TgZ(15,"div",7)(16,"label",12),e._uU(17,"M\xf4 t\u1ea3"),e.qZA(),e._UZ(18,"textarea",13),e.qZA()()(),e.TgZ(19,"div",14)(20,"button",15),e.NdJ("click",function(){return i.onDestroy()}),e.qZA(),e._UZ(21,"button",16),e.qZA()()()),2&t&&(e.Q6J("formGroup",i.formGroup),e.xp6(4),e.Oqu(i.title),e.xp6(10),e.Q6J("ngIf",i.formGroup.controls.name.invalid&&i.formGroup.controls.name.touched),e.xp6(7),e.Q6J("disabled",i.formGroup.invalid))},directives:[c._Y,c.JL,c.sg,x.Hq,C.H,c.Fj,Y.o,c.JJ,c.u,h.O5,j.g],styles:[".outbound[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden}.outbound[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:45px}.outbound[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:45px;bottom:45px;left:0;width:100%;overflow:auto}.outbound[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;left:0;width:100%}"]}),n})();var ai=a(9269),ci=a(3542);const ui=["divBound"],pi=["divTable"],di=["divPaginator"];function mi(n,s){1&n&&(e.TgZ(0,"tr")(1,"th",28),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",29),e._uU(4,"T\xean "),e._UZ(5,"p-sortIcon",30),e.qZA(),e.TgZ(6,"th",31),e._uU(7,"M\xf4 t\u1ea3"),e.qZA(),e.TgZ(8,"th",32),e._uU(9,"Th\u1eddi gian t\u1ea1o "),e._UZ(10,"p-sortIcon",33),e.qZA(),e.TgZ(11,"th",34),e._uU(12,"C\u1eadp nh\u1eadt "),e._UZ(13,"p-sortIcon",35),e.qZA()())}function hi(n,s){if(1&n&&(e.TgZ(0,"tr",36)(1,"td",28),e._uU(2),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",31),e._uU(6),e.qZA(),e.TgZ(7,"td",37),e._uU(8),e.qZA(),e.TgZ(9,"td",37),e._uU(10),e.qZA()()),2&n){const t=s.$implicit,i=s.rowIndex,o=e.oxw(2);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu((o.currentPage-1)*o.itemsPerPage+1+i),e.xp6(2),e.AsE("",t.name," (#",t.id,")"),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(o.convertTime(t.createdAt)),e.xp6(2),e.Oqu(o.convertTime(t.updatedAt))}}function gi(n,s){1&n&&(e.TgZ(0,"div",38),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function fi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onAdd()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",0==t.isFromUser)}}function _i(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",40),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onEdit()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentType||0==t.currentType.is_from_user)}}function bi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onDelete()}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!t.currentType||0==t.currentType.is_from_user)}}const Ti=function(){return[15,20,30,50]};function vi(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4),e._UZ(3,"p-breadcrumb",5),e.TgZ(4,"div",6)(5,"h3",7),e._UZ(6,"i",8),e._uU(7,"Danh s\xe1ch Lo\u1ea1i s\u1ef1 c\u1ed1 "),e.qZA()(),e._UZ(8,"p-tabMenu",9),e.TgZ(9,"div",10,11)(11,"p-table",12),e.NdJ("selectionChange",function(o){return e.CHM(t),e.oxw().currentType=o}),e.YNc(12,mi,14,0,"ng-template",13),e.YNc(13,hi,11,7,"ng-template",14),e.YNc(14,gi,2,0,"ng-template",15),e.qZA()()(),e.TgZ(15,"div",16,17)(17,"div",18)(18,"div",19),e.YNc(19,fi,1,1,"button",20),e.YNc(20,_i,1,1,"button",21),e.YNc(21,bi,1,1,"button",22),e.qZA(),e.TgZ(22,"div",23)(23,"p-paginator",24),e.NdJ("onPageChange",function(o){return e.CHM(t),e.oxw().onPageChange(o)}),e.qZA()(),e.TgZ(24,"div",25)(25,"button",26),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(26,"span",27),e._uU(27),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(5),e.Q6J("model",t.tabs)("activeItem",t.activeTab),e.xp6(3),e.Q6J("selection",t.currentType)("value",t.types)("scrollable",!0)("loading",t.loading),e.xp6(8),e.Q6J("ngIf",t.permission.trouble.type_edit),e.xp6(1),e.Q6J("ngIf",t.permission.trouble.type_edit),e.xp6(1),e.Q6J("ngIf",t.permission.trouble.type_edit),e.xp6(2),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(19,Ti))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function yi(n,s){1&n&&(e._UZ(0,"i",49),e.TgZ(1,"span",50),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Ci(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-messages",43),e.YNc(2,yi,3,0,"ng-template",44),e.qZA()(),e.TgZ(3,"div",45)(4,"div",46),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",47),e.TgZ(6,"span",48),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const xi=[{path:"list",component:$e},{path:"map",component:ft},{path:"type",component:(()=>{class n{constructor(t,i,o,r,l,u,d){this.tHttpService=t,this.messageService=i,this.renderer=o,this.confirmService=r,this.dialogService=l,this.permissionService=u,this.router=d,this.tabIndex=1,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.types=[],this.isFromUser=1,this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"height",`  ${this.divBound.nativeElement.offsetHeight-this.divPaginator.nativeElement.offsetHeight-110}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t="";return t=this.windowWidth<576?.95*this.windowWidth+"px":this.windowWidth>=576&&this.windowWidth<768?.55*this.windowWidth+"px":this.windowWidth>=768&&this.windowWidth<992?.45*this.windowWidth+"px":this.windowWidth>=992&&this.windowWidth<1400?.4*this.windowWidth+"px":.3*this.windowWidth+"px",t}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfTroubleTypes())})}initForm(){this.pathLinks=[{label:"Qu\u1ea3n l\xfd s\u1ef1 c\u1ed1",disabled:!0},{label:"Danh s\xe1ch Lo\u1ea1i s\u1ef1 c\u1ed1",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"},this.tabs=[{label:"Lo\u1ea1i s\u1ef1 c\u1ed1 ng\u01b0\u1eddi d\xf9ng",command:()=>{this.tabIndex=1,this.isFromUser=1,this.fetchListOfTroubleTypes()}},{label:"Lo\u1ea1i s\u1ef1 c\u1ed1 thi\u1ebft b\u1ecb",command:()=>{this.tabIndex=2,this.isFromUser=0,this.fetchListOfTroubleTypes()}}],this.activeTab=this.tabs[0],this.tabIndex=1}fetchListOfTroubleTypes(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubleTypes(this.itemsPerPage,this.offset,this.isFromUser).subscribe({next:t=>{0===t.status?(this.types=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentType=void 0):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfTroubleTypes()}onReSync(){this.fetchListOfTroubleTypes()}onAdd(){this.dialogService.open(V,{showHeader:!1,height:"365px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfTroubleTypes()})}onEdit(){this.dialogService.open(V,{data:{type:this.currentType,title:"C\u1eadp nh\u1eadt Lo\u1ea1i s\u1ef1 c\u1ed1"},showHeader:!1,height:"365px",width:this.calcWidth(),contentStyle:{padding:"0",margin:0}}).onClose.subscribe(()=>{this.fetchListOfTroubleTypes()})}onDelete(){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Lo\u1ea1i s\u1ef1 c\u1ed1 "${this.currentType.name}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Lo\u1ea1i s\u1ef1 c\u1ed1",icon:"pi pi-info-circle"}).then(t=>{t&&this.tHttpService.deleteTroubleType(this.currentType.id).subscribe({next:i=>{0===i.status?(this.currentType=void 0,this.fetchListOfTroubleTypes(),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a Lo\u1ea1i s\u1ef1 c\u1ed1 th\xe0nh c\xf4ng"})):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}).catch(t=>{})}convertTime(t){return S.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}onComeback(){localStorage.removeItem(g.o.USER),sessionStorage.removeItem(g.o.ACC),this.router.navigate(["/come-back"])}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.R),e.Y36(f.ez),e.Y36(e.Qsj),e.Y36(ai.I),e.Y36(T.xA),e.Y36(k.$),e.Y36(Z.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-trouble-type"]],viewQuery:function(t,i){if(1&t&&(e.Gf(ui,5,e.SBq),e.Gf(pi,5,e.SBq),e.Gf(di,5,e.SBq)),2&t){let o;e.iGM(o=e.CRH())&&(i.divBound=o.first),e.iGM(o=e.CRH())&&(i.divTable=o.first),e.iGM(o=e.CRH())&&(i.divPaginator=o.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[3,"model","activeItem"],[1,"page-content","mt-1"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus","class","mx-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen","class","mr-1",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","type","button","label","X\xf3a b\u1ecf","icon","fa-solid fa-minus","class","mr-1",3,"disabled","click",4,"ngIf"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],["pSortableColumn","createdAt",2,"min-width","200px"],["field","createdAt"],["pSortableColumn","updatedAt",2,"min-width","200px"],["field","updatedAt"],[3,"pSelectableRow"],[2,"min-width","200px"],[1,"p-fluid","p-2"],["pButton","","pRipple","","type","button","label","Th\xeam","icon","fa-solid fa-plus",1,"mx-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","Ch\u1ec9nh s\u1eeda","icon","fa-solid fa-pen",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","X\xf3a b\u1ecf","icon","fa-solid fa-minus",1,"mr-1",3,"disabled","click"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,vi,28,20,"div",0),e.YNc(1,Ci,8,0,"ng-template",null,1,e.W1O)),2&t){const o=e.MAs(2);e.Q6J("ngIf",i.permission.trouble.self)("ngIfElse",o)}},directives:[h.O5,U.a,ci.d,v.iA,f.jx,v.lQ,v.fz,v.Ei,x.Hq,C.H,M.D,D.V],styles:[""]}),n})()},{path:"report",component:oi},{path:"report-list",component:St}];let Zi=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[Z.Bz.forChild(xi)],Z.Bz]}),n})();var wi=a(4695);let Ei=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[h.ez,Zi,wi.m]]}),n})()}}]);