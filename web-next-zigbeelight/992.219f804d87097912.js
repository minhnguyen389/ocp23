"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[992],{7992:(ht,F,c)=>{c.r(F),c.d(F,{DeviceReportModule:()=>pt});var C=c(9808),b=c(9979),w=c(5861),e=c(5e3),Z=c(6675),E=c(4327),y=c(4313),S=c(8087),L=c(5758);class Y{}var Q=c(1764),p=c.n(Q),z=c(5268),I=c.n(z),T=c(8215),$=c(6290),x=c(9783),A=c(5330),O=c(5431),M=c(7658),P=c(6526),_=c(2382),H=c(845),k=c(5787),J=c(5077),U=c(1424),B=c(4119),W=c(5034),v=c(8952),q=c(97),V=c(3640),G=c(3300);const j=["divBound"],X=["divHeader"],K=["divTable"];function ee(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",33),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",34),e._uU(4,"Th\u1eddi \u0111i\u1ec3m"),e.qZA(),e.TgZ(5,"th",35),e._uU(6,"Thi\u1ebft b\u1ecb"),e.qZA(),e.TgZ(7,"th",34),e._uU(8,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(9,"th",34),e._uU(10,"U1(V)"),e.qZA(),e.TgZ(11,"th",34),e._uU(12,"I1(A)"),e.qZA(),e.TgZ(13,"th",34),e._uU(14,"P1(W)"),e.qZA(),e.TgZ(15,"th",34),e._uU(16,"U2(V)"),e.qZA(),e.TgZ(17,"th",34),e._uU(18,"I2(A)"),e.qZA(),e.TgZ(19,"th",34),e._uU(20,"P2(W)"),e.qZA(),e.TgZ(21,"th",34),e._uU(22,"U3(V)"),e.qZA(),e.TgZ(23,"th",34),e._uU(24,"I3(A)"),e.qZA(),e.TgZ(25,"th",34),e._uU(26,"P3(W)"),e.qZA(),e.TgZ(27,"th",36),e._uU(28,"Th\u1eddi gian ghi"),e.qZA()())}function te(o,s){if(1&o&&(e.TgZ(0,"td",34)(1,"span",40),e._uU(2),e.qZA()()),2&o){const t=e.oxw(),i=t.$implicit;e.uIk("rowspan",t.rowspan),e.xp6(2),e.Oqu(i.time)}}function ie(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("(#",t.device_id,")")}}function ne(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("|(",t.mac,")")}}const oe=function(o){return{"background-color":o}};function se(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td",33),e._uU(2),e.qZA(),e.YNc(3,te,3,2,"td",37),e.TgZ(4,"td",35)(5,"span"),e._uU(6),e.YNc(7,ie,2,1,"span",38),e.YNc(8,ne,2,1,"span",38),e.qZA()(),e.TgZ(9,"td",34)(10,"span",39),e._uU(11),e.qZA()(),e.TgZ(12,"td",34),e._uU(13),e.qZA(),e.TgZ(14,"td",34),e._uU(15),e.qZA(),e.TgZ(16,"td",34),e._uU(17),e.qZA(),e.TgZ(18,"td",34),e._uU(19),e.qZA(),e.TgZ(20,"td",34),e._uU(21),e.qZA(),e.TgZ(22,"td",34),e._uU(23),e.qZA(),e.TgZ(24,"td",34),e._uU(25),e.qZA(),e.TgZ(26,"td",34),e._uU(27),e.qZA(),e.TgZ(28,"td",34),e._uU(29),e.qZA(),e.TgZ(30,"td",36),e._uU(31),e.qZA()()),2&o){const t=s.$implicit,n=s.rowIndex,i=s.rowgroup,a=e.oxw(2);e.xp6(2),e.Oqu(n+1),e.xp6(1),e.Q6J("ngIf",i),e.xp6(3),e.hij(" ",null==t.device?null:t.device.name," "),e.xp6(1),e.Q6J("ngIf",t.device_id),e.xp6(1),e.Q6J("ngIf",t.mac),e.xp6(2),e.Q6J("ngStyle",e.VKq(17,oe,"Offline"===t.state?"blue":"Online"===t.state?"green":null)),e.xp6(1),e.Oqu(t.state),e.xp6(2),e.Oqu(t[22]),e.xp6(2),e.Oqu(t[25]),e.xp6(2),e.Oqu(t[28]),e.xp6(2),e.Oqu(t[23]),e.xp6(2),e.Oqu(t[26]),e.xp6(2),e.Oqu(t[29]),e.xp6(2),e.Oqu(t[24]),e.xp6(2),e.Oqu(t[27]),e.xp6(2),e.Oqu(t[30]),e.xp6(2),e.Oqu(a.convertTime(t.createdAt))}}function ae(o,s){1&o&&(e.TgZ(0,"div",41),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn c\xe1c \u0111i\u1ec1u ki\u1ec7n ph\xf9 h\u1ee3p sau \u0111\xf3 t\xecm ki\u1ebfm. "),e.qZA())}const le=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function re(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",5,6),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",7,8),e._UZ(4,"p-breadcrumb",9),e.TgZ(5,"div",10)(6,"h3",11),e._UZ(7,"i",12),e._uU(8,"Ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Thi\u1ebft b\u1ecb theo th\u1eddi \u0111i\u1ec3m "),e.qZA()(),e.TgZ(9,"div",13)(10,"div",14)(11,"div",15)(12,"p-multiSelect",16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().selectedDevices=i}),e.qZA(),e.TgZ(13,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()(),e.TgZ(14,"div",18)(15,"input",19),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().rangeTimes=i}),e.qZA()(),e.TgZ(16,"div",14)(17,"div",15)(18,"p-multiSelect",20),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().selectedTimes=i}),e.qZA(),e.TgZ(19,"button",17),e.NdJ("click",function(i){return e.CHM(t),e.oxw(),e.MAs(4).toggle(i)}),e.qZA()()(),e.TgZ(20,"div",21)(21,"div",22)(22,"span")(23,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(24,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(25,"span")(26,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportExcell()}),e.qZA()()()()()(),e.TgZ(27,"div",26,27),e._UZ(29,"ngx-loading",28),e.TgZ(30,"p-table",29),e.YNc(31,ee,29,0,"ng-template",30),e.YNc(32,se,32,19,"ng-template",31),e.qZA(),e.YNc(33,ae,2,0,"div",32),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(8),e.Q6J("options",t.devices)("ngModel",t.selectedDevices),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(17,le))("showClearButton",!0)("ngModel",t.rangeTimes)("dateLimit",7),e.xp6(3),e.Q6J("options",t.times)("ngModel",t.selectedTimes),e.xp6(6),e.Q6J("disabled",!(t.selectedTimes&&0!=t.selectedTimes.length&&t.rangeTimes&&t.rangeTimes.startDate&&t.rangeTimes.endDate)),e.xp6(2),e.Q6J("disabled",!t.dataHistories||!t.dataHistories.length),e.xp6(3),e.Q6J("show",t.loading),e.xp6(1),e.Q6J("value",t.dataHistories)("lazy",!0),e.xp6(3),e.Q6J("ngIf",!t.dataHistories||!t.dataHistories.length)}}function ce(o,s){1&o&&(e._UZ(0,"i",48),e.TgZ(1,"span",49),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function de(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-messages",43),e.YNc(2,ce,3,0,"ng-template",4),e.qZA()(),e.TgZ(3,"div",44)(4,"div",45),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",46),e.TgZ(6,"span",47),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}function me(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onAddTime()}),e.qZA()}}function ue(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",54),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",55),e._uU(4,"Th\u1eddi \u0111i\u1ec3m"),e.qZA(),e.TgZ(5,"th",56),e._uU(6,"Thao t\xe1c"),e.qZA()())}function pe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",54),e._uU(2),e.qZA(),e.TgZ(3,"td",55)(4,"ngx-timepicker-field",57),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit.time=i}),e.qZA()(),e.TgZ(5,"td",34)(6,"button",58),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).onRemoveTime(a)}),e.qZA()()()}if(2&o){const t=s.$implicit,n=s.rowIndex;e.xp6(2),e.Oqu(n+1),e.xp6(2),e.MGl("name","ti",n,""),e.Q6J("ngModel",t.time)("controlOnly",!0)("format",24)}}function he(o,s){if(1&o&&(e.TgZ(0,"div",50)(1,"p-table",51),e.YNc(2,me,1,0,"ng-template",52),e.YNc(3,ue,7,0,"ng-template",30),e.YNc(4,pe,7,5,"ng-template",31),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("value",t.times)("scrollable",!0)}}const ge=function(){return{width:"320px"}};p().extend(I());let fe=(()=>{class o{constructor(t,n,i,a,l,d){this.logHttpService=t,this.messageService=n,this.renderer=i,this.dialogService=a,this.permissionService=l,this.router=d,this.devices=[],this.selectedDevices=[],this.listDeviceChecked=[],this.times=[],this.selectedTimes=[],this.dataHistories=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"Ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Thi\u1ebft b\u1ecb theo th\u1eddi \u0111i\u1ec3m",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfDeviceHistories(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3);let t=this.selectedTimes.sort();this.logHttpService.getDeviceHistory(this.selectedDevices,this.startDate,this.endDate,t).subscribe({next:n=>{0===n.status?(this.processData(n.data),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}processData(t){this.dataHistories=[],this.listDeviceChecked=[],this.listDeviceChecked=this.devices&&this.devices.length?this.devices:t.danhSachTu;for(const n in t)if("danhSachTu"!==n){let i=t[n];if(i&&i.length)i.forEach(a=>{a.time=p()(n).format("DD/MM/YYYY HH:mm:ss"),a.state="Online",this.dataHistories.push(a)}),this.listDeviceChecked.forEach(a=>{if(!i.find(l=>l.device_id==a.id)){let l=new Y;l.device=a,l.device_id=a.id,l.state="Offline",l.time=p()(n).format("DD/MM/YYYY HH:mm:ss"),this.dataHistories.push(l)}});else if(p()().diff(n,"seconds",!0)>=0)this.listDeviceChecked.forEach(l=>{let d=new Y;d.device=l,d.device_id=l.id,d.state="Offline",d.time=p()(n).format("DD/MM/YYYY HH:mm:ss"),this.dataHistories.push(d)});else{let l=new Y;l.device=new L.AS,l.device.name="Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb",l.time=p()(n).format("DD/MM/YYYY HH:mm:ss"),this.dataHistories.push(l)}}}convertTime(t){return Z.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){var t=this;return(0,w.Z)(function*(){let n=t.rangeTimes&&t.rangeTimes.startDate?p().utc(t.rangeTimes.startDate).format("DD/MM/YYYY"):"...",i=t.rangeTimes&&t.rangeTimes.endDate?p().utc(t.rangeTimes.endDate).format("DD/MM/YYYY"):"...";const a=new y.Workbook,l=a.addWorksheet("U-I-P"),d=l.getRow(2);d.height=30,l.mergeCells(2,1,2,14),d.getCell(1).value="B\xc1O C\xc1O HO\u1ea0T \u0110\u1ed8NG C\u1ee6A THI\u1ebeT B\u1eca",d.getCell(1).font={name:"Times New Roman",size:12,bold:!0},d.getCell(1).alignment={horizontal:"center"};const m=l.getRow(3);l.mergeCells(3,1,3,14),m.getCell(1).value=`T\u1eeb ${n} \u0111\u1ebfn ${i}`,m.getCell(1).font={name:"Times New Roman",size:11},m.getCell(1).alignment={horizontal:"center"};const h=l.getRow(5);h.values=["#","Th\u1eddi \u0111i\u1ec3m","Thi\u1ebft b\u1ecb","Tr\u1ea1ng th\xe1i","U1(V)","I1(A)","P1(W)","U2(V)","I2(A)","P2(W)","U3(V)","I3(A)","P3(W)","Th\u1eddi gian ghi"],h.alignment={horizontal:"center"},h.font={name:"Times New Roman",size:12,bold:!0};for(let r=1;r<15;r++)h.getCell(r).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF00BFFF"},bgColor:{argb:"FF00BFFF"}};let g=[],f={start:0,end:0,value:t.dataHistories[0].time};t.dataHistories.forEach((r,u)=>{let D=l.getRow(u+6);D.values=[u+1,r.time,`${r.device.name}${r.device_id?" (#"+r.device_id+")":""}${r.mac?"|("+r.mac+")":""}`,r.state,r[22],r[25],r[28],r[23],r[26],r[29],r[24],r[27],r[30],t.convertTime(r.createdAt)],D.font={name:"Times New Roman",size:11},r.time==f.value?f.end=u:(g.push(f),f={start:u,end:u,value:t.dataHistories[u].time}),u==t.dataHistories.length-1&&(f.end=u,g.push(f))}),g.forEach(r=>{const u=l.getRow(r.start+6);l.mergeCells(r.start+6,2,r.end+6,2),u.getCell(2).value=r.value,u.getCell(2).font={bold:!0}}),a.xlsx.writeBuffer().then(r=>{(0,E.saveAs)(new Blob([r],{type:"application/octet-stream"}),"Bao_cao_hoat_dong.xlsx")})})()}onPickDevice(){this.dialogService.open(S.$,{data:{deviceIns:this.devices,selectedDeviceIns:this.devices,title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!0,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(n=>{n&&(this.devices=n,this.selectedDevices=[],this.devices.forEach(i=>{this.selectedDevices.push(i.id)}))})}onClear(){this.devices=[],this.selectedDevices=[],this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0,this.times=[],this.selectedTimes=[]}onCloseTimeDialog(){this.selectedTimes=[],this.times.forEach(t=>{this.selectedTimes.push(t.time)})}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate&&(this.startDate=p().utc(this.rangeTimes.startDate).subtract(7,"hours").format(),this.endDate=p().utc(this.rangeTimes.endDate).subtract(7,"hours").format()),this.fetchListOfDeviceHistories()}onComeback(){localStorage.removeItem(T.o.USER),sessionStorage.removeItem(T.o.ACC),this.router.navigate(["/come-back"])}onAddTime(){this.times.push({time:"00:00"})}onRemoveTime(t){this.times.splice(this.times.indexOf(t),1)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36($.N),e.Y36(x.ez),e.Y36(e.Qsj),e.Y36(A.xA),e.Y36(O.$),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-onoff-at-time"]],viewQuery:function(t,n){if(1&t&&(e.Gf(j,5,e.SBq),e.Gf(X,5,e.SBq),e.Gf(K,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(n.divBound=i.first),e.iGM(i=e.CRH())&&(n.divHeader=i.first),e.iGM(i=e.CRH())&&(n.divTable=i.first)}},decls:6,vars:6,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[3,"showCloseIcon","onHide"],["timeDialog",""],["pTemplate",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["defaultLabel","Ch\u1ecdn thi\u1ebft b\u1ecb","emptyMessage","Ch\u1ecdn '+' \u0111\u1ec3 th\xeam","optionLabel","name","optionValue","id",3,"options","ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","ngModel","dateLimit","ngModelChange"],["optionLabel","time","optionValue","time","emptyMessage","Ch\u1ecdn '+' \u0111\u1ec3 th\xeam","defaultLabel","Ch\u1ecdn th\u1eddi \u0111i\u1ec3m",3,"options","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file",3,"disabled","click"],[1,"absolute","left-0","bottom-0","w-full","overflow-auto"],["divTable",""],[3,"show"],["rowGroupMode","rowspan","groupRowsBy","time","sortField","time","sortMode","single","styleClass","p-datatable-sm p-datatable-striped",3,"value","lazy"],["pTemplate","header"],["pTemplate","body"],["class","p-fluid p-2",4,"ngIf"],[2,"width","60px","max-width","60px"],[2,"min-width","100px"],[2,"min-width","300px"],[2,"min-width","200px"],["style","min-width:100px",4,"ngIf"],[4,"ngIf"],[1,"m-0","py-1","px-2","text-white","border-round-sm",3,"ngStyle"],[1,"font-bold"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"],[1,"p-fluid"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","caption"],["pButton","","pRipple","","label","Th\xeam","type","button","icon","pi pi-plus",1,"p-button-sm",3,"click"],[2,"max-width","50px"],[2,"min-width","150px"],[2,"min-width","80px"],[3,"name","ngModel","controlOnly","format","ngModelChange"],["pButton","","pRipple","","type","button","icon","fa-solid fa-minus",1,"p-button-outlined","p-button-sm","mr-1",3,"click"]],template:function(t,n){if(1&t&&(e.YNc(0,re,34,18,"div",0),e.YNc(1,de,8,0,"ng-template",null,1,e.W1O),e.TgZ(3,"p-overlayPanel",2,3),e.NdJ("onHide",function(){return n.onCloseTimeDialog()}),e.YNc(5,he,5,2,"ng-template",4),e.qZA()),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.permission.device_report.self)("ngIfElse",i),e.xp6(3),e.Akn(e.DdM(5,ge)),e.Q6J("showCloseIcon",!0)}},directives:[C.O5,M.a,P.NU,_.JJ,_.On,H.Hq,k.H,J.SP,_.Fj,U.o,B.u,W.RJ,v.iA,x.jx,C.PC,q.V,V.T,G.Ox],styles:["[_nghost-%COMP%]     .p-multiselect{min-width:100%;width:100%}@media screen and (max-width: 640px){[_nghost-%COMP%]     .p-multiselect{width:100%}}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{position:sticky;top:0}.layout-news-active   [_nghost-%COMP%]     .p-datatable tr>th{top:0}"]}),o})();var N=c(6015),R=c(1753);const _e=["divBound"],ve=["divHeader"],Te=["divTable"];function xe(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"th",31),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",32),e._uU(4,"T\xean "),e._UZ(5,"p-sortIcon",33),e.qZA(),e.TgZ(6,"th",34),e._uU(7),e.qZA()()),2&o){const t=e.oxw(3);e.xp6(7),e.hij("Th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng (gi\u1edd) /",t.hours,"h")}}function Ce(o,s){if(1&o&&(e.TgZ(0,"tr",35)(1,"td",31),e._uU(2),e.qZA(),e.TgZ(3,"td",34),e._uU(4),e.qZA(),e.TgZ(5,"td",34),e._uU(6),e.qZA()()),2&o){const t=s.$implicit,n=s.rowIndex,i=e.oxw(3);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(i.convert2Hour(t.sum))}}function be(o,s){1&o&&(e.TgZ(0,"div",36),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function De(o,s){if(1&o&&(e.TgZ(0,"div")(1,"p-table",27),e.YNc(2,xe,8,1,"ng-template",28),e.YNc(3,Ce,7,4,"ng-template",29),e.YNc(4,be,2,0,"ng-template",30),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("value",t.totalDevices)("scrollable",!0)("loading",t.loading)}}function we(o,s){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"p-chart",37),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("data",t.chartData)("options",t.chartOptions)}}const Ze=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function Ee(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"T\u1ed5ng th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Thi\u1ebft b\u1ecb "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"div",12)(12,"p-multiSelect",13),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().selectedDevices=i}),e.qZA(),e.TgZ(13,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()(),e.TgZ(14,"div",15)(15,"input",16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().rangeTimes=i}),e.qZA()(),e.TgZ(16,"div",17)(17,"div",18)(18,"span")(19,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(20,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(21,"span")(22,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewList()}),e.qZA(),e.TgZ(23,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewChart()}),e.qZA(),e.TgZ(24,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportExcell()}),e.qZA()()()()()(),e.TgZ(25,"div",24,25),e.YNc(27,De,5,3,"div",26),e.YNc(28,we,2,2,"div",26),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(8),e.Q6J("options",t.devices)("ngModel",t.selectedDevices),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(15,Ze))("showClearButton",!0)("ngModel",t.rangeTimes)("dateLimit",30),e.xp6(5),e.Q6J("disabled",!t.rangeTimes||!t.rangeTimes.startDate||!t.rangeTimes.endDate),e.xp6(2),e.Q6J("disabled","list"==t.displayIs),e.xp6(1),e.Q6J("disabled","chart"==t.displayIs),e.xp6(1),e.Q6J("disabled",!t.totalDevices||!t.totalDevices.length),e.xp6(3),e.Q6J("ngIf","list"==t.displayIs),e.xp6(1),e.Q6J("ngIf","chart"==t.displayIs)}}function ye(o,s){1&o&&(e._UZ(0,"i",45),e.TgZ(1,"span",46),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Ae(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",38)(1,"p-messages",39),e.YNc(2,ye,3,0,"ng-template",40),e.qZA()(),e.TgZ(3,"div",41)(4,"div",42),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",43),e.TgZ(6,"span",44),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}p().extend(I());let Oe=(()=>{class o{constructor(t,n,i,a,l,d){this.dHttpService=t,this.messageService=n,this.renderer=i,this.dialogService=a,this.permissionService=l,this.router=d,this.devices=[],this.selectedDevices=[],this.listDeviceChecked=[],this.totalDevices=[],this.mapDevices=new Map,this.displayIs="list",this.chartOptions={plugins:{title:{display:!0,text:"Bi\u1ec3u \u0111\u1ed3 T\u1ed5ng th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng c\u1ee7a thi\u1ebft b\u1ecb",fontSize:18},legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057",callback:(m,h,g)=>m+" h"},grid:{color:"#ebedef"}}}},this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.loadAllDevice())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"T\u1ed5ng th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng c\u1ee7a Thi\u1ebft b\u1ecb",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}loadAllDevice(){this.dHttpService.getMaintenance(1e6,0,void 0,void 0).subscribe({next:t=>{0===t.status?t.data.rows.forEach(i=>{this.mapDevices.set(i.id.toString(),i.name)}):console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message)},error:t=>{console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchListOfTime(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getOperationTime(this.selectedDevices,this.startDate,this.endDate).subscribe({next:t=>{0===t.status?(this.totalDevices=t.data,this.updateList(),"chart"==this.displayIs&&this.updateChart(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convert2Hour(t){return(t/60).toLocaleString("en-us",{minimumFractionDigits:1,maximumFractionDigits:1})}updateList(){this.totalDevices.forEach(t=>{t.name=this.mapDevices.get(t.device_id)})}updateChart(){let t=this.rangeTimes&&this.rangeTimes.startDate?p().utc(this.rangeTimes.startDate).startOf("date").format("DD/MM/YYYY"):"...",n=this.rangeTimes&&this.rangeTimes.endDate?p().utc(this.rangeTimes.endDate).startOf("date").format("DD/MM/YYYY"):"...",i=[],a=[];this.totalDevices.forEach(l=>{i.push(this.mapDevices.get(l.device_id)),a.push(this.convert2Hour(l.sum))}),this.chartData={labels:i,datasets:[{label:`Th\u1eddi gian t\u1eeb ${t} \u0111\u1ebfn ${n} (${this.hours} gi\u1edd)`,backgroundColor:"#42A5F5",data:a}]}}convertTime(t){return Z.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){var t=this;return(0,w.Z)(function*(){let n=t.rangeTimes&&t.rangeTimes.startDate?p().utc(t.rangeTimes.startDate).format("DD/MM/YYYY"):"...",i=t.rangeTimes&&t.rangeTimes.endDate?p().utc(t.rangeTimes.endDate).format("DD/MM/YYYY"):"...";const a=new y.Workbook,l=a.addWorksheet("Th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng"),d=l.getRow(2);d.height=30,l.mergeCells(2,1,2,3),d.getCell(1).value="B\xc1O C\xc1O HO\u1ea0T \u0110\u1ed8NG C\u1ee6A THI\u1ebeT B\u1eca",d.getCell(1).font={name:"Times New Roman",size:12,bold:!0},d.getCell(1).alignment={horizontal:"center"};const m=l.getRow(3);l.mergeCells(3,1,3,3),m.getCell(1).value=`T\u1eeb ${n} \u0111\u1ebfn ${i} (${t.hours}h)`,m.getCell(1).font={name:"Times New Roman",size:11},m.getCell(1).alignment={horizontal:"center"};let h=[];t.totalDevices.forEach((g,f)=>{let r=[f+1,g.name,t.convert2Hour(g.sum)];h.push(r)}),l.addTable({name:"CS",ref:"A5",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"Th\u1eddi gian ho\u1ea1t \u0111\u1ed9ng (gi\u1edd)",filterButton:!1}],rows:h}),a.xlsx.writeBuffer().then(g=>{(0,E.saveAs)(new Blob([g],{type:"application/octet-stream"}),"Tong gio hoat dong.xlsx")})})()}onPickDevice(){this.dialogService.open(S.$,{data:{deviceIns:this.devices,selectedDeviceIns:this.devices,title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!0,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(n=>{n&&(this.devices=n,this.selectedDevices=[],this.devices.forEach(i=>{this.selectedDevices.push(i.id)}))})}onClear(){this.devices=[],this.selectedDevices=[],this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate&&(this.startDate=p().utc(this.rangeTimes.startDate).startOf("date").subtract(7,"hours").format(),this.endDate=p().utc(this.rangeTimes.endDate).startOf("date").subtract(7,"hours").format(),this.hours=this.rangeTimes.endDate.startOf("date").diff(this.rangeTimes.startDate.startOf("date"),"hours")),this.fetchListOfTime()}onComeback(){localStorage.removeItem(T.o.USER),sessionStorage.removeItem(T.o.ACC),this.router.navigate(["/come-back"])}onViewList(){this.displayIs="list",this.updateList()}onViewChart(){this.displayIs="chart",this.updateChart()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(N.x),e.Y36(x.ez),e.Y36(e.Qsj),e.Y36(A.xA),e.Y36(O.$),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-operation-time"]],viewQuery:function(t,n){if(1&t&&(e.Gf(_e,5,e.SBq),e.Gf(ve,5,e.SBq),e.Gf(Te,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(n.divBound=i.first),e.iGM(i=e.CRH())&&(n.divHeader=i.first),e.iGM(i=e.CRH())&&(n.divTable=i.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["defaultLabel","Ch\u1ecdn thi\u1ebft b\u1ecb","emptyMessage","Ch\u1ecdn '+' \u0111\u1ec3 th\xeam","optionLabel","name","optionValue","id",3,"options","ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","ngModel","dateLimit","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-list",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chart-line",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file",3,"disabled","click"],[1,"absolute","left-0","bottom-0","w-full","overflow-auto"],["divTable",""],[4,"ngIf"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],[3,"pSelectableRow"],[1,"p-fluid","p-2"],["type","bar","width","100vw","height","80vh",3,"data","options"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,n){if(1&t&&(e.YNc(0,Ee,29,16,"div",0),e.YNc(1,Ae,8,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.permission.electric_energy.self)("ngIfElse",i)}},directives:[C.O5,M.a,P.NU,_.JJ,_.On,H.Hq,k.H,J.SP,_.Fj,U.o,B.u,v.iA,x.jx,v.lQ,v.fz,v.Ei,R.C,q.V],styles:["[_nghost-%COMP%]     .p-multiselect{min-width:100%;width:100%}@media screen and (max-width: 640px){[_nghost-%COMP%]     .p-multiselect{width:100%}}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{position:sticky;top:0}.layout-news-active   [_nghost-%COMP%]     .p-datatable tr>th{top:0}"]}),o})();const Me=["divBound"],He=["divHeader"],ke=["divTable"];function Be(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",31),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",32),e._uU(4,"Thi\u1ebft b\u1ecb"),e.qZA(),e.TgZ(5,"th",33),e._uU(6,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(7,"th",33),e._uU(8,"Th\u1eddi gian"),e.qZA()())}function qe(o,s){if(1&o&&(e.TgZ(0,"td",38)(1,"span",39),e._uU(2),e.qZA()()),2&o){const t=e.oxw(),i=t.$implicit;e.uIk("rowspan",t.rowspan),e.xp6(2),e.Oqu(i.name)}}function Se(o,s){1&o&&(e.TgZ(0,"span",40),e._uU(1,"B\u1eadt"),e.qZA())}function Ye(o,s){1&o&&(e.TgZ(0,"span",41),e._uU(1,"T\u1eaft"),e.qZA())}function Ie(o,s){if(1&o&&(e.TgZ(0,"tr",34)(1,"td",31),e._uU(2),e.qZA(),e.YNc(3,qe,3,2,"td",35),e.TgZ(4,"td",33),e.YNc(5,Se,2,0,"span",36),e.YNc(6,Ye,2,0,"span",37),e.qZA(),e.TgZ(7,"td",33),e._uU(8),e.qZA()()),2&o){const t=s.$implicit,n=s.rowIndex,i=s.rowgroup,a=e.oxw(3);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(n+1),e.xp6(1),e.Q6J("ngIf",i),e.xp6(2),e.Q6J("ngIf",t.state),e.xp6(1),e.Q6J("ngIf",!t.state),e.xp6(2),e.Oqu(a.convertTime(t.createdAt))}}function Je(o,s){1&o&&(e.TgZ(0,"div",42),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. H\xe3y ch\u1ecdn c\xe1c \u0111i\u1ec1u ki\u1ec7n ph\xf9 h\u1ee3p sau \u0111\xf3 t\xecm ki\u1ebfm. "),e.qZA())}function Ue(o,s){if(1&o&&(e.TgZ(0,"div")(1,"p-table",27),e.YNc(2,Be,9,0,"ng-template",28),e.YNc(3,Ie,9,6,"ng-template",29),e.qZA(),e.YNc(4,Je,2,0,"div",30),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("value",t.deviceOnOffs)("lazy",!0),e.xp6(3),e.Q6J("ngIf",!t.deviceOnOffs||!t.deviceOnOffs.length)}}function Ne(o,s){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"p-chart",43),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("data",t.chartData)("options",t.chartOptions)}}const Fe=function(){return{applyLabel:"Ch\u1ecdn",clearLabel:"X\xf3a",format:"DD/MM/YYYY",separator:" \u0111\u1ebfn "}};function Pe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"Tr\u1ea1ng th\xe1i b\u1eadt t\u1eaft c\u1ee7a thi\u1ebft b\u1ecb "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"div",12)(12,"input",13),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().device_name=i}),e.qZA(),e.TgZ(13,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().onPickDevice()}),e.qZA()()(),e.TgZ(14,"div",15)(15,"input",16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().rangeTimes=i}),e.qZA()(),e.TgZ(16,"div",17)(17,"div",18)(18,"span")(19,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(20,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA()(),e.TgZ(21,"span")(22,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewList()}),e.qZA(),e.TgZ(23,"button",22),e.NdJ("click",function(){return e.CHM(t),e.oxw().onViewChart()}),e.qZA(),e.TgZ(24,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().exportExcell()}),e.qZA()()()()()(),e.TgZ(25,"div",24,25),e.YNc(27,Ue,5,3,"div",26),e.YNc(28,Ne,2,2,"div",26),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(8),e.Q6J("ngModel",t.device_name),e.xp6(3),e.Q6J("showDropdowns",!0)("locale",e.DdM(14,Fe))("showClearButton",!0)("ngModel",t.rangeTimes)("dateLimit",30),e.xp6(5),e.Q6J("disabled",!t.rangeTimes||!t.rangeTimes.startDate||!t.rangeTimes.endDate),e.xp6(2),e.Q6J("disabled","list"==t.displayIs),e.xp6(1),e.Q6J("disabled","chart"==t.displayIs),e.xp6(1),e.Q6J("disabled",!t.deviceOnOffs||!t.deviceOnOffs.length),e.xp6(3),e.Q6J("ngIf","list"==t.displayIs),e.xp6(1),e.Q6J("ngIf","chart"==t.displayIs)}}function Re(o,s){1&o&&(e._UZ(0,"i",51),e.TgZ(1,"span",52),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function Le(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",44)(1,"p-messages",45),e.YNc(2,Re,3,0,"ng-template",46),e.qZA()(),e.TgZ(3,"div",47)(4,"div",48),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",49),e.TgZ(6,"span",50),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}p().extend(I());let Qe=(()=>{class o{constructor(t,n,i,a,l,d){this.dHttpService=t,this.messageService=n,this.renderer=i,this.dialogService=a,this.permissionService=l,this.router=d,this.deviceOnOffs=[],this.mapDevices=new Map,this.displayIs="list",this.deviceTimes=[],this.xValues=[],this.y1Value=[],this.y2Value=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth,this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.loadAllDevice())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"Tr\u1ea1ng th\xe1i b\u1eadt t\u1eaft c\u1ee7a thi\u1ebft b\u1ecb",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}loadAllDevice(){this.dHttpService.getMaintenance(1e7,0,void 0,void 0).subscribe({next:t=>{0===t.status?t.data.rows.forEach(i=>{this.mapDevices.set(i.id,i.name)}):console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message)},error:t=>{console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchListOfOnOff(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getOnOff(this.device_id,999999999,0,this.startDate,this.endDate).subscribe({next:t=>{0===t.status?(this.processDataList(t.data.rows),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}processDataList(t){t.forEach(n=>{n.name=n.device.name}),this.deviceOnOffs=[],this.mapDevices.forEach((n,i)=>{let a=t.filter(l=>l.device_id==i);this.deviceOnOffs.push(...a)}),this.fetchListOfTime()}fetchListOfTime(){this.dHttpService.getOperationTime(this.device_id?[this.device_id]:void 0,this.startDate,this.endDate).subscribe({next:t=>{0===t.status?(this.deviceTimes=t.data,this.updateName()):console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message)},error:t=>{console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}updateName(){this.deviceTimes.forEach(t=>{t.name=this.mapDevices.get(Number(t.device_id))}),this.processDataChart()}processDataChart(){this.updateOption(),this.xValues=[],this.y1Value=[],this.y2Value=[],this.deviceTimes.forEach(t=>{this.xValues.push(t.name),this.y1Value.push(Number(this.convert2Hour(t.sum))),this.y2Value.push(Number(this.convert2Hour(60*this.hours-t.sum)))}),this.chartData={labels:this.xValues,datasets:[{type:"bar",label:"B\u1eadt",backgroundColor:"#66BB6A",data:this.y1Value},{type:"bar",label:"T\u1eaft",backgroundColor:"#42A5F5",data:this.y2Value}]}}updateOption(){this.chartOptions={plugins:{title:{display:!0,text:`Bi\u1ec3u \u0111\u1ed3 th\u1eddi gian b\u1eadt t\u1eaft (${this.hours}h)`,fontSize:18}},tooltips:{mode:"index",intersect:!1},responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,ticks:{callback:(t,n,i)=>t+" h"}}}}}convert2Hour(t){return(t/60).toLocaleString("en-us",{minimumFractionDigits:1,maximumFractionDigits:1})}convertTime(t){return Z.I.isoToVnTime(t)}onGoBackHome(){this.router.navigate(["/"])}exportExcell(){var t=this;return(0,w.Z)(function*(){let n=t.rangeTimes&&t.rangeTimes.startDate?p().utc(t.rangeTimes.startDate).format("DD/MM/YYYY"):"...",i=t.rangeTimes&&t.rangeTimes.endDate?p().utc(t.rangeTimes.endDate).format("DD/MM/YYYY"):"...";const a=new y.Workbook,l=a.addWorksheet("ON-Off"),d=l.getRow(2);d.height=30,l.mergeCells(2,1,2,4),d.getCell(1).value="B\xc1O C\xc1O HO\u1ea0T \u0110\u1ed8NG C\u1ee6A THI\u1ebeT B\u1eca",d.getCell(1).font={name:"Times New Roman",size:12,bold:!0},d.getCell(1).alignment={horizontal:"center"};const m=l.getRow(3);l.mergeCells(3,1,3,4),m.getCell(1).value=`T\u1eeb ${n} \u0111\u1ebfn ${i}`,m.getCell(1).font={name:"Times New Roman",size:11},m.getCell(1).alignment={horizontal:"center"};const h=l.getRow(5);h.values=["#","Thi\u1ebft b\u1ecb","Tr\u1ea1ng th\xe1i","Th\u1eddi gian"],h.alignment={horizontal:"center"},h.font={name:"Times New Roman",size:12,bold:!0};for(let r=1;r<5;r++)h.getCell(r).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF00BFFF"},bgColor:{argb:"FF00BFFF"}};let g=[],f={start:0,end:0,value:t.deviceOnOffs[0].name};t.deviceOnOffs.forEach((r,u)=>{let D=l.getRow(u+6);D.values=[u+1,r.name,r.state?"B\u1eadt":"T\u1eaft",t.convertTime(r.createdAt)],D.font={name:"Times New Roman",size:11},r.name==f.value?f.end=u:(g.push(f),f={start:u,end:u,value:t.deviceOnOffs[u].name}),u==t.deviceOnOffs.length-1&&(f.end=u,g.push(f))}),g.forEach(r=>{const u=l.getRow(r.start+6);l.mergeCells(r.start+6,2,r.end+6,2),u.getCell(2).value=r.value,u.getCell(2).font={bold:!0}}),a.xlsx.writeBuffer().then(r=>{(0,E.saveAs)(new Blob([r],{type:"application/octet-stream"}),"Bao_cao_hoat_dong.xlsx")})})()}onPickDevice(){this.dialogService.open(S.$,{data:{deviceIns:[],title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!1,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(n=>{n&&(this.device_name=`${n.name} (#${n.id})`,this.device_id=n.id)})}onClear(){this.device_id=void 0,this.device_name=void 0,this.rangeTimes=void 0,this.startDate=void 0,this.endDate=void 0}onSearch(){this.rangeTimes&&this.rangeTimes.startDate&&this.rangeTimes.endDate&&(this.startDate=p().utc(this.rangeTimes.startDate).startOf("date").subtract(7,"hours").format(),this.endDate=p().utc(this.rangeTimes.endDate).startOf("date").subtract(7,"hours").format(),this.hours=this.rangeTimes.endDate.startOf("date").diff(this.rangeTimes.startDate.startOf("date"),"hours")),this.fetchListOfOnOff()}onComeback(){localStorage.removeItem(T.o.USER),sessionStorage.removeItem(T.o.ACC),this.router.navigate(["/come-back"])}onViewList(){this.displayIs="list"}onViewChart(){this.displayIs="chart"}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(N.x),e.Y36(x.ez),e.Y36(e.Qsj),e.Y36(A.xA),e.Y36(O.$),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-on-off"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Me,5,e.SBq),e.Gf(He,5,e.SBq),e.Gf(ke,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(n.divBound=i.first),e.iGM(i=e.CRH())&&(n.divHeader=i.first),e.iGM(i=e.CRH())&&(n.divTable=i.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"field","col-12","md:col-3","mb-1"],[1,"p-inputgroup"],["type","text","pInputText","","placeholder","Ch\u1ecdn thi\u1ebft b\u1ecb","disabled","",3,"ngModel","ngModelChange"],["type","button","pButton","","pRipple","","icon","pi pi-plus",3,"click"],[1,"col-12","md:col-3","mb-1","flex","align-items-center"],["type","text","pInputText","","placeholder","Ch\u1ecdn kho\u1ea3ng th\u1eddi gian","ngxDaterangepickerMd","",1,"w-full",3,"showDropdowns","locale","showClearButton","ngModel","dateLimit","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-list",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-chart-line",1,"p-button-info","mr-1",3,"disabled","click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t file",3,"disabled","click"],[1,"absolute","left-0","bottom-0","w-full","overflow-auto"],["divTable",""],[4,"ngIf"],["styleClass","p-datatable-sm p-datatable-striped","rowGroupMode","rowspan","groupRowsBy","name","sortField","name","sortMode","single",3,"value","lazy"],["pTemplate","header"],["pTemplate","body"],["class","p-fluid p-2",4,"ngIf"],[2,"width","60px","max-width","60px"],[2,"min-width","300px"],[2,"min-width","200px"],[3,"pSelectableRow"],["style","min-width:100px",4,"ngIf"],["class","m-0 py-1 px-2 text-white border-round-sm bg-green-500",4,"ngIf"],["class","m-0 py-1 px-2 text-white border-round-sm bg-blue-500",4,"ngIf"],[2,"min-width","100px"],[1,"font-bold"],[1,"m-0","py-1","px-2","text-white","border-round-sm","bg-green-500"],[1,"m-0","py-1","px-2","text-white","border-round-sm","bg-blue-500"],[1,"p-fluid","p-2"],["type","bar","width","100vw","height","80vh",3,"data","options"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,n){if(1&t&&(e.YNc(0,Pe,29,15,"div",0),e.YNc(1,Le,8,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.permission.electric_energy.self)("ngIfElse",i)}},directives:[C.O5,M.a,_.Fj,U.o,_.JJ,_.On,H.Hq,k.H,J.SP,B.u,v.iA,x.jx,v.Ei,R.C,q.V],styles:["[_nghost-%COMP%]     .p-multiselect{min-width:100%;width:100%}@media screen and (max-width: 640px){[_nghost-%COMP%]     .p-multiselect{width:100%}}[_nghost-%COMP%]     .p-datatable .p-datatable-thead>tr>th{position:sticky;top:0}.layout-news-active   [_nghost-%COMP%]     .p-datatable tr>th{top:0}"]}),o})();var ze=c(4036),$e=c(4132);const We=["divBound"],Ve=["divHeader"],Ge=["divTable"],je=["divPaginator"];function Xe(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",34),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",35),e._uU(4,"T\xean "),e._UZ(5,"p-sortIcon",36),e.qZA(),e.TgZ(6,"th",37),e._uU(7,"\u0110\u1ecba ch\u1ec9"),e.qZA(),e.TgZ(8,"th",38),e._uU(9,"Ho\u1ea1t \u0111\u1ed9ng (gi\u1edd)"),e.qZA(),e.TgZ(10,"th",38),e._uU(11,"B\u1ea3o d\u01b0\u1ee1ng (gi\u1edd)"),e.qZA(),e.TgZ(12,"th",39),e._uU(13,"C\u1ea3nh b\xe1o"),e.qZA(),e.TgZ(14,"th",39),e._uU(15,"T\xecnh tr\u1ea1ng"),e.qZA()())}function Ke(o,s){1&o&&(e.TgZ(0,"span",44),e._uU(1,"B\xecnh th\u01b0\u1eddng"),e.qZA())}function et(o,s){1&o&&(e.TgZ(0,"span",45),e._uU(1,"C\u1ea7n b\u1ea3o d\u01b0\u1ee1ng"),e.qZA())}function tt(o,s){1&o&&(e.TgZ(0,"span",46),e._uU(1,"S\u1eafp b\u1ea3o d\u01b0\u1ee1ng"),e.qZA())}function it(o,s){1&o&&(e.TgZ(0,"span",44),e._uU(1,"B\xecnh th\u01b0\u1eddng"),e.qZA())}function nt(o,s){1&o&&(e.TgZ(0,"span",45),e._uU(1,"\u0110ang b\u1ea3o d\u01b0\u1ee1ng"),e.qZA())}function ot(o,s){if(1&o&&(e.TgZ(0,"tr",40)(1,"td",34),e._uU(2),e.qZA(),e.TgZ(3,"td",37),e._uU(4),e.qZA(),e.TgZ(5,"td",37),e._uU(6),e.qZA(),e.TgZ(7,"td",38),e._uU(8),e.qZA(),e.TgZ(9,"td",38),e._uU(10),e.qZA(),e.TgZ(11,"td",39),e.YNc(12,Ke,2,0,"span",41),e.YNc(13,et,2,0,"span",42),e.YNc(14,tt,2,0,"span",43),e.qZA(),e.TgZ(15,"td",39),e.YNc(16,it,2,0,"span",41),e.YNc(17,nt,2,0,"span",42),e.qZA()()),2&o){const t=s.$implicit,n=s.rowIndex,i=e.oxw(2);e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu((i.currentPage-1)*i.itemsPerPage+1+n),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.address),e.xp6(2),e.Oqu(i.convert2Hour(t.work_time)),e.xp6(2),e.Oqu(i.convert2Hour(t.maintain_time)),e.xp6(2),e.Q6J("ngIf",0==t.maintain_warning),e.xp6(1),e.Q6J("ngIf",1==t.maintain_warning),e.xp6(1),e.Q6J("ngIf",2==t.maintain_warning),e.xp6(2),e.Q6J("ngIf",0==t.maintain_state),e.xp6(1),e.Q6J("ngIf",1==t.maintain_state)}}function st(o,s){1&o&&(e.TgZ(0,"div",47),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}const at=function(){return[15,20,30,50]};function lt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e.TgZ(2,"div",4,5),e._UZ(4,"p-breadcrumb",6),e.TgZ(5,"div",7)(6,"h3",8),e._UZ(7,"i",9),e._uU(8,"Th\xf4ng tin b\u1ea3o d\u01b0\u1ee1ng "),e.qZA()(),e.TgZ(9,"div",10)(10,"div",11)(11,"p-dropdown",12),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().warning=i}),e.qZA()(),e.TgZ(12,"div",11)(13,"p-dropdown",13),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().state=i}),e.qZA()(),e.TgZ(14,"div",14)(15,"div",15)(16,"span")(17,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().onClear()}),e.qZA(),e.TgZ(18,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSearch()}),e.qZA(),e.TgZ(19,"button",18),e.NdJ("click",function(){return e.CHM(t),e.oxw().fetchData2Export()}),e.qZA()()()()()(),e.TgZ(20,"div",19,20)(22,"p-table",21),e.NdJ("selectionChange",function(i){return e.CHM(t),e.oxw().currentMaintenance=i}),e.YNc(23,Xe,16,0,"ng-template",22),e.YNc(24,ot,18,11,"ng-template",23),e.YNc(25,st,2,0,"ng-template",24),e.qZA()(),e.TgZ(26,"div",25,26)(28,"div",27),e._UZ(29,"div",28),e.TgZ(30,"div",29)(31,"p-paginator",30),e.NdJ("onPageChange",function(i){return e.CHM(t),e.oxw().onPageChange(i)}),e.qZA()(),e.TgZ(32,"div",31)(33,"button",32),e.NdJ("click",function(){return e.CHM(t),e.oxw().onReSync()}),e.qZA(),e.TgZ(34,"span",33),e._uU(35),e.qZA()()()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("model",t.pathLinks)("home",t.homeLink),e.xp6(7),e.Q6J("options",t.warningOption)("ngModel",t.warning),e.xp6(2),e.Q6J("options",t.stateOption)("ngModel",t.state),e.xp6(9),e.Q6J("selection",t.currentMaintenance)("value",t.maintenances)("scrollable",!0)("loading",t.loading),e.xp6(9),e.Q6J("rows",t.itemsPerPage)("totalRecords",t.totalItems)("rowsPerPageOptions",e.DdM(18,at))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(t.currentPage-1)*t.itemsPerPage+1,"-",(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage>t.totalItems?t.totalItems:(t.currentPage-1)*t.itemsPerPage+t.itemsPerPage,"/",t.totalItems,"")}}function rt(o,s){1&o&&(e._UZ(0,"i",55),e.TgZ(1,"span",56),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function ct(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",48)(1,"p-messages",49),e.YNc(2,rt,3,0,"ng-template",50),e.qZA()(),e.TgZ(3,"div",51)(4,"div",52),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",53),e.TgZ(6,"span",54),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const dt=[{path:"maintenance",component:(()=>{class o{constructor(t,n,i,a,l,d){this.dHttpService=t,this.messageService=n,this.renderer=i,this.dialogService=a,this.permissionService=l,this.router=d,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.maintenances=[],this.warningOption=[{name:"T\u1ea5t c\u1ea3 c\u1ea3nh b\xe1o",value:null},{name:"C\u1ea7n b\u1ea3o d\u01b0\u1ee1ng",value:1},{name:"S\u1eafp b\u1ea3o d\u01b0\u1ee1ng",value:2},{name:"B\xecnh th\u01b0\u1eddng",value:0}],this.stateOption=[{name:"T\u1ea5t c\u1ea3 tr\u1ea1ng th\xe1i",value:null},{name:"\u0110ang b\u1ea3o d\u01b0\u1ee1ng",value:1},{name:"B\xecnh th\u01b0\u1eddng",value:0}],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){this.windowWidth=this.divBound.nativeElement.offsetWidth;let i=this.divPaginator.nativeElement.offsetHeight;this.renderer.setStyle(this.divTable.nativeElement,"top",`  ${this.divHeader.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.divTable.nativeElement,"bottom",`  ${i}px`)}ngAfterViewInit(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t="";return t=this.windowWidth<576?.95*this.windowWidth+"px":this.windowWidth>=576&&this.windowWidth<768?.55*this.windowWidth+"px":this.windowWidth>=768&&this.windowWidth<992?.45*this.windowWidth+"px":this.windowWidth>=992&&this.windowWidth<1400?.4*this.windowWidth+"px":.3*this.windowWidth+"px",t}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t,this.initForm(),this.fetchListOfMaintencance())})}initForm(){this.pathLinks=[{label:"B\xe1o c\xe1o",disabled:!0},{label:"Th\xf4ng tin b\u1ea3o d\u01b0\u1ee1ng",disabled:!0}],this.homeLink={icon:"fa-solid fa-home",routerLink:"/"}}fetchListOfMaintencance(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getMaintenance(this.itemsPerPage,this.offset,this.warning,this.state).subscribe({next:t=>{0===t.status?(this.maintenances=t.data.rows,this.totalItems=t.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.currentMaintenance=void 0):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onPageChange(t){this.currentPage=t.page+1,this.itemsPerPage=t.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfMaintencance()}onReSync(){this.fetchListOfMaintencance()}convertTime(t){return Z.I.isoToVnTime(t)}onClear(){this.warning=void 0,this.state=void 0}onSearch(){this.fetchListOfMaintencance()}convert2Hour(t){return(t/60).toLocaleString("en-us",{minimumFractionDigits:1,maximumFractionDigits:1})}fetchData2Export(){this.dHttpService.getMaintenance(this.totalItems,0,this.warning,this.state).subscribe({next:t=>{0===t.status?this.exportExcell(t.data.rows):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}exportExcell(t){var n=this;return(0,w.Z)(function*(){const i=new y.Workbook,a=i.addWorksheet("Bao duong"),l=a.getRow(2);l.height=20,a.mergeCells(2,1,2,7),l.getCell(1).value="TH\xd4NG TIN B\u1ea2O D\u01af\u1ee0NG",l.getCell(1).font={name:"Times New Roman",size:12,bold:!0},l.getCell(1).alignment={horizontal:"center"};let d=[];t.forEach((m,h)=>{let g=[h+1,m.name,m.address,n.convert2Hour(m.work_time),n.convert2Hour(m.maintain_time),1==m.maintain_warning?"C\u1ea7n b\u1ea3o d\u01b0\u1ee1ng":2==m.maintain_warning?"S\u1eafp b\u1ea3o d\u01b0\u1ee1ng":"B\xecnh th\u01b0\u1eddng",1==m.maintain_state?"\u0110ang b\u1ea3o d\u01b0\u1ee1ng":"B\xecnh th\u01b0\u1eddng"];d.push(g)}),a.addTable({name:"CS",ref:"A4",headerRow:!0,totalsRow:!1,style:{theme:"TableStyleMedium6",showRowStripes:!1},columns:[{name:"#",filterButton:!1},{name:"Thi\u1ebft b\u1ecb",filterButton:!0},{name:"\u0110\u1ecba ch\u1ec9",filterButton:!1},{name:"Ho\u1ea1t \u0111\u1ed9ng (gi\u1edd)",filterButton:!1},{name:"B\u1ea3o d\u01b0\u1ee1ng (gi\u1edd)",filterButton:!1},{name:"C\u1ea3nh b\xe1o",filterButton:!0},{name:"T\xecnh tr\u1ea1ng",filterButton:!0}],rows:d}),i.xlsx.writeBuffer().then(m=>{(0,E.saveAs)(new Blob([m],{type:"application/octet-stream"}),"trang thai bao duong.xlsx")})})()}onGoBackHome(){this.router.navigate(["/"])}onComeback(){localStorage.removeItem(T.o.USER),sessionStorage.removeItem(T.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(N.x),e.Y36(x.ez),e.Y36(e.Qsj),e.Y36(A.xA),e.Y36(O.$),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-maintenace"]],viewQuery:function(t,n){if(1&t&&(e.Gf(We,5,e.SBq),e.Gf(Ve,5,e.SBq),e.Gf(Ge,5,e.SBq),e.Gf(je,5,e.SBq)),2&t){let i;e.iGM(i=e.CRH())&&(n.divBound=i.first),e.iGM(i=e.CRH())&&(n.divHeader=i.first),e.iGM(i=e.CRH())&&(n.divTable=i.first),e.iGM(i=e.CRH())&&(n.divPaginator=i.first)}},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],[1,"absolute","top-0","left-0","w-full"],["divHeader",""],["styleClass","text-sm p-1",3,"model","home"],[1,"flex","align-items-center"],[1,"text-blue-700","m-0","px-2","pt-2","pb-0"],[1,"fa-solid","fa-list","mr-2"],[1,"grid","p-0","m-0"],[1,"field","col-12","md:col-3","mb-1"],["placeholder","Ch\u1ecdn th\xf4ng tin","panelStyleClass","text-overflow-ellipsis text-sm","optionLabel","name","optionValue","value","styleClass","w-full",3,"options","ngModel","ngModelChange"],["placeholder","Ch\u1ecdn tr\u1ea1ng th\xe1i","panelStyleClass","text-overflow-ellipsis text-sm","optionLabel","name","optionValue","value","styleClass","w-full",3,"options","ngModel","ngModelChange"],[1,"col-12","md:col-3"],[1,"flex","justify-content-between"],["type","button","pButton","","icon","fa-solid fa-undo","pTooltip","\u0110\u1eb7t l\u1ea1i","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","fa-solid fa-search","pTooltip","T\xecm ki\u1ebfm","tooltipPosition","top",1,"mr-1",3,"click"],["type","button","pButton","","icon","pi pi-file-excel","pTooltip","Xu\u1ea5t Excel",3,"click"],[1,"absolute","left-0","w-full"],["divTable",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["divPaginator",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-5","flex","align-items-center"],[1,"col-12","md:col-5","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],[2,"width","60px","max-width","60px"],["pSortableColumn","name",2,"min-width","300px"],["field","name"],[2,"min-width","300px"],[2,"min-width","150px"],[2,"min-width","200px"],[3,"pSelectableRow"],["class","m-0 py-1 px-2 text-white border-round-sm bg-green-500",4,"ngIf"],["class","m-0 py-1 px-2 text-white border-round-sm bg-red-500",4,"ngIf"],["class","m-0 py-1 px-2 text-white border-round-sm bg-orange-500",4,"ngIf"],[1,"m-0","py-1","px-2","text-white","border-round-sm","bg-green-500"],[1,"m-0","py-1","px-2","text-white","border-round-sm","bg-red-500"],[1,"m-0","py-1","px-2","text-white","border-round-sm","bg-orange-500"],[1,"p-fluid","p-2"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,n){if(1&t&&(e.YNc(0,lt,36,19,"div",0),e.YNc(1,ct,8,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.permission.device_report.self)("ngIfElse",i)}},directives:[C.O5,M.a,ze.Lt,_.JJ,_.On,H.Hq,B.u,v.iA,x.jx,v.lQ,v.fz,v.Ei,$e.D,k.H,q.V],styles:[""]}),o})()},{path:"on-off",component:Qe},{path:"on-off-at-time",component:fe},{path:"operation-time",component:Oe}];let mt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[b.Bz.forChild(dt)],b.Bz]}),o})();var ut=c(4695);let pt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[C.ez,mt,ut.m]]}),o})()}}]);