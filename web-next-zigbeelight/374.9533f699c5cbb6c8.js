"use strict";(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[374],{6180:(O,A,u)=>{u.d(A,{R:()=>R});var e=u(520),C=u(4004),_=u(2340);class w{}var S=u(5e3);let R=(()=>{class g{constructor(r){this.http=r}getListOfTroubles(r,s,i,l,E,b,T,h,f,a,p,c,v){let t=new e.LE;return t=t.append("limit",p),t=t.append("offset",c),(null!=r||null!=r)&&(t=t.append("group",r)),(null!=s||null!=s)&&(t=t.append("trouble_type_id",s)),(null!=l||null!=l)&&(t=t.append("time_start",l)),(null!=E||null!=E)&&(t=t.append("time_end",E)),(null!=i||null!=i)&&(t=t.append("state",i)),(null!=v||null!=v)&&(t=t.append("device_id",v)),b&&T&&h&&f&&(t=t.append("lat1",b),t=t.append("lat2",h),t=t.append("long1",T),t=t.append("long2",f)),(null!=a||null!=a)&&(t=t.append("created_by_user_id",a)),this.http.get(`${_.N.url.BASE_URL}/trouble`,{params:t})}changleState(r,s){let i=new e.LE;return i=i.append("state",s),this.http.put(`${_.N.url.BASE_URL}/trouble/${r}`,i)}changleStateAll(r){let s=new e.LE;return s=s.append("state",r),this.http.put(`${_.N.url.BASE_URL}/trouble/all`,s)}createReport(r,s,i,l,E,b,T,h,f){const a=new FormData;return a.append("content",r),a.append("latitude",s.toString()),a.append("longitude",i.toString()),a.append("address",l),a.append("trouble_type_id",E.toString()),b&&a.append("company_id",b.toString()),T&&a.append("device_id",T.toString()),h&&0!==h.length&&h.forEach(p=>{a.append("image",p)}),f&&0!==f.length&&f.forEach(p=>{a.append("file",p)}),this.http.post(`${_.N.url.BASE_URL}/trouble`,a,{reportProgress:!0,observe:"events"}).pipe((0,C.U)(p=>{var c=new w;switch(p.type){case e.dt.UploadProgress:const v=Math.round(100*p.loaded/p.total);return c.status=v,c.message="progress",c;case e.dt.Response:return p.body;default:return c.status=p.type,c.message="Unhandled event",c}}))}createReportByGuest(r,s,i,l,E,b,T,h,f){const a=new FormData;return a.append("content",r),a.append("latitude",s.toString()),a.append("longitude",i.toString()),a.append("address",l),a.append("trouble_type_id",E.toString()),b&&a.append("company_id",b.toString()),T&&a.append("device_id",T.toString()),h&&0!==h.length&&h.forEach(p=>{a.append("image",p)}),f&&0!==f.length&&f.forEach(p=>{a.append("file",p)}),this.http.post(`${_.N.url.BASE_URL}/public/trouble`,a,{reportProgress:!0,observe:"events"}).pipe((0,C.U)(p=>{var c=new w;switch(p.type){case e.dt.UploadProgress:const v=Math.round(100*p.loaded/p.total);return c.status=v,c.message="progress",c;case e.dt.Response:return p.body;default:return c.status=p.type,c.message="Unhandled event",c}}))}getListOfTroubleTypes(r,s,i){let l=new e.LE;return l=l.append("limit",r),l=l.append("offset",s),i>=0&&(l=l.append("is_from_user",i)),this.http.get(`${_.N.url.BASE_URL}/trouble/type`,{params:l})}getListOfTroubleTypesByGuest(r,s){let i=new e.LE;return i=i.append("company_id",r),s>=0&&(i=i.append("is_from_user",s)),this.http.get(`${_.N.url.BASE_URL}/public/trouble/type`,{params:i})}createTroubleType(r,s){let i=new e.LE;return i=i.append("name",r),s&&(i=i.append("description",s)),this.http.post(`${_.N.url.BASE_URL}/trouble/type`,i)}editTroubleType(r,s,i){let l=new e.LE;return s&&(l=l.append("name",s)),i&&(l=l.append("description",i)),this.http.put(`${_.N.url.BASE_URL}/trouble/type/${r}`,l)}deleteTroubleType(r){return this.http.delete(`${_.N.url.BASE_URL}/trouble/type/${r}`)}changeTroubleTypeForTrouble(r,s){let i=new e.LE;return i=i.append("trouble_type_id",s),this.http.put(`${_.N.url.BASE_URL}/trouble/${r}`,i)}editTroubleDisplayOnMap(r,s){let i=new e.LE;return i=i.append("is_displayed_on_map",s.toString()),this.http.put(`${_.N.url.BASE_URL}/trouble/${r}`,i)}}return g.\u0275fac=function(r){return new(r||g)(S.LFG(e.eN))},g.\u0275prov=S.Yz7({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},374:(O,A,u)=>{u.d(A,{S:()=>v});var e=u(5e3),C=u(8215),_=u(6675),w=u(9783),U=u(6180),N=u(5431),L=u(9979),B=u(845),D=u(5787),P=u(8952),S=u(9808),R=u(4132);const g=["header"],Z=["content"],r=["footer"];function s(t,m){1&t&&(e.TgZ(0,"tr")(1,"th",22),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",23),e._uU(4,"Tr\u1ea1ng th\xe1i"),e.qZA(),e.TgZ(5,"th",24),e._uU(6,"Ng\u01b0\u1eddi g\u1eedi"),e.qZA(),e.TgZ(7,"th",25),e._uU(8,"N\u1ed9i dung"),e.qZA(),e.TgZ(9,"th",26),e._uU(10,"\u0110ia \u0111i\u1ec3m"),e.qZA(),e.TgZ(11,"th",27),e._uU(12,"Th\u1eddi gian"),e._UZ(13,"p-sortIcon",28),e.qZA()())}function i(t,m){if(1&t&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.created_by_user.username)}}function l(t,m){if(1&t&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.AsE(" ",n.created_by_device.name,"(#",n.created_by_device.id,")")}}function E(t,m){1&t&&(e.TgZ(0,"span"),e._uU(1,"C\u01b0 d\xe2n"),e.qZA())}function b(t,m){if(1&t&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.created_by_device.address)}}function T(t,m){if(1&t&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&t){const n=e.oxw().$implicit;e.xp6(1),e.Oqu(n.address)}}const h=function(t){return{"background-color":t}};function f(t,m){if(1&t&&(e.TgZ(0,"tr",29)(1,"td",22),e._uU(2),e.qZA(),e.TgZ(3,"td",23)(4,"span",30),e._uU(5),e.qZA()(),e.TgZ(6,"td",24),e.YNc(7,i,2,1,"span",31),e.YNc(8,l,2,2,"span",31),e.YNc(9,E,2,0,"span",31),e.qZA(),e.TgZ(10,"td",25),e._uU(11),e.qZA(),e.TgZ(12,"td",26),e.YNc(13,b,2,1,"span",31),e.YNc(14,T,2,1,"span",31),e.qZA(),e.TgZ(15,"td",24),e._uU(16),e.qZA()()),2&t){const n=m.$implicit,o=m.rowIndex,d=e.oxw();e.Q6J("pSelectableRow",n),e.xp6(2),e.Oqu((d.currentPage-1)*d.itemsPerPage+1+o),e.xp6(2),e.Q6J("ngStyle",e.VKq(11,h,0===n.state?"red":1===n.state?"orange":"green")),e.xp6(1),e.Oqu(n.state_name),e.xp6(2),e.Q6J("ngIf",n.created_by_user),e.xp6(1),e.Q6J("ngIf",n.created_by_device),e.xp6(1),e.Q6J("ngIf",!n.created_by_user&&!n.created_by_device),e.xp6(2),e.Oqu(n.content),e.xp6(2),e.Q6J("ngIf",n.created_by_device),e.xp6(1),e.Q6J("ngIf",!n.created_by_device),e.xp6(2),e.Oqu(d.convertTime(n.createdAt))}}function a(t,m){1&t&&(e.TgZ(0,"div",32),e._uU(1," Kh\xf4ng c\xf3 d\u1eef li\u1ec7u trong m\u1ee5c n\xe0y. "),e.qZA())}function p(t,m){if(1&t){const n=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){return e.CHM(n),e.oxw().onChangeState(1)}),e.qZA()}if(2&t){const n=e.oxw();e.Q6J("disabled",!n.currentTrouble||0!==n.currentTrouble.state)}}const c=function(){return[15,20,30,50]};let v=(()=>{class t{constructor(n,o,d,y,x){this.messageService=n,this.tHttpService=o,this.renderer=d,this.permissionService=y,this.router=x,this.enProcessBtn=!1,this.closeEvent=new e.vpe,this.troubleSelected=new e.vpe,this.offset=0,this.totalItems=0,this.itemsPerPage=15,this.currentPage=1,this.troubles=[],this.loading=!1}ngOnDestroy(){this.subPermission&&this.subPermission.unsubscribe(),this.loadingTime&&clearTimeout(this.loadingTime)}setStyleDiv(){let o=this.footer.nativeElement.offsetHeight;this.renderer.setStyle(this.content.nativeElement,"top",`  ${this.header.nativeElement.offsetHeight}px`),this.renderer.setStyle(this.content.nativeElement,"bottom",`  ${o}px`)}ngAfterViewChecked(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}ngOnInit(){this.subPermission=this.permissionService.currentPermission.subscribe(n=>{n&&(this.permission=n,this.fetchListOfTroubles())})}onClose(){this.closeEvent.emit("close")}fetchListOfTroubles(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.tHttpService.getListOfTroubles(void 0,void 0,0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.itemsPerPage,this.offset,void 0).subscribe({next:n=>{0===n.status?(this.troubles=n.data.rows,this.totalItems=n.data.count,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}convertTime(n){return _.I.isoToVnTime(n)}onChangeState(n){this.tHttpService.changleState(this.currentTrouble.id,n).subscribe({next:o=>{0===o.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 thay \u0111\u1ed5i tr\u1ea1ng th\xe1i x\u1eed l\xfd th\xe0nh c\xf4ng"}),this.fetchListOfTroubles()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${o.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o.message))},error:o=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",o)}})}onPageChange(n){this.currentPage=n.page+1,this.itemsPerPage=n.rows,this.offset=(this.currentPage-1)*this.itemsPerPage,this.fetchListOfTroubles()}onReSync(){this.fetchListOfTroubles()}onRowSelect(n){this.troubleSelected.emit(this.currentTrouble)}onComeback(){localStorage.removeItem(C.o.USER),sessionStorage.removeItem(C.o.ACC),this.router.navigate(["/come-back"])}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(w.ez),e.Y36(U.R),e.Y36(e.Qsj),e.Y36(N.$),e.Y36(L.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-trouble-new-event"]],viewQuery:function(n,o){if(1&n&&(e.Gf(g,5,e.SBq),e.Gf(Z,5,e.SBq),e.Gf(r,5,e.SBq)),2&n){let d;e.iGM(d=e.CRH())&&(o.header=d.first),e.iGM(d=e.CRH())&&(o.content=d.first),e.iGM(d=e.CRH())&&(o.footer=d.first)}},inputs:{enProcessBtn:"enProcessBtn"},outputs:{closeEvent:"closeEvent",troubleSelected:"troubleSelected"},decls:24,vars:14,consts:[[1,"relative","h-full","w-full",3,"resize"],[1,"absolute","top-0","left-0","w-full"],["header",""],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"absolute","left-0","w-full","p-0"],["content",""],["selectionMode","single","styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"selection","value","scrollable","loading","selectionChange","onRowSelect"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"absolute","bottom-0","left-0","w-full","border-top-1","border-gray-300"],["footer",""],[1,"grid","grid-nogutter"],[1,"col-12","md:col-3","flex","align-items-center"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check","class","mx-1",3,"disabled","click",4,"ngIf"],[1,"col-12","md:col-7","flex","align-items-center","justify-content-end"],["styleClass","p-0",3,"rows","totalRecords","rowsPerPageOptions","showJumpToPageDropdown","showPageLinks","onPageChange"],[1,"col-12","md:col-2","flex","align-items-center"],["pButton","","pRipple","","type","button","icon","fa-solid fa-sync",1,"p-button-raised","p-button-text","m-0","p-1",3,"click"],[1,"ml-1"],["pFrozenColumn","",2,"width","60px","max-width","60px"],["pFrozenColumn","",2,"min-width","100px"],[2,"min-width","200px"],[2,"min-width","300px"],[2,"min-width","250px"],["pSortableColumn","createdAt",2,"min-width","200px"],["field","createdAt"],[3,"pSelectableRow"],[1,"m-0","p-0","pl-2","pr-2","text-white","border-round-sm",3,"ngStyle"],[4,"ngIf"],[1,"p-fluid","p-2"],["pButton","","pRipple","","type","button","label","Ti\u1ebfp nh\u1eadn","icon","fa-solid fa-check",1,"mx-1",3,"disabled","click"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e.NdJ("resize",function(){return o.onWindowResize()},!1,e.Jf7),e.TgZ(1,"div",1,2)(3,"div",3)(4,"span",4),e._uU(5,"C\xe1c s\u1ef1 ki\u1ec7n c\u1ea3nh b\xe1o m\u1edbi"),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return o.onClose()}),e.qZA()()(),e.TgZ(7,"div",6,7)(9,"p-table",8),e.NdJ("selectionChange",function(y){return o.currentTrouble=y})("onRowSelect",function(y){return o.onRowSelect(y)}),e.YNc(10,s,14,0,"ng-template",9),e.YNc(11,f,17,13,"ng-template",10),e.YNc(12,a,2,0,"ng-template",11),e.qZA()(),e.TgZ(13,"div",12,13)(15,"div",14)(16,"div",15),e.YNc(17,p,1,1,"button",16),e.qZA(),e.TgZ(18,"div",17)(19,"p-paginator",18),e.NdJ("onPageChange",function(y){return o.onPageChange(y)}),e.qZA()(),e.TgZ(20,"div",19)(21,"button",20),e.NdJ("click",function(){return o.onReSync()}),e.qZA(),e.TgZ(22,"span",21),e._uU(23),e.qZA()()()()()),2&n&&(e.xp6(9),e.Q6J("selection",o.currentTrouble)("value",o.troubles)("scrollable",!0)("loading",o.loading),e.xp6(8),e.Q6J("ngIf",o.enProcessBtn&&o.permission.trouble.process),e.xp6(2),e.Q6J("rows",o.itemsPerPage)("totalRecords",o.totalItems)("rowsPerPageOptions",e.DdM(13,c))("showJumpToPageDropdown",!0)("showPageLinks",!1),e.xp6(4),e.lnq("Hi\u1ec3n th\u1ecb ",(o.currentPage-1)*o.itemsPerPage+1,"-",(o.currentPage-1)*o.itemsPerPage+o.itemsPerPage>o.totalItems?o.totalItems:(o.currentPage-1)*o.itemsPerPage+o.itemsPerPage,"/",o.totalItems,""))},directives:[B.Hq,D.H,P.iA,w.jx,P.on,P.lQ,P.fz,P.Ei,S.PC,S.O5,R.D],styles:[""]}),t})()}}]);