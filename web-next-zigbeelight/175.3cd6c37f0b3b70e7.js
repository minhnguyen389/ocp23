(self.webpackChunkweb_next_zigbeelight=self.webpackChunkweb_next_zigbeelight||[]).push([[175],{2404:(L,w,d)=>{"use strict";d.d(w,{Fl:()=>b,L:()=>p,RM:()=>h,Z9:()=>e,d2:()=>_,lc:()=>g});class _{}class b{}class e{}class p{}class g{}class h{}},1175:(L,w,d)=>{"use strict";d.r(w),d.d(w,{DeviceEditorModule:()=>oi});var _=d(9808),b=d(9979),f=d(5861),e=d(5e3),E=d(5758),p=d(4464),g=d(2216),h=d(8407),D=d(4520),m=(d(2937),d(8215)),J=d(2340),K=d(414),V=d(6675),A=d(6015),x=d(9783);function j(o,r){1&o&&(e.TgZ(0,"span"),e._uU(1,"\u0110\u01a1n l\u1ebb"),e.qZA())}function z(o,r){1&o&&(e.TgZ(0,"span"),e._uU(1,"T\u1ed5ng h\u1ee3p"),e.qZA())}let X=(()=>{class o{constructor(t,i){this.dHttpService=t,this.messageService=i}ngOnInit(){this.fetchDeviceInfo()}fetchDeviceInfo(){this.dHttpService.getInfo(this.device.id).subscribe({next:t=>{0===t.status?this.deviceInfo=t.data:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}converTime(t){return V.I.isoToVnTime(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-editor-map-tooltip"]],inputs:{device:"device"},decls:18,vars:6,consts:[["id","tooltip",1,"card","p-1"],[1,"m-0","p-0"],[1,"font-bold","text-blue-500"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"p",1)(2,"span",2),e._uU(3,"Thi\u1ebft b\u1ecb: "),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"p",1)(6,"span",2),e._uU(7,"Ph\xe2n lo\u1ea1i: "),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"p",1)(10,"span",2),e._uU(11,"Lo\u1ea1i thi\u1ebft b\u1ecb: "),e.qZA(),e._uU(12),e.qZA(),e.TgZ(13,"p",1)(14,"span",2),e._uU(15,"Ki\u1ec3u: "),e.qZA(),e.YNc(16,j,2,0,"span",3),e.YNc(17,z,2,0,"span",3),e.qZA()()),2&t&&(e.xp6(4),e.AsE("",null==i.deviceInfo?null:i.deviceInfo.name," (#",null==i.deviceInfo?null:i.deviceInfo.id,") "),e.xp6(4),e.hij("",null==i.deviceInfo||null==i.deviceInfo.device_subtype||null==i.deviceInfo.device_subtype.device_type?null:i.deviceInfo.device_subtype.device_type.name," "),e.xp6(4),e.hij("",null==i.deviceInfo?null:i.deviceInfo.device_subtype.name," "),e.xp6(4),e.Q6J("ngIf",i.deviceInfo&&0==i.deviceInfo.device_subtype.device_type.is_combination),e.xp6(1),e.Q6J("ngIf",i.deviceInfo&&1==i.deviceInfo.device_subtype.device_type.is_combination))},directives:[_.O5],styles:["#tooltip[_ngcontent-%COMP%]{width:250px}#tooltip[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], #tooltip[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], #tooltip[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{word-break:break-all;white-space:normal}"]}),o})();var k=d(845),M=d(5787),ee=d(7376);function te(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("get-location")}),e.qZA(),e.TgZ(2,"button",3),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("set-home-location")}),e.qZA(),e._UZ(3,"p-divider",4),e.TgZ(4,"button",5),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("add-device")}),e.qZA()()}}function ie(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",6),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("set-info")}),e.qZA(),e.TgZ(2,"button",7),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("delete-device")}),e.qZA(),e._UZ(3,"p-divider",4),e.TgZ(4,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("google-map")}),e.qZA()()}}function ne(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("set-config")}),e.qZA(),e.TgZ(2,"button",6),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("set-info")}),e.qZA(),e._UZ(3,"p-divider",4),e.TgZ(4,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommandSelect("google-map")}),e.qZA()()}}let oe=(()=>{class o{constructor(){this.type="on-map",this.onSelect=new e.vpe}ngOnInit(){}onCommandSelect(t){this.onSelect.emit(t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-editor-map-popup"]],inputs:{type:"type"},outputs:{onSelect:"onSelect"},decls:3,vars:3,consts:[["class","p-fluid",4,"ngIf"],[1,"p-fluid"],["pButton","","pRipple","","type","button","icon","pi pi-map-marker","label","Xem t\u1ecda \u0111\u1ed9",1,"p-button-text","text-left","m-0","p-1",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-home","label","\u0110\u1eb7t c\u1eeda s\u1ed5 m\u1eb7c \u0111\u1ecbnh",1,"p-button-text","text-left","m-0","p-1",3,"click"],["styleClass","m-1 p-0"],["pButton","","pRipple","","type","button","icon","pi pi-plus","label","Th\xeam thi\u1ebft b\u1ecb",1,"p-button-text","text-left","m-0","p-1",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-pencil","label","C\u1eadp nh\u1eadt th\xf4ng tin",1,"p-button-text","text-left","m-0","p-1",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-times","label","X\xf3a kh\u1ecfi h\u1ec7 th\u1ed1ng",1,"p-button-text","text-left","m-0","p-1",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-search","label","V\u1ecb tr\xed tr\xean Google Maps",1,"p-button-text","text-left","m-0","p-1",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-cog","label","C\xe0i \u0111\u1eb7t th\xf4ng s\u1ed1",1,"p-button-text","text-left","m-0","p-1",3,"click"]],template:function(t,i){1&t&&(e.YNc(0,te,5,0,"div",0),e.YNc(1,ie,5,0,"div",0),e.YNc(2,ne,5,0,"div",0)),2&t&&(e.Q6J("ngIf","on-map"==i.type),e.xp6(1),e.Q6J("ngIf","on-marker"==i.type),e.xp6(1),e.Q6J("ngIf","on-qr"==i.type))},directives:[_.O5,k.Hq,M.H,ee.i],styles:[""]}),o})();var se=d(7301),I=d(5330),re=d(3542),q=d(4036),v=d(2382),P=d(2537),N=d(1424),H=d(7010);function ae(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-inputMask",18),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("ngModel",t.value)}}function le(o,r){if(1&o&&(e.TgZ(0,"div",13),e.YNc(1,ae,5,2,"div",14),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",1==t.id)}}function ce(o,r){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,le,2,1,"div",12),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",1===t.group)}}function de(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",7),e.YNc(1,ce,2,1,"div",8),e.TgZ(2,"div",9)(3,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e.qZA(),e.TgZ(4,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSaveMac()}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.parameters)}}const pe=function(){return["RS485","Ethernet"]};function ue(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-dropdown",20),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("options",e.DdM(3,pe))("ngModel",t.value)}}function he(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-dropdown",21),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.group_id=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit,i=e.oxw(2);e.xp6(2),e.hij("Nh\xf3m \u0111i\u1ec1u khi\u1ec3n (",t.name,")"),e.xp6(2),e.Q6J("options",i.groupOptions)("ngModel",t.group_id)}}function me(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-dropdown",22),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.controller_id=n})("onChange",function(){e.CHM(t);const n=e.oxw(2).$implicit;return e.oxw(2).onChangeCabinet(n)}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit,i=e.oxw(2);e.xp6(2),e.hij("T\u1ee7 \u0111i\u1ec1u khi\u1ec3n (",t.name,")"),e.xp6(2),e.Q6J("options",i.cabinetOptions)("ngModel",t.controller_id)}}function ge(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-dropdown",23),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.port_id=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit,i=e.oxw(2);e.xp6(2),e.hij("C\u1ed5ng \u0111i\u1ec1u khi\u1ec3n (",t.name,")"),e.xp6(2),e.Q6J("options",i.portOptions)("ngModel",t.port_id)}}const _e=function(){return["1","2","3","4"]};function fe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"p-dropdown",24),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("options",e.DdM(3,_e))("ngModel",t.value)}}function ve(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2),e.qZA(),e.TgZ(3,"div",17)(4,"input",25),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("disabled",10===t.id)("ngModel",t.value)}}function Ce(o,r){if(1&o&&(e.TgZ(0,"div",13),e.YNc(1,ue,5,4,"div",14),e.YNc(2,he,5,3,"div",14),e.YNc(3,me,5,3,"div",14),e.YNc(4,ge,5,3,"div",14),e.YNc(5,fe,5,4,"div",14),e.YNc(6,ve,5,3,"div",14),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",2==t.id),e.xp6(1),e.Q6J("ngIf",4==t.id),e.xp6(1),e.Q6J("ngIf",7==t.id),e.xp6(1),e.Q6J("ngIf",35==t.id),e.xp6(1),e.Q6J("ngIf",54==t.id),e.xp6(1),e.Q6J("ngIf",1!==t.id&&2!==t.id&&4!==t.id&&7!==t.id&&35!==t.id&&54!==t.id)}}function be(o,r){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,Ce,7,6,"div",12),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",1===t.group)}}function xe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",19),e.YNc(1,be,2,1,"div",8),e.TgZ(2,"div",9)(3,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e.qZA(),e.TgZ(4,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSaveSetting()}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.parameters)}}function ye(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",1)(2,"span",2)(3,"u"),e._uU(4,"C\u1eadp nh\u1eadt d\u1eef li\u1ec7u:"),e.qZA()()(),e.TgZ(5,"div",19)(6,"div",13)(7,"div",15)(8,"label",16),e._uU(9,"Th\u1eddi gian c\u1eadp nh\u1eadt (gi\xe2y)"),e.qZA(),e.TgZ(10,"div",17)(11,"p-inputNumber",27),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().time_update=n}),e.qZA()()()(),e.TgZ(12,"div",9)(13,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e.qZA(),e.TgZ(14,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSetTimeSent()}),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(11),e.Q6J("min",30)("max",1800)("ngModel",t.time_update)}}function Te(o,r){1&o&&(e.TgZ(0,"p",28),e._uU(1,"Kh\xf4ng c\xf3 th\xf4ng s\u1ed1 c\xe0i \u0111\u1eb7t."),e.qZA())}let Ee=(()=>{class o{constructor(t,i,n){this.dHttpService=t,this.messageService=i,this.router=n,this.onChange=new e.vpe,this.groupOptions=[],this.portOptions=[],this.cabinetOptions=[],this.parameters=[],this.time_update=30}ngOnDestroy(){this.timeOutGroup&&clearTimeout(this.timeOutGroup),this.timeOutPort&&clearTimeout(this.timeOutPort),this.timeOutCab&&clearTimeout(this.timeOutCab)}ngOnChanges(t){let i=t.configPayload;i&&i.currentValue&&(this.currentDeviceConfig=this.configPayload.currentDeviceConfig,this.is_cabinet=this.configPayload.is_cabinet,this.parameters=this.currentDeviceConfig.danh_sach_thong_so,this.is_cabinet?(this.firm_version=this.currentDeviceConfig.firmVer,this.time_update=this.currentDeviceConfig.time_sent):(this.controller_id=this.configPayload.controller_id,this.group_id=this.configPayload.group_id,this.fetListOfcabinetOptions()))}ngOnInit(){}fetListOfcabinetOptions(){this.dHttpService.getListCabinet().subscribe({next:t=>{if(0===t.status){this.cabinetOptions=t.data,this.cabinetOptions.forEach(n=>n.fullname=`${n.device.name} (${n.value})`);let i=this.cabinetOptions.find(n=>n.value==this.controller_id);i&&this.fetchGroupAndPortOfController(i.device_id),this.timeOutCab&&clearTimeout(this.timeOutCab),this.timeOutCab=setTimeout(()=>{this.parameters.forEach(n=>{7==n.id&&(n.controller_id=n.value)})},50)}else this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message)},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchGroupAndPortOfController(t){this.dHttpService.getDeviceParameterAndValue(t,m.o.CASE_CAUHINH).subscribe({next:i=>{0===i.status?this.processGroupOfController(i.data[0]):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}processGroupOfController(t){t.danh_sach_thong_so.forEach(i=>{if(14===i.id)if(i.value){let n=JSON.parse(i.value);this.groupOptions=n.groups,this.groupOptions.forEach(s=>{s.fullname=`${s.ten} (${s.id})`,s.id=s.id.toString()}),this.timeOutGroup&&clearTimeout(this.timeOutGroup),this.timeOutGroup=setTimeout(()=>{this.parameters.forEach(s=>{4==s.id&&(s.group_id||(s.group_id=s.value),this.groupOptions.find(l=>l.id==s.group_id)||(s.group_id=void 0))})},50)}else this.groupOptions=[];else if(15===i.id)if(i.value){let n=JSON.parse(i.value);this.portOptions=n.ports,this.portOptions.forEach(s=>{s.fullname=`${s.ten} (${s.id})`,s.id=s.id.toString()}),this.timeOutPort&&clearTimeout(this.timeOutPort),this.timeOutPort=setTimeout(()=>{this.parameters.forEach(s=>{35==s.id&&(s.port_id=s.value,s.port_id||(s.port_id=s.value),this.portOptions.find(l=>l.id==s.port_id)||(s.port_id=void 0))})},50)}else this.portOptions=[]})}onChangeCabinet(t){let i=this.cabinetOptions.find(n=>n.value==t.controller_id);this.fetchGroupAndPortOfController(i.device_id)}onCancel(){this.onChange.emit()}onSetTimeSent(){this.dHttpService.setTimeSent(this.currentDeviceConfig.id,this.time_update).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\u1eddi gian th\xe0nh c\xf4ng."}),this.onChange.emit()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onSaveMac(){let t;this.parameters.forEach(i=>{1==i.id&&i.value&&(t=i.value.split("-").join(""))}),t?this.dHttpService.setMac(this.currentDeviceConfig.id,t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt MAC th\xe0nh c\xf4ng."}),this.onChange.emit()):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\xf4ng s\u1ed1 MAC kh\xf4ng h\u1ee3p l\u1ec7."})}onSaveSetting(){var t=this;return(0,f.Z)(function*(){const i=[],n=[];let s=!0,l=!0,c=!0;t.parameters.forEach(a=>{4==a.id?a.group_id?(i.push(a.id),n.push(a.group_id),s=!0,t.new_group_id=a.group_id):s=!1:7==a.id?a.controller_id?(i.push(a.id),n.push(a.controller_id),c=!0,t.new_controller_id=a.controller_id):c=!1:35==a.id?a.port_id?(i.push(a.id),n.push(a.port_id),l=!0):l=!1:1===a.group&&a.value&&(i.push(a.id),n.push(a.value))}),s&&c&&l?i.length&&n.length&&i.length==n.length?t.dHttpService.configDevice(t.currentDeviceConfig.id,i,n).subscribe({next:a=>{0===a.status?(t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),t.checkAndUpdateConfigForCabinet(),t.onChange.emit()):2===a.status?t.onComeback():(t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${a.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",a.message))},error:a=>{t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",a)}}):t.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng c\xf3 th\xf4ng tin c\xe0i \u0111\u1eb7t \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt."}):t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\xf4ng s\u1ed1 nh\xf3m/c\u1ed5ng/t\u1ee7 \u0111i\u1ec1u khi\u1ec3n kh\xf4ng h\u1ee3p l\u1ec7."})})()}checkAndUpdateConfigForCabinet(){(this.controller_id!==this.new_controller_id||this.group_id!==this.new_group_id)&&this.dHttpService.updateDIMsForListOfCabinets([this.controller_id,this.new_controller_id]).subscribe({next:t=>{0!==t.status&&(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\u1eadp nh\u1eadt c\u1ea5u h\xecnh t\u1ef1 \u0111\u1ed9ng cho t\u1ee7 b\u1ecb l\u1ed7i. Vui l\xf2ng T\u1ea3i xu\u1ed1ng th\u1ee7 c\xf4ng c\u1ea5u h\xecnh cho T\u1ee7 Qu\u1ea3n l\xfd c\u0169 v\xe0 m\u1edbi c\u1ee7a \u0111\xe8n."}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onComeback(){localStorage.removeItem(m.o.USER),sessionStorage.removeItem(m.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-setting-config"]],inputs:{configPayload:"configPayload"},outputs:{onChange:"onChange"},features:[e.TTD],decls:10,vars:5,consts:[[1,"m-0","p-1","mb-1","bg-blue-100","border-round","border-1","border-blue-100"],[1,"p-1"],[1,"font-bold"],["class","p-1 bg-white border-bottom-3 border-blue-100",4,"ngIf","ngIfElse"],["class","p-1 bg-white",4,"ngIf","ngIfElse"],["class","m-0 p-1 bg-blue-100 border-round border-1 border-blue-100",4,"ngIf"],["noSetting",""],[1,"p-1","bg-white","border-bottom-3","border-blue-100"],[4,"ngFor","ngForOf"],[1,"flex","align-items-center","justify-content-end","border-top-1","border-gray-300","pt-1"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-save",1,"mr-1",3,"click"],["class","p-fluid",4,"ngIf"],[1,"p-fluid"],["class","field grid mb-1",4,"ngIf"],[1,"field","grid","mb-1"],[1,"col-12","md:col-3"],[1,"col-12","md:col-9"],["mask","****-****-****","styleClass","w-full","characterPattern","[a-f0-9]",3,"ngModel","ngModelChange"],[1,"p-1","bg-white"],["placeholder","Ch\u1ecdn k\u1ebft n\u1ed1i","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange"],["placeholder","Ch\u1ecdn nh\xf3m \u0111i\u1ec1u khi\u1ec3n","optionLabel","fullname","optionValue","id","panelStyleClass","text-overflow-ellipsis text-sm","emptyMessage","Kh\xf4ng c\xf3 nh\xf3m. H\xe3y ch\u1ecdn t\u1ee7 ph\xf9 h\u1ee3p.",3,"options","ngModel","ngModelChange"],["placeholder","Ch\u1ecdn t\u1ee7 \u0111i\u1ec1u khi\u1ec3n","optionLabel","fullname","optionValue","value","panelStyleClass","text-overflow-ellipsis text-sm","emptyMessage","Kh\xf4ng c\xf3 t\u1ee7 tr\xean h\u1ec7 th\u1ed1ng",3,"options","ngModel","ngModelChange","onChange"],["optionLabel","fullname","optionValue","id","panelStyleClass","text-overflow-ellipsis text-sm","placeholder","Ch\u1ecdn c\u1ed5ng \u0111i\u1ec1u khi\u1ec3n","emptyMessage","Kh\xf4ng c\xf3 c\u1ed5ng. H\xe3y ch\u1ecdn t\u1ee7 ph\xf9 h\u1ee3p.",3,"options","ngModel","ngModelChange"],["panelStyleClass","text-overflow-ellipsis text-sm","placeholder","Ch\u1ecdn c\u1ea5p \u0111i\u1ec1u khi\u1ec3n",3,"options","ngModel","ngModelChange"],["type","text","pInputText","",3,"disabled","ngModel","ngModelChange"],[1,"m-0","p-1","bg-blue-100","border-round","border-1","border-blue-100"],["mode","decimal","placeholder","30-1800 gi\xe2y",3,"min","max","ngModel","ngModelChange"],[1,"m-0","p-1"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2)(3,"u"),e._uU(4,"Th\xf4ng s\u1ed1 c\xe0i \u0111\u1eb7t:"),e.qZA()()(),e.YNc(5,de,5,1,"div",3),e.YNc(6,xe,5,1,"div",4),e.qZA(),e.YNc(7,ye,15,3,"div",5),e.YNc(8,Te,2,0,"ng-template",null,6,e.W1O)),2&t){const n=e.MAs(9);e.xp6(5),e.Q6J("ngIf",i.parameters.length)("ngIfElse",n),e.xp6(1),e.Q6J("ngIf",i.parameters.length)("ngIfElse",n),e.xp6(1),e.Q6J("ngIf",i.is_cabinet&&i.firm_version)}},directives:[_.O5,_.sg,P.vy,v.JJ,v.On,k.Hq,M.H,q.Lt,v.Fj,N.o,H.Rn],styles:[""]}),o})();var U=d(2404),B=d(8087),$=d(9269),Z=d(8952),R=d(4119),Q=d(3640),F=d(5034);function De(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",19),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",20),e._UZ(4,"span",21),e._uU(5," T\xean"),e.qZA(),e.TgZ(6,"th",22),e._uU(7,"ID"),e.qZA(),e.TgZ(8,"th",23),e._uU(9,"Thao t\xe1c"),e.qZA()())}function Se(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"input",30),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().$implicit.ten=n}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Q6J("ngModel",t.ten)}}function Me(o,r){if(1&o&&(e._UZ(0,"span",21),e._uU(1)),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("",t.ten," ")}}function Ze(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",19),e._uU(2),e.qZA(),e.TgZ(3,"td",24)(4,"p-cellEditor"),e.YNc(5,Se,1,1,"ng-template",25),e.YNc(6,Me,2,1,"ng-template",26),e.qZA()(),e.TgZ(7,"td",22),e._uU(8),e.qZA(),e.TgZ(9,"td",23)(10,"button",27),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onRemoveGroup(s)}),e.qZA(),e.TgZ(11,"button",28),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onUpdateDeviceToGroup(s)}),e.qZA(),e.TgZ(12,"button",29),e.NdJ("click",function(n){const l=e.CHM(t).$implicit,c=e.oxw(2),a=e.MAs(15);return c.onViewDeviceInsideGroup(l),a.toggle(n)}),e.qZA()()()}if(2&o){const t=r.$implicit,i=r.rowIndex,n=e.oxw(2);e.xp6(2),e.Oqu(i+1),e.xp6(1),e.Q6J("pEditableColumn",t)("pEditableColumnField","ten")("pEditableColumnRowIndex",i),e.xp6(5),e.Oqu(t.id),e.xp6(2),e.Q6J("disabled","0"==t.id||!n.mac),e.xp6(1),e.Q6J("disabled",!n.mac),e.xp6(1),e.Q6J("disabled",!n.mac)}}function we(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"p-table",12),e.YNc(3,De,10,0,"ng-template",13),e.YNc(4,Ze,13,8,"ng-template",14),e.qZA()(),e.TgZ(5,"div",15)(6,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().onAddGroup()}),e.qZA(),e.TgZ(7,"span")(8,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e.qZA(),e.TgZ(9,"button",18),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSaveGroup()}),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("value",t.groups.groups)("scrollable",!0),e.xp6(4),e.Q6J("disabled",!t.mac||t.groups.groups.length>=8)}}function Ae(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",19),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",20),e._UZ(4,"span",21),e._uU(5," T\xean"),e.qZA(),e.TgZ(6,"th",22),e._uU(7,"ID"),e.qZA(),e.TgZ(8,"th",23),e._uU(9,"Thao t\xe1c"),e.qZA()())}function ke(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"input",30),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().$implicit.ten=n}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Q6J("ngModel",t.ten)}}function Ie(o,r){if(1&o&&(e._UZ(0,"span",21),e._uU(1)),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("",t.ten," ")}}function Le(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",19),e._uU(2),e.qZA(),e.TgZ(3,"td",24)(4,"p-cellEditor"),e.YNc(5,ke,1,1,"ng-template",25),e.YNc(6,Ie,2,1,"ng-template",26),e.qZA()(),e.TgZ(7,"td",22),e._uU(8),e.qZA(),e.TgZ(9,"td",23)(10,"button",31),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onRemovePort(s)}),e.qZA()()()}if(2&o){const t=r.$implicit,i=r.rowIndex,n=e.oxw(2);e.xp6(2),e.Oqu(i+1),e.xp6(1),e.Q6J("pEditableColumn",t)("pEditableColumnField","ten")("pEditableColumnRowIndex",i),e.xp6(5),e.Oqu(t.id),e.xp6(2),e.Q6J("disabled",t.id<=1||!n.mac)}}function Oe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"p-table",12),e.YNc(3,Ae,10,0,"ng-template",13),e.YNc(4,Le,11,6,"ng-template",14),e.qZA()(),e.TgZ(5,"div",15)(6,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().onAddPort()}),e.qZA(),e.TgZ(7,"span")(8,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e.qZA(),e.TgZ(9,"button",18),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSavePort()}),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("value",t.ports.ports)("scrollable",!0),e.xp6(4),e.Q6J("disabled",!t.mac||t.ports.ports.length>=8)}}function qe(o,r){1&o&&(e.TgZ(0,"p",32),e._uU(1,"Kh\xf4ng c\xf3 th\xf4ng s\u1ed1 c\xe0i \u0111\u1eb7t."),e.qZA())}function Ne(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",19),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",35),e._uU(4,"Thi\u1ebft b\u1ecb"),e.qZA()())}function Je(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"td",19),e._uU(2),e.qZA(),e.TgZ(3,"td",35),e._uU(4),e.qZA()()),2&o){const t=r.$implicit,i=r.rowIndex;e.xp6(2),e.Oqu(i+1),e.xp6(2),e.AsE("",t.name," (#",t.id,")")}}function Fe(o,r){1&o&&(e.TgZ(0,"div",36),e._uU(1," Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb trong nh\xf3m. "),e.qZA())}function Pe(o,r){if(1&o&&(e.TgZ(0,"p-table",33),e.YNc(1,Ne,5,0,"ng-template",13),e.YNc(2,Je,5,3,"ng-template",14),e.YNc(3,Fe,2,0,"ng-template",34),e.qZA()),2&o){const t=e.oxw();e.Q6J("value",t.deviceInsideGroups)("scrollable",!0)}}const He=function(){return{width:"300px"}};let Ue=(()=>{class o{constructor(t,i,n,s,l){this.dHttpService=t,this.messageService=i,this.dialogService=n,this.confirmService=s,this.router=l,this.onChange=new e.vpe,this.deviceInsideGroups=[],this.loading=!1}ngOnChanges(t){let i=t.currentDeviceConfig;i&&i.currentValue&&this.processDevice()}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){}processDevice(){this.has_group=!1,this.has_port=!1,this.currentDeviceConfig.danh_sach_thong_so.forEach(t=>{1==t.id?this.mac=t.value:14===t.id?(this.has_group=!0,t.value?this.groups=JSON.parse(t.value):(this.groups=new U.Fl,this.groups.so_luong=0,this.groups.groups=[])):15===t.id&&(this.has_port=!0,t.value?this.ports=JSON.parse(t.value):(this.ports=new U.Z9,this.ports.so_luong=0,this.ports.ports=[]))})}onAddGroup(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.createGroupOfCabinet(this.mac,"Nh\xf3m m\u1edbi",void 0).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"T\u1ea1o nh\xf3m \u0111i\u1ec1u khi\u1ec3n m\u1edbi th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onRemoveGroup(t){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Nh\xf3m \u0111i\u1ec1u khi\u1ec3n "${t.ten}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Nh\xf3m \u0111i\u1ec1u khi\u1ec3n",icon:"pi pi-info-circle"}).then(i=>{i&&this.dHttpService.removeGroupOfCabinet(this.mac,t.id).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"X\xf3a nh\xf3m \u0111i\u1ec1u khi\u1ec3n th\xe0nh c\xf4ng."}),this.onChange.emit()):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})}).catch(i=>{})}onViewDeviceInsideGroup(t){this.dHttpService.getDeviceInsideGroup(this.mac,t.id).subscribe({next:i=>{0===i.status?(this.deviceInsideGroups=[],i.data.forEach(n=>this.deviceInsideGroups.push(n.device))):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"'C\u1eadp nh\u1eadt danh s\xe1ch thi\u1ebft b\u1ecb trong nh\xf3m th\xe0nh c\xf4ng.'"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onUpdateDeviceToGroup(t){var i=this;return(0,f.Z)(function*(){try{let n=[];(yield(0,p.n)(i.dHttpService.getDeviceInsideGroup(i.mac,t.id))).data.forEach(c=>n.push(c.device)),i.dialogService.open(B.$,{data:{deviceIns:n,title:"Ch\u1ecdn thi\u1ebft b\u1ecb v\xe0o nh\xf3m \u0111i\u1ec1u khi\u1ec3n",has_parent:0,has_multi_selection:!0,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(c=>{if(c&&0!==c.length){let a=[];c.forEach(u=>a.push(u.id)),i.dHttpService.updateGroupOfCabinet(i.mac,t.id,a).subscribe({next:u=>{0===u.status?i.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt nh\xf3m \u0111i\u1ec1u khi\u1ec3n th\xe0nh c\xf4ng."}):(i.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${u.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",u.message))},error:u=>{i.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",u)}})}})}catch(n){console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})()}onCancel(){this.onChange.emit()}onSaveGroup(){const t=[],i=[];this.currentDeviceConfig.danh_sach_thong_so.forEach(n=>{2===n.group&&14===n.id&&(t.push(n.id),i.push(JSON.stringify(this.groups)))}),this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),0!==t.length&&0!==i.length&&t.length==i.length&&this.dHttpService.configDevice(this.currentDeviceConfig.id,t,i).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onAddPort(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.createPortOfCabinet(this.currentDeviceConfig.id).subscribe({next:t=>{0===t.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"T\u1ea1o C\u1ed5ng \u0111i\u1ec1u khi\u1ec3n m\u1edbi th\xe0nh c\xf4ng"}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onRemovePort(t){this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a C\u1ed5ng \u0111i\u1ec1u khi\u1ec3n "${t.ten}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a C\u1ed5ng \u0111i\u1ec1u khi\u1ec3n",icon:"pi pi-info-circle"}).then(i=>{i&&this.dHttpService.removePortOfCabinet(this.currentDeviceConfig.id,t.id).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"X\xf3a c\u1ed5ng \u0111i\u1ec1u khi\u1ec3n th\xe0nh c\xf4ng"}),this.onChange.emit()):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})}).catch(i=>{})}onSavePort(){const t=[],i=[];this.currentDeviceConfig.danh_sach_thong_so.forEach(n=>{2===n.group&&15===n.id&&(t.push(n.id),i.push(JSON.stringify(this.ports)))}),this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),0!==t.length&&0!==i.length&&t.length==i.length&&this.dHttpService.configDevice(this.currentDeviceConfig.id,t,i).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onComeback(){localStorage.removeItem(m.o.USER),sessionStorage.removeItem(m.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez),e.Y36(I.xA),e.Y36($.I),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-control-config"]],inputs:{currentDeviceConfig:"currentDeviceConfig"},outputs:{onChange:"onChange"},features:[e.TTD],decls:18,vars:9,consts:[[1,"m-0","p-1","mb-1","bg-blue-100","border-round","border-1","border-blue-100"],[1,"p-1"],[1,"font-bold"],["class","p-1 bg-white",4,"ngIf","ngIfElse"],[1,"m-0","p-1","bg-blue-100","border-round","border-1","border-blue-100"],["noSetting",""],[3,"showCloseIcon"],["dIG",""],["pTemplate",""],[3,"show"],[1,"p-1","bg-white"],[1,"p-fluid"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"flex","align-items-center","justify-content-between","border-top-1","border-gray-300","pt-1"],["pButton","","pRipple","","type","button","icon","fa-solid fa-plus",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-save",1,"mr-1",3,"click"],[2,"max-width","50px"],[2,"min-width","300px"],[1,"pi","pi-pencil","mr-2"],[2,"min-width","50px"],[2,"min-width","100px"],[2,"min-width","300px",3,"pEditableColumn","pEditableColumnField","pEditableColumnRowIndex"],["pTemplate","input"],["pTemplate","output"],["pButton","","pRipple","","type","button","icon","fa-solid fa-minus","pTooltip","X\xf3a nh\xf3m","tooltipPosition","top",1,"p-button-outlined","p-button-sm","mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","icon","fa-solid fa-edit","pTooltip","Ch\u1ec9nh s\u1eeda danh s\xe1ch thi\u1ebft b\u1ecb trong nh\xf3m","tooltipPosition","top",1,"p-button-sm","mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","icon","fa-solid fa-eye","pTooltip","Xem danh s\xe1ch thi\u1ebft b\u1ecb trong nh\xf3m","tooltipPosition","top",1,"p-button-sm","mr-1",3,"disabled","click"],["pInputText","","type","text",1,"p-inputtext-sm",3,"ngModel","ngModelChange"],["pButton","","pRipple","","type","button","icon","fa-solid fa-minus","pTooltip","X\xf3a c\u1ed5ng","tooltipPosition","top",1,"p-button-outlined","p-button-sm","mr-1",3,"disabled","click"],[1,"m-0","p-1"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","200px",3,"value","scrollable"],["pTemplate","emptymessage"],[2,"min-width","200px"],[1,"p-fluid","p-2"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"span",2)(3,"u"),e._uU(4,"Nh\xf3m \u0111i\u1ec1u khi\u1ec3n:"),e.qZA()()(),e.YNc(5,we,10,3,"div",3),e.qZA(),e.TgZ(6,"div",4)(7,"div",1)(8,"span",2)(9,"u"),e._uU(10,"C\u1ed5ng \u0111i\u1ec1u khi\u1ec3n:"),e.qZA()()(),e.YNc(11,Oe,10,3,"div",3),e.qZA(),e.YNc(12,qe,2,0,"ng-template",null,5,e.W1O),e.TgZ(14,"p-overlayPanel",6,7),e.YNc(16,Pe,4,2,"ng-template",8),e.qZA(),e._UZ(17,"ngx-loading",9)),2&t){const n=e.MAs(13);e.xp6(5),e.Q6J("ngIf",i.has_group)("ngIfElse",n),e.xp6(6),e.Q6J("ngIf",i.has_port)("ngIfElse",n),e.xp6(3),e.Akn(e.DdM(8,He)),e.Q6J("showCloseIcon",!0),e.xp6(3),e.Q6J("show",i.loading)}},directives:[_.O5,Z.iA,x.jx,Z.Wq,Z.YL,v.Fj,N.o,v.JJ,v.On,k.Hq,M.H,R.u,Q.T,F.RJ],styles:[""]}),o})();var Be=d(3300);function $e(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"label",23),e._uU(2,"Gi\xe1 tr\u1ecb d\xf2ng r\xf2 k\xedch ho\u1ea1t (mA)"),e.qZA(),e.TgZ(3,"div",24)(4,"input",25),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(4),e.Q6J("ngModel",t.value)}}function Re(o,r){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,$e,5,1,"div",21),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",55==t.id)}}function Qe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"label",23),e._uU(2,"S\u1ed1 l\u1ea7n \u0111\xf3ng l\u1ea1i khi t\xe1c \u0111\u1ed9ng"),e.qZA(),e.TgZ(3,"div",24)(4,"input",25),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(4),e.Q6J("ngModel",t.value)}}function Ye(o,r){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,Qe,5,1,"div",21),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",58==t.id)}}function Ge(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"label",23),e._uU(2,"Chu k\u1ef3 \u0111\xf3ng l\u1ea1i (gi\xe2y)"),e.qZA(),e.TgZ(3,"div",24)(4,"input",25),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).$implicit.value=n}),e.qZA()()()}if(2&o){const t=e.oxw(2).$implicit;e.xp6(4),e.Q6J("ngModel",t.value)}}function We(o,r){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,Ge,5,1,"div",21),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",59==t.id)}}function Ke(o,r){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,Re,2,1,"div",20),e.YNc(2,Ye,2,1,"div",20),e.YNc(3,We,2,1,"div",20),e.qZA()),2&o){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",2===t.group),e.xp6(1),e.Q6J("ngIf",2===t.group),e.xp6(1),e.Q6J("ngIf",2===t.group)}}function Ve(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e.YNc(1,Ke,4,3,"div",18),e.TgZ(2,"div",13)(3,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onCancel()}),e.qZA(),e.TgZ(4,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).onSaveLC()}),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.currentDeviceConfig.danh_sach_thong_so)}}function je(o,r){if(1&o&&(e.TgZ(0,"div",1)(1,"div",2)(2,"span",3)(3,"u"),e._uU(4,"C\u1ea3nh b\xe1o d\xf2ng r\xf2:"),e.qZA()()(),e.YNc(5,Ve,5,1,"div",17),e.qZA()),2&o){const t=e.oxw(),i=e.MAs(31);e.xp6(5),e.Q6J("ngIf",t.currentDeviceConfig.danh_sach_thong_so&&0!==t.currentDeviceConfig.danh_sach_thong_so.length)("ngIfElse",i)}}function ze(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",26),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",27),e._uU(4,"Th\u1eddi gian"),e.qZA(),e.TgZ(5,"th",28),e._uU(6,"P th\u1ea5p (kW)"),e.qZA(),e.TgZ(7,"th",28),e._uU(8,"P cao (kW)"),e.qZA(),e.TgZ(9,"th",29),e._uU(10,"Thao t\xe1c"),e.qZA()())}function Xe(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",27)(4,"ngx-timepicker-field",30),e.NdJ("ngModelChange",function(n){return e.CHM(t).$implicit.time=n}),e.qZA()(),e.TgZ(5,"td",28)(6,"p-inputNumber",31),e.NdJ("ngModelChange",function(n){return e.CHM(t).$implicit.min=n})("ngModelChange",function(){const s=e.CHM(t).$implicit;return e.oxw().onCheckValid(s)}),e.qZA()(),e.TgZ(7,"td",28)(8,"p-inputNumber",32),e.NdJ("ngModelChange",function(n){return e.CHM(t).$implicit.max=n})("ngModelChange",function(){const s=e.CHM(t).$implicit;return e.oxw().onCheckValid(s)}),e.qZA()(),e.TgZ(9,"td",29)(10,"button",33),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().onRemovePWS(s)}),e.qZA()()()}if(2&o){const t=r.$implicit,i=r.rowIndex;e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Q6J("ngModel",t.time)("controlOnly",!0)("format",24),e.xp6(2),e.Tol(t.is_valid?"":"ng-invalid ng-dirty"),e.Q6J("ngModel",t.min)("minFractionDigits",1)("min",0),e.xp6(2),e.Tol(t.is_valid?"":"ng-invalid ng-dirty"),e.Q6J("ngModel",t.max)("min",t.min)("minFractionDigits",1)}}function et(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",26),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",27),e._uU(4,"Th\xf4ng s\u1ed1"),e.qZA(),e.TgZ(5,"th",28),e._uU(6,"M\u1ee9c th\u1ea5p"),e.qZA(),e.TgZ(7,"th",28),e._uU(8,"M\u1ee9c cao"),e.qZA(),e.TgZ(9,"th",29),e._uU(10,"Thao t\xe1c"),e.qZA()())}function tt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"p-inputNumber",31),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().$implicit.min=n})("ngModelChange",function(){e.CHM(t);const n=e.oxw().$implicit;return e.oxw().onCheckUIValid(n)}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Tol(t.is_valid?"":"ng-invalid ng-dirty"),e.Q6J("ngModel",t.min)("minFractionDigits",1)("min",0)}}function it(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"p-inputNumber",32),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().$implicit.max=n})("ngModelChange",function(){e.CHM(t);const n=e.oxw().$implicit;return e.oxw().onCheckUIValid(n)}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Tol(t.is_valid?"":"ng-invalid ng-dirty"),e.Q6J("ngModel",t.max)("min",t.min)("minFractionDigits",1)}}function nt(o,r){if(1&o&&(e.TgZ(0,"tr")(1,"td",26),e._uU(2),e.qZA(),e.TgZ(3,"td",27),e._uU(4),e.qZA(),e.TgZ(5,"td",28),e.YNc(6,tt,1,5,"p-inputNumber",34),e.qZA(),e.TgZ(7,"td",28),e.YNc(8,it,1,5,"p-inputNumber",35),e.qZA(),e._UZ(9,"td",29),e.qZA()),2&o){const t=r.$implicit,i=r.rowIndex;e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("ngIf",t.min_en),e.xp6(2),e.Q6J("ngIf",t.max_en)}}function ot(o,r){1&o&&(e.TgZ(0,"p",36),e._uU(1,"Kh\xf4ng c\xf3 th\xf4ng s\u1ed1 c\xe0i \u0111\u1eb7t."),e.qZA())}let st=(()=>{class o{constructor(t,i,n,s){this.dHttpService=t,this.messageService=i,this.router=n,this.dialogService=s,this.onChange=new e.vpe,this.devicePowerWarningItems=[],this.UIWarningItems=[{name:"U1 (V)",min:0,max:0,min_en:!0,max_en:!0,is_valid:!0},{name:"U2 (V)",min:0,max:0,min_en:!0,max_en:!0,is_valid:!0},{name:"U3 (V)",min:0,max:0,min_en:!0,max_en:!0,is_valid:!0},{name:"I1 (A)",min:0,max:0,min_en:!1,max_en:!0,is_valid:!0},{name:"I2 (A)",min:0,max:0,min_en:!1,max_en:!0,is_valid:!0},{name:"I3 (A)",min:0,max:0,min_en:!1,max_en:!0,is_valid:!0}],this.form_valid=!1,this.form_ui_valid=!1,this.has_LC=!1,this.loading=!1}ngOnChanges(t){let i=t.currentDeviceConfig;i&&i.currentValue&&(this.checkLC(),this.fetchDevicePowerWarningSetting(),this.fetchUIWarningSetting())}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}checkLC(){this.has_LC=!1,this.currentDeviceConfig.danh_sach_thong_so.forEach(t=>{(55===t.id||58===t.id||59===t.id)&&(this.has_LC=!0)})}ngOnInit(){}onCancel(){this.onChange.emit()}onSaveLC(){const t=[],i=[];this.currentDeviceConfig.danh_sach_thong_so.forEach(n=>{(2===n.group&&55===n.id&&n.value||2===n.group&&58===n.id&&n.value||2===n.group&&59===n.id&&n.value)&&(t.push(n.id),i.push(n.value))}),3===t.length&&3===i.length?(this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.configDevice(this.currentDeviceConfig.id,t,i).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\xf4ng s\u1ed1 c\u1ea3nh b\xe1o d\xf2ng r\xf2 kh\xf4ng h\u1ee3p l\u1ec7."})}fetchDevicePowerWarningSetting(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getDevicePowerWarningSetting(this.currentDeviceConfig.id).subscribe({next:t=>{0===t.status?(this.devicePowerWarning=t.data,this.devicePowerWarningItems=[],this.devicePowerWarning&&(this.devicePowerWarning.power_warning_items.forEach(i=>{let n=new E.gm;n.time=i.time,n.max=i.max/1e3,n.min=i.min/1e3,n.is_valid=!0,this.devicePowerWarningItems.push(n)}),this.checkFormValid()),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}fetchUIWarningSetting(){this.UIWarningItems=[{name:"U1 (V)",min:this.currentDeviceConfig.v1_low?this.currentDeviceConfig.v1_low:0,max:this.currentDeviceConfig.v1_high?this.currentDeviceConfig.v1_high:0,min_en:!0,max_en:!0,is_valid:!0},{name:"U2 (V)",min:this.currentDeviceConfig.v2_low?this.currentDeviceConfig.v2_low:0,max:this.currentDeviceConfig.v2_high?this.currentDeviceConfig.v2_high:0,min_en:!0,max_en:!0,is_valid:!0},{name:"U3 (V)",min:this.currentDeviceConfig.v3_low?this.currentDeviceConfig.v3_low:0,max:this.currentDeviceConfig.v3_high?this.currentDeviceConfig.v3_high:0,min_en:!0,max_en:!0,is_valid:!0},{name:"I1 (A)",min:0,max:this.currentDeviceConfig.i1_high?this.currentDeviceConfig.i1_high:0,min_en:!1,max_en:!0,is_valid:!0},{name:"I2 (A)",min:0,max:this.currentDeviceConfig.i2_high?this.currentDeviceConfig.i2_high:0,min_en:!1,max_en:!0,is_valid:!0},{name:"I3 (A)",min:0,max:this.currentDeviceConfig.i3_high?this.currentDeviceConfig.i3_high:0,min_en:!1,max_en:!0,is_valid:!0}],this.checkFormUIValid()}onRemovePWS(t){this.devicePowerWarningItems.splice(this.devicePowerWarningItems.indexOf(t),1),this.checkFormValid()}onAddPWS(){let t=new E.gm;t.time="00:00",t.is_valid=!1,this.devicePowerWarningItems.push(t),this.form_valid=!1}onSavePWS(){let t=0;if(this.devicePowerWarningItems.forEach(n=>{t+=this.devicePowerWarningItems.filter(s=>s.time==n.time).length}),t>this.devicePowerWarningItems.length)return void this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"C\u1ea3nh b\xe1o th\u1eddi gian b\u1ecb tr\xf9ng nhau."});let i=[];this.devicePowerWarningItems.forEach(n=>{let s=new E.gm;s.time=n.time,s.max=1e3*n.max,s.min=1e3*n.min,i.push(s)}),this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.createOrUpdatePowerWarningSetting(this.currentDeviceConfig.id,void 0,i).subscribe({next:n=>{0===n.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===n.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:n=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onCheckValid(t){t.is_valid=t.min>=0&&t.max>=0&&t.max>t.min,this.checkFormValid()}checkFormValid(){this.form_valid=!0,this.devicePowerWarningItems.forEach(t=>{(!t.is_valid||!t.time)&&(this.form_valid=!1)})}onCheckUIValid(t){t.is_valid=0==t.min&&0==t.max||t.max>t.min,this.checkFormUIValid()}checkFormUIValid(){this.form_ui_valid=!0,this.UIWarningItems.forEach(t=>{t.is_valid||(this.form_ui_valid=!1)})}onSaveUI(){this.onSaveUIData([this.currentDeviceConfig.id])}onSaveUIFor(){this.dialogService.open(B.$,{data:{deviceIns:[],selectedDeviceIns:!0,title:"Ch\u1ecdn thi\u1ebft b\u1ecb",has_parent:void 0,has_multi_selection:!0,disabled_nodes:["type@1"],disabled_device_in:!1},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(n=>{if(n){let s=[];n.forEach(l=>s.push(l.id)),this.onSaveUIData(s)}})}onSaveUIData(t){this.dHttpService.settingUIWarning(this.UIWarningItems[0].max,this.UIWarningItems[0].min,this.UIWarningItems[1].max,this.UIWarningItems[1].min,this.UIWarningItems[2].max,this.UIWarningItems[2].min,this.UIWarningItems[3].max,this.UIWarningItems[4].max,this.UIWarningItems[5].max,void 0,t,void 0).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt th\xf4ng tin c\xe0i \u0111\u1eb7t th\xe0nh c\xf4ng."}),this.onChange.emit(),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}onComeback(){localStorage.removeItem(m.o.USER),sessionStorage.removeItem(m.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez),e.Y36(b.F0),e.Y36(I.xA))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-alarm-config"]],inputs:{currentDeviceConfig:"currentDeviceConfig"},outputs:{onChange:"onChange"},features:[e.TTD],decls:33,vars:9,consts:[["class","m-0 p-1 mb-1 bg-blue-100 border-round border-1 border-blue-100",4,"ngIf"],[1,"m-0","p-1","mb-1","bg-blue-100","border-round","border-1","border-blue-100"],[1,"p-1"],[1,"font-bold"],[1,"p-1","bg-white"],[1,"p-fluid"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],[1,"flex","align-items-center","justify-content-between","border-top-1","border-gray-300","pt-1"],["pButton","","pRipple","","type","button","icon","fa-solid fa-plus",1,"mr-1",3,"click"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-save",1,"mr-1",3,"disabled","click"],[1,"flex","align-items-center","justify-content-end","border-top-1","border-gray-300","pt-1"],["pButton","","pRipple","","type","button","label","\xc1p d\u1ee5ng cho...","icon","fa-solid fa-save",1,"p-button-success","mr-1",3,"disabled","click"],["noSetting",""],[3,"show"],["class","p-1 bg-white",4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-save",1,"mr-1",3,"click"],["class","p-fluid",4,"ngIf"],["class","field grid mb-1",4,"ngIf"],[1,"field","grid","mb-1"],["for","name",1,"col-12","md:col-5"],[1,"col-12","md:col-7"],["type","text","pInputText","",3,"ngModel","ngModelChange"],[2,"max-width","30px"],[2,"min-width","150px"],[2,"min-width","120px"],[2,"min-width","80px"],[3,"ngModel","controlOnly","format","ngModelChange"],["mode","decimal","inputId","locale-user",3,"ngModel","minFractionDigits","min","ngModelChange"],["mode","decimal","inputId","locale-user",3,"ngModel","min","minFractionDigits","ngModelChange"],["pButton","","pRipple","","type","button","icon","fa-solid fa-minus",1,"p-button-outlined","p-button-sm","mr-1",3,"click"],["mode","decimal","inputId","locale-user",3,"ngModel","minFractionDigits","min","class","ngModelChange",4,"ngIf"],["mode","decimal","inputId","locale-user",3,"ngModel","min","minFractionDigits","class","ngModelChange",4,"ngIf"],[1,"m-0","p-1"]],template:function(t,i){1&t&&(e.YNc(0,je,6,2,"div",0),e.TgZ(1,"div",1)(2,"div",2)(3,"span",3)(4,"u"),e._uU(5,"C\u1ea3nh b\xe1o c\xf4ng su\u1ea5t ngu\u1ed3n:"),e.qZA()()(),e.TgZ(6,"div",4)(7,"div",5)(8,"p-table",6),e.YNc(9,ze,11,0,"ng-template",7),e.YNc(10,Xe,11,14,"ng-template",8),e.qZA()(),e.TgZ(11,"div",9)(12,"button",10),e.NdJ("click",function(){return i.onAddPWS()}),e.qZA(),e.TgZ(13,"span")(14,"button",11),e.NdJ("click",function(){return i.onCancel()}),e.qZA(),e.TgZ(15,"button",12),e.NdJ("click",function(){return i.onSavePWS()}),e.qZA()()()()(),e.TgZ(16,"div",1)(17,"div",2)(18,"span",3)(19,"u"),e._uU(20,"C\u1ea3nh b\xe1o th\xf4ng s\u1ed1 U-I:"),e.qZA()()(),e.TgZ(21,"div",4)(22,"div",5)(23,"p-table",6),e.YNc(24,et,11,0,"ng-template",7),e.YNc(25,nt,10,4,"ng-template",8),e.qZA()(),e.TgZ(26,"div",13)(27,"button",11),e.NdJ("click",function(){return i.onCancel()}),e.qZA(),e.TgZ(28,"button",12),e.NdJ("click",function(){return i.onSaveUI()}),e.qZA(),e.TgZ(29,"button",14),e.NdJ("click",function(){return i.onSaveUIFor()}),e.qZA()()()(),e.YNc(30,ot,2,0,"ng-template",null,15,e.W1O),e._UZ(32,"ngx-loading",16)),2&t&&(e.Q6J("ngIf",i.has_LC),e.xp6(8),e.Q6J("value",i.devicePowerWarningItems)("scrollable",!0),e.xp6(7),e.Q6J("disabled",!i.form_valid),e.xp6(8),e.Q6J("value",i.UIWarningItems)("scrollable",!0),e.xp6(5),e.Q6J("disabled",!i.form_ui_valid),e.xp6(1),e.Q6J("disabled",!i.form_ui_valid),e.xp6(3),e.Q6J("show",i.loading))},directives:[_.O5,_.sg,v.Fj,N.o,v.JJ,v.On,k.Hq,M.H,Z.iA,x.jx,Be.Ox,H.Rn,F.RJ],styles:[""]}),o})();function rt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",16)(1,"app-setting-config",17),e.NdJ("onChange",function(){return e.CHM(t),e.oxw(2).onReload()}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("configPayload",t.configPayload)}}function at(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",16)(1,"app-control-config",18),e.NdJ("onChange",function(){return e.CHM(t),e.oxw(2).onReload()}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("currentDeviceConfig",t.currentDeviceConfig)}}function lt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",16)(1,"app-alarm-config",18),e.NdJ("onChange",function(){return e.CHM(t),e.oxw(2).onReload()}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("currentDeviceConfig",t.currentDeviceConfig)}}function ct(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",0)(1,"p-dropdown",14),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().currentDeviceConfigId=n})("onChange",function(){return e.CHM(t),e.oxw().onChangeDevice()}),e.qZA(),e.YNc(2,rt,2,1,"div",15),e.YNc(3,at,2,1,"div",15),e.YNc(4,lt,2,1,"div",15),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("options",t.deviceParameters)("ngModel",t.currentDeviceConfigId)("emptyMessage","Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb"),e.xp6(1),e.Q6J("ngIf",1==t.tabIndex),e.xp6(1),e.Q6J("ngIf",2==t.tabIndex),e.xp6(1),e.Q6J("ngIf",3==t.tabIndex)}}function dt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().onDownloadConfigToCabinet()}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!t.mac_address)}}function pt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){return e.CHM(t),e.oxw().onResDownloadConfigToLed()}),e.qZA()}}function ut(o,r){if(1&o&&(e.TgZ(0,"p",21),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.no_device_msg)}}let Y=(()=>{class o{constructor(t,i,n,s,l){this.dHttpService=t,this.messageService=i,this.ref=n,this.config=s,this.router=l,this.tabIndex=1,this.no_device_msg="",this.deviceParameters=[],this.loading=!1,this.en_alert="0"}ngOnDestroy(){this.loadingTime&&clearTimeout(this.loadingTime)}ngOnInit(){this.config.data&&(this.device=this.config.data.device,this.req_download_to_led=this.config.data.req_download_to_led,this.device&&this.fetchDeviceInfo())}initTab(){this.tabs=[{label:"Th\xf4ng s\u1ed1",command:()=>{this.tabIndex=1}},{label:"\u0110i\u1ec1u khi\u1ec3n",visible:this.is_cabinet,command:()=>{this.tabIndex=2}},{label:"C\u1ea3nh b\xe1o",visible:this.is_cabinet,command:()=>{this.tabIndex=3}}],this.tabIndex?this.activeTab=this.tabs[this.tabIndex-1]:(this.activeTab=this.tabs[0],this.tabIndex=1)}fetchDeviceInfo(){this.loadingTime=setTimeout(()=>{this.loading=!0},1e3),this.dHttpService.getDeviceParameterAndValue(this.device.id,m.o.CASE_CAUHINH).subscribe({next:t=>{0===t.status?(this.deviceParameters=t.data,this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime),this.deviceParameters&&0!=this.deviceParameters.length?(this.currentDeviceConfig=this.currentDeviceConfigId?this.deviceParameters.find(i=>i.id==this.currentDeviceConfigId):this.deviceParameters[0],this.checkDevice()):this.no_device_msg=`Thi\u1ebft b\u1ecb: "${this.device.name}" kh\xf4ng h\u1ed7 tr\u1ee3 c\u1ea5u h\xecnh.`):2===t.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t),this.loading=!1,this.loadingTime&&clearTimeout(this.loadingTime)}})}checkDevice(){let n,s,t=!1,i=!1;this.currentDeviceConfig.danh_sach_thong_so.forEach(l=>{1==l.id?(t=!0,this.mac_address=l.value):7==l.id?(i=!0,n=l.value):4==l.id&&(s=l.value)}),this.is_cabinet=!(!t||i),this.initTab(),this.configPayload={currentDeviceConfig:this.currentDeviceConfig,is_cabinet:this.is_cabinet,mac_address:this.mac_address,controller_id:n,group_id:s}}onChangeDevice(){this.currentDeviceConfig=this.deviceParameters.find(t=>t.id==this.currentDeviceConfigId),this.checkDevice()}onDestroy(){this.ref.destroy()}onReload(){this.fetchDeviceInfo()}onDownloadConfigToCabinet(){this.dHttpService.updateDIMsForCabinet(this.currentDeviceConfig.id).subscribe({next:t=>{0===t.status?this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 t\u1ea3i c\u1ea5u h\xecnh xu\u1ed1ng thi\u1ebft b\u1ecb."}):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onResDownloadConfigToLed(){this.ref.close({device:this.currentDeviceConfig,en_alert:this.en_alert})}onComeback(){localStorage.removeItem(m.o.USER),sessionStorage.removeItem(m.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez),e.Y36(I.E7),e.Y36(I.S),e.Y36(b.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-configuration"]],decls:16,vars:7,consts:[[1,"relative","h-full","w-full"],[1,"head"],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[3,"model","activeItem"],[1,"content","p-1"],["class","relative h-full w-full",4,"ngIf","ngIfElse"],[1,"bttm","flex","align-items-center","justify-content-end","border-top-1","border-gray-300"],["pButton","","pRipple","","type","button","label","\u0110\xf3ng","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","T\u1ea3i c\u1ea5u h\xecnh","class","mr-1","icon","pi pi-download",3,"disabled","click",4,"ngIf"],["pButton","","pRipple","","type","button","label","T\u1ea3i c\u1ea5u h\xecnh","class","mr-1","icon","pi pi-download",3,"click",4,"ngIf"],["noDevice",""],[3,"show"],["optionLabel","name","optionValue","id","styleClass","w-full mb-1","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","emptyMessage","ngModelChange","onChange"],["class","cfg",4,"ngIf"],[1,"cfg"],[3,"configPayload","onChange"],[3,"currentDeviceConfig","onChange"],["pButton","","pRipple","","type","button","label","T\u1ea3i c\u1ea5u h\xecnh","icon","pi pi-download",1,"mr-1",3,"disabled","click"],["pButton","","pRipple","","type","button","label","T\u1ea3i c\u1ea5u h\xecnh","icon","pi pi-download",1,"mr-1",3,"click"],[1,"m-0","p-1"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4,"C\u1ea5u h\xecnh thi\u1ebft b\u1ecb"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.onDestroy()}),e.qZA()(),e._UZ(6,"p-tabMenu",5),e.qZA(),e.TgZ(7,"div",6),e.YNc(8,ct,5,6,"div",7),e.qZA(),e.TgZ(9,"div",8)(10,"button",9),e.NdJ("click",function(){return i.onDestroy()}),e.qZA(),e.YNc(11,dt,1,1,"button",10),e.YNc(12,pt,1,0,"button",11),e.qZA()(),e.YNc(13,ut,2,1,"ng-template",null,12,e.W1O),e._UZ(15,"ngx-loading",13)),2&t){const n=e.MAs(14);e.xp6(6),e.Q6J("model",i.tabs)("activeItem",i.activeTab),e.xp6(2),e.Q6J("ngIf",i.deviceParameters&&0!==i.deviceParameters.length)("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",i.is_cabinet),e.xp6(1),e.Q6J("ngIf",i.req_download_to_led),e.xp6(3),e.Q6J("show",i.loading)}},directives:[k.Hq,M.H,re.d,_.O5,q.Lt,v.JJ,v.On,Ee,Ue,st,F.RJ],styles:[".head[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:86px}.content[_ngcontent-%COMP%]{position:absolute;top:86px;left:0;bottom:45px;width:100%}.cfg[_ngcontent-%COMP%]{position:absolute;top:42px;left:0;bottom:0;width:100%;overflow:auto}.bttm[_ngcontent-%COMP%]{position:absolute;bottom:0;height:45px;width:100%}"]}),o})();d(7156);var ht=d(2304),G=d(9997),mt=d(5431),gt=d(8386),_t=d(564),ft=d(7675);class vt{constructor(r,t,i){this.options={baudRate:9600,dataBits:8,parity:"none",bufferSize:256,flowControl:"none"},this.controlCharacter="\n",this.keepReading=!0,this.readFunction=r,t&&(this.options=t),i&&(this.controlCharacter=i)}sendData(r){var t=this;return(0,f.Z)(function*(){yield t.writer.write(r)})()}readLoop(){var r=this;return(0,f.Z)(function*(){for(;r.port.readable&&r.keepReading;){const t=new TextDecoderStream;r.readableStreamClosed=r.port.readable.pipeTo(t.writable),r.reader=t.readable.pipeThrough(new TransformStream(new Ct(r.controlCharacter))).getReader();try{for(;;){const{value:i,done:n}=yield r.reader.read();if(n)break;i&&r.readFunction(i)}}catch(i){console.error("Read Loop error. Have the serial device been disconnected ? "),alert("C\xf3 l\u1ed7i x\u1ea3y ra")}}})()}close(r){var t=this;return(0,f.Z)(function*(){t.keepReading=!1,t.reader.cancel(),yield t.readableStreamClosed.catch(()=>{}),t.writer.close(),yield t.writableStreamClosed,yield t.port.close(),r(null)})()}connect(r){var t=this;return(0,f.Z)(function*(){if(t.keepReading=!0,"serial"in navigator){let i=navigator;yield i.serial.getPorts();try{t.port=yield i.serial.requestPort()}catch(l){return void console.error("Requesting port error: "+l)}try{yield t.port.open(t.options)}catch(l){return void console.error("Opening port error: "+l)}const s=new TextEncoderStream;t.writableStreamClosed=s.readable.pipeTo(t.port.writable),t.writer=s.writable.getWriter(),t.readLoop(),r(t.port)}else console.error("This browser does NOT support the Web Serial API")})()}}class Ct{constructor(r){this.container="",this.container="",this.controlCharacter=r}transform(r,t){this.container+=r;const i=this.container.split(this.controlCharacter);this.container=i.pop(),i.forEach(n=>t.enqueue(n))}flush(r){r.enqueue(this.container)}}function bt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",24),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommConnect()}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",!t.commSelected)}}function xt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCommDisconnect()}),e.qZA()}}function yt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"input",36),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).mac_filter=n})("keypress",function(){return e.CHM(t),e.oxw(2).onFilterChange()}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("ngModel",t.mac_filter)}}function Tt(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",37),e._uU(2,"CMD"),e.qZA(),e.TgZ(3,"th",37),e._uU(4,"\u0110\xe8n"),e.qZA(),e.TgZ(5,"th",38),e._uU(6,"T\u1ee7"),e.qZA(),e.TgZ(7,"th",39),e._uU(8,"Nh\xf3m"),e.qZA(),e.TgZ(9,"th",40),e._uU(10,"Alarm"),e.qZA(),e.TgZ(11,"th",39),e._uU(12,"DIM"),e.qZA(),e.TgZ(13,"th",39),e._uU(14,"U(V)"),e.qZA(),e.TgZ(15,"th",39),e._uU(16,"I(A)"),e.qZA(),e.TgZ(17,"th",39),e._uU(18,"P(W)"),e.qZA(),e.TgZ(19,"th",41),e._uU(20,"Version"),e.qZA(),e.TgZ(21,"th",42),e._uU(22,"Config"),e.qZA()())}const Et=function(o){return{color:o}};function Dt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr")(1,"td",37)(2,"div",43)(3,"p",43)(4,"button",44),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onTurnOff(s)}),e.qZA(),e.TgZ(5,"button",45),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onTurnOn(s)}),e.qZA(),e.TgZ(6,"button",46),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(2);return l.onGetData(s),l.onSelectedLed(s)}),e.qZA()(),e.TgZ(7,"p",43)(8,"button",47),e.NdJ("click",function(n){const l=e.CHM(t).$implicit,c=e.oxw(2);return e.MAs(30).toggle(n),c.onSelectedLed(l)}),e.qZA(),e.TgZ(9,"button",48),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onOpenCfgLed(s.mac)}),e.qZA()()()(),e.TgZ(10,"td",37)(11,"span",49),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onMapSearch(s.mac)}),e._uU(12),e.qZA()(),e.TgZ(13,"td",38)(14,"span",50),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).onMapSearch(s.controller)}),e._uU(15),e.qZA()(),e.TgZ(16,"td",39),e._uU(17),e.qZA(),e.TgZ(18,"td",40)(19,"div",43)(20,"p",43),e._uU(21),e.qZA(),e.TgZ(22,"p",43),e._uU(23),e.qZA()()(),e.TgZ(24,"td",39),e._uU(25),e.qZA(),e.TgZ(26,"td",39),e._uU(27),e.qZA(),e.TgZ(28,"td",39),e._uU(29),e.qZA(),e.TgZ(30,"td",39),e._uU(31),e.qZA(),e.TgZ(32,"td",41),e._uU(33),e.qZA(),e.TgZ(34,"td",42)(35,"div",43)(36,"p",43),e._uU(37),e.qZA(),e.TgZ(38,"p",43),e._uU(39),e.qZA()()()()}if(2&o){const t=r.$implicit,i=e.oxw(2);e.xp6(11),e.Q6J("ngStyle",e.VKq(13,Et,t.dim&&"00"!=t.dim?"#00f000":"blue")),e.xp6(1),e.Oqu(i.macDivision(t.mac)),e.xp6(3),e.hij(" ",i.macDivision(t.controller),""),e.xp6(2),e.Oqu(i.hex2dec(t.group)),e.xp6(4),e.hij("Ngu\u1ed3n: ",t.alarm_ps?t.alarm_ps:"N/A",""),e.xp6(2),e.hij("Ch\u1ed1ng s\xe9t: ",t.alarm_cs?t.alarm_cs:"N/A",""),e.xp6(2),e.Oqu(i.hex2dec(t.dim)),e.xp6(2),e.Oqu(t.volt),e.xp6(2),e.Oqu(t.current),e.xp6(2),e.Oqu(t.power),e.xp6(2),e.Oqu(t.firmVer),e.xp6(4),e.hij("Ngu\u1ed3n: ",t.en_alarm_ps,""),e.xp6(2),e.hij("Ch\u1ed1ng s\xe9t: ",t.en_alarm_cs,"")}}function St(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",27)(2,"span",28)(3,"u"),e._uU(4,"Danh s\xe1ch \u0111\xe8n:"),e.qZA()(),e.TgZ(5,"span")(6,"button",29),e.NdJ("click",function(){return e.CHM(t),e.oxw().onLedScan()}),e.qZA()()(),e.TgZ(7,"div",30)(8,"div",31)(9,"p-table",32),e.YNc(10,yt,1,1,"ng-template",33),e.YNc(11,Tt,23,0,"ng-template",34),e.YNc(12,Dt,40,15,"ng-template",35),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(6),e.Q6J("disabled",!t.serialPort),e.xp6(3),e.Q6J("value",t.getListLEDs())("scrollable",!0)}}function Mt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",26)(1,"div",27)(2,"span",28)(3,"u"),e._uU(4,"Thay \u0111\u1ed5i t\u1ee7 \u0111i\u1ec1u khi\u1ec3n"),e.qZA()()(),e.TgZ(5,"div",30)(6,"div",31)(7,"table",51)(8,"tr")(9,"th",52),e._uU(10,"MAC t\u1ee7 c\u0169"),e.qZA(),e.TgZ(11,"th",52),e._uU(12,"MAC t\u1ee7 m\u1edbi"),e.qZA(),e.TgZ(13,"th",52),e._uU(14,"Thao t\xe1c"),e.qZA()(),e.TgZ(15,"tr")(16,"td",52)(17,"p-inputMask",53),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().oldCabinet=n}),e.qZA()(),e.TgZ(18,"td",52)(19,"p-inputMask",53),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().newCabinet=n}),e.qZA()(),e.TgZ(20,"td",52)(21,"button",54),e.NdJ("click",function(){return e.CHM(t),e.oxw().onChangeCabinet()}),e.qZA()()()()()()()}if(2&o){const t=e.oxw();e.xp6(17),e.Q6J("ngModel",t.oldCabinet),e.xp6(2),e.Q6J("ngModel",t.newCabinet),e.xp6(2),e.Q6J("disabled",!t.oldCabinet||!t.newCabinet)}}const Zt=function(){return[4800,9600,19200,115200]},wt=function(){return[5,6,7,8]},At=function(){return[1,1.5,2]},kt=function(){return["none","even","odd","space"]};function It(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",55)(1,"div",56)(2,"span",8),e._uU(3,"Baud"),e.qZA(),e.TgZ(4,"p-dropdown",57),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().serialOptions.baudRate=n}),e.qZA()(),e.TgZ(5,"div",56)(6,"span",8),e._uU(7,"Data"),e.qZA(),e.TgZ(8,"p-dropdown",57),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().serialOptions.dataBits=n}),e.qZA()(),e.TgZ(9,"div",56)(10,"span",8),e._uU(11,"Stop"),e.qZA(),e.TgZ(12,"p-dropdown",57),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().serialOptions.stopBits=n}),e.qZA()(),e.TgZ(13,"div",56)(14,"span",8),e._uU(15,"Parity"),e.qZA(),e.TgZ(16,"p-dropdown",57),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().serialOptions.parity=n}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("options",e.DdM(8,Zt))("ngModel",t.serialOptions.baudRate),e.xp6(4),e.Q6J("options",e.DdM(9,wt))("ngModel",t.serialOptions.dataBits),e.xp6(4),e.Q6J("options",e.DdM(10,At))("ngModel",t.serialOptions.stopBits),e.xp6(4),e.Q6J("options",e.DdM(11,kt))("ngModel",t.serialOptions.parity)}}function Lt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",55)(1,"div",56)(2,"span",8),e._uU(3,"C\u1ea3nh b\xe1o ngu\u1ed3n"),e.qZA(),e.TgZ(4,"p-dropdown",58),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().currentLedCfg.en_alarm_ps=n}),e.qZA()(),e.TgZ(5,"div",56)(6,"span",8),e._uU(7,"C\u1ea3nh b\xe1o ch\u1ed1ng s\xe9t"),e.qZA(),e.TgZ(8,"p-dropdown",58),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().currentLedCfg.en_alarm_cs=n}),e.qZA()(),e.TgZ(9,"button",59),e.NdJ("click",function(){return e.CHM(t),e.oxw().onSetCfg()}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("options",t.enCfgOption)("ngModel",t.currentLedCfg.en_alarm_ps),e.xp6(4),e.Q6J("options",t.enCfgOption)("ngModel",t.currentLedCfg.en_alarm_cs)}}function Ot(o,r){1&o&&(e.TgZ(0,"div"),e._uU(1," T\xednh n\u0103ng \u0111ang \u0111\u01b0\u1ee3c ph\xe1t tri\u1ec3n. Vui l\xf2ng quay l\u1ea1i sau. "),e.qZA())}const qt=function(){return{width:"300px"}},W=function(){return{width:"350px"}};let Nt=(()=>{class o{constructor(t){this.messageService=t,this.closeEvent=new e.vpe,this.searchEvent=new e.vpe,this.reqDownloadEvent=new e.vpe,this.commOption=[{key:"Zlamp Tool V1 (COM-RF)",value:"uart"}],this.comm_status_msg="Kh\xf4ng k\u1ebft n\u1ed1i",this.funcOption=[{key:"Qu\xe9t \u0111\xe8n LED",value:"scan_led"},{key:"Thay \u0111\u1ed5i t\u1ee7 \u0111i\u1ec1u khi\u1ec3n",value:"change_zcu"}],this.funcSelected="scan_led",this.serialOptions={baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:256,flowControl:"none"},this.serviceUuid="0000ffe0-0000-1000-8000-00805f9b34fb",this.characteristicUuid="0000ffe1-0000-1000-8000-00805f9b34fb",this.bleOption={filters:[{namePrefix:"Led"}],optionalServices:[this.serviceUuid]},this.bleDataBuffer="",this.leds=new Map,this.id_pack=1,this.enCfgOption=[{key:"Cho ph\xe9p",value:1},{key:"Kh\xf4ng cho ph\xe9p",value:0}]}ngOnChanges(t){let i=t.readyDownloadSettingToLed;i&&i.currentValue&&this.onDownloadSettingToLed(this.readyDownloadSettingToLed.device)}ngOnInit(){this.serialSupported="serial"in navigator,this.bleSupported="bluetooth"in navigator}onClose(){this.closeEvent.emit("close")}onCommSelected(t){"uart"!=t.value||this.serialSupported?"ble"==t.value&&!this.bleSupported&&this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 k\u1ebft n\u1ed1i Bluetooth"}):this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 k\u1ebft n\u1ed1i Serial"})}onUpdateCommOption(){}onCommConnect(){"uart"==this.commSelected?this.onSerialConnect():"ble"==this.commSelected&&this.onBleConnect()}onCommDisconnect(){"uart"==this.commSelected?this.onSerialDisconnect():"ble"==this.commSelected&&this.onBleDisconnect()}onSerialConnect(){this.serial=new vt(t=>this.serialDataHandler(t),this.serialOptions,";"),this.serialPort||this.serial.connect(t=>{this.serialPort=t,this.comm_status_msg=`K\u1ebft n\u1ed1i COM: ${this.serialOptions.baudRate}-${this.serialOptions.dataBits}-${this.serialOptions.stopBits}-${this.serialOptions.parity}`,this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 k\u1ebft n\u1ed1i c\u1ed5ng COM th\xe0nh c\xf4ng"})})}onSerialDisconnect(){this.serialPort&&this.serial.close(()=>{this.serialPort=null,this.comm_status_msg="Kh\xf4ng k\u1ebft n\u1ed1i",this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 ng\u1eaft k\u1ebft n\u1ed1i c\u1ed5ng COM th\xe0nh c\xf4ng"})})}serialDataHandler(t){"#"==t.substring(0,1)&&51==t.length?this.processLedDataHandler(t):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"})}onBleConnect(){var t=this;return(0,f.Z)(function*(){try{if(t.bleDevice=yield navigator.bluetooth.requestDevice(t.bleOption),!t.bleDevice)return;t.comm_status_msg=`K\u1ebft n\u1ed1i Bluetooth: ${t.bleDevice.name}`,t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 k\u1ebft n\u1ed1i c\u1ed5ng Bluetooth ${t.bleDevice.name} th\xe0nh c\xf4ng`}),t.bleDevice.addEventListener("gattserverdisconnected",s=>{t.onDisconnectedHandler(s)});let n=yield(yield t.bleDevice.gatt.connect()).getPrimaryService(t.serviceUuid);t.bleCharacteristic=yield n.getCharacteristic(t.characteristicUuid),yield t.bleCharacteristic.startNotifications(),t.bleCharacteristic.addEventListener("characteristicvaluechanged",s=>{t.bleHandleNotifications(s)})}catch(i){console.error(i),t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra. Vui l\xf2ng th\u1eed l\u1ea1i"})}})()}onBleDisconnect(){!this.bleDevice||this.bleDevice.gatt.connected&&(this.bleDevice.gatt.disconnect(),this.bleDataBuffer="")}onDisconnectedHandler(t){const i=t.target;this.comm_status_msg="Kh\xf4ng k\u1ebft n\u1ed1i",this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 ng\u1eaft k\u1ebft n\u1ed1i c\u1ed5ng Bluetooth ${i.name} th\xe0nh c\xf4ng`}),this.bleDevice=null}bleHandleNotifications(t){let i=t.target.value,s=new TextDecoder("utf-8").decode(i);this.bleDataBuffer+=s,this.bleDataBuffer.split(";").forEach(c=>{"#"==c.substring(0,1)&&51==c.length&&(this.bleDataBuffer=this.bleDataBuffer.replace(c+";",""),this.processLedDataHandler(c))})}onLedSearch(t){this.searchEvent.emit(t.mac)}onControllerSearch(t){this.searchEvent.emit(t)}onMapSearch(t){if(!t)return void this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Thi\u1ebfu th\xf4ng tin \u0111\u1ecba ch\u1ec9 MAC"});let i=t.split("-").join("");this.searchEvent.emit(i)}onLedScan(){this.leds.clear(),this.serialPort?this.onLedScanBySerial():this.bleDevice?this.onLedScanByBle():this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}onLedScanBySerial(){let t=this.packageCMD("14",void 0,void 0,void 0,void 0,void 0,void 0);this.serial.sendData(`${t}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 g\u1eedi l\u1ec7nh T\xecm ki\u1ebfm \u0110\xe8n"})}onLedScanByBle(){var t=this;return(0,f.Z)(function*(){let i=new TextEncoder,n=t.packageCMD("14",void 0,void 0,void 0,void 0,void 0,void 0),s=i.encode(n),l=t.sliceIntoChunks(s,20),c=0;for(;c<l.length;)yield t.bleCharacteristic.writeValueWithoutResponse(l[c]),c+=1})()}sliceIntoChunks(t,i){const n=[];for(let s=0;s<t.length;s+=i){const l=t.slice(s,s+i);n.push(l)}return n}onTurnOn(t){if(this.serialPort){let i=this.packageCMD("02",t.mac,t.controller,"00","64",void 0,void 0);this.serial.sendData(`${i}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi l\u1ec7nh b\u1eadt LEDs = ${t.mac}`})}else this.bleDevice||this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}onTurnOff(t){if(this.serialPort){let i=this.packageCMD("02",t.mac,t.controller,"00","00",void 0,void 0);this.serial.sendData(`${i}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi l\u1ec7nh t\u1eaft LEDs = ${t.mac}`})}else this.bleDevice||this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}onGetData(t){if(this.serialPort){let i=this.packageCMD("17",t.mac,void 0,void 0,void 0,void 0,void 0);this.serial.sendData(`${i}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi l\u1ec7nh \u0111\u1ecdc firmware LEDs = ${t.mac}`}),setTimeout(()=>{let n=this.packageCMD("03",t.mac,t.controller,t.group,"64",void 0,void 0);this.serial.sendData(`${n}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi l\u1ec7nh \u0111\u1ecdc d\u1eef li\u1ec7u LEDs = ${t.mac}`})},1e3)}else this.bleDevice||this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}onOpenCfgLed(t){this.reqDownloadEvent.emit(t)}onSelectedLed(t){this.currentLedCfg=t}onSetCfg(){if(this.serialPort){let i=this.packageCMD("05",this.currentLedCfg.mac,this.currentLedCfg.controller,this.currentLedCfg.group,void 0,this.dec2hex(0|this.currentLedCfg.en_alarm_ps<<1|this.currentLedCfg.en_alarm_cs<<2),void 0);this.serial.sendData(`${i}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi l\u1ec7nh c\xe0i \u0111\u1eb7t c\u1ea3nh b\xe1o cho LEDs = ${this.currentLedCfg.mac}`}),setTimeout(()=>{let n=this.packageCMD("11",this.currentLedCfg.mac,void 0,void 0,void 0,void 0,void 0);this.serial.sendData(`${n}\n`)},1e3)}else this.bleDevice||this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}onCloseCfgDialog(){this.currentLedCfg=null}onSetParam(){}onCloseParamDialog(){this.currentLedCfg=null}onDownloadSettingToLed(t){let i,n,s;if(t.danh_sach_thong_so.forEach(l=>{1==l.id?i=l.value:4==l.id?s=this.string2hex(l.value):7==l.id&&(n=l.value)}),this.serialPort){let l=this.packageCMD("03",i,n,s,"00",void 0,void 0);for(let c=0;c<3;c++)this.serial.sendData(`${l}\n`);this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`\u0110\xe3 g\u1eedi c\u1ea5u h\xecnh cho LEDs = ${i}`})}else this.bleDevice||this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Ch\u01b0a c\xf3 k\u1ebft n\u1ed1i"})}processLedDataHandler(t){var i=this;return(0,f.Z)(function*(){let n=t.toLocaleLowerCase(),s=n.substring(9,11);if("12"==s){let c=n.substring(11,23);if(i.mac_filter&&!c.includes(i.mac_filter))return;let a=new E.ou;a.mac=n.substring(11,23),a.controller=n.substring(23,35),a.group=n.substring(35,37);let u=parseInt(n.substring(37,39),16);a.en_alarm_ps=u>>1&1,a.en_alarm_cs=u>>2&1,i.leds.set(c,a),i.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`LEDs = ${a.mac} tr\u1ea3 l\u1eddi l\u1ec7nh qu\xe9t \u0111\xe8n/c\xe0i \u0111\u1eb7t c\u1ea3nh b\xe1o`})}else if("10"==s){let c=n.substring(23,35),a=i.leds.get(c);if(a){a.controller=n.substring(11,23),a.group=n.substring(35,37),a.dim=n.substring(37,39);let u=parseInt(n.substring(39,47),16);a.power=2047&u,a.current=(u>>11&4095)/1e3,a.volt=u>>23&511;let C=parseInt(n.substring(47,49),16);0==Number(3&C)?a.alarm_ps="NONE":1==Number(3&C)?a.alarm_ps="LOWER":2==Number(3&C)&&(a.alarm_ps="HIGHER"),1==Number(C>>2&1)?a.alarm_cs="ERROR":0==Number(C>>2&1)&&(a.alarm_cs="NONE");let y=parseInt(n.substring(49,51),16);a.en_alarm_ps=y>>1&1,a.en_alarm_cs=y>>2&1,i.currentLedCfg=null}i.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`LEDs = ${c} tr\u1ea3 l\u1eddi l\u1ec7nh c\xe0i \u0111\u1eb7t/\u0111\u1ecdc d\u1eef li\u1ec7u`})}else if("02"==s){let c=n.substring(23,35),a=i.leds.get(c);a&&(a.controller=n.substring(11,23),a.dim=n.substring(35,37),a.volt=null,a.current=null,a.power=null,a.alarm_cs=null,a.alarm_ps=null,a.en_alarm_cs=null,a.en_alarm_ps=null),i.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:`LEDs = ${c} tr\u1ea3 l\u1eddi l\u1ec7nh \u0111i\u1ec1u khi\u1ec3n`})}else if("18"==s){let c=n.substring(11),a="";for(var l=0;l<c.length;l+=2)a+=String.fromCharCode(parseInt(c.slice(l,l+2),16));i.leds.get(i.currentLedCfg.mac).firmVer=a.replace(/[\u0000-\u001F\u007F-\u009F]/g,"")}})()}packageCMD(t,i,n,s,l,c,a){let u;this.id_pack>255&&(this.id_pack=1);let C=255,S=C^this.id_pack^1;if("14"==t){let T="140000000000000000000000000000000000000000";u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("02"==t){let T=`02${n}${i}${l}00000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("03"==t){let T=`03${n}${i}${s}${l}000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("05"==t){let T=`05${n}${i}${c}00000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("11"==t){let T=`11${i}0000000000000000000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("17"==t){let T=`17${i}0000000000000000000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}else if("08"==t){let T=`08${n}${a}0000000000000000`;u="#ZCUCMD="+this.dec2hex(C)+this.dec2hex(this.id_pack)+this.dec2hex(1)+this.dec2hex(S)+T+";"}return this.id_pack+=2,u}dec2hex(t){if(t>255)return null;let i=t.toString(16);return 1==i.length&&(i="0"+i),i}hex2dec(t){return t?parseInt(t,16).toString():"N/A"}string2hex(t){let i=parseInt(t);if(i>255)return null;let n=i.toString(16);return 1==n.length&&(n="0"+n),n}macDivision(t){return`${t.substring(0,4)}-${t.substring(4,8)}-${t.substring(8,12)}`}onFilterChange(){}getListLEDs(){let t=[];return this.leds.forEach(i=>t.push(i)),t}onChangeCabinet(){let t=this.oldCabinet.split("-").join(""),i=this.newCabinet.split("-").join(""),n=this.packageCMD("08",void 0,t,void 0,void 0,void 0,i);this.serial.sendData(`${n}\n`),this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 g\u1eedi l\u1ec7nh thay \u0111\u1ed5i T\u1ee7"})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.ez))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-setup-tool"]],inputs:{readyDownloadSettingToLed:"readyDownloadSettingToLed"},outputs:{closeEvent:"closeEvent",searchEvent:"searchEvent",reqDownloadEvent:"reqDownloadEvent"},features:[e.TTD],decls:35,vars:24,consts:[[1,"relative","h-full","w-full"],[1,"head"],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content","p-1"],[1,"connect"],[1,"p-inputgroup"],[1,"p-inputgroup-addon"],[1,"pi","pi-link"],["optionLabel","key","optionValue","value","placeholder","Ch\u1ecdn k\u1ebft n\u1ed1i","styleClass","w-full","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","disabled","ngModelChange","onChange"],["type","button","pButton","","pRipple","","icon","fa-solid fa-cog","pTooltip","C\xe0i \u0111\u1eb7t th\xf4ng s\u1ed1 c\u1ed5ng COM",1,"p-button-success",3,"disabled","click"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link","pTooltip","K\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"disabled","click",4,"ngIf"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link-slash","class","p-button-danger","pTooltip","Ng\u1eaft k\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"click",4,"ngIf"],[1,"flex","align-items-center","justify-content-center","p-1"],[1,"pi","pi-cog"],["optionLabel","key","optionValue","value","placeholder","Ch\u1ecdn ch\u1ee9c n\u0103ng","styleClass","w-full","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","disabled","ngModelChange"],[1,"action"],["class","absolute top-0 bottom-0 w-full bg-blue-100 border-round border-1 border-blue-100",4,"ngIf"],[3,"showCloseIcon","onHide"],["dSerialConfig",""],["pTemplate",""],["dAlarmCfg",""],["dParamCfg",""],["type","button","pButton","","pRipple","","icon","fa-solid fa-link","pTooltip","K\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",3,"disabled","click"],["type","button","pButton","","pRipple","","icon","fa-solid fa-link-slash","pTooltip","Ng\u1eaft k\u1ebft n\u1ed1i v\u1edbi c\xf4ng c\u1ee5",1,"p-button-danger",3,"click"],[1,"absolute","top-0","bottom-0","w-full","bg-blue-100","border-round","border-1","border-blue-100"],[1,"w-full","flex","align-items-center","justify-content-between","p-1"],[1,"font-bold"],["pButton","","pRipple","","label","Qu\xe9t thi\u1ebft b\u1ecb","type","button","icon","pi pi-search",1,"p-button-sm",3,"disabled","click"],[1,"absolute","bg-white",2,"top","40px","bottom","0","width","100%"],[1,"absolute","top-0","bottom-0","w-full"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["id","filt","type","text","pInputText","","placeholder","T\xecm ki\u1ebfm theo MAC",1,"w-full",3,"ngModel","ngModelChange","keypress"],["pFrozenColumn","",2,"min-width","130px"],[2,"min-width","130px"],[2,"min-width","80px"],[2,"min-width","140px"],[2,"min-width","150px"],[2,"min-width","100px"],[1,"m-0","p-0"],["pButton","","pRipple","","type","button","icon","pi pi-circle","pTooltip","T\u1eaft","tooltipPosition","top",1,"p-button-raised","p-button-text","p-button-sm",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-circle-fill","pTooltip","B\u1eadt","tooltipPosition","top",1,"p-button-raised","p-button-text","p-button-sm",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-upload","pTooltip","\u0110\u1ecdc c\u1ea5u h\xecnh","tooltipPosition","top",1,"p-button-raised","p-button-success","p-button-text","p-button-sm",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-exclamation-triangle","pTooltip","Cfg C\u1ea3nh b\xe1o","tooltipPosition","top",1,"p-button-raised","p-button-warning","p-button-text","p-button-sm",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-cog","pTooltip","C\xe0i \u0111\u1eb7t","tooltipPosition","top",1,"p-button-raised","p-button-info","p-button-text","p-button-sm",3,"click"],[1,"point","m-0",3,"ngStyle","click"],[1,"point","m-0",3,"click"],[1,"tbl-pre","p-1"],[1,"cell-pre"],["mask","****-****-****","styleClass","w-full","characterPattern","[a-f0-9]",3,"ngModel","ngModelChange"],["pButton","","pRipple","","type","button","label","\xc1p d\u1ee5ng","icon","fa-solid fa-download",3,"disabled","click"],[1,"p-fluid"],[1,"p-inputgroup","mb-1"],["placeholder","Ch\u1ecdn t\u1ed1c \u0111\u1ed9","styleClass","w-full","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange"],["optionLabel","key","optionValue","value","placeholder","Ch\u1ecdn...","styleClass","w-full","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange"],["pButton","","pRipple","","type","button","label","T\u1ea3i xu\u1ed1ng c\xe0i \u0111\u1eb7t",1,"p-button-raised","p-button-sm",3,"click"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4,"C\xf4ng c\u1ee5 C\xe0i \u0111\u1eb7t \u0111\xe8n"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.onClose()}),e.qZA()()(),e.TgZ(6,"div",5)(7,"div",0)(8,"div",6)(9,"div",7)(10,"span",8),e._UZ(11,"i",9),e.qZA(),e.TgZ(12,"p-dropdown",10),e.NdJ("ngModelChange",function(l){return i.commSelected=l})("onChange",function(l){return i.onCommSelected(l)}),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(l){return e.CHM(n),e.MAs(27).toggle(l)}),e.qZA(),e.YNc(14,bt,1,1,"button",12),e.YNc(15,xt,1,0,"button",13),e.qZA(),e.TgZ(16,"div",14)(17,"small"),e._uU(18),e.qZA()(),e.TgZ(19,"div",7)(20,"span",8),e._UZ(21,"i",15),e.qZA(),e.TgZ(22,"p-dropdown",16),e.NdJ("ngModelChange",function(l){return i.funcSelected=l}),e.qZA()()(),e.TgZ(23,"div",17),e.YNc(24,St,13,3,"div",18),e.YNc(25,Mt,22,3,"div",18),e.qZA()()()(),e.TgZ(26,"p-overlayPanel",19,20),e.NdJ("onHide",function(){return i.onUpdateCommOption()}),e.YNc(28,It,17,12,"ng-template",21),e.qZA(),e.TgZ(29,"p-overlayPanel",19,22),e.NdJ("onHide",function(){return i.onCloseCfgDialog()}),e.YNc(31,Lt,10,4,"ng-template",21),e.qZA(),e.TgZ(32,"p-overlayPanel",19,23),e.NdJ("onHide",function(){return i.onCloseParamDialog()}),e.YNc(34,Ot,2,0,"ng-template",21),e.qZA()}2&t&&(e.xp6(12),e.Q6J("options",i.commOption)("ngModel",i.commSelected)("disabled",i.serialPort||i.bleDevice),e.xp6(1),e.Q6J("disabled","uart"!==i.commSelected||i.serialPort),e.xp6(1),e.Q6J("ngIf",!i.serialPort&&!i.bleDevice),e.xp6(1),e.Q6J("ngIf",i.serialPort||i.bleDevice),e.xp6(3),e.hij(" ",i.comm_status_msg,""),e.xp6(4),e.Q6J("options",i.funcOption)("ngModel",i.funcSelected)("disabled",!i.serialPort),e.xp6(2),e.Q6J("ngIf","scan_led"==i.funcSelected),e.xp6(1),e.Q6J("ngIf","change_zcu"==i.funcSelected),e.xp6(1),e.Akn(e.DdM(21,qt)),e.Q6J("showCloseIcon",!0),e.xp6(3),e.Akn(e.DdM(22,W)),e.Q6J("showCloseIcon",!0),e.xp6(3),e.Akn(e.DdM(23,W)),e.Q6J("showCloseIcon",!0))},directives:[k.Hq,M.H,q.Lt,v.JJ,v.On,R.u,_.O5,Z.iA,x.jx,v.Fj,N.o,Z.on,_.PC,P.vy,Q.T],styles:[".head[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:86px}.content[_ngcontent-%COMP%]{position:absolute;top:40px;left:0;bottom:0;width:100%}.content[_ngcontent-%COMP%]   .connect[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:120px;width:100%}.content[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{position:absolute;top:120px;left:0;bottom:0;width:100%}.point[_ngcontent-%COMP%]{cursor:pointer}.tbl-pre[_ngcontent-%COMP%]{border:1px solid lightblue;text-align:center;width:100%}.tbl-pre[_ngcontent-%COMP%]   .cell-pre[_ngcontent-%COMP%]{border:1px solid lightblue;text-align:center;width:30%}"]}),o})();function Jt(o,r){1&o&&(e.TgZ(0,"tr")(1,"th",20),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",21),e._uU(4,"T\xean"),e.qZA(),e._UZ(5,"th",20),e.qZA())}function Ft(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"tr",22)(1,"td",20),e._uU(2),e.qZA(),e.TgZ(3,"td",21),e._uU(4),e.qZA(),e.TgZ(5,"td",20)(6,"button",23),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw().onRemoveDevice(s)}),e.qZA()()()}if(2&o){const t=r.$implicit,i=r.rowIndex;e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(i+1),e.xp6(2),e.AsE("",t.name," (#",t.id,")")}}function Pt(o,r){1&o&&(e.TgZ(0,"div",24),e._uU(1," Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb. "),e.qZA())}let Ht=(()=>{class o{constructor(t,i){this.dHttpService=t,this.messageService=i,this.closeEvent=new e.vpe,this.deviceMap=new Map,this.devices=[],this.controllers=new Map,this.groupOptions=[],this.cabinetOptions=[]}ngOnChanges(t){let i=t.DeviceIns;i&&i.currentValue&&this.checkDims()}ngOnInit(){this.fetListOfcabinetOptions()}onClose(){this.deviceMap.clear(),this.closeEvent.emit()}checkDims(){this.DeviceIns.forEach(t=>{let l,i=!1,n=!1,s=!1;t.device_has_parameter.forEach(c=>{1==c.parameter_id?i=!0:7==c.parameter_id?(n=!0,c.value&&(l=c.value)):4==c.parameter_id&&(s=!0)}),i&&n&&s&&this.deviceMap.set(t.id,{controller_id:l,device:t})}),this.genDevice()}genDevice(){this.devices=[],this.controllers.clear(),this.deviceMap.forEach(t=>{this.devices.push(t.device),t.controller_id&&this.controllers.set(t.controller_id,t.device.id)})}onRemoveDevice(t){this.deviceMap.delete(t.id),this.genDevice()}onSaveDeviceGroup(){var t=this;return(0,f.Z)(function*(){if(!t.deviceMap.size)return void t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb \u0111\u1ec3 th\xeam v\xe0o nh\xf3m"});let i=[],n=[];t.deviceMap.forEach((c,a)=>{i.push(a)}),t.controllers.forEach((c,a)=>{n.push(a)}),0===(yield(0,p.n)(t.dHttpService.updateGroupOfCabinet(t.cabinetSelected.value,t.groupSelected.id,i))).status&&0===(yield(0,p.n)(t.dHttpService.updateDIMsForListOfCabinets(n))).status?(t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt nh\xf3m \u0111i\u1ec1u khi\u1ec3n th\xe0nh c\xf4ng"}),t.closeEvent.emit()):t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i."})})()}fetListOfcabinetOptions(){this.dHttpService.getListCabinet().subscribe({next:t=>{0===t.status?this.cabinetOptions=t.data:(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message))},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}fetchGroupOfController(t){this.dHttpService.getDeviceParameterAndValue(t,m.o.CASE_CAUHINH).subscribe({next:i=>{0===i.status?this.processGroupOfController(i.data[0]):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}processGroupOfController(t){t.danh_sach_thong_so.forEach(i=>{if(14===i.id)if(i.value){let n=JSON.parse(i.value);this.groupOptions=n.groups,setTimeout(()=>{this.groupSelected=this.groupOptions.find(s=>s.id==i.value)},50)}else this.groupOptions=[]})}onChangeCabinet(){this.fetchGroupOfController(this.cabinetSelected.device_id)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-group"]],inputs:{DeviceIns:"DeviceIns"},outputs:{closeEvent:"closeEvent"},features:[e.TTD],decls:23,vars:7,consts:[[1,"relative","h-full","w-full"],[1,"head"],[1,"flex","align-items-center","justify-content-between","border-bottom-1","border-gray-300"],[1,"ml-2","font-semibold"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-danger","p-button-text",3,"click"],[1,"content"],[1,"m-0","p-1"],[1,"p-fluid"],[1,"field","mb-1"],["placeholder","Ch\u1ecdn t\u1ee7 \u0111i\u1ec1u khi\u1ec3n","optionLabel","device.name","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange","onChange"],["placeholder","Ch\u1ecdn nh\xf3m \u0111i\u1ec1u khi\u1ec3n","optionLabel","ten","panelStyleClass","text-overflow-ellipsis text-sm",3,"options","ngModel","ngModelChange"],[1,"tbl"],["styleClass","p-datatable-sm p-datatable-striped","scrollHeight","flex",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"footer"],[1,"flex","align-items-center","justify-content-end","border-top-1","border-gray-300","pt-1"],["pButton","","pRipple","","type","button","label","H\u1ee7y b\u1ecf","icon","fa-solid fa-times",1,"p-button-outlined","mr-1",3,"click"],["pButton","","pRipple","","type","button","label","L\u01b0u th\xf4ng tin","icon","fa-solid fa-save",1,"mr-1",3,"disabled","click"],[2,"width","60px","max-width","60px"],[2,"min-width","300px"],[3,"pSelectableRow"],["pButton","","pRipple","","type","button","icon","fa-solid fa-minus",1,"p-button-outlined","p-button-sm","m-0","mr-1",3,"click"],[1,"p-fluid","p-2"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e._uU(4,"Bi\xean t\u1eadp nh\xf3m \u0110\xe8n"),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return i.onClose()}),e.qZA()()(),e.TgZ(6,"div",5)(7,"div",0)(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-dropdown",9),e.NdJ("ngModelChange",function(s){return i.cabinetSelected=s})("onChange",function(){return i.onChangeCabinet()}),e.qZA()(),e.TgZ(12,"div",8)(13,"p-dropdown",10),e.NdJ("ngModelChange",function(s){return i.groupSelected=s}),e.qZA()()()(),e.TgZ(14,"div",11)(15,"p-table",12),e.YNc(16,Jt,6,0,"ng-template",13),e.YNc(17,Ft,7,4,"ng-template",14),e.YNc(18,Pt,2,0,"ng-template",15),e.qZA()()()(),e.TgZ(19,"div",16)(20,"div",17)(21,"button",18),e.NdJ("click",function(){return i.onClose()}),e.qZA(),e.TgZ(22,"button",19),e.NdJ("click",function(){return i.onSaveDeviceGroup()}),e.qZA()()()()),2&t&&(e.xp6(11),e.Q6J("options",i.cabinetOptions)("ngModel",i.cabinetSelected),e.xp6(2),e.Q6J("options",i.groupOptions)("ngModel",i.groupSelected),e.xp6(2),e.Q6J("value",i.devices)("scrollable",!0),e.xp6(7),e.Q6J("disabled",!i.groupSelected||!i.cabinetSelected))},directives:[k.Hq,M.H,q.Lt,v.JJ,v.On,Z.iA,x.jx,Z.Ei],styles:[".head[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:86px}.content[_ngcontent-%COMP%]{position:absolute;top:40px;left:0;bottom:45px;width:100%}.content[_ngcontent-%COMP%]   .tbl[_ngcontent-%COMP%]{position:absolute;top:88px;left:0;bottom:0;width:100%;overflow:auto}.footer[_ngcontent-%COMP%]{position:absolute;left:0;bottom:0;height:45px;width:100%}"]}),o})();var Ut=d(229),Bt=d(97);const $t=["divBound"],Rt=["divSetup"],Qt=["divGroup"],Yt=["divLayer"];function Gt(o,r){1&o&&e._UZ(0,"a",12),2&o&&e.Q6J("innerHTML",r.$implicit.name,e.oJD)}function Wt(o,r){1&o&&e._UZ(0,"div",13),2&o&&e.Q6J("innerHTML",r.$implicit,e.oJD)}function Kt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",14,15)(2,"app-setup-tool",16),e.NdJ("closeEvent",function(){return e.CHM(t),e.oxw(2).onCloseDeviceSetup()})("searchEvent",function(n){return e.CHM(t),e.oxw(2).onMapSearch(n)})("reqDownloadEvent",function(n){return e.CHM(t),e.oxw(2).onReqDownloadSettingToLed(n)}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Q6J("readyDownloadSettingToLed",t.readyDownloadSettingToLed)}}function Vt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",17,18)(2,"app-device-group",19),e.NdJ("closeEvent",function(){return e.CHM(t),e.oxw(2).onCloseDeviceGroup()}),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Q6J("DeviceIns",t.deviceInAreaSelected)}}function jt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",20,21)(2,"app-map-layer-control",22),e.NdJ("closeEvent",function(){return e.CHM(t),e.oxw(2).onCloseMapLayerEvent()})("layerChange",function(n){return e.CHM(t),e.oxw(2).onLayerChangeEvent(n)}),e.qZA()()}}function zt(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",2,3),e.NdJ("resize",function(){return e.CHM(t),e.oxw().onWindowResize()},!1,e.Jf7),e._UZ(2,"div",4),e.TgZ(3,"div",5),e.NdJ("keyup",function(n){return e.CHM(t),e.oxw().onKeyupSearch(n)}),e.TgZ(4,"ng-autocomplete",6),e.NdJ("selected",function(n){return e.CHM(t),e.oxw().onSelectedSearch(n)})("inputChanged",function(n){return e.CHM(t),e.oxw().onChangeSearch(n)}),e.qZA(),e.YNc(5,Gt,1,1,"ng-template",null,7,e.W1O),e.YNc(7,Wt,1,1,"ng-template",null,8,e.W1O),e.qZA(),e.YNc(9,Kt,3,1,"div",9),e.YNc(10,Vt,3,1,"div",10),e.YNc(11,jt,3,0,"div",11),e.qZA()}if(2&o){const t=e.MAs(6),i=e.MAs(8),n=e.oxw();e.xp6(4),e.Q6J("data",n.dataSuggests)("searchKeyword",n.keyword)("itemTemplate",t)("minQueryLength",1)("notFoundTemplate",i),e.xp6(5),e.Q6J("ngIf",n.display_setup_tool),e.xp6(1),e.Q6J("ngIf",n.display_device_group),e.xp6(1),e.Q6J("ngIf",n.display_map_layer)}}function Xt(o,r){1&o&&(e._UZ(0,"i",30),e.TgZ(1,"span",31),e._uU(2,"B\u1ea1n kh\xf4ng c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ee5c n\xe0y!"),e.qZA())}function ei(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div",23)(1,"p-messages",24),e.YNc(2,Xt,3,0,"ng-template",25),e.qZA()(),e.TgZ(3,"div",26)(4,"div",27),e.NdJ("click",function(){return e.CHM(t),e.oxw().onGoBackHome()}),e._UZ(5,"span",28),e.TgZ(6,"span",29),e._uU(7,"Quay l\u1ea1i Trang ch\u1ee7"),e.qZA()()()}}const ti=[{path:"",component:(()=>{class o{constructor(t,i,n,s,l,c,a,u,C,y,S){this.dHttpService=t,this.messageService=i,this.renderer=n,this.confirmService=s,this.dialogService=l,this.permissionService=c,this.activeRoute=a,this.userService=u,this.viewContainerRef=C,this.router=y,this.userHttpService=S,this.homeLat=21.028291,this.homeLng=105.843517,this.enableTooltip=!0,this.tooltipMap=new Map,this.firstDraw=!0,this.pixiDevices=[],this.en_right_click=!1,this.devices=[],this.dataSuggests=[],this.keyword="name",this.keywordIn="",this.display_setup_tool=!1,this.display_device_group=!1,this.display_map_layer=!1,this.ctrlKeyDown=!1}ngOnDestroy(){this.destroyAllTooltips(),this.pixiOverlay&&this.pixiOverlay.removeFrom(this.leafletMap),this.leafletMap&&this.leafletMap.remove(),this.subPermission&&this.subPermission.unsubscribe(),this.subParam&&this.subParam.unsubscribe(),this.dragTimer&&clearTimeout(this.dragTimer)}setStyleDiv(){let t=this.divBound.nativeElement.offsetWidth;t<576?(this.display_setup_tool&&(this.renderer.setStyle(this.divSetup.nativeElement,"width","100%"),this.renderer.setStyle(this.divSetup.nativeElement,"height","70%")),this.display_device_group&&(this.renderer.setStyle(this.divGroup.nativeElement,"width","100%"),this.renderer.setStyle(this.divGroup.nativeElement,"height","70%")),this.display_map_layer&&(this.renderer.setStyle(this.divLayer.nativeElement,"width","100%"),this.renderer.setStyle(this.divLayer.nativeElement,"height","70%"))):t>=576&&t<1025?(this.display_setup_tool&&(this.renderer.setStyle(this.divSetup.nativeElement,"width","400px"),this.renderer.setStyle(this.divSetup.nativeElement,"height","100%")),this.display_device_group&&(this.renderer.setStyle(this.divGroup.nativeElement,"width","50%"),this.renderer.setStyle(this.divGroup.nativeElement,"height","100%")),this.display_map_layer&&(this.renderer.setStyle(this.divLayer.nativeElement,"width","400px"),this.renderer.setStyle(this.divLayer.nativeElement,"height","100%"))):t>=1025&&t<1367?(this.display_setup_tool&&(this.renderer.setStyle(this.divSetup.nativeElement,"width","50%"),this.renderer.setStyle(this.divSetup.nativeElement,"height","100%")),this.display_device_group&&(this.renderer.setStyle(this.divGroup.nativeElement,"width","45%"),this.renderer.setStyle(this.divGroup.nativeElement,"height","100%")),this.display_map_layer&&(this.renderer.setStyle(this.divLayer.nativeElement,"width","600px"),this.renderer.setStyle(this.divLayer.nativeElement,"height","100%"))):(this.display_setup_tool&&(this.renderer.setStyle(this.divSetup.nativeElement,"width","50%"),this.renderer.setStyle(this.divSetup.nativeElement,"height","100%")),this.display_device_group&&(this.renderer.setStyle(this.divGroup.nativeElement,"width","40%"),this.renderer.setStyle(this.divGroup.nativeElement,"height","100%")),this.display_map_layer&&(this.renderer.setStyle(this.divLayer.nativeElement,"width","600px"),this.renderer.setStyle(this.divLayer.nativeElement,"height","100%")))}ngAfterViewChecked(){this.setStyleDiv()}onWindowResize(){this.setStyleDiv()}calcWidth(){let t=this.divBound.nativeElement.offsetWidth,i="";return i=t<768?.95*t+"px":t>=768&&t<1025?.7*t+"px":t>=1025&&t<1367?.6*t+"px":.5*t+"px",i}ngOnInit(){this.loadDataEngine(),this.subPermission=this.permissionService.currentPermission.subscribe(t=>{t&&(this.permission=t)}),this.user=this.userService.getMyAccount(),this.user.latitude&&this.user.longitude&&(this.homeLat=this.user.latitude,this.homeLng=this.user.longitude),this.subParam=this.activeRoute.queryParams.subscribe(t=>{t&&(this.navigatedDevice=new E.AS,this.navigatedDevice.name=t.name,this.navigatedDevice.id=t.id,this.navigatedDevice.latitude=t.focus_lat,this.navigatedDevice.longitude=t.focus_lng)})}ngAfterViewInit(){this.setStyleDiv(),this.initMap()}initMap(){this.leafletMap&&this.leafletMap.remove(),this.leafletMap=null;let t=G.K.baseMaps;this.leafletMap=h.map("editor-map",{center:[this.homeLat,this.homeLng],zoom:m.o.MAP_ZOOM_INIT,layers:[G.K.OpenStreetMap_Mapnik],attributionControl:!1,zoomControl:!1}),h.control.layers(t,{}).addTo(this.leafletMap).setPosition("bottomright"),h.control.scale().addTo(this.leafletMap).setPosition("bottomleft");let i=h.easyButton("fa-solid fa-qrcode",(a,u)=>{this.onQrEditor()}),n=h.easyButton("fa-solid fa-cog",(a,u)=>{this.display_setup_tool=!this.display_setup_tool}),s=h.easyButton("fa-solid fa-map",(a,u)=>{this.display_map_layer=!0}),l=h.easyButton("fa-solid fa-location-crosshairs",(a,u)=>this.getCurrentPosition()),c=h.easyButton({states:[{stateName:"on-right-click",icon:"fa-computer-mouse",title:"ON Right Click Mobile",onClick:a=>{this.ctrlRightClick=a,this.en_right_click=!0,a.state("off-right-click")}},{icon:"fa-hand-pointer",stateName:"off-right-click",title:"OFF Right Click Mobile",onClick:a=>{this.ctrlRightClick=a,this.en_right_click=!1,a.state("on-right-click")}}]});h.easyBar([i,n,s,l,c]).addTo(this.leafletMap).setPosition("topright"),this.leafletMap.on("click",a=>{this.markerClicked?(this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupItem=h.popup({closeButton:!1}).setLatLng([this.markerClicked.lat,this.markerClicked.lng]).setContent(`${this.markerClicked.originObject.name?this.markerClicked.originObject.name:"--"}`).openOn(this.leafletMap),this.selectedDevice=this.markerClicked.originObject,this.markerClicked=void 0,this.en_right_click?this.openPopup(a.latlng,"on-marker",this.selectedDevice):this.onConfiguration(),this.en_right_click=!1,this.ctrlRightClick&&this.ctrlRightClick.state("on-right-click")):(this.en_right_click=!1,this.ctrlRightClick&&this.ctrlRightClick.state("on-right-click"),this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupMenu&&this.popupMenu.removeFrom(this.leafletMap),this.destroyAllTooltips(),this.myMarker&&this.myMarker.removeFrom(this.leafletMap))}),this.leafletMap.on("mouseup",a=>{this.ctrlKeyDown||this.onDragEnd(a.latlng)}),this.leafletMap.on("mousemove",a=>{this.ctrlKeyDown||this.onDragMove(a.latlng)}),this.leafletMap.on("contextmenu",a=>{this.markerClicked?(this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupItem=h.popup({closeButton:!1}).setLatLng([this.markerClicked.lat,this.markerClicked.lng]).setContent(`${this.markerClicked.originObject.name?this.markerClicked.originObject.name:"--"}`).openOn(this.leafletMap),this.selectedDevice=this.markerClicked.originObject,this.markerClicked=void 0,this.openPopup(a.latlng,"on-marker",this.selectedDevice)):this.openPopup(a.latlng,"on-map",void 0)}),this.leafletMap.selectArea.enable(),this.leafletMap.on("areaselected",a=>{this.display_device_group=!0,this.onAddDeviceToGroup(a.bounds)}),this.leafletMap.whenReady(()=>{setTimeout(()=>{if(this.initPixiOverlay(),this.navigatedDevice.latitude&&this.navigatedDevice.longitude){let a=new h.LatLng(this.navigatedDevice.latitude,this.navigatedDevice.longitude);this.leafletMap.setView(a,17),this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupItem=h.popup().setLatLng(a).setContent(`\n            ${this.navigatedDevice.name?this.navigatedDevice.name:"--"}\n            <br>\n            (${this.navigatedDevice.latitude}, ${this.navigatedDevice.longitude})`).openOn(this.leafletMap)}},100)})}initPixiOverlay(){this.pixiContainer&&(this.pixiContainer.destroy(),this.pixiContainer=null),this.pixiContainer=new D.Container;var t={doubleBuffering:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,autoPreventDefault:!1};this.pixiOverlay=h.pixiOverlay((i,n)=>{this.pixiUtils=i,this.pixiEvent=n,"add"===n.type?this.fetchDeviceByLocation():"moveend"===n.type||"reDraw"===n.type?(this.drawDeviceMarker(),this.fetchDeviceByLocation()):"drag"===n.type&&this.onReDrawByDrag(n)},this.pixiContainer,t),this.pixiOverlay.addTo(this.leafletMap)}getCurrentPosition(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{let i=t.coords.latitude,n=t.coords.longitude;this.leafletMap.flyTo([i,n],18);var s=h.icon({iconUrl:"/assets/map/user-32.png",iconSize:[24,24],iconAnchor:[12,0]});this.myMarker=h.marker([i,n],{icon:s}).addTo(this.leafletMap),this.myMarker.bindTooltip(`V\u1ecb tr\xed c\u1ee7a t\xf4i:(${i},${n})`,{direction:"top"}).openTooltip()},t=>{switch(t.code){case t.PERMISSION_DENIED:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Quy\u1ec1n truy c\u1eadp v\u1ecb tr\xed b\u1ecb t\u1eeb ch\u1ed1i. C\u1ea7n cho ph\xe9p \u0111\u1ec3 m\u1edf l\u1ea1i quy\u1ec1n truy c\u1eadp"});break;case t.POSITION_UNAVAILABLE:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"V\u1ecb tr\xed kh\xf4ng s\u1eb5n s\xe0ng"});break;case t.TIMEOUT:this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Th\u1eddi gian l\u1ea5y t\u1ecda \u0111\u1ed9 qu\xe1 l\xe2u"})}},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"Tr\xecnh duy\u1ec7t kh\xf4ng h\u1ed7 tr\u1ee3 l\u1ea5y t\u1ecda \u0111\u1ed9 \u0111\u1ecba l\xfd"})}fetchDeviceByLocation(){let t;this.leafletMap&&(t=this.leafletMap.getBounds()),t&&this.dHttpService.getDeviceByLocation(t._southWest.lat,t._southWest.lng,t._northEast.lat,t._northEast.lng,9999999,this.mapIds,1).subscribe({next:i=>{0===i.status?(this.devices=i.data.rows,this.destroyAllTooltips(),this.selectedDevice&&(this.selectedDevice=this.devices.find(n=>n.id==this.selectedDevice.id)),this.createDeviceMarker()):2===i.status?this.onComeback():(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}createDeviceMarker(){this.pixiDevices.forEach(t=>{t.sprite.destroy()}),this.pixiDevices=[],this.devices.forEach(t=>{if(t.latitude&&t.longitude){let i;i=t.onoff_state?t.warning_state?J.N.url.BASE_IMG+t.device_subtype.device_type.warning_icon:J.N.url.BASE_IMG+t.device_subtype.device_type.active_icon:J.N.url.BASE_IMG+t.device_subtype.device_type.inactive_icon;let n=new g.J;n.lat=t.latitude,n.lng=t.longitude,n.sprite=D.Sprite.from(i),n.firstDraw=!0,n.preZoom=void 0,n.originObject=t,this.pixiDevices.push(n)}}),this.prepareDeviceMarkerToDraw()}prepareDeviceMarkerToDraw(){this.pixiDevices.forEach(t=>{t.sprite.interactive=!0,t.sprite.buttonMode=!0;let i=t.originObject;t.sprite.on("click",()=>{this.markerClicked=t,this.destroyTooltip(i.id)}),t.sprite.on("tap",()=>{this.markerClicked=t,this.destroyTooltip(i.id)}),t.sprite.on("mousedown",()=>{this.destroyTooltip(i.id),this.ctrlKeyDown||(this.dragTimer=setTimeout(()=>{this.onDragStartMarker(t)},500))}),t.sprite.on("mouseover",()=>{this.destroyTooltip(i.id),!0===this.enableTooltip&&this.openTooltip(i)}),t.sprite.on("mouseout",()=>{this.destroyTooltip(i.id)}),t.sprite.on("rightclick",()=>{this.markerClicked=t,this.destroyTooltip(i.id)}),this.pixiContainer.addChild(t.sprite)}),this.firstDraw?setTimeout(()=>{this.drawDeviceMarker(),this.firstDraw=!1},100):this.drawDeviceMarker()}drawDeviceMarker(){this.pixiDevices.forEach(t=>{let i=this.pixiUtils.latLngToLayerPoint([t.lat,t.lng]);t.sprite.x=i.x,t.sprite.y=i.y,t.sprite.anchor.set(.5,.5),t.sprite.scale.set(1/this.pixiUtils.getScale())}),this.pixiUtils.getRenderer().render(this.pixiUtils.getContainer())}onReDrawByDrag(t){let i=t.LatLng,n=this.pixiDevices.find(s=>s.sprite==t.sprite);n&&(n.lat=i.lat,n.lng=i.lng,this.drawDeviceMarker())}onDragStartMarker(t){this.leafletMap.dragging.disable(),this.enableTooltip=!1,this.markerDragged=t,this.destroyAllTooltips(),this.destroyPopup()}onDragMove(t){this.markerDragged&&(this.markerDragged.dragging=!0,this.pixiOverlay.redraw({type:"drag",LatLng:t,sprite:this.markerDragged.sprite}))}onDragEnd(t){if(this.dragTimer&&clearTimeout(this.dragTimer),this.leafletMap.dragging.enable(),this.enableTooltip=!0,this.markerDragged&&this.markerDragged.dragging){var i=h.latLng(this.markerDragged.originObject.latitude,this.markerDragged.originObject.longitude),n=this.markerDragged.sprite,s=this.markerDragged.originObject;this.markerDragged=null,this.markerClicked=null,!this.markerDragged&&i!==t&&this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n thay \u0111\u1ed5i v\u1ecb tr\xed thi\u1ebft b\u1ecb "${s.name}" tr\xean b\u1ea3n \u0111\u1ed3 kh\xf4ng?`,header:"X\xe1c nh\u1eadn thay \u0111\u1ed5i v\u1ecb tr\xed thi\u1ebft b\u1ecb",icon:"pi pi-info-circle"}).then(l=>{if(l){s.latitude=t.lat,s.longitude=t.lng;let c=this.pixiDevices.find(a=>a.originObject.id===s.id);c&&(c.lat=t.lat,c.lng=t.lng,this.updateDeviceLocation(s))}}).catch(l=>{this.pixiOverlay.redraw({type:"drag",LatLng:i,sprite:n})})}else this.markerDragged=null}updateDeviceLocation(t){this.dHttpService.editInfo(t).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"C\u1eadp nh\u1eadt v\u1ecb tr\xed thi\u1ebft b\u1ecb th\xe0nh c\xf4ng"}),this.pixiOverlay.redraw({type:"reDraw"}),this.loadDataEngine()):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}openTooltip(t){let i=this.viewContainerRef.createComponent(X);i.instance.device=t;let n=h.tooltip({direction:"bottom",opacity:.95});n.setContent(i.location.nativeElement),n.setLatLng([t.latitude,t.longitude]),n.addTo(this.leafletMap),this.tooltipMap.set(t.id,{tooltip:n,ref:i})}destroyAllTooltips(){this.tooltipMap.size&&this.tooltipMap.forEach((t,i)=>{t.tooltip&&t.tooltip.removeFrom(this.leafletMap),t.ref&&t.ref.destroy()})}destroyTooltip(t){if(this.tooltipMap.has(t)){let i=this.tooltipMap.get(t);i.tooltip&&i.tooltip.removeFrom(this.leafletMap),i.ref&&i.ref.destroy(),this.tooltipMap.delete(t)}}openPopup(t,i,n){this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.destroyPopup(),this.popupRef=this.viewContainerRef.createComponent(oe),this.popupRef.instance.type=i,this.popupRef.instance.device=n,this.popupRef.instance.onSelect.subscribe(s=>{this.onPopupSelect(s,t),setTimeout(()=>{this.destroyPopup()},100)}),this.popupMenu=h.popup({closeButton:!1,maxWidth:350,minWidth:200}).setLatLng(t).setContent(this.popupRef.location.nativeElement).openOn(this.leafletMap)}destroyPopup(){this.popupMenu&&this.popupMenu.removeFrom(this.leafletMap),this.popupRef&&this.popupRef.destroy()}onPopupSelect(t,i){"get-location"==t?h.popup({closeButton:!1}).setLatLng(i).setContent(`T\u1ecda \u0111\u1ed9: (${i.lat}, ${i.lng}`).openOn(this.leafletMap):"set-home-location"==t?this.setHomeLocation(i):"add-device"==t?this.dialogService.open(se.L,{data:{latlng:i},showHeader:!1,height:"350px",width:"400px",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(s=>{s&&(this.fetchDeviceByLocation(),this.loadDataEngine())}):"delete-device"==t?this.onDeleteDevice():"set-config"==t?this.onConfiguration():"set-info"==t?this.onEditInfo():"hide-map-layer"==t?this.onHideOnMap():"google-map"==t&&window.open(`https://www.google.com/maps/search/?api=1&query=${this.selectedDevice.latitude},${this.selectedDevice.longitude}`)}loadDataEngine(){this.dHttpService.getAllDeviceForSearchSuggest().subscribe({next:t=>{if(0===t.status){let i=t.data;this.dataSuggests=[],i&&0!==i.length&&i.forEach(n=>{let s=new E.AS;s.id=n.id,s.name=`${n.name}(#${n.id}${n.device_has_parameter[0]?"-"+n.device_has_parameter[0].value:""})`,s.latitude=n.latitude,s.longitude=n.longitude,s.mac=n.device_has_parameter[0]?n.device_has_parameter[0].value:"",this.dataSuggests.push(s)})}else this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${t.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t.message)},error:t=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",t)}})}onSelectedSearch(t){if(t.latitude&&t.longitude){let i=h.latLng(t.latitude,t.longitude);this.leafletMap.setView(i,17),this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupItem=h.popup({closeButton:!1}).setLatLng(i).setContent(`${t.name}<br>(${t.latitude}, ${t.longitude})`).openOn(this.leafletMap)}else this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Thi\u1ebft b\u1ecb ch\u01b0a \u0111\u01b0\u1ee3c g\xe1n t\u1ecda \u0111\u1ed9 tr\xean b\u1ea3n \u0111\u1ed3"})}onChangeSearch(t){this.keywordIn=t}onKeyupSearch(t){"Enter"===t.key&&this.searchByEnter(this.keywordIn)}searchByEnter(t){let i=[];this.dataSuggests.forEach(n=>{let s=n.name.toLowerCase(),l=t.toLowerCase();s.includes(l)&&i.push(n)}),i&&0!==i.length?(1===i.length&&this.leafletMap.setView([i[0].latitude,i[0].longitude],17),i.forEach(n=>{this.popupItem&&this.popupItem.removeFrom(this.leafletMap),this.popupItem=h.popup({autoClose:!1,closeButton:!1}).setLatLng([n.latitude,n.longitude]).setContent(`${n.name}<br>(${n.latitude}, ${n.longitude})`).openOn(this.leafletMap)})):this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng c\xf3 thi\u1ebft b\u1ecb ph\xf9 h\u1ee3p"})}onGoBackHome(){this.router.navigate(["/"])}onEditInfo(){this.dialogService.open(K.q,{data:{device:this.selectedDevice,editable:!0,title:"C\u1eadp nh\u1eadt thi\u1ebft b\u1ecb"},showHeader:!1,width:"99vw",height:"99vh",contentStyle:{padding:"0",margin:0}}).onDestroy.subscribe(()=>{this.selectedDevice=null,this.fetchDeviceByLocation(),this.loadDataEngine()})}onConfiguration(){this.dialogService.open(Y,{data:{device:this.selectedDevice},showHeader:!1,width:this.calcWidth(),height:"99vh",contentStyle:{padding:"0",margin:0}}).onDestroy.subscribe(()=>{this.selectedDevice=null,this.loadDataEngine(),this.popupItem&&this.popupItem.removeFrom(this.leafletMap)})}onQrEditor(){this.dialogService.open(ht.H,{showHeader:!1,width:"320px",height:"390px",contentStyle:{padding:"0",margin:0,"background-color":"transparent"}}).onClose.subscribe(i=>{i&&this.fetchDeviceByCode(i)})}fetchDeviceByCode(t){this.dHttpService.getDeviceByCode(t).subscribe({next:i=>{if(0===i.status){let n=i.data;if(n.latitude&&n.longitude){let s=h.latLng(n.latitude,n.longitude);this.leafletMap.setView(s,17),this.selectedDevice=n,this.openPopup(s,"on-qr",void 0)}else this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Thi\u1ebft b\u1ecb ch\u01b0a \u0111\u01b0\u1ee3c g\xe1n t\u1ecda \u0111\u1ed9 tr\xean b\u1ea3n \u0111\u1ed3"})}else this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message)},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onDeleteDevice(){var t=this;return(0,f.Z)(function*(){let i;try{const n=yield(0,p.n)(t.dHttpService.getDeviceParameterAndValue(t.selectedDevice.id,m.o.CASE_CAUHINH));if(0!==n.status)return t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${n.message}`}),void console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n.message);let s=n.data;if(1==s.length&&s[0].id==t.selectedDevice.id){let l,c,a;s[0].danh_sach_thong_so.forEach(u=>{1==u.id?l=!0:7==u.id&&(c=!0,a=u.value)}),l&&c&&(i=a)}t.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a Thi\u1ebft b\u1ecb "${t.selectedDevice.name}" kh\xf4ng?`,header:"X\xe1c nh\u1eadn x\xf3a Thi\u1ebft b\u1ecb",icon:"pi pi-info-circle"}).then(function(){var l=(0,f.Z)(function*(c){if(c){const a=yield(0,p.n)(t.dHttpService.delete(t.selectedDevice.id));if(0!==a.status)return t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${a.message}`}),void console.error("C\xf3 l\u1ed7i x\u1ea3y ra",a.message);if(t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 x\xf3a thi\u1ebft b\u1ecb th\xe0nh c\xf4ng"}),t.fetchDeviceByLocation(),t.loadDataEngine(),i){const u=yield(0,p.n)(t.dHttpService.updateDIMsForListOfCabinets([i]));if(0!==u.status)return t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\u1eadp nh\u1eadt c\u1ea5u h\xecnh t\u1ef1 \u0111\u1ed9ng cho t\u1ee7 b\u1ecb l\u1ed7i. Vui l\xf2ng T\u1ea3i xu\u1ed1ng th\u1ee7 c\xf4ng c\u1ea5u h\xecnh cho T\u1ee7 Qu\u1ea3n l\xfd \u0111\xe8n \u0111\xe3 x\xf3a."}),void console.error("C\xf3 l\u1ed7i x\u1ea3y ra",u.message)}}});return function(c){return l.apply(this,arguments)}}()).catch(l=>{})}catch(n){t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",n)}})()}onHideOnMap(){var t=this;this.confirmService.confirm({message:`B\u1ea1n c\xf3 mu\u1ed1n \u1ea9n Thi\u1ebft b\u1ecb "${this.selectedDevice.name}" kh\u1ecfi b\u1ea3n \u0111\u1ed3 kh\xf4ng?`,header:"X\xe1c nh\u1eadn \u1ea9n Thi\u1ebft b\u1ecb kh\u1ecfi b\u1ea3n \u0111\u1ed3",icon:"pi pi-info-circle"}).then(function(){var i=(0,f.Z)(function*(n){n&&t.dHttpService.editInfo({id:t.selectedDevice.id,is_displayed_on_map:0}).subscribe({next:s=>{0===s.status?(t.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\xe3 \u1ea9n thi\u1ebft b\u1ecb th\xe0nh c\xf4ng"}),t.fetchDeviceByLocation(),t.loadDataEngine()):2===s.status?t.onComeback():(t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${s.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",s.message))},error:s=>{t.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",s)}})});return function(n){return i.apply(this,arguments)}}()).catch(i=>{})}setHomeLocation(t){this.userHttpService.edit(this.user.id,void 0,void 0,void 0,t.lat,t.lng).subscribe({next:i=>{0===i.status?(this.messageService.add({severity:"success",summary:"Th\xe0nh c\xf4ng",detail:"\u0110\u1eb7t c\u1eeda s\u1ed5 xem m\u1eb7c \u0111\u1ecbnh th\xe0nh c\xf4ng"}),this.leafletMap.panTo(t),this.onSaveMyLocation(t)):(this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:`${i.message}`}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i.message))},error:i=>{this.messageService.add({severity:"error",summary:"L\u1ed7i",detail:"C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i"}),console.error("C\xf3 l\u1ed7i x\u1ea3y ra",i)}})}onSaveMyLocation(t){let i=this.userService.getMyAccount();i.latitude=t.lat,i.longitude=t.lng,this.userService.saveUser2Storage(i),this.userService.saveMyAccount(i)}onCloseDeviceSetup(){this.display_setup_tool=!1}onMapSearch(t){let i=this.dataSuggests.find(n=>n.mac==t);i?this.onSelectedSearch(i):this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng t\xecm th\u1ea5y thi\u1ebft b\u1ecb tr\xean b\u1ea3n \u0111\u1ed3"})}onReqDownloadSettingToLed(t){let i=this.dataSuggests.find(s=>s.mac==t);i?(this.onSelectedSearch(i),this.dialogService.open(Y,{data:{device:i,req_download_to_led:!0},showHeader:!1,width:this.calcWidth(),height:"99vh",contentStyle:{padding:"0",margin:0}}).onClose.subscribe(s=>{this.readyDownloadSettingToLed=s,setTimeout(()=>{this.readyDownloadSettingToLed=null},500)})):this.messageService.add({severity:"warn",summary:"C\u1ea3nh b\xe1o",detail:"Kh\xf4ng t\xecm th\u1ea5y thi\u1ebft b\u1ecb tr\xean b\u1ea3n \u0111\u1ed3"})}onAddDeviceToGroup(t){var i=this;return(0,f.Z)(function*(){const n=yield(0,p.n)(i.dHttpService.getDeviceByLocation2(t._southWest.lat,t._southWest.lng,t._northEast.lat,t._northEast.lng,9999999));0===n.status&&(i.deviceInAreaSelected=n.data.rows)})()}onCloseDeviceGroup(){this.display_device_group=!1,this.deviceInAreaSelected=[]}onCloseMapLayerEvent(){this.display_map_layer=!1}onLayerChangeEvent(t){this.mapIds=t,this.fetchDeviceByLocation()}handlectrlKeyDown(t){this.ctrlKeyDown=!0}handleControlKeyUp(t){this.ctrlKeyDown=!1}onComeback(){localStorage.removeItem(m.o.USER),sessionStorage.removeItem(m.o.ACC),this.router.navigate(["/come-back"])}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(A.x),e.Y36(x.ez),e.Y36(e.Qsj),e.Y36($.I),e.Y36(I.xA),e.Y36(mt.$),e.Y36(b.gz),e.Y36(gt.K),e.Y36(e.s_b),e.Y36(b.F0),e.Y36(_t.b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-device-editor-map"]],viewQuery:function(t,i){if(1&t&&(e.Gf($t,5,e.SBq),e.Gf(Rt,5,e.SBq),e.Gf(Qt,5,e.SBq),e.Gf(Yt,5,e.SBq)),2&t){let n;e.iGM(n=e.CRH())&&(i.divBound=n.first),e.iGM(n=e.CRH())&&(i.divSetup=n.first),e.iGM(n=e.CRH())&&(i.divGroup=n.first),e.iGM(n=e.CRH())&&(i.divLayer=n.first)}},hostBindings:function(t,i){1&t&&e.NdJ("keydown.Control",function(s){return i.handlectrlKeyDown(s)},!1,e.Jf7)("keyup.Control",function(s){return i.handleControlKeyUp(s)},!1,e.Jf7)},decls:3,vars:2,consts:[["class","relative h-full w-full",3,"resize",4,"ngIf","ngIfElse"],["noPermission",""],[1,"relative","h-full","w-full",3,"resize"],["divBound",""],["id","editor-map"],["id","search",3,"keyup"],["placeholder","**Nh\u1eadp T\xean, ID, MAC","notFoundText","Kh\xf4ng c\xf3 d\u1eef li\u1ec7u ph\xf9 h\u1ee3p.",3,"data","searchKeyword","itemTemplate","minQueryLength","notFoundTemplate","selected","inputChanged"],["itemTemplate",""],["notFoundTemplate",""],["id","setup-tool",4,"ngIf"],["id","device-group",4,"ngIf"],["id","layer",4,"ngIf"],[2,"font-size","0.8em","padding","8px",3,"innerHTML"],[2,"font-size","0.8em",3,"innerHTML"],["id","setup-tool"],["divSetup",""],[3,"readyDownloadSettingToLed","closeEvent","searchEvent","reqDownloadEvent"],["id","device-group"],["divGroup",""],[3,"DeviceIns","closeEvent"],["id","layer"],["divLayer",""],[3,"closeEvent","layerChange"],[1,"flex","align-items-center","justify-content-center"],["severity","error"],["pTemplate",""],[1,"flex","align-items-center","justify-content-center","cursor-pointer"],["pRipple","",1,"flex","align-items-center","justify-content-center","w-full","h-4rem","max-w-20rem","bg-blue-500","border-round-md","shadow-8","text-white","font-bold",3,"click"],[1,"fa-solid","fa-home"],[1,"text-center","text-xl","mx-2"],[1,"pi","pi-times-circle"],[1,"ml-2"]],template:function(t,i){if(1&t&&(e.YNc(0,zt,12,8,"div",0),e.YNc(1,ei,8,0,"ng-template",null,1,e.W1O)),2&t){const n=e.MAs(2);e.Q6J("ngIf",i.permission.device.self)("ngIfElse",n)}},directives:[_.O5,ft.YR,Nt,Ht,Ut.F,Bt.V,x.jx,M.H],styles:["#editor-map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;width:100%;z-index:210}#search[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:300px;z-index:212;padding:2px}#setup-tool[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:220;background-color:#fff}#device-group[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:222;background-color:#fff}#layer[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;z-index:233;background-color:#fff}"]}),o})()}];let ii=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[b.Bz.forChild(ti)],b.Bz]}),o})();var ni=d(4695);let oi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[_.ez,ii,ni.m]]}),o})()},7156:(L,w,d)=>{d(4950)},4950:(L,w,d)=>{var b,f;b=[d(8407)],void 0!==(f=function(e){var E=function(){return!0};e.Map.SelectArea=e.Map.BoxZoom.extend({statics:{AREA_SELECTED:"areaselected",AREA_SELECT_START:"areaselectstart",AREA_SELECTION_TOGGLED:"areaselecttoggled"},options:{shiftKey:!1,ctrlKey:!0,validate:E,autoDisable:!1,cursor:"crosshair"},initialize:function(p,g){e.Util.setOptions(this,g||{}),e.Map.BoxZoom.prototype.initialize.call(this,p),this._validate=null,this._moved=!1,this._autoDisable=!this.options.ctrlKey&&this.options.autoDisable,this._lastLayerPoint=null,this._beforeCursor=null,this.setValidate(this.options.validate),this.setAutoDisable(this.options.autoDisable)},setValidate:function(p){var g=this;return"function"!=typeof p&&(p=E),this._validate=function(h){return p.call(g,h)},this},setAutoDisable:function(p){this._autoDisable=!!p},setControlKey:function(p){var g=this._enabled;g&&this.disable(),this.options.ctrlKey=!!p,p&&(this.options.shiftKey=!1),g&&this.enable()},setShiftKey:function(p){var g=this._enabled;g&&this.disable(),this.options.shiftKey=!!p,p&&(this.options.ctrlKey=!1),g&&this.enable()},enable:function(p,g){this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.disable():this.options.ctrlKey||this._map.dragging.disable(),e.Map.BoxZoom.prototype.enable.call(this),this.options.ctrlKey||this._setCursor(),p&&this.setValidate(p),this.setAutoDisable(g),this._map.fire(e.Map.SelectArea.AREA_SELECTION_TOGGLED)},disable:function(){e.Map.BoxZoom.prototype.disable.call(this),this.options.ctrlKey||this._restoreCursor(),this.options.shiftKey?this._map.boxZoom&&this._map.boxZoom.enable():this._map.dragging.enable(),this._map.fire(e.Map.SelectArea.AREA_SELECTION_TOGGLED)},addHooks:function(){e.Map.BoxZoom.prototype.addHooks.call(this),e.DomEvent.on(document,"keyup",this._onKeyUp,this).on(document,"keydown",this._onKeyPress,this).on(document,"contextmenu",this._onMouseDown,this).on(window,"blur",this._onBlur,this),this._map.on("dragstart",this._onMouseDown,this)},removeHooks:function(){e.Map.BoxZoom.prototype.removeHooks.call(this),e.DomEvent.off(document,"keyup",this._onKeyUp,this).off(document,"keydown",this._onKeyPress,this).off(document,"contextmenu",this._onMouseDown,this).off(window,"blur",this._onBlur,this),this._map.off("dragstart",this._onMouseDown,this)},_onMouseDown:function(p){if(this._moved=!1,this._lastLayerPoint=null,this.options.shiftKey&&!p.shiftKey||this.options.ctrlKey&&!p.ctrlKey||1!==p.which&&1!==p.button)return!1;e.DomEvent.stop(p);var g=this._map.mouseEventToLayerPoint(p);if(!this._validate(g))return!1;e.DomUtil.disableTextSelection(),e.DomUtil.disableImageDrag(),this._startLayerPoint=g,e.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this)},_onMouseMove:function(p){this._moved||(this._box=e.DomUtil.create("div","leaflet-zoom-box",this._pane),e.DomUtil.setPosition(this._box,this._startLayerPoint),this._map.fire(e.Map.SelectArea.AREA_SELECT_START));var g=this._startLayerPoint,h=this._box,D=this._map.mouseEventToLayerPoint(p),O=D.subtract(g);if(this._validate(D)){this._lastLayerPoint=D;var m=new e.Point(Math.min(D.x,g.x),Math.min(D.y,g.y));e.DomUtil.setPosition(h,m),this._moved=!0,h.style.width=Math.max(0,Math.abs(O.x)-4)+"px",h.style.height=Math.max(0,Math.abs(O.y)-4)+"px"}},_onKeyUp:function(p){27===p.keyCode?this._moved&&this._box&&this._finish():this.options.ctrlKey&&(this._restoreCursor(),this._map.dragging.enable())},_onKeyPress:function(p){this.options.ctrlKey&&(p.ctrlKey||"dragstart"===p.type)&&null===this._beforeCursor&&(this._setCursor(),this._map.dragging._draggable._onUp(p),this._map.dragging.disable())},_onBlur:function(p){this._restoreCursor(),this._map.dragging.enable()},_setCursor:function(){this._beforeCursor=this._container.style.cursor,this._container.style.cursor=this.options.cursor},_restoreCursor:function(){this._container.style.cursor=this._beforeCursor,this._beforeCursor=null},_onMouseUp:function(p){this._finish();var g=this._map,h=this._lastLayerPoint;if(h&&!this._startLayerPoint.equals(h)){e.DomEvent.stop(p);var D=new e.LatLngBounds(g.layerPointToLatLng(this._startLayerPoint),g.layerPointToLatLng(h));this._autoDisable?this.disable():this._restoreCursor(),this._moved=!1,e.Util.requestAnimFrame(function(){g.fire(e.Map.SelectArea.AREA_SELECTED,{bounds:D})})}}}),e.Map.mergeOptions({selectArea:!1}),e.Map.addInitHook("addHandler","selectArea",e.Map.SelectArea)}.apply(w,b))&&(L.exports=f)}}]);